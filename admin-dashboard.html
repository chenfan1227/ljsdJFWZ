<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§¯åˆ†å® - ç®¡ç†åå°</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html {
            background: #f5f7fa;
            min-height: 100vh;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f7fa;
            color: #333;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        .admin-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* ä¾§è¾¹æ  */
        .sidebar {
            width: 280px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .logo {
            text-align: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 30px;
        }
        
        .logo h1 {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .logo p {
            opacity: 0.8;
            font-size: 0.9rem;
            color: white;
        }
        
        .admin-info {
            padding: 15px 25px;
            background: rgba(255,255,255,0.1);
            margin: 0 20px 20px 20px;
            border-radius: 10px;
            font-size: 0.9rem;
            color: white;
        }
        
        .menu-item {
            display: block;
            color: white;
            text-decoration: none;
            padding: 15px 25px;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        
        .menu-item:hover {
            background: rgba(255,255,255,0.1);
            color: white;
            border-left-color: #fff;
            text-decoration: none;
        }
        
        .menu-item.active {
            background: rgba(255,255,255,0.15);
            color: white;
            border-left-color: #fff;
        }
        
        .menu-icon {
            display: inline-block;
            width: 20px;
            margin-right: 10px;
            text-align: center;
        }
        
        .logout-btn {
            position: absolute;
            bottom: 20px;
            left: 25px;
            right: 25px;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #4caf50;
            color: white;
        }
        
        .btn-success:hover {
            background: #45a049;
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin-bottom: 15px;
        }
        
        .stat-icon.revenue { background: linear-gradient(135deg, #4caf50, #45a049); }
        .stat-icon.users { background: linear-gradient(135deg, #2196f3, #1976d2); }
        .stat-icon.installs { background: linear-gradient(135deg, #ff9800, #f57c00); }
        .stat-icon.ads { background: linear-gradient(135deg, #9c27b0, #7b1fa2); }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 900;
            color: #333;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .stat-change {
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .stat-change.positive {
            color: #4caf50;
        }
        
        .stat-change.negative {
            color: #f44336;
        }
        
        .positive {
            color: #48bb78;
        }
        
        .negative {
            color: #f56565;
        }
        
        /* ç­›é€‰æ æ ·å¼ */
        .filter-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .filter-group label {
            font-weight: 500;
            color: #4a5568;
        }
        
        .filter-group select {
            padding: 8px 12px;
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            background: white;
            font-size: 0.9rem;
            cursor: pointer;
        }
        
        .filter-actions {
            display: flex;
            gap: 10px;
        }
        
        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
        }
        
        /* è¡¨æ ¼æ ·å¼ */
        .table-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .table-header {
            padding: 20px 25px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
        }
        
        .search-box {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            width: 250px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #555;
            border-bottom: 1px solid #eee;
        }
        
        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-active {
            background: #e8f5e8;
            color: #4caf50;
        }
        
        .status-inactive {
            background: #ffebee;
            color: #f44336;
        }
        
        .status-premium {
            background: #fff3e0;
            color: #ff9800;
        }
        
        /* é¡µé¢åˆ‡æ¢ */
        .page {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .page.active {
            display: block;
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* é”™è¯¯çŠ¶æ€ */
        .error-message {
            background: #ffebee;
            color: #d32f2f;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #d32f2f;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
        }
        
        /* ç§¯åˆ†ç®¡ç†ä¸“ç”¨æ ·å¼ */
        .points-operations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .operation-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .operation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #667eea;
        }
        
        .operation-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px auto;
        }
        
        .operation-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .operation-card p {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .points-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .modal-header h2 {
            color: #333;
            margin: 0;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
            padding: 5px;
        }
        
        .close-btn:hover {
            color: #333;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .user-search-result {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            display: none;
        }
        
        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .user-points {
            font-size: 1.2rem;
            font-weight: bold;
            color: #28a745;
        }
        
        .points-warning {
            color: #dc3545;
            font-size: 0.9rem;
            margin-top: 10px;
            padding: 10px;
            background: #f8d7da;
            border-radius: 5px;
            display: none;
        }
        
        .points-success {
            color: #155724;
            font-size: 0.9rem;
            margin-top: 10px;
            padding: 10px;
            background: #d4edda;
            border-radius: 5px;
            display: none;
        }
        
        .batch-input {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .batch-row {
            display: grid;
            grid-template-columns: 2fr 1fr 2fr auto;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .remove-row {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .add-row {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 15px;
            cursor: pointer;
            margin-top: 10px;
        }
    </style>
        
        <style>
            /* ç°ä»£åŒ–ä¸»é¢˜ç³»ç»Ÿ */
            :root {
                /* ç°ä»£æ¸å˜è‰²è°ƒ */
                --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
                --accent-gradient: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
                
                /* åœ†è§’ç³»ç»Ÿ */
                --radius-xs: 4px;
                --radius-sm: 8px;
                --radius-md: 16px;
                --radius-lg: 24px;
                --radius-xl: 32px;
                
                /* ç°ä»£é˜´å½±ç³»ç»Ÿ */
                --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
                --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
                --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
                --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
                --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
                --shadow-glow: 0 0 0 1px rgba(99, 102, 241, 0.05), 0 1px 3px 0 rgba(0, 0, 0, 0.1);
                
                /* å“ç‰Œè‰²ç³» */
                --brand: #667eea;
                --brand-2: #764ba2;
                --brand-light: #eef2ff;
                --accent: #f093fb;
                --accent-light: #fdf2ff;
                
                /* è¯­ä¹‰è‰²å½© */
                --success: #10b981;
                --success-light: #ecfdf5;
                --warning: #f59e0b;
                --warning-light: #fffbeb;
                --error: #ef4444;
                --error-light: #fef2f2;
                --info: #3b82f6;
                --info-light: #eff6ff;
                
                /* æ–‡å­—è‰²ç³» */
                --text-1: #111827;
                --text-2: #374151;
                --text-3: #6b7280;
                --text-4: #9ca3af;
                
                /* èƒŒæ™¯è‰²ç³» */
                --bg-1: #ffffff;
                --bg-2: #f9fafb;
                --bg-3: #f3f4f6;
                --bg-4: #e5e7eb;
                
                /* è¾¹æ¡†è‰²ç³» */
                --line: #e5e7eb;
                --line-light: #f3f4f6;
                --line-dark: #d1d5db;
                
                /* è¿‡æ¸¡åŠ¨ç”» */
                --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
                --transition-bounce: 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            }
            body {
                letter-spacing: 0.2px !important;
                color: var(--text-1) !important;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                background-attachment: fixed !important;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
                font-weight: 400 !important;
                line-height: 1.5 !important;
                margin: 0 !important;
                padding: 0 !important;
                min-height: 100vh !important;
            }
            
            /* ä¸»å†…å®¹åŒºåŸŸç°ä»£åŒ– */
            .main-content {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(20px);
                border-radius: var(--radius-lg);
                margin: var(--radius-md);
                box-shadow: var(--shadow-xl);
            }
            /* ç°ä»£åŒ–æŒ‰é’®æ ·å¼ */
            .btn, .modern-btn, .premium-btn {
                border-radius: var(--radius-md) !important;
                box-shadow: var(--shadow-sm);
                border: none;
                font-weight: 500;
                transition: all var(--transition);
                position: relative;
                overflow: hidden;
            }
            
            .btn-primary {
                background: var(--primary-gradient) !important;
                border: none !important;
                color: white !important;
            }
            
            .btn-success {
                background: var(--success-gradient) !important;
                border: none !important;
                color: white !important;
            }
            
            .btn-warning {
                background: var(--warning-gradient) !important;
                border: none !important;
                color: white !important;
            }
            
            .btn:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-lg);
            }
            
            /* ç°ä»£åŒ–å®¹å™¨æ ·å¼ */
            .table-container, .chart-container, .admob-card, .settings-card, .dashboard-card, .premium-action-panel {
                border-radius: var(--radius-lg) !important;
                box-shadow: var(--shadow-md);
                border: 1px solid var(--line-light);
                background: var(--bg-1);
                transition: all var(--transition);
            }
            
            .table-container:hover, .chart-container:hover, .admob-card:hover, .settings-card:hover, .dashboard-card:hover {
                box-shadow: var(--shadow-lg);
                transform: translateY(-2px);
            }
            
            /* ç»Ÿè®¡å¡ç‰‡ç°ä»£åŒ– */
            .stat-card, .premium-stat-card {
                border-radius: var(--radius-xl) !important;
                background: var(--bg-1);
                box-shadow: var(--shadow-md);
                border: 1px solid var(--line-light);
                transition: all var(--transition);
                position: relative;
                overflow: hidden;
            }
            
            .stat-card:hover, .premium-stat-card:hover {
                transform: translateY(-4px);
                box-shadow: var(--shadow-xl);
            }
            
            /* æ¸å˜èƒŒæ™¯è£…é¥° */
            .stat-card::before, .premium-stat-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: var(--primary-gradient);
                opacity: 0;
                transition: opacity var(--transition);
            }
            
            .stat-card:hover::before, .premium-stat-card:hover::before {
                opacity: 1;
            }
            /* ç°ä»£åŒ–è¡¨å•å…ƒç´  */
            input, select, textarea {
                border-radius: var(--radius-md) !important;
                border: 2px solid var(--line-light);
                padding: 12px 16px;
                font-size: 14px;
                transition: all var(--transition);
                background: var(--bg-1);
                color: var(--text-1);
            }
            
            input:focus, select:focus, textarea:focus {
                outline: none;
                border-color: var(--brand);
                box-shadow: var(--shadow-glow);
                transform: translateY(-1px);
            }
            
            /* è¡¨æ ¼ç°ä»£åŒ– */
            .table {
                border-radius: var(--radius-lg);
                overflow: hidden;
                box-shadow: var(--shadow-sm);
                border: none;
            }
            
            .table th {
                background: var(--bg-2);
                border: none;
                font-weight: 600;
                color: var(--text-2);
                padding: 16px 20px;
            }
            
            .table td {
                border: none;
                padding: 16px 20px;
                border-bottom: 1px solid var(--line-light);
                transition: background-color var(--transition);
            }
            
            .table tr:hover td {
                background: var(--bg-2);
            }
            /* ç»Ÿä¸€æŒ‰é’®é…è‰²æ›´è½»é‡ */
            .btn.btn-primary, .modern-btn.primary, .premium-btn.primary { background: linear-gradient(135deg,var(--brand) 0%, var(--brand-2) 100%); }
            .btn.btn-success, .modern-btn.success { background: #16a34a; }
            .btn.btn-secondary, .modern-btn.secondary, .premium-btn.secondary { background: #eef2ff; color: #374151; border: 1px solid #e5e7eb; }
            .btn:hover, .modern-btn:hover, .premium-btn:hover { filter: brightness(1.02); transform: translateY(-1px); }
            
            /* éª¨æ¶å±æ ·å¼ */
            .skeleton { animation: pulse 1.3s ease-in-out infinite; background: linear-gradient(90deg,#f2f3f7 25%, #e6e8ee 37%, #f2f3f7 63%); background-size: 400% 100%; border-radius: var(--radius-sm); }
            .skeleton-card { background: var(--bg-1); border: 1px solid var(--line); border-radius: var(--radius-md); padding: 20px; box-shadow: var(--shadow-sm); }
            .skeleton-line { height: 12px; margin: 8px 0; }
            .skeleton-btn { height: 36px; width: 120px; }
            .skeleton-chip { height: 24px; width: 80px; border-radius: 999px; }
            .skeleton-icon { width: 48px; height: 48px; border-radius: var(--radius-md); }
            .skeleton-grid { display: grid; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); gap: 16px; }
            @keyframes pulse { 0%{background-position:100% 50%} 100%{background-position:0 50%} }
        </style>
        <!-- ç°ä»£åŒ–UIå¢å¼ºæ ·å¼ -->
        <style>
            /* === ç°ä»£åŒ–ç»„ä»¶æ ·å¼è¦†ç›– === */
            
            /* x_panel ç°ä»£åŒ– */
            .x_panel {
                background: rgba(255, 255, 255, 0.95) !important;
                backdrop-filter: blur(10px);
                border: 1px solid var(--line-light) !important;
                border-radius: var(--radius-lg) !important;
                box-shadow: var(--shadow-md) !important;
                margin-bottom: 32px !important;
                overflow: hidden;
                transition: all var(--transition);
                position: relative;
            }
            
            .x_panel::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 3px;
                background: var(--primary-gradient);
                opacity: 0;
                transition: opacity var(--transition);
            }
            
            .x_panel:hover {
                box-shadow: var(--shadow-lg) !important;
                transform: translateY(-4px);
            }
            
            .x_panel:hover::before {
                opacity: 1;
            }
            
            /* é¢æ¿æ ‡é¢˜ç°ä»£åŒ– */
            .x_title h2 {
                color: var(--text-1) !important;
                font-weight: 600 !important;
                font-size: 20px !important;
                margin: 0 !important;
                padding: 20px 24px !important;
                border-bottom: 2px solid var(--line-light) !important;
                background: var(--bg-2) !important;
            }
            
            .x_content {
                padding: 24px !important;
            }
            
            /* page-title ç°ä»£åŒ– */
            .page-title h3 {
                color: var(--text-1) !important;
                font-weight: 700 !important;
                font-size: 28px !important;
                margin-bottom: 8px !important;
                background: var(--primary-gradient);
                background-clip: text;
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
            }
            
            .page-title p {
                color: var(--text-3) !important;
                font-size: 16px !important;
                margin: 0 !important;
            }
            
            /* tile ç»Ÿè®¡å¡ç‰‡ç°ä»£åŒ– */
            .tile {
                background: rgba(255, 255, 255, 0.95) !important;
                backdrop-filter: blur(10px);
                border: 1px solid var(--line-light) !important;
                border-radius: var(--radius-xl) !important;
                box-shadow: var(--shadow-md) !important;
                transition: all var(--transition);
                position: relative;
                overflow: hidden;
            }
            
            .tile::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: var(--success-gradient);
                opacity: 0.8;
            }
            
            .tile:hover {
                box-shadow: var(--shadow-xl) !important;
                transform: translateY(-6px);
            }
            
            /* count æ•°å­—æ ·å¼ç°ä»£åŒ– */
            .count {
                font-size: 42px !important;
                font-weight: 700 !important;
                color: var(--text-1) !important;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            
            /* è¡¨æ ¼ç°ä»£åŒ–å¢å¼º */
            .jambo_table {
                border-radius: var(--radius-lg) !important;
                overflow: hidden;
                box-shadow: var(--shadow-sm) !important;
                border: none !important;
            }
            
            .jambo_table thead th {
                background: var(--primary-gradient) !important;
                color: white !important;
                border: none !important;
                font-weight: 600 !important;
                padding: 20px !important;
                font-size: 14px !important;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            
            .jambo_table tbody td {
                border: none !important;
                padding: 20px !important;
                border-bottom: 1px solid var(--line-light) !important;
                transition: background-color var(--transition);
                color: var(--text-2) !important;
            }
            
            .jambo_table tbody tr:hover td {
                background: var(--bg-2) !important;
            }
            
            /* è¡¨å•æ§ä»¶ç°ä»£åŒ–å¢å¼º */
            .form-control {
                border: 2px solid var(--line-light) !important;
                border-radius: var(--radius-md) !important;
                padding: 12px 16px !important;
                font-size: 14px !important;
                transition: all var(--transition);
                background: var(--bg-1) !important;
                color: var(--text-1) !important;
            }
            
            .form-control:focus {
                outline: none !important;
                border-color: var(--brand) !important;
                box-shadow: var(--shadow-glow) !important;
                transform: translateY(-1px);
            }
            
            /* ç°ä»£åŒ–æŒ‰é’®å¢å¼º */
            .btn-outline-primary {
                background: transparent !important;
                border: 2px solid var(--brand) !important;
                color: var(--brand) !important;
            }
            
            .btn-outline-primary:hover {
                background: var(--primary-gradient) !important;
                color: white !important;
                transform: translateY(-2px);
            }
            
            /* å¼€å…³æŒ‰é’®ç°ä»£åŒ– */
            .switch {
                position: relative;
                display: inline-block;
                width: 52px;
                height: 28px;
            }
            
            .switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }
            
            .slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: var(--line);
                transition: var(--transition);
                border-radius: 28px;
            }
            
            .slider:before {
                position: absolute;
                content: "";
                height: 22px;
                width: 22px;
                left: 3px;
                bottom: 3px;
                background-color: white;
                transition: var(--transition);
                border-radius: 50%;
                box-shadow: var(--shadow-sm);
            }
            
            input:checked + .slider {
                background: var(--primary-gradient);
            }
            
            input:checked + .slider:before {
                transform: translateX(24px);
            }
            
            /* ä¾§è¾¹æ ä¿æŒç®€æ´ */
            .sidebar {
                width: 280px !important;
            }
            
            /* ç®€åŒ–èƒŒæ™¯æ ·å¼ */
            html, body {
                background: #f5f7fa !important;
            }
            
            .main-content {
                margin-left: 280px !important;
            }
            
        </style>
    </head>
    <body>
    <div class="admin-container">
        <!-- ä¾§è¾¹æ  -->
        <nav class="sidebar">
            <div class="logo">
                <h1>ğŸ’ ç§¯åˆ†å®</h1>
                <p>ç®¡ç†åå°</p>
            </div>
            
            <div class="admin-info" id="adminInfo">
                <div>ğŸ›¡ï¸ <span id="adminName">åŠ è½½ä¸­...</span></div>
                <div style="opacity: 0.7; font-size: 0.8rem;">æƒé™: <span id="adminRole">-</span></div>
                <div id="adminFixHint" style="display:none; margin-top:6px;">
                    <button class="btn btn-primary" style="padding:6px 10px; font-size:12px;" onclick="openUltimateFix()">ä¿®å¤è®¤è¯</button>
                </div>
            </div>
            
            <a href="#" class="menu-item active" onclick="showPage('dashboard')">
                <span class="menu-icon">ğŸ“Š</span>
                æ•°æ®æ¦‚è§ˆ
            </a>
            
            <a href="#" class="menu-item" onclick="showPage('admob')">
                <span class="menu-icon">ğŸ“±</span>
                AdMobæ”¶ç›Š
            </a>
            
            <a href="#" class="menu-item" onclick="showPage('users')">
                <span class="menu-icon">ğŸ‘¥</span>
                ç”¨æˆ·ç®¡ç†
            </a>
            
            <a href="#" class="menu-item" onclick="showPage('points')" id="pointsMenuItem" style="display: none;">
                <span class="menu-icon">ğŸ’</span>
                ç§¯åˆ†ç®¡ç†
            </a>
            
            <a href="#" class="menu-item" onclick="showPage('revenue')">
                <span class="menu-icon">ğŸ’°</span>
                æ”¶ç›ŠæŠ¥å‘Š
            </a>
            
            <a href="#" class="menu-item" onclick="showPage('analytics')">
                <span class="menu-icon">ğŸ“ˆ</span>
                æ•°æ®åˆ†æ
            </a>
            
            <a href="#" class="menu-item" onclick="showPage('pointsConfig')">
                <span class="menu-icon">ğŸ¯</span>
                ç§¯åˆ†é…ç½®
            </a>
            
            <a href="#" class="menu-item" onclick="showPage('admobConfig')">
                <span class="menu-icon">ğŸ“±</span>
                å¹¿å‘Šé…ç½®
            </a>
            
            <a href="#" class="menu-item" onclick="showPage('settings')">
                <span class="menu-icon">âš™ï¸</span>
                ç³»ç»Ÿè®¾ç½®
            </a>
            
            <button class="logout-btn" onclick="logout()">
                ğŸšª é€€å‡ºç™»å½•
            </button>
        </nav>
        
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <!-- æ•°æ®æ¦‚è§ˆé¡µé¢ -->
            <div id="dashboard" class="page active">
                <div class="header">
                    <h1>ğŸ“Š æ•°æ®æ¦‚è§ˆ</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="refreshData()">åˆ·æ–°æ•°æ®</button>
                        <button class="btn btn-success" onclick="exportReport()">å¯¼å‡ºæŠ¥å‘Š</button>
                    </div>
                </div>
                
                <!-- ç»Ÿè®¡å¡ç‰‡ -->
                <div class="stats-grid" id="statsGrid">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>æ­£åœ¨åŠ è½½æ•°æ®...</div>
                    </div>
                </div>
                
                <!-- æ”¶ç›Šè¶‹åŠ¿å›¾ -->
                <div class="chart-container">
                    <div class="chart-header">
                        <h2 class="chart-title">æ”¶ç›Šè¶‹åŠ¿</h2>
                    </div>
                    <canvas id="revenueChart" width="400" height="200"></canvas>
                </div>
            </div>
            
            <!-- AdMobæ”¶ç›Šé¡µé¢ -->
            <div id="admob" class="page">
                <div class="header">
                    <h1>ğŸ“± AdMob æ”¶ç›Šåˆ†æ</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="syncAdMobData()">åŒæ­¥AdMobæ•°æ®</button>
                    </div>
                </div>
                
                <div id="admobContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>æ­£åœ¨åŠ è½½AdMobæ•°æ®...</div>
                    </div>
                </div>
            </div>
            
            <!-- ç”¨æˆ·ç®¡ç†é¡µé¢ -->
            <div id="users" class="page">
                <div class="header">
                    <h1>ğŸ‘¥ ç”¨æˆ·ç®¡ç†</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="addUser()">æ·»åŠ ç”¨æˆ·</button>
                        <button class="btn btn-success" onclick="exportUsers()">å¯¼å‡ºç”¨æˆ·</button>
                    </div>
                </div>
                
                <div id="usersContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>æ­£åœ¨åŠ è½½ç”¨æˆ·æ•°æ®...</div>
                    </div>
                </div>
            </div>
            
            <!-- æ”¶ç›ŠæŠ¥å‘Šé¡µé¢ -->
            <div id="revenue" class="page">
                <div class="header">
                    <h1>ğŸ’° æ”¶ç›ŠæŠ¥å‘Š</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="generateReport()">ç”ŸæˆæŠ¥å‘Š</button>
                    </div>
                </div>
                
                <div id="revenueContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>æ­£åœ¨åŠ è½½æ”¶ç›Šæ•°æ®...</div>
                    </div>
                </div>
            </div>
            
            <!-- ç§¯åˆ†ç®¡ç†é¡µé¢ (ä»…è¶…çº§ç®¡ç†å‘˜) -->
            <div id="points" class="page">
                <div class="header">
                    <h1>ğŸ’ ç§¯åˆ†ç®¡ç†ç³»ç»Ÿ</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="refreshPointsData()">åˆ·æ–°æ•°æ®</button>
                        <button class="btn btn-success" onclick="showPointsAdjustModal()">è°ƒæ•´ç§¯åˆ†</button>
                        <button class="btn btn-info" onclick="exportPointsReport()">å¯¼å‡ºæŠ¥å‘Š</button>
                    </div>
                </div>

                <!-- ç§¯åˆ†æ¦‚è§ˆç»Ÿè®¡ -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <h3>æ€»ç§¯åˆ†æ± </h3>
                        <div class="metric-value" id="totalPointsPool">-</div>
                        <div class="metric-trend">
                            <span class="trend-icon">ğŸ’</span>
                            <span>å…¨å¹³å°ç§¯åˆ†æ€»å’Œ</span>
                        </div>
                    </div>
                    <div class="metric-card">
                        <h3>ä»Šæ—¥ç§¯åˆ†å‘æ”¾</h3>
                        <div class="metric-value" id="todayPointsEarned">-</div>
                        <div class="metric-trend">
                            <span class="trend-icon">â¬†ï¸</span>
                            <span>ç”¨æˆ·ä»Šæ—¥è·å¾—ç§¯åˆ†</span>
                        </div>
                    </div>
                    <div class="metric-card">
                        <h3>ä»Šæ—¥ç§¯åˆ†æ¶ˆè€—</h3>
                        <div class="metric-value" id="todayPointsSpent">-</div>
                        <div class="metric-trend">
                            <span class="trend-icon">â¬‡ï¸</span>
                            <span>ç”¨æˆ·ä»Šæ—¥æ¶ˆè´¹ç§¯åˆ†</span>
                        </div>
                    </div>
                    <div class="metric-card">
                        <h3>å¯Œè±ªç”¨æˆ·</h3>
                        <div class="metric-value" id="richUsers">-</div>
                        <div class="metric-trend">
                            <span class="trend-icon">ğŸ‘‘</span>
                            <span>ç§¯åˆ†>10ä¸‡çš„ç”¨æˆ·</span>
                        </div>
                    </div>
                </div>

                <!-- ç§¯åˆ†æ“ä½œé¢æ¿ -->
                <div class="section">
                    <h2>ğŸ’° ç§¯åˆ†æ“ä½œé¢æ¿</h2>
                    <div class="points-operations">
                        <div class="operation-card" onclick="showUserPointsSearch()">
                            <div class="operation-icon">ğŸ”</div>
                            <h3>æŸ¥çœ‹ç”¨æˆ·ç§¯åˆ†</h3>
                            <p>æŸ¥çœ‹ä»»æ„ç”¨æˆ·çš„ç§¯åˆ†è¯¦æƒ…å’Œå†å²è®°å½•</p>
                        </div>
                        <div class="operation-card" onclick="showPointsAdjustModal()">
                            <div class="operation-icon">âš–ï¸</div>
                            <h3>è°ƒæ•´ç”¨æˆ·ç§¯åˆ†</h3>
                            <p>æ‰‹åŠ¨å¢åŠ æˆ–å‡å°‘ç”¨æˆ·ç§¯åˆ†ä½™é¢</p>
                        </div>
                        <div class="operation-card" onclick="showBatchAdjustModal()">
                            <div class="operation-icon">ğŸ“</div>
                            <h3>æ‰¹é‡ç§¯åˆ†è°ƒæ•´</h3>
                            <p>æ‰¹é‡è°ƒæ•´å¤šä¸ªç”¨æˆ·çš„ç§¯åˆ†</p>
                        </div>
                        <div class="operation-card" onclick="showPointsAnalytics()">
                            <div class="operation-icon">ğŸ“Š</div>
                            <h3>ç§¯åˆ†æ•°æ®åˆ†æ</h3>
                            <p>åˆ†æç§¯åˆ†æµåŠ¨å’Œç”¨æˆ·è¡Œä¸º</p>
                        </div>
                    </div>
                </div>

                <!-- ç§¯åˆ†äº¤æ˜“è®°å½• -->
                <div class="section">
                    <h2>ğŸ“‹ æœ€è¿‘ç§¯åˆ†äº¤æ˜“</h2>
                    <div class="table-container">
                        <table id="pointsTransactionsTable">
                            <thead>
                                <tr>
                                    <th>æ—¶é—´</th>
                                    <th>ç”¨æˆ·</th>
                                    <th>ç±»å‹</th>
                                    <th>ç§¯åˆ†å˜åŠ¨</th>
                                    <th>ä½™é¢</th>
                                    <th>è¯´æ˜</th>
                                    <th>æ“ä½œå‘˜</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 40px; color: #999;">
                                        æ­£åœ¨åŠ è½½ç§¯åˆ†äº¤æ˜“æ•°æ®...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ç§¯åˆ†ç±»å‹ç»Ÿè®¡ -->
                <div class="section">
                    <h2>ğŸ“ˆ ç§¯åˆ†ç±»å‹åˆ†æ</h2>
                    <div class="chart-grid">
                        <div class="chart-card">
                            <h3>ç§¯åˆ†è·å¾—é€”å¾„</h3>
                            <canvas id="pointsEarnChart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>ç§¯åˆ†æ¶ˆè´¹ç±»å‹</h3>
                            <canvas id="pointsSpendChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ•°æ®åˆ†æé¡µé¢ -->
            <div id="analytics" class="page">
                <div class="header">
                    <h1>ğŸ“ˆ æ•°æ®åˆ†æ</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="loadAnalyticsData()">åˆ·æ–°æ•°æ®</button>
                        <button class="btn btn-success" onclick="exportAnalyticsReport()">å¯¼å‡ºåˆ†ææŠ¥å‘Š</button>
                    </div>
                </div>
                
                <div id="analyticsContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>æ­£åœ¨åŠ è½½åˆ†ææ•°æ®...</div>
                    </div>
                </div>
            </div>
            
            <!-- ç§¯åˆ†é…ç½®é¡µé¢ -->
            <div id="pointsConfig" class="page">
                <div class="header">
                    <h1>ğŸ¯ ç§¯åˆ†é…ç½®ç®¡ç†</h1>
                    <p>é…ç½®å„ç§ç§¯åˆ†è·å–æ–¹å¼çš„æ•°å€¼å’Œè§„åˆ™</p>
                </div>
                
                <div id="pointsConfigContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>æ­£åœ¨åŠ è½½ç§¯åˆ†é…ç½®...</div>
                    </div>
                </div>
            </div>
            
            <!-- å¹¿å‘Šé…ç½®é¡µé¢ -->
            <div id="admobConfig" class="page">
                <div class="header">
                    <h1>ğŸ“± AdMobå¹¿å‘Šé…ç½®</h1>
                    <p>ç®¡ç†åº”ç”¨å†…å¹¿å‘Šå•å…ƒå’Œæ˜¾ç¤ºç­–ç•¥</p>
                </div>
                
                <div id="admobConfigContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>æ­£åœ¨åŠ è½½å¹¿å‘Šé…ç½®...</div>
                    </div>
                </div>
            </div>

            <!-- ç³»ç»Ÿè®¾ç½®é¡µé¢ -->
            <div id="settings" class="page">
                <div class="header">
                    <h1>âš™ï¸ ç³»ç»Ÿè®¾ç½®</h1>
                </div>
                
                <div id="settingsContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>æ­£åœ¨åŠ è½½ç³»ç»Ÿé…ç½®...</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // APIé…ç½®
        const API_BASE_URL = 'http://192.168.1.29:3001/api';
        let authToken = null;
        let adminData = null;
        
        // è®¤è¯ç›¸å…³ï¼ˆå…¼å®¹å¤šç§æœ¬åœ°ç»“æ„ï¼‰
        function getAuthToken() {
            const candidateKeys = ['adminAuth', 'admin_auth', 'auth_data', 'session_data'];
            for (const key of candidateKeys) {
                const raw = localStorage.getItem(key) || sessionStorage.getItem(key);
                if (!raw) continue;
                try {
                    const parsed = JSON.parse(raw);
                    if (parsed?.token) return parsed.token;
                    if (parsed?.access_token) return parsed.access_token;
                } catch (_) {}
            }
            return localStorage.getItem('adminToken') || sessionStorage.getItem('adminToken') || null;
        }
        
        function setAuthHeaders() {
            authToken = getAuthToken();
            if (!authToken) {
                const hint = document.getElementById('adminFixHint');
                if (hint) hint.style.display = 'block';
                if (typeof showAuthError === 'function') {
                    showAuthError('æœªè®¤è¯ï¼Œè¯·ç‚¹å‡»â€œä¿®å¤è®¤è¯â€æˆ–å‰å¾€ç³»ç»Ÿè®¾ç½®æ‰§è¡Œä¿®å¤');
                }
                return false;
            }
            return true;
        }
        
        // APIè¯·æ±‚å‡½æ•°
        async function apiRequest(endpoint, options = {}) {
            if (!authToken) {
                authToken = getAuthToken();
                if (!authToken) throw new Error('æœªè®¤è¯');
            }
            
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`,
                    ...options.headers
                },
                ...options
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}${endpoint}`, config);
                const data = await response.json();
                
                if (!response.ok) {
                    if (response.status === 401 || response.status === 403) {
                        if (typeof showAuthError === 'function') {
                            showAuthError('è®¤è¯å¤±æ•ˆï¼Œè¯·ç‚¹å‡»â€œä¿®å¤è®¤è¯â€é‡æ–°è·å–Token');
                        }
                        throw new Error('æœªè®¤è¯');
                    }
                    throw new Error(data.error || `HTTP ${response.status}`);
                }
                
                return data;
            } catch (error) {
                console.error('APIè¯·æ±‚å¤±è´¥:', error);
                throw error;
            }
        }
        
        // åŠ è½½ä»ªè¡¨æ¿æ•°æ®
        async function loadDashboardData() {
            try {
                const data = await apiRequest('/admin/dashboard');
                
                const statsHtml = `
                    <div class="stat-card">
                        <div class="stat-icon revenue">ğŸ’°</div>
                        <div class="stat-value">$${data.data.revenue.today.toFixed(2)}</div>
                        <div class="stat-label">ä»Šæ—¥æ€»æ”¶ç›Š</div>
                        <div class="stat-change positive">â†— +${data.data.revenue.growth}% è¾ƒæ˜¨æ—¥</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon users">ğŸ‘¥</div>
                        <div class="stat-value">${data.data.activeUsers.count.toLocaleString()}</div>
                        <div class="stat-label">æ´»è·ƒç”¨æˆ·</div>
                        <div class="stat-change positive">â†— +${data.data.activeUsers.growth}% è¾ƒæ˜¨æ—¥</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon installs">ğŸ“±</div>
                        <div class="stat-value">${data.data.newUsers.today.toLocaleString()}</div>
                        <div class="stat-label">ä»Šæ—¥æ–°å¢ç”¨æˆ·</div>
                        <div class="stat-change positive">â†— +${data.data.newUsers.growth}% è¾ƒæ˜¨æ—¥</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon ads">ğŸ“º</div>
                        <div class="stat-value">${data.data.adImpressions.today.toLocaleString()}</div>
                        <div class="stat-label">å¹¿å‘Šå±•ç¤ºæ¬¡æ•°</div>
                        <div class="stat-change positive">â†— +${data.data.adImpressions.growth}% è¾ƒæ˜¨æ—¥</div>
                    </div>
                `;
                
                document.getElementById('statsGrid').innerHTML = statsHtml;
                
                // åŠ è½½æ”¶ç›Šè¶‹åŠ¿å›¾
                loadRevenueChart();
                
            } catch (error) {
                console.error('åŠ è½½ä»ªè¡¨æ¿æ•°æ®å¤±è´¥:', error);
                document.getElementById('statsGrid').innerHTML = `
                    <div class="error-message">
                        âš ï¸ åŠ è½½æ•°æ®å¤±è´¥: ${error.message}
                        <br><button onclick="loadDashboardData()" style="margin-top:10px;" class="btn btn-primary">é‡è¯•</button>
                        <br><button onclick="openDataFix()" style="margin-top:5px;" class="btn btn-success">ğŸ”§ æ•°æ®ä¿®å¤å·¥å…·</button>
                    </div>
                `;
            }
        }
        
        // åŠ è½½æ”¶ç›Šè¶‹åŠ¿å›¾
        async function loadRevenueChart() {
            try {
                const data = await apiRequest('/admin/revenue-trend?days=7');
                
                const ctx = document.getElementById('revenueChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.data.map(item => new Date(item.date).toLocaleDateString('zh-CN')),
                        datasets: [{
                            label: 'æ¯æ—¥æ”¶ç›Š ($)',
                            data: data.data.map(item => item.revenue),
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value;
                                    }
                                }
                            }
                        }
                    }
                });
                
            } catch (error) {
                console.error('åŠ è½½æ”¶ç›Šè¶‹åŠ¿å›¾å¤±è´¥:', error);
            }
        }
        
        // é¡µé¢åˆ‡æ¢
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');

            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            if (event && event.target && event.target.classList) event.target.classList.add('active');

            // å¦‚æœæœªè®¤è¯ï¼Œç»™å‡ºå‹å¥½æç¤ºå¹¶é˜»æ­¢åŠ è½½
            if (!setAuthHeaders()) {
                const containerMap = { dashboard: 'statsGrid', admob: 'admobContent', users: 'usersContent', revenue: 'revenueContent' };
                const cid = containerMap[pageId];
                if (cid && document.getElementById(cid)) {
                    document.getElementById(cid).innerHTML = `
                        <div class="error-message">âš ï¸ æœªè®¤è¯ï¼Œæ— æ³•åŠ è½½æ•°æ®ã€‚
                        <br><button class="btn btn-primary" style="margin-top:10px;" onclick="openUltimateFix()">ä¿®å¤è®¤è¯</button></div>`;
                }
                return;
            }

            if (pageId === 'dashboard') {
                loadDashboardData();
            } else if (pageId === 'admob') {
                loadAdMobData();
            } else if (pageId === 'users') {
                loadUsersData();
            } else if (pageId === 'revenue') {
                loadRevenueData();
            } else if (pageId === 'points') {
                loadPointsOverview();
            } else if (pageId === 'analytics') {
                loadAnalyticsData();
            } else if (pageId === 'pointsConfig') {
                loadPointsConfigData();
            } else if (pageId === 'admobConfig') {
                loadAdMobConfigData();
            } else if (pageId === 'settings') {
                loadSettingsData();
            }
        }
        
        // åŠ è½½AdMobæ•°æ®
        async function loadAdMobData() {
            try {
                const data = await apiRequest('/admin/admob/revenue');
                
                const admobHtml = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon revenue">ğŸ’µ</div>
                            <div class="stat-value">$${data.data.totalRevenue.toFixed(2)}</div>
                            <div class="stat-label">ä»Šæ—¥AdMobæ”¶ç›Š</div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">å¹¿å‘Šå•å…ƒè¯¦ç»†æ•°æ®</h3>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>å¹¿å‘Šå•å…ƒID</th>
                                    <th>å¹¿å‘Šç±»å‹</th>
                                    <th>å±•ç¤ºæ¬¡æ•°</th>
                                    <th>ç‚¹å‡»æ¬¡æ•°</th>
                                    <th>æ”¶ç›Š</th>
                                    <th>eCPM</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.data.adUnits.map(unit => `
                                    <tr>
                                        <td>${unit.ad_unit_id}</td>
                                        <td>${unit.ad_type}</td>
                                        <td>${unit.impressions.toLocaleString()}</td>
                                        <td>${unit.clicks.toLocaleString()}</td>
                                        <td>$${unit.revenue.toFixed(2)}</td>
                                        <td>$${unit.ecpm.toFixed(2)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                
                document.getElementById('admobContent').innerHTML = admobHtml;
                
            } catch (error) {
                console.error('åŠ è½½AdMobæ•°æ®å¤±è´¥:', error);
                document.getElementById('admobContent').innerHTML = `
                    <div class="error-message">
                        âš ï¸ åŠ è½½AdMobæ•°æ®å¤±è´¥: ${error.message}
                    </div>
                `;
            }
        }
        
        // åŠ è½½ç”¨æˆ·æ•°æ®
        async function loadUsersData() {
            try {
                const [usersData, statsData] = await Promise.all([
                    apiRequest('/admin/users'),
                    apiRequest('/admin/users/stats')
                ]);
                
                const usersHtml = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon users">ğŸ‘¥</div>
                            <div class="stat-value">${statsData.data.total_users.toLocaleString()}</div>
                            <div class="stat-label">æ€»ç”¨æˆ·æ•°</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon revenue">âš¡</div>
                            <div class="stat-value">${statsData.data.active_users.toLocaleString()}</div>
                            <div class="stat-label">æ´»è·ƒç”¨æˆ·</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon installs">ğŸ’</div>
                            <div class="stat-value">${statsData.data.vip_users.toLocaleString()}</div>
                            <div class="stat-label">VIPç”¨æˆ·</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon ads">ğŸ“Š</div>
                            <div class="stat-value">${statsData.data.daily_new_users.toLocaleString()}</div>
                            <div class="stat-label">ä»Šæ—¥æ–°å¢</div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">ç”¨æˆ·åˆ—è¡¨</h3>
                            <input type="text" class="search-box" placeholder="æœç´¢ç”¨æˆ·..." onkeyup="searchUsers(this.value)">
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ç”¨æˆ·ID</th>
                                    <th>ç”¨æˆ·å</th>
                                    <th>é‚®ç®±</th>
                                    <th>ç§¯åˆ†ä½™é¢</th>
                                    <th>ä¼šå‘˜ç­‰çº§</th>
                                    <th>çŠ¶æ€</th>
                                    <th>æ³¨å†Œæ—¶é—´</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${usersData.data.users.map(user => `
                                    <tr>
                                        <td>${user.user_id}</td>
                                        <td>${user.username || '-'}</td>
                                        <td>${user.email || '-'}</td>
                                        <td>${parseInt(user.points_balance).toLocaleString()}</td>
                                        <td><span class="status-badge status-premium">${user.membership_level}</span></td>
                                        <td><span class="status-badge ${user.status === 'active' ? 'status-active' : 'status-inactive'}">${user.status === 'active' ? 'æ´»è·ƒ' : 'éæ´»è·ƒ'}</span></td>
                                        <td>${new Date(user.created_at).toLocaleDateString('zh-CN')}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                
                document.getElementById('usersContent').innerHTML = usersHtml;
                
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:', error);
                document.getElementById('usersContent').innerHTML = `
                    <div class="error-message">
                        âš ï¸ åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥: ${error.message}
                    </div>
                `;
            }
        }
        
        // é€€å‡ºç™»å½•
        function logout() {
            localStorage.removeItem('adminAuth');
            sessionStorage.removeItem('adminAuth');
            window.location.href = 'admin-test.html';
        }
        
        // åˆ·æ–°æ•°æ®
        function refreshData() {
            loadDashboardData();
            alert('ğŸ“Š æ•°æ®å·²åˆ·æ–°ï¼');
        }
        
        // æ£€æŸ¥è®¤è¯çŠ¶æ€
        function checkAuth() {
            const authData = localStorage.getItem('adminAuth') || sessionStorage.getItem('adminAuth');
            
            if (!authData) {
                console.log('âŒ æœªæ‰¾åˆ°è®¤è¯æ•°æ®');
                showAuthError('æœªæ‰¾åˆ°è®¤è¯æ•°æ®ï¼Œè¯·ç‚¹å‡»ä¿®å¤è®¤è¯');
                return false;
            }
            
            try {
                const auth = JSON.parse(authData);
                adminData = auth;

                const user = auth.user || auth.admin || auth;
                const displayName = user.name || user.username || 'ç®¡ç†å‘˜';
                const displayRole = user.role || 'super_admin';

                const nameEl = document.getElementById('adminName');
                const roleEl = document.getElementById('adminRole');
                if (nameEl) nameEl.textContent = displayName;
                if (roleEl) roleEl.textContent = displayRole;

                return true;
            } catch (error) {
                console.error('è§£æè®¤è¯æ•°æ®å¤±è´¥:', error);
                logout();
                return false;
            }
        }
        
        // è·å–ç®¡ç†å‘˜ä¿¡æ¯ï¼ˆç¡®ä¿adminDataå·²åˆå§‹åŒ–ï¼‰
        function getAdminData() {
            if (!adminData) {
                const authData = localStorage.getItem('adminAuth') || sessionStorage.getItem('adminAuth');
                if (authData) {
                    try {
                        adminData = JSON.parse(authData);
                    } catch (error) {
                        console.error('è§£æç®¡ç†å‘˜æ•°æ®å¤±è´¥:', error);
                    }
                }
            }
            return adminData;
        }
        
        // å…¶ä»–åŠŸèƒ½å‡½æ•°
        function syncAdMobData() {
            alert('ğŸ”„ AdMobæ•°æ®åŒæ­¥ä¸­...');
        }
        
        function exportReport() {
            alert('ğŸ“„ æŠ¥å‘Šå·²å¯¼å‡ºï¼');
        }
        
        function addUser() {
            alert('â• æ·»åŠ ç”¨æˆ·åŠŸèƒ½');
        }
        
        function exportUsers() {
            alert('ğŸ“„ ç”¨æˆ·æ•°æ®å·²å¯¼å‡ºï¼');
        }
        
        function generateReport() {
            alert('ğŸ“Š æ­£åœ¨ç”Ÿæˆæ”¶ç›ŠæŠ¥å‘Š...');
        }
        
        function searchUsers(query) {
            // å®ç°ç”¨æˆ·æœç´¢åŠŸèƒ½
            console.log('æœç´¢ç”¨æˆ·:', query);
        }
        
        // åŠ è½½æ”¶ç›ŠæŠ¥å‘Šæ•°æ®
        async function loadRevenueData(period = '30') {
            try {
                const data = await apiRequest(`/admin/revenue/report?period=${period}`);
                
                const revenueHtml = `
                    <!-- æ”¶ç›Šæ¦‚è§ˆå¡ç‰‡ -->
                    <div class="stats-grid" style="margin-bottom: 30px;">
                        <div class="stat-card">
                            <div class="stat-icon revenue">ğŸ’°</div>
                            <div class="stat-value">$${data.data.summary.total_revenue.toFixed(2)}</div>
                            <div class="stat-label">æ€»æ”¶ç›Š (${period}å¤©)</div>
                            <div class="stat-change ${data.data.summary.growth_rate >= 0 ? 'positive' : 'negative'}">
                                ${data.data.summary.growth_rate >= 0 ? 'â†—' : 'â†˜'} ${Math.abs(data.data.summary.growth_rate).toFixed(1)}%
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ“±</div>
                            <div class="stat-value">$${data.data.summary.admob_total.toFixed(2)}</div>
                            <div class="stat-label">AdMobæ”¶ç›Š</div>
                            <div class="stat-change">${((data.data.summary.admob_total / data.data.summary.total_revenue) * 100).toFixed(1)}%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ›’</div>
                            <div class="stat-value">$${data.data.summary.iap_total.toFixed(2)}</div>
                            <div class="stat-label">åº”ç”¨å†…è´­ä¹°</div>
                            <div class="stat-change">${((data.data.summary.iap_total / data.data.summary.total_revenue) * 100).toFixed(1)}%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ“Š</div>
                            <div class="stat-value">$${data.data.summary.avg_daily_revenue.toFixed(2)}</div>
                            <div class="stat-label">æ—¥å‡æ”¶ç›Š</div>
                        </div>
                    </div>
                    
                    <!-- æ—¶é—´èŒƒå›´é€‰æ‹©å™¨ -->
                    <div class="filter-bar" style="margin-bottom: 20px;">
                        <div class="filter-group">
                            <label>æ—¶é—´èŒƒå›´:</label>
                            <select id="revenuePeriodSelect" onchange="loadRevenueData(this.value)">
                                <option value="7" ${period === '7' ? 'selected' : ''}>æœ€è¿‘7å¤©</option>
                                <option value="30" ${period === '30' ? 'selected' : ''}>æœ€è¿‘30å¤©</option>
                                <option value="90" ${period === '90' ? 'selected' : ''}>æœ€è¿‘90å¤©</option>
                            </select>
                        </div>
                        <div class="filter-actions">
                            <button class="btn btn-primary" onclick="exportRevenueReport()">å¯¼å‡ºæŠ¥å‘Š</button>
                        </div>
                    </div>
                    
                    <!-- æ”¶ç›Šè¶‹åŠ¿å›¾ -->
                    <div class="chart-container" style="margin-bottom: 30px;">
                        <div class="chart-header">
                            <h3 class="chart-title">æ”¶ç›Šè¶‹åŠ¿å›¾</h3>
                        </div>
                        <canvas id="revenueLineChart" width="400" height="200"></canvas>
                    </div>
                    
                    <!-- æ”¶ç›Šæ¥æºé¥¼å›¾ -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">æ”¶ç›Šæ¥æºåˆ†å¸ƒ</h3>
                            </div>
                            <canvas id="revenueSourceChart" width="300" height="300"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">åœ°åŒºæ”¶ç›Šåˆ†å¸ƒ</h3>
                            </div>
                            <canvas id="revenueCountryChart" width="300" height="300"></canvas>
                        </div>
                    </div>
                    
                    <!-- è¯¦ç»†æ•°æ®è¡¨æ ¼ -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">æ¯æ—¥æ”¶ç›Šæ˜ç»†</h3>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>æ—¥æœŸ</th>
                                    <th>AdMobæ”¶ç›Š</th>
                                    <th>åº”ç”¨å†…è´­ä¹°</th>
                                    <th>æ€»æ”¶ç›Š</th>
                                    <th>åŒæ¯”å¢é•¿</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.data.daily_data.map((item, index) => {
                                    const prevRevenue = index > 0 ? data.data.daily_data[index - 1].total_revenue : item.total_revenue;
                                    const growth = ((item.total_revenue - prevRevenue) / prevRevenue * 100).toFixed(1);
                                    return `
                                        <tr>
                                            <td>${item.date}</td>
                                            <td>$${item.admob_revenue.toFixed(2)}</td>
                                            <td>$${item.in_app_purchases.toFixed(2)}</td>
                                            <td><strong>$${item.total_revenue.toFixed(2)}</strong></td>
                                            <td class="${growth >= 0 ? 'positive' : 'negative'}">
                                                ${growth >= 0 ? 'â†—' : 'â†˜'} ${Math.abs(growth)}%
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                
                document.getElementById('revenueContent').innerHTML = revenueHtml;
                
                // ç»˜åˆ¶å›¾è¡¨
                drawRevenueCharts(data.data);
                
            } catch (error) {
                console.error('åŠ è½½æ”¶ç›Šæ•°æ®å¤±è´¥:', error);
                document.getElementById('revenueContent').innerHTML = `
                    <div class="error-message">
                        âš ï¸ åŠ è½½æ”¶ç›Šæ•°æ®å¤±è´¥: ${error.message}
                        <br><button onclick="loadRevenueData()" style="margin-top:10px;" class="btn btn-primary">é‡è¯•</button>
                    </div>
                `;
            }
        }
        
        // ç»˜åˆ¶æ”¶ç›Šå›¾è¡¨
        function drawRevenueCharts(data) {
            // æ”¶ç›Šè¶‹åŠ¿å›¾
            const lineCtx = document.getElementById('revenueLineChart').getContext('2d');
            new Chart(lineCtx, {
                type: 'line',
                data: {
                    labels: data.daily_data.map(item => item.date.substring(5)),
                    datasets: [{
                        label: 'AdMobæ”¶ç›Š',
                        data: data.daily_data.map(item => item.admob_revenue),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'åº”ç”¨å†…è´­ä¹°',
                        data: data.daily_data.map(item => item.in_app_purchases),
                        borderColor: '#f093fb',
                        backgroundColor: 'rgba(240, 147, 251, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'æ€»æ”¶ç›Š',
                        data: data.daily_data.map(item => item.total_revenue),
                        borderColor: '#48bb78',
                        backgroundColor: 'rgba(72, 187, 120, 0.1)',
                        tension: 0.4,
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(0);
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': $' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });
            
            // æ”¶ç›Šæ¥æºé¥¼å›¾
            const sourceCtx = document.getElementById('revenueSourceChart').getContext('2d');
            new Chart(sourceCtx, {
                type: 'doughnut',
                data: {
                    labels: data.breakdown.by_source.map(item => item.source),
                    datasets: [{
                        data: data.breakdown.by_source.map(item => item.revenue),
                        backgroundColor: ['#667eea', '#f093fb', '#48bb78', '#ed8936'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed;
                                    const percentage = data.breakdown.by_source[context.dataIndex].percentage;
                                    return context.label + ': $' + value.toFixed(2) + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
            
            // åœ°åŒºæ”¶ç›Šé¥¼å›¾
            const countryCtx = document.getElementById('revenueCountryChart').getContext('2d');
            new Chart(countryCtx, {
                type: 'doughnut',
                data: {
                    labels: data.breakdown.by_country.map(item => item.country),
                    datasets: [{
                        data: data.breakdown.by_country.map(item => item.revenue),
                        backgroundColor: ['#e53e3e', '#3182ce', '#38a169', '#d69e2e'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed;
                                    const percentage = data.breakdown.by_country[context.dataIndex].percentage;
                                    return context.label + ': $' + value.toFixed(2) + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // å¯¼å‡ºæ”¶ç›ŠæŠ¥å‘Š
        function exportRevenueReport() {
            alert('ğŸ“Š æ”¶ç›ŠæŠ¥å‘Šå¯¼å‡ºåŠŸèƒ½å·²è§¦å‘ï¼åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šç”Ÿæˆå¹¶ä¸‹è½½Excel/PDFæŠ¥å‘Šã€‚');
        }
        
        // åŠ è½½æ•°æ®åˆ†ææ•°æ®
        async function loadAnalyticsData(period = '30') {
            try {
                const [overviewData, behaviorData] = await Promise.all([
                    apiRequest(`/admin/analytics/overview?period=${period}`),
                    apiRequest('/admin/analytics/user-behavior')
                ]);
                
                const analyticsHtml = `
                    <!-- å…³é”®æŒ‡æ ‡å¡ç‰‡ -->
                    <div class="stats-grid" style="margin-bottom: 30px;">
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ‘¥</div>
                            <div class="stat-value">${overviewData.data.user_metrics.total_users.toLocaleString()}</div>
                            <div class="stat-label">æ€»ç”¨æˆ·æ•°</div>
                            <div class="stat-change positive">+${overviewData.data.user_metrics.new_users_today} ä»Šæ—¥æ–°å¢</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ“±</div>
                            <div class="stat-value">${overviewData.data.user_metrics.active_users_today.toLocaleString()}</div>
                            <div class="stat-label">ä»Šæ—¥æ´»è·ƒç”¨æˆ·</div>
                            <div class="stat-change">${overviewData.data.user_metrics.avg_retention_rate.toFixed(1)}% ç•™å­˜ç‡</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon revenue">ğŸ’°</div>
                            <div class="stat-value">$${overviewData.data.revenue_metrics.total_revenue.toFixed(2)}</div>
                            <div class="stat-label">æ€»æ”¶ç›Š (${period}å¤©)</div>
                            <div class="stat-change ${overviewData.data.revenue_metrics.revenue_growth >= 0 ? 'positive' : 'negative'}">
                                ${overviewData.data.revenue_metrics.revenue_growth >= 0 ? 'â†—' : 'â†˜'} ${Math.abs(overviewData.data.revenue_metrics.revenue_growth).toFixed(1)}%
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ¯</div>
                            <div class="stat-value">${overviewData.data.activity_metrics.total_sessions.toLocaleString()}</div>
                            <div class="stat-label">æ€»ä¼šè¯æ•°</div>
                            <div class="stat-change">${Math.floor(overviewData.data.activity_metrics.avg_session_time)}s å¹³å‡æ—¶é•¿</div>
                        </div>
                    </div>
                    
                    <!-- æ—¶é—´èŒƒå›´é€‰æ‹© -->
                    <div class="filter-bar" style="margin-bottom: 20px;">
                        <div class="filter-group">
                            <label>åˆ†æå‘¨æœŸ:</label>
                            <select id="analyticsPeriodSelect" onchange="loadAnalyticsData(this.value)">
                                <option value="7" ${period === '7' ? 'selected' : ''}>æœ€è¿‘7å¤©</option>
                                <option value="30" ${period === '30' ? 'selected' : ''}>æœ€è¿‘30å¤©</option>
                                <option value="90" ${period === '90' ? 'selected' : ''}>æœ€è¿‘90å¤©</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- å›¾è¡¨åŒºåŸŸ -->
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 30px;">
                        <!-- ç”¨æˆ·æ´»è·ƒåº¦è¶‹åŠ¿ -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">ç”¨æˆ·æ´»è·ƒåº¦è¶‹åŠ¿</h3>
                            </div>
                            <canvas id="userActivityChart" width="600" height="300"></canvas>
                        </div>
                        
                        <!-- ç”¨æˆ·åˆ†ç¾¤ -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">ç”¨æˆ·åˆ†ç¾¤åˆ†æ</h3>
                            </div>
                            <canvas id="userSegmentChart" width="300" height="300"></canvas>
                        </div>
                    </div>
                    
                    <!-- åŠŸèƒ½ä½¿ç”¨ç‡å’Œè½¬åŒ–æ¼æ–— -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                        <!-- åŠŸèƒ½ä½¿ç”¨ç‡ -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">åŠŸèƒ½ä½¿ç”¨ç‡æ’è¡Œ</h3>
                            </div>
                            <div style="padding: 20px;">
                                ${overviewData.data.top_features.map(feature => `
                                    <div style="margin-bottom: 15px;">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                            <span>${feature.feature}</span>
                                            <span><strong>${feature.usage_rate}%</strong></span>
                                        </div>
                                        <div style="background: #f1f5f9; border-radius: 10px; height: 8px;">
                                            <div style="background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 10px; height: 100%; width: ${feature.usage_rate}%;"></div>
                                        </div>
                                        <div style="font-size: 0.8rem; color: #666; margin-top: 2px;">${feature.user_count.toLocaleString()} ç”¨æˆ·ä½¿ç”¨</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- ç”¨æˆ·è½¬åŒ–æ¼æ–— -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">ç”¨æˆ·è½¬åŒ–æ¼æ–—</h3>
                            </div>
                            <canvas id="conversionFunnelChart" width="400" height="300"></canvas>
                        </div>
                    </div>
                    
                    <!-- ç•™å­˜åˆ†æ -->
                    <div class="chart-container" style="margin-bottom: 30px;">
                        <div class="chart-header">
                            <h3 class="chart-title">ç”¨æˆ·ç•™å­˜åˆ†æ</h3>
                        </div>
                        <canvas id="retentionChart" width="800" height="300"></canvas>
                    </div>
                    
                    <!-- ç”¨æˆ·åˆ†ç¾¤è¯¦ç»†è¡¨æ ¼ -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">ç”¨æˆ·åˆ†ç¾¤è¯¦ç»†æ•°æ®</h3>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ç”¨æˆ·åˆ†ç¾¤</th>
                                    <th>ç”¨æˆ·æ•°é‡</th>
                                    <th>å æ¯”</th>
                                    <th>å¹³å‡æ”¶ç›Š</th>
                                    <th>æ´»è·ƒåº¦</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${behaviorData.data.user_segments.map(segment => `
                                    <tr>
                                        <td><strong>${segment.segment}</strong></td>
                                        <td>${segment.count.toLocaleString()}</td>
                                        <td>${segment.percentage}%</td>
                                        <td>$${segment.avg_revenue.toFixed(2)}</td>
                                        <td>
                                            <div style="background: #f1f5f9; border-radius: 10px; height: 6px; width: 100px;">
                                                <div style="background: #48bb78; border-radius: 10px; height: 100%; width: ${segment.percentage}%;"></div>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                
                document.getElementById('analyticsContent').innerHTML = analyticsHtml;
                
                // ç»˜åˆ¶åˆ†æå›¾è¡¨
                drawAnalyticsCharts(overviewData.data, behaviorData.data);
                
            } catch (error) {
                console.error('åŠ è½½åˆ†ææ•°æ®å¤±è´¥:', error);
                document.getElementById('analyticsContent').innerHTML = `
                    <div class="error-message">
                        âš ï¸ åŠ è½½åˆ†ææ•°æ®å¤±è´¥: ${error.message}
                        <br><button onclick="loadAnalyticsData()" style="margin-top:10px;" class="btn btn-primary">é‡è¯•</button>
                    </div>
                `;
            }
        }
        
        // ç»˜åˆ¶åˆ†æå›¾è¡¨
        function drawAnalyticsCharts(overviewData, behaviorData) {
            // ç”¨æˆ·æ´»è·ƒåº¦è¶‹åŠ¿å›¾
            const activityCtx = document.getElementById('userActivityChart').getContext('2d');
            new Chart(activityCtx, {
                type: 'line',
                data: {
                    labels: overviewData.time_series.users.map(item => item.date.substring(5)),
                    datasets: [{
                        label: 'æ–°å¢ç”¨æˆ·',
                        data: overviewData.time_series.users.map(item => item.new_users),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'æ´»è·ƒç”¨æˆ·',
                        data: overviewData.time_series.users.map(item => item.active_users),
                        borderColor: '#48bb78',
                        backgroundColor: 'rgba(72, 187, 120, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // ç”¨æˆ·åˆ†ç¾¤é¥¼å›¾
            const segmentCtx = document.getElementById('userSegmentChart').getContext('2d');
            new Chart(segmentCtx, {
                type: 'doughnut',
                data: {
                    labels: behaviorData.user_segments.map(item => item.segment),
                    datasets: [{
                        data: behaviorData.user_segments.map(item => item.count),
                        backgroundColor: ['#e53e3e', '#3182ce', '#38a169', '#d69e2e'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const segment = behaviorData.user_segments[context.dataIndex];
                                    return context.label + ': ' + segment.count.toLocaleString() + ' (' + segment.percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
            
            // è½¬åŒ–æ¼æ–—å›¾
            const funnelCtx = document.getElementById('conversionFunnelChart').getContext('2d');
            new Chart(funnelCtx, {
                type: 'bar',
                data: {
                    labels: behaviorData.funnel_analysis.map(item => item.step),
                    datasets: [{
                        label: 'ç”¨æˆ·æ•°',
                        data: behaviorData.funnel_analysis.map(item => item.users),
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: '#667eea',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const funnel = behaviorData.funnel_analysis[context.dataIndex];
                                    return context.dataset.label + ': ' + funnel.users.toLocaleString() + ' (' + funnel.conversion + '%)';
                                }
                            }
                        }
                    }
                }
            });
            
            // ç•™å­˜åˆ†æå›¾
            const retentionCtx = document.getElementById('retentionChart').getContext('2d');
            new Chart(retentionCtx, {
                type: 'line',
                data: {
                    labels: behaviorData.cohort_analysis.retention_by_week.map(item => item.week),
                    datasets: [{
                        label: 'ç•™å­˜ç‡ (%)',
                        data: behaviorData.cohort_analysis.retention_by_week.map(item => item.retention),
                        borderColor: '#f093fb',
                        backgroundColor: 'rgba(240, 147, 251, 0.1)',
                        tension: 0.4,
                        borderWidth: 3,
                        pointBackgroundColor: '#f093fb',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'ç•™å­˜ç‡: ' + context.parsed.y + '%';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // å¯¼å‡ºåˆ†ææŠ¥å‘Š
        function exportAnalyticsReport() {
            alert('ğŸ“ˆ æ•°æ®åˆ†ææŠ¥å‘Šå¯¼å‡ºåŠŸèƒ½å·²è§¦å‘ï¼åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šç”Ÿæˆè¯¦ç»†çš„åˆ†ææŠ¥å‘Šã€‚');
        }
        
        function loadSettingsData() {
            // ç¡®ä¿ç®¡ç†å‘˜æ•°æ®å·²åŠ è½½
            const admin = getAdminData();
            const user = admin?.user || admin?.admin || admin || {};
            const displayName = user.name || user.username || 'æœªçŸ¥';
            const displayRole = user.role || 'æœªçŸ¥';
            const loginTime = admin?.timestamp ? new Date(admin.timestamp).toLocaleString() : 'æœªçŸ¥';
            
            const settingsHTML = `
                <style>
                    .settings-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                        gap: 25px;
                        margin-bottom: 30px;
                    }
                    
                    .settings-card {
                        background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
                        border-radius: 20px;
                        padding: 25px;
                        border: 1px solid rgba(255,255,255,0.1);
                        backdrop-filter: blur(10px);
                        transition: all 0.3s ease;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .settings-card:hover {
                        transform: translateY(-5px);
                        box-shadow: 0 15px 40px rgba(0,0,0,0.1);
                    }
                    
                    .settings-card::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 4px;
                        background: linear-gradient(90deg, #4CAF50, #2196F3, #FF9800, #9C27B0);
                        background-size: 400% 400%;
                        animation: gradientShift 3s ease infinite;
                    }
                    
                    @keyframes gradientShift {
                        0% { background-position: 0% 50%; }
                        50% { background-position: 100% 50%; }
                        100% { background-position: 0% 50%; }
                    }
                    
                    .settings-icon {
                        font-size: 48px;
                        margin-bottom: 15px;
                        display: block;
                        text-align: center;
                        filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
                    }
                    
                    .settings-title {
                        font-size: 20px;
                        font-weight: 700;
                        margin-bottom: 10px;
                        text-align: center;
                        background: linear-gradient(135deg, #333, #666);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                    }
                    
                    .settings-desc {
                        color: #666;
                        text-align: center;
                        margin-bottom: 20px;
                        line-height: 1.5;
                    }
                    
                    .settings-btn {
                        width: 100%;
                        padding: 12px 20px;
                        border: none;
                        border-radius: 12px;
                        font-size: 14px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        position: relative;
                        overflow: hidden;
                        text-transform: uppercase;
                        letter-spacing: 1px;
                    }
                    
                    .btn-auth { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
                    .btn-security { background: linear-gradient(135deg, #f093fb, #f5576c); color: white; }
                    .btn-config { background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; }
                    .btn-data { background: linear-gradient(135deg, #43e97b, #38f9d7); color: white; }
                    
                    .settings-btn:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                    }
                    
                    .quick-actions {
                        background: linear-gradient(135deg, rgba(0,0,0,0.05) 0%, rgba(0,0,0,0.02) 100%);
                        border-radius: 20px;
                        padding: 30px;
                        margin-top: 30px;
                        border: 1px solid rgba(0,0,0,0.05);
                    }
                    
                    .quick-title {
                        font-size: 24px;
                        font-weight: 700;
                        margin-bottom: 20px;
                        text-align: center;
                        background: linear-gradient(135deg, #667eea, #764ba2);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                    }
                    
                    .quick-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                        gap: 15px;
                    }
                    
                    .quick-btn {
                        padding: 15px 20px;
                        border: none;
                        border-radius: 12px;
                        font-size: 14px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }
                    
                    .quick-btn:hover {
                        transform: translateY(-3px);
                        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
                    }
                    
                    .btn-reset { background: linear-gradient(135deg, #ff6b6b, #ee5a24); color: white; }
                    .btn-clear { background: linear-gradient(135deg, #feca57, #ff9ff3); color: white; }
                    .btn-export { background: linear-gradient(135deg, #48dbfb, #0abde3); color: white; }
                    .btn-info { background: linear-gradient(135deg, #1dd1a1, #55a3ff); color: white; }
                    .btn-fix { background: linear-gradient(135deg, #ffecd2, #fcb69f); color: #333; }
                    
                    /* è®¾ç½®è¯¦æƒ…é¡µé¢æ ·å¼ */
                    .settings-detail {
                        max-width: 1000px;
                        margin: 0 auto;
                    }
                    
                    .settings-detail h2 {
                        color: #333;
                        margin-bottom: 30px;
                        font-size: 1.8rem;
                        text-align: center;
                    }
                    
                    .settings-content {
                        background: white;
                        border-radius: 15px;
                        padding: 30px;
                        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
                        margin-bottom: 20px;
                    }
                    
                    .info-grid {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 30px;
                        margin-bottom: 30px;
                    }
                    
                    .info-card {
                        background: #f8f9fa;
                        padding: 20px;
                        border-radius: 12px;
                        border-left: 4px solid #667eea;
                    }
                    
                    .info-card h3 {
                        color: #333;
                        margin-bottom: 20px;
                        font-size: 1.2rem;
                    }
                    
                    .info-item {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 10px 0;
                        border-bottom: 1px solid #e9ecef;
                    }
                    
                    .info-item:last-child {
                        border-bottom: none;
                    }
                    
                    .label {
                        font-weight: 600;
                        color: #495057;
                    }
                    
                    .value {
                        font-family: monospace;
                        padding: 4px 8px;
                        border-radius: 4px;
                        background: white;
                    }
                    
                    .value.success {
                        color: #28a745;
                        background: #d4edda;
                    }
                    
                    .value.error {
                        color: #dc3545;
                        background: #f8d7da;
                    }
                    
                    .action-buttons {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 10px;
                    }
                    
                    .action-buttons .btn {
                        padding: 10px 15px;
                        font-size: 0.9rem;
                    }
                    
                    .token-info {
                        margin-top: 30px;
                    }
                    
                    .token-info h3 {
                        color: #333;
                        margin-bottom: 15px;
                    }
                    
                    .token-display {
                        display: flex;
                        gap: 10px;
                        align-items: flex-start;
                    }
                    
                    .token-display textarea {
                        flex: 1;
                        height: 100px;
                        padding: 15px;
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        font-family: monospace;
                        font-size: 0.8rem;
                        resize: vertical;
                        background: #f8f9fa;
                    }
                    
                    .btn-back {
                        background: #6c757d;
                        color: white;
                        border: none;
                        padding: 12px 24px;
                        border-radius: 25px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    }
                    
                    .btn-back:hover {
                        background: #5a6268;
                        transform: translateY(-2px);
                    }
                    
                    .security-status, .system-info, .storage-details {
                        background: #f8f9fa;
                        padding: 20px;
                        border-radius: 12px;
                        border-left: 4px solid #28a745;
                    }
                    
                    .status-item {
                        padding: 8px 0;
                        border-bottom: 1px solid #e9ecef;
                    }
                    
                    .status-item:last-child {
                        border-bottom: none;
                    }
                    
                    .status-item.success {
                        color: #28a745;
                    }
                    
                    .status-item.error {
                        color: #dc3545;
                    }
                    
                    .status-item.warning {
                        color: #ffc107;
                    }
                    
                    /* é…ç½®é¡µé¢æ ·å¼ */
                    .config-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
                        gap: 25px;
                        margin-bottom: 30px;
                    }
                    
                    .config-grid-2 {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 20px;
                    }
                    
                    .config-card {
                        background: white;
                        border-radius: 15px;
                        padding: 25px;
                        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                        border-left: 5px solid #667eea;
                        transition: all 0.3s ease;
                    }
                    
                    .config-card:hover {
                        transform: translateY(-5px);
                        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                    }
                    
                    .config-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 20px;
                        padding-bottom: 15px;
                        border-bottom: 2px solid #f8f9fa;
                    }
                    
                    .config-header h3 {
                        color: #333;
                        font-size: 1.3rem;
                        margin: 0;
                    }
                    
                    .config-body {
                        display: flex;
                        flex-direction: column;
                        gap: 15px;
                    }
                    
                    .config-item {
                        display: flex;
                        flex-direction: column;
                        gap: 8px;
                    }
                    
                    .config-item label {
                        font-weight: 600;
                        color: #495057;
                        font-size: 0.9rem;
                    }
                    
                    .config-input, .config-textarea {
                        padding: 12px 15px;
                        border: 2px solid #e9ecef;
                        border-radius: 8px;
                        font-size: 0.95rem;
                        transition: all 0.3s ease;
                        background: #f8f9fa;
                    }
                    
                    .config-input:focus, .config-textarea:focus {
                        outline: none;
                        border-color: #667eea;
                        background: white;
                        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                    }
                    
                    .config-textarea {
                        resize: vertical;
                        min-height: 80px;
                    }
                    
                    .toggle-switch {
                        position: relative;
                        display: inline-block;
                        width: 60px;
                        height: 30px;
                    }
                    
                    .toggle-switch input {
                        opacity: 0;
                        width: 0;
                        height: 0;
                    }
                    
                    .toggle-switch label {
                        position: absolute;
                        cursor: pointer;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background-color: #ccc;
                        border-radius: 30px;
                        transition: 0.4s;
                    }
                    
                    .toggle-switch label:before {
                        position: absolute;
                        content: "";
                        height: 22px;
                        width: 22px;
                        left: 4px;
                        bottom: 4px;
                        background-color: white;
                        border-radius: 50%;
                        transition: 0.4s;
                    }
                    
                    .toggle-switch input:checked + label {
                        background-color: #667eea;
                    }
                    
                    .toggle-switch input:checked + label:before {
                        transform: translateX(30px);
                    }
                    
                    .config-actions {
                        text-align: center;
                        margin-top: 30px;
                        padding: 20px;
                        background: white;
                        border-radius: 15px;
                        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                    }
                    
                    .config-actions .btn {
                        margin: 0 10px;
                    }
                    
                    .config-section {
                        background: white;
                        border-radius: 15px;
                        padding: 25px;
                        margin-bottom: 25px;
                        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                        border-left: 5px solid #48bb78;
                    }
                    
                    .config-section h3 {
                        color: #333;
                        margin-bottom: 20px;
                        font-size: 1.2rem;
                    }
                    
                    .admob-config {
                        max-width: 1000px;
                        margin: 0 auto;
                    }
                    
                    @media (max-width: 768px) {
                        .config-grid {
                            grid-template-columns: 1fr;
                        }
                        
                        .config-grid-2 {
                            grid-template-columns: 1fr;
                        }
                        
                        .config-header {
                            flex-direction: column;
                            gap: 15px;
                            align-items: flex-start;
                        }
                    }
                    
                    /* ç°ä»£åŒ–è®¾ç½®è¯¦æƒ…é¡µé¢æ ·å¼ */
                    .modern-settings-detail {
                        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                        min-height: 100vh;
                        padding: 0;
                        margin: -20px;
                    }
                    
                    .detail-header {
                        background: white;
                        padding: 30px 40px;
                        box-shadow: 0 2px 20px rgba(0,0,0,0.1);
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 30px;
                    }
                    
                    .header-content {
                        display: flex;
                        align-items: center;
                        gap: 20px;
                    }
                    
                    .header-icon {
                        font-size: 3rem;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        background-clip: text;
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.1));
                    }
                    
                    .header-text h2 {
                        font-size: 2.2rem;
                        font-weight: 700;
                        color: #2d3748;
                        margin: 0 0 5px 0;
                    }
                    
                    .header-text p {
                        color: #718096;
                        font-size: 1.1rem;
                        margin: 0;
                    }
                    
                    .back-btn {
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
                        border: none;
                        padding: 12px 20px;
                        border-radius: 12px;
                        color: #4a5568;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    }
                    
                    .back-btn:hover {
                        background: linear-gradient(135deg, #cbd5e0 0%, #a0aec0 100%);
                        transform: translateY(-2px);
                        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    }
                    
                    .detail-content {
                        padding: 0 40px 40px;
                    }
                    
                    .dashboard-cards {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 30px;
                        margin-bottom: 30px;
                    }
                    
                    .dashboard-card {
                        background: white;
                        border-radius: 20px;
                        box-shadow: 0 8px 30px rgba(0,0,0,0.1);
                        overflow: hidden;
                        transition: all 0.3s ease;
                    }
                    
                    .dashboard-card:hover {
                        transform: translateY(-5px);
                        box-shadow: 0 15px 40px rgba(0,0,0,0.15);
                    }
                    
                    .dashboard-card.token-panel {
                        grid-column: 1 / -1;
                    }
                    
                    .card-header {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        padding: 20px 25px;
                        display: flex;
                        align-items: center;
                        gap: 15px;
                    }
                    
                    .card-icon {
                        font-size: 1.5rem;
                    }
                    
                    .card-header h3 {
                        font-size: 1.3rem;
                        font-weight: 600;
                        margin: 0;
                    }
                    
                    .card-content {
                        padding: 25px;
                    }
                    
                    .info-row {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 15px 0;
                        border-bottom: 1px solid #e2e8f0;
                    }
                    
                    .info-row:last-child {
                        border-bottom: none;
                    }
                    
                    .info-label {
                        font-weight: 600;
                        color: #4a5568;
                        font-size: 0.95rem;
                    }
                    
                    .info-value {
                        font-weight: 500;
                        padding: 6px 12px;
                        border-radius: 8px;
                        font-size: 0.9rem;
                    }
                    
                    .status-success {
                        background: #c6f6d5;
                        color: #22543d;
                    }
                    
                    .status-error {
                        background: #fed7d7;
                        color: #c53030;
                    }
                    
                    .role-badge {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        font-weight: 600;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }
                    
                    .action-grid {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 15px;
                    }
                    
                    .modern-btn {
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 8px;
                        padding: 15px 20px;
                        border: none;
                        border-radius: 12px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        text-decoration: none;
                        font-size: 0.9rem;
                    }
                    
                    .modern-btn.primary {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                    }
                    
                    .modern-btn.success {
                        background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
                        color: white;
                    }
                    
                    .modern-btn.warning {
                        background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
                        color: white;
                    }
                    
                    .modern-btn.danger {
                        background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
                        color: white;
                    }
                    
                    .modern-btn.secondary {
                        background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
                        color: #4a5568;
                    }
                    
                    .modern-btn:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    }
                    
                    .btn-icon {
                        font-size: 1.1rem;
                    }
                    
                    .token-container {
                        background: #f7fafc;
                        border-radius: 12px;
                        padding: 20px;
                    }
                    
                    .token-preview {
                        background: #2d3748;
                        color: #e2e8f0;
                        padding: 15px;
                        border-radius: 8px;
                        margin-bottom: 15px;
                        font-family: 'Courier New', monospace;
                        word-break: break-all;
                        font-size: 0.85rem;
                    }
                    
                    .token-actions {
                        display: flex;
                        gap: 10px;
                    }
                    
                    @media (max-width: 768px) {
                        .modern-settings-detail {
                            margin: -10px;
                        }
                        
                        .detail-header {
                            padding: 20px;
                            flex-direction: column;
                            gap: 20px;
                            align-items: flex-start;
                        }
                        
                        .detail-content {
                            padding: 0 20px 20px;
                        }
                        
                        .dashboard-cards {
                            grid-template-columns: 1fr;
                            gap: 20px;
                        }
                        
                        .action-grid {
                            grid-template-columns: 1fr;
                        }
                        
                        .token-actions {
                            flex-direction: column;
                        }
                    }
                    
                    /* é«˜çº§ç§¯åˆ†é…ç½®æ ·å¼ */
                    .points-config-header {
                        margin-bottom: 30px;
                    }
                    
                    .config-summary {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                        gap: 20px;
                        margin-bottom: 25px;
                    }
                    
                    .summary-card {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        padding: 25px;
                        border-radius: 15px;
                        display: flex;
                        align-items: center;
                        gap: 15px;
                        box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
                    }
                    
                    .summary-icon {
                        font-size: 2.5rem;
                        opacity: 0.9;
                    }
                    
                    .summary-info h3 {
                        font-size: 2rem;
                        font-weight: 700;
                        margin: 0 0 5px 0;
                    }
                    
                    .summary-info p {
                        margin: 0;
                        opacity: 0.9;
                        font-size: 0.9rem;
                    }
                    
                    .config-toolbar {
                        display: flex;
                        gap: 15px;
                        flex-wrap: wrap;
                    }
                    
                    .points-config-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
                        gap: 25px;
                    }
                    
                    .advanced-config-card {
                        background: white;
                        border-radius: 20px;
                        box-shadow: 0 8px 30px rgba(0,0,0,0.1);
                        overflow: hidden;
                        transition: all 0.3s ease;
                        border: 2px solid transparent;
                    }
                    
                    .advanced-config-card:hover {
                        transform: translateY(-5px);
                        box-shadow: 0 15px 40px rgba(0,0,0,0.2);
                        border-color: #667eea;
                    }
                    
                    .card-priority {
                        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                        padding: 15px 20px;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        border-bottom: 1px solid #dee2e6;
                    }
                    
                    .priority-badge {
                        background: #667eea;
                        color: white;
                        padding: 5px 12px;
                        border-radius: 20px;
                        font-weight: 600;
                        font-size: 0.8rem;
                    }
                    
                    .card-actions {
                        display: flex;
                        gap: 8px;
                    }
                    
                    .action-btn {
                        background: transparent;
                        border: none;
                        padding: 8px;
                        border-radius: 50%;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        font-size: 1rem;
                    }
                    
                    .action-btn:hover {
                        background: rgba(102, 126, 234, 0.1);
                        transform: scale(1.1);
                    }
                    
                    .action-btn.danger:hover {
                        background: rgba(220, 53, 69, 0.1);
                    }
                    
                    .card-header-advanced {
                        padding: 20px;
                        display: flex;
                        align-items: center;
                        gap: 15px;
                    }
                    
                    .task-icon {
                        font-size: 2.5rem;
                        cursor: pointer;
                        transition: transform 0.3s ease;
                        padding: 10px;
                        border-radius: 10px;
                        background: rgba(102, 126, 234, 0.1);
                    }
                    
                    .task-icon:hover {
                        transform: scale(1.1);
                        background: rgba(102, 126, 234, 0.2);
                    }
                    
                    .task-info {
                        flex: 1;
                    }
                    
                    .task-name-input {
                        background: transparent;
                        border: none;
                        font-size: 1.3rem;
                        font-weight: 600;
                        color: #333;
                        width: 100%;
                        padding: 5px;
                        border-radius: 5px;
                        transition: all 0.3s ease;
                    }
                    
                    .task-name-input:focus {
                        background: #f8f9fa;
                        outline: none;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.3);
                    }
                    
                    .task-stats {
                        color: #6c757d;
                        font-size: 0.9rem;
                        margin-top: 5px;
                    }
                    
                    .card-body-advanced {
                        padding: 20px;
                        background: #f8f9fa;
                    }
                    
                    .config-row {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 20px;
                        margin-bottom: 20px;
                    }
                    
                    .config-col label {
                        display: block;
                        font-weight: 600;
                        color: #495057;
                        margin-bottom: 8px;
                        font-size: 0.9rem;
                    }
                    
                    .input-with-unit {
                        display: flex;
                        align-items: center;
                        background: white;
                        border: 2px solid #e9ecef;
                        border-radius: 8px;
                        overflow: hidden;
                        transition: border-color 0.3s ease;
                    }
                    
                    .input-with-unit:focus-within {
                        border-color: #667eea;
                    }
                    
                    .config-input-small {
                        border: none;
                        padding: 12px 15px;
                        flex: 1;
                        outline: none;
                        font-size: 0.95rem;
                    }
                    
                    .unit {
                        background: #e9ecef;
                        padding: 12px 15px;
                        color: #6c757d;
                        font-weight: 600;
                        font-size: 0.85rem;
                    }
                    
                    .task-metrics {
                        display: grid;
                        grid-template-columns: repeat(3, 1fr);
                        gap: 15px;
                        margin-top: 20px;
                        padding-top: 20px;
                        border-top: 1px solid #dee2e6;
                    }
                    
                    .metric {
                        text-align: center;
                    }
                    
                    .metric-label {
                        display: block;
                        font-size: 0.8rem;
                        color: #6c757d;
                        margin-bottom: 5px;
                    }
                    
                    .metric-value {
                        font-size: 1.1rem;
                        font-weight: 600;
                        color: #333;
                    }
                    
                    /* æ¨¡æ€æ¡†æ ·å¼ */
                    .stats-modal, .add-task-modal {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0,0,0,0.8);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        z-index: 10000;
                        animation: fadeIn 0.3s ease;
                    }
                    
                    .stats-modal-content, .add-task-modal-content {
                        background: white;
                        border-radius: 20px;
                        max-width: 90%;
                        max-height: 90%;
                        overflow: auto;
                        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                        animation: slideUp 0.3s ease;
                    }
                    
                    .stats-modal-content {
                        width: 800px;
                    }
                    
                    .add-task-modal-content {
                        width: 600px;
                    }
                    
                    .stats-header, .modal-header {
                        padding: 25px 30px;
                        border-bottom: 1px solid #dee2e6;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    }
                    
                    .stats-title {
                        display: flex;
                        align-items: center;
                        gap: 15px;
                    }
                    
                    .task-icon-large {
                        font-size: 3rem;
                    }
                    
                    .stats-title h2, .modal-header h2 {
                        margin: 0;
                        color: #333;
                        font-size: 1.5rem;
                    }
                    
                    .stats-title p {
                        margin: 5px 0 0 0;
                        color: #6c757d;
                    }
                    
                    .close-btn {
                        background: #f8f9fa;
                        border: none;
                        width: 40px;
                        height: 40px;
                        border-radius: 50%;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 1.2rem;
                        color: #6c757d;
                        transition: all 0.3s ease;
                    }
                    
                    .close-btn:hover {
                        background: #dc3545;
                        color: white;
                    }
                    
                    .stats-summary {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                        gap: 20px;
                        padding: 30px;
                    }
                    
                    .stats-card {
                        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                        padding: 20px;
                        border-radius: 15px;
                        text-align: center;
                        transition: all 0.3s ease;
                    }
                    
                    .stats-card:hover {
                        transform: translateY(-3px);
                        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
                    }
                    
                    .stats-card.trend-up {
                        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
                    }
                    
                    .stats-card.trend-down {
                        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
                    }
                    
                    .stats-icon {
                        font-size: 2rem;
                        margin-bottom: 10px;
                    }
                    
                    .stats-info h3 {
                        font-size: 1.8rem;
                        font-weight: 700;
                        margin: 0 0 5px 0;
                        color: #333;
                    }
                    
                    .stats-info p {
                        margin: 0;
                        color: #6c757d;
                        font-size: 0.9rem;
                    }
                    
                    .stats-chart {
                        padding: 30px;
                        border-top: 1px solid #dee2e6;
                    }
                    
                    .stats-chart h3 {
                        margin: 0 0 20px 0;
                        color: #333;
                        font-size: 1.2rem;
                    }
                    
                    .chart-container {
                        display: flex;
                        align-items: end;
                        gap: 15px;
                        height: 200px;
                        padding: 20px 0;
                        border-bottom: 2px solid #dee2e6;
                    }
                    
                    .chart-bar {
                        flex: 1;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        position: relative;
                    }
                    
                    .bar {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        width: 100%;
                        border-radius: 4px 4px 0 0;
                        min-height: 20px;
                        transition: all 0.3s ease;
                        position: relative;
                    }
                    
                    .bar:hover {
                        background: linear-gradient(135deg, #5a6fd8 0%, #6b4190 100%);
                        transform: scale(1.05);
                    }
                    
                    .bar-label {
                        margin-top: 10px;
                        font-size: 0.8rem;
                        color: #6c757d;
                        font-weight: 600;
                    }
                    
                    .bar-value {
                        position: absolute;
                        top: -25px;
                        left: 50%;
                        transform: translateX(-50%);
                        font-size: 0.7rem;
                        color: #333;
                        font-weight: 600;
                        opacity: 0;
                        transition: opacity 0.3s ease;
                    }
                    
                    .chart-bar:hover .bar-value {
                        opacity: 1;
                    }
                    
                    /* æ–°å¢ä»»åŠ¡è¡¨å•æ ·å¼ */
                    .add-task-form {
                        padding: 30px;
                    }
                    
                    .form-row {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 20px;
                        margin-bottom: 20px;
                    }
                    
                    .form-group {
                        margin-bottom: 20px;
                    }
                    
                    .form-group label {
                        display: block;
                        font-weight: 600;
                        color: #495057;
                        margin-bottom: 8px;
                        font-size: 0.9rem;
                    }
                    
                    .form-group input, .form-group textarea, .form-group select {
                        width: 100%;
                        padding: 12px 15px;
                        border: 2px solid #e9ecef;
                        border-radius: 8px;
                        font-size: 0.95rem;
                        transition: all 0.3s ease;
                        box-sizing: border-box;
                    }
                    
                    .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                    }
                    
                    .form-actions {
                        display: flex;
                        gap: 15px;
                        justify-content: flex-end;
                        margin-top: 30px;
                        padding-top: 20px;
                        border-top: 1px solid #dee2e6;
                    }
                    
                    .btn-primary, .btn-secondary {
                        padding: 12px 24px;
                        border: none;
                        border-radius: 8px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        font-size: 0.9rem;
                    }
                    
                    .btn-primary {
                        background: #667eea;
                        color: white;
                    }
                    
                    .btn-primary:hover {
                        background: #5a6fd8;
                        transform: translateY(-2px);
                    }
                    
                    .btn-secondary {
                        background: #6c757d;
                        color: white;
                    }
                    
                    .btn-secondary:hover {
                        background: #5a6268;
                        transform: translateY(-2px);
                    }
                    
                    @keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    
                    @keyframes slideUp {
                        from { transform: translateY(30px); opacity: 0; }
                        to { transform: translateY(0); opacity: 1; }
                    }
                    
                    @media (max-width: 768px) {
                        .config-summary {
                            grid-template-columns: 1fr;
                        }
                        
                        .points-config-grid {
                            grid-template-columns: 1fr;
                        }
                        
                        .config-row {
                            grid-template-columns: 1fr;
                        }
                        
                        .task-metrics {
                            grid-template-columns: 1fr;
                        }
                        
                        .form-row {
                            grid-template-columns: 1fr;
                        }
                        
                        .stats-modal-content, .add-task-modal-content {
                            width: 95%;
                        }
                        
                        .stats-summary {
                            grid-template-columns: 1fr;
                        }
                    }
                    
                    /* AdMobé…ç½®ç°ä»£åŒ–æ ·å¼ */
                    .admob-config-modern {
                        max-width: 1200px;
                        margin: 0 auto;
                    }
                    
                    .admob-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 30px;
                        padding: 25px;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        border-radius: 20px;
                        color: white;
                    }
                    
                    .admob-status {
                        display: flex;
                        align-items: center;
                        gap: 20px;
                    }
                    
                    .status-indicator {
                        display: flex;
                        align-items: center;
                        gap: 10px;
                        padding: 10px 20px;
                        border-radius: 25px;
                        background: rgba(255,255,255,0.2);
                        backdrop-filter: blur(10px);
                    }
                    
                    .status-indicator.active .status-dot {
                        background: #4CAF50;
                        box-shadow: 0 0 10px #4CAF50;
                    }
                    
                    .status-indicator.inactive .status-dot {
                        background: #f44336;
                        box-shadow: 0 0 10px #f44336;
                    }
                    
                    .status-dot {
                        width: 12px;
                        height: 12px;
                        border-radius: 50%;
                        animation: pulse 2s infinite;
                    }
                    
                    .status-text {
                        font-weight: 600;
                        font-size: 0.9rem;
                    }
                    
                    .test-mode-badge {
                        padding: 8px 16px;
                        border-radius: 20px;
                        font-weight: 600;
                        font-size: 0.85rem;
                    }
                    
                    .test-mode-badge.test {
                        background: rgba(255, 193, 7, 0.2);
                        color: #ffd700;
                    }
                    
                    .test-mode-badge.production {
                        background: rgba(76, 175, 80, 0.2);
                        color: #4CAF50;
                    }
                    
                    .admob-actions {
                        display: flex;
                        gap: 15px;
                    }
                    
                    .admob-config-grid {
                        display: grid;
                        grid-template-columns: 1fr 1fr 1fr;
                        gap: 25px;
                    }
                    
                    .admob-card {
                        background: white;
                        border-radius: 20px;
                        box-shadow: 0 8px 30px rgba(0,0,0,0.1);
                        overflow: hidden;
                        transition: all 0.3s ease;
                    }
                    
                    .admob-card:hover {
                        transform: translateY(-5px);
                        box-shadow: 0 15px 40px rgba(0,0,0,0.15);
                    }
                    
                    .admob-card-header {
                        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                        padding: 20px;
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        border-bottom: 1px solid #dee2e6;
                    }
                    
                    .admob-card-header .card-icon {
                        font-size: 1.5rem;
                        margin-right: 10px;
                    }
                    
                    .admob-card-header h3 {
                        font-size: 1.2rem;
                        font-weight: 600;
                        color: #333;
                        margin: 0;
                    }
                    
                    .card-info, .card-status {
                        background: #667eea;
                        color: white;
                        padding: 5px 12px;
                        border-radius: 15px;
                        font-size: 0.8rem;
                        font-weight: 600;
                    }
                    
                    .card-status {
                        background: #28a745;
                    }
                    
                    .admob-card-body {
                        padding: 25px;
                    }
                    
                    .config-input-modern {
                        width: 100%;
                        padding: 12px 15px;
                        border: 2px solid #e9ecef;
                        border-radius: 8px;
                        font-size: 0.9rem;
                        transition: all 0.3s ease;
                        font-family: 'Courier New', monospace;
                    }
                    
                    .config-input-modern:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                    }
                    
                    .input-copy-group {
                        display: flex;
                        gap: 10px;
                        align-items: center;
                    }
                    
                    .copy-btn {
                        background: #667eea;
                        color: white;
                        border: none;
                        padding: 12px;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        font-size: 0.9rem;
                        min-width: 45px;
                    }
                    
                    .copy-btn:hover {
                        background: #5a6fd8;
                        transform: scale(1.05);
                    }
                    
                    .toggle-group {
                        display: flex;
                        align-items: center;
                        gap: 15px;
                    }
                    
                    .toggle-description {
                        color: #6c757d;
                        font-size: 0.85rem;
                        font-style: italic;
                    }
                    
                    .ad-unit-list {
                        display: flex;
                        flex-direction: column;
                        gap: 20px;
                    }
                    
                    .ad-unit-item {
                        display: flex;
                        align-items: center;
                        gap: 15px;
                        padding: 15px;
                        background: #f8f9fa;
                        border-radius: 12px;
                        transition: all 0.3s ease;
                    }
                    
                    .ad-unit-item:hover {
                        background: #e9ecef;
                        transform: translateX(5px);
                    }
                    
                    .ad-unit-info {
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        min-width: 120px;
                    }
                    
                    .ad-unit-icon {
                        font-size: 1.5rem;
                        width: 40px;
                        height: 40px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        background: white;
                        border-radius: 10px;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                    }
                    
                    .ad-unit-details {
                        display: flex;
                        flex-direction: column;
                    }
                    
                    .ad-unit-name {
                        font-weight: 600;
                        color: #333;
                        font-size: 0.9rem;
                    }
                    
                    .ad-unit-type {
                        color: #6c757d;
                        font-size: 0.8rem;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }
                    
                    .ad-unit-config {
                        display: flex;
                        flex: 1;
                        gap: 10px;
                        align-items: center;
                    }
                    
                    .ad-unit-input {
                        flex: 1;
                        padding: 10px 12px;
                        border: 1px solid #dee2e6;
                        border-radius: 6px;
                        font-size: 0.85rem;
                        font-family: 'Courier New', monospace;
                        transition: all 0.3s ease;
                    }
                    
                    .ad-unit-input:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
                    }
                    
                    .strategy-grid {
                        display: flex;
                        flex-direction: column;
                        gap: 20px;
                    }
                    
                    .strategy-item {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 15px;
                        background: #f8f9fa;
                        border-radius: 10px;
                    }
                    
                    .strategy-label {
                        font-weight: 600;
                        color: #333;
                        font-size: 0.9rem;
                    }
                    
                    .strategy-select {
                        padding: 8px 12px;
                        border: 1px solid #dee2e6;
                        border-radius: 6px;
                        background: white;
                        font-size: 0.85rem;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    }
                    
                    .strategy-select:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
                    }
                    
                    .copy-toast {
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: #333;
                        color: white;
                        padding: 12px 24px;
                        border-radius: 25px;
                        font-size: 0.9rem;
                        font-weight: 600;
                        z-index: 10001;
                        animation: fadeInOut 2s ease;
                    }
                    
                    @keyframes pulse {
                        0% { opacity: 1; }
                        50% { opacity: 0.5; }
                        100% { opacity: 1; }
                    }
                    
                    @keyframes fadeInOut {
                        0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                        20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                        80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                        100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                    }
                    
                    @media (max-width: 1024px) {
                        .admob-config-grid {
                            grid-template-columns: 1fr 1fr;
                        }
                    }
                    
                    @media (max-width: 768px) {
                        .admob-config-grid {
                            grid-template-columns: 1fr;
                        }
                        
                        .admob-header {
                            flex-direction: column;
                            gap: 20px;
                            align-items: flex-start;
                        }
                        
                        .admob-status {
                            flex-direction: column;
                            align-items: flex-start;
                            gap: 15px;
                        }
                        
                        .ad-unit-item {
                            flex-direction: column;
                            align-items: flex-start;
                            gap: 15px;
                        }
                        
                        .ad-unit-config {
                            width: 100%;
                        }
                    }
                    
                    /* æ–°ç•Œé¢æ ·å¼ - ç§¯åˆ†é…ç½® */
                    .points-task-list {
                        padding: 0;
                    }
                    
                    .task-item {
                        background: white;
                        border-radius: 12px;
                        margin-bottom: 15px;
                        border: 1px solid #e9ecef;
                        transition: all 0.3s ease;
                    }
                    
                    .task-item:hover {
                        border-color: #667eea;
                        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
                        transform: translateY(-2px);
                    }
                    
                    .task-main {
                        display: grid;
                        grid-template-columns: 1fr auto auto;
                        gap: 20px;
                        padding: 20px;
                        align-items: center;
                    }
                    
                    .task-info-section {
                        display: flex;
                        align-items: center;
                        gap: 15px;
                    }
                    
                    .task-icon-wrapper {
                        cursor: pointer;
                        transition: transform 0.3s ease;
                    }
                    
                    .task-icon-wrapper:hover {
                        transform: scale(1.1);
                    }
                    
                    .task-icon-display {
                        width: 50px;
                        height: 50px;
                        border-radius: 12px;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 1.5rem;
                        color: white;
                        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                    }
                    
                    .task-details {
                        flex: 1;
                    }
                    
                    .task-name-section {
                        display: flex;
                        align-items: center;
                        gap: 10px;
                        margin-bottom: 5px;
                    }
                    
                    .task-name-edit {
                        background: transparent;
                        border: none;
                        font-size: 1.2rem;
                        font-weight: 600;
                        color: #333;
                        padding: 5px;
                        border-radius: 4px;
                        transition: all 0.3s ease;
                    }
                    
                    .task-name-edit:focus {
                        background: #f8f9fa;
                        outline: none;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
                    }
                    
                    .priority-indicator {
                        background: #667eea;
                        color: white;
                        padding: 2px 8px;
                        border-radius: 12px;
                        font-size: 0.75rem;
                        font-weight: 600;
                    }
                    
                    .task-desc-edit {
                        background: transparent;
                        border: none;
                        color: #666;
                        font-size: 0.9rem;
                        padding: 3px;
                        border-radius: 4px;
                        width: 100%;
                        transition: all 0.3s ease;
                    }
                    
                    .task-desc-edit:focus {
                        background: #f8f9fa;
                        outline: none;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
                    }
                    
                    .task-stats-inline {
                        font-size: 0.85rem;
                        color: #888;
                        margin-top: 8px;
                    }
                    
                    .task-config-section {
                        display: flex;
                        gap: 20px;
                        align-items: center;
                    }
                    
                    .config-group {
                        text-align: center;
                    }
                    
                    .config-group label {
                        display: block;
                        font-size: 0.8rem;
                        color: #666;
                        margin-bottom: 5px;
                        font-weight: 600;
                    }
                    
                    .input-unit-group {
                        display: flex;
                        align-items: center;
                        background: #f8f9fa;
                        border-radius: 8px;
                        padding: 2px;
                        border: 1px solid #e9ecef;
                        transition: all 0.3s ease;
                    }
                    
                    .input-unit-group:focus-within {
                        border-color: #667eea;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
                    }
                    
                    .config-number-input {
                        border: none;
                        background: transparent;
                        padding: 8px 10px;
                        width: 60px;
                        text-align: center;
                        font-weight: 600;
                        outline: none;
                    }
                    
                    .input-unit {
                        background: #e9ecef;
                        padding: 6px 10px;
                        border-radius: 6px;
                        font-size: 0.8rem;
                        color: #666;
                        font-weight: 600;
                    }
                    
                    .status-toggle {
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    }
                    
                    .toggle-switch-simple {
                        position: relative;
                        width: 44px;
                        height: 24px;
                    }
                    
                    .toggle-switch-simple input {
                        opacity: 0;
                        width: 0;
                        height: 0;
                    }
                    
                    .toggle-switch-simple label {
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: #ccc;
                        border-radius: 24px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    }
                    
                    .toggle-switch-simple label::before {
                        content: '';
                        position: absolute;
                        width: 18px;
                        height: 18px;
                        border-radius: 50%;
                        background: white;
                        top: 3px;
                        left: 3px;
                        transition: all 0.3s ease;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                    }
                    
                    .toggle-switch-simple input:checked + label {
                        background: #667eea;
                    }
                    
                    .toggle-switch-simple input:checked + label::before {
                        transform: translateX(20px);
                    }
                    
                    .task-actions-section {
                        display: flex;
                        gap: 8px;
                    }
                    
                    .action-btn-clean {
                        background: #f8f9fa;
                        border: none;
                        width: 36px;
                        height: 36px;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 0.9rem;
                    }
                    
                    .action-btn-clean:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    }
                    
                    .action-btn-clean.primary:hover {
                        background: #667eea;
                        color: white;
                    }
                    
                    .action-btn-clean.success:hover {
                        background: #4caf50;
                        color: white;
                    }
                    
                    .action-btn-clean.danger:hover {
                        background: #f44336;
                        color: white;
                    }
                    
                    /* AdMob æ–°ç•Œé¢æ ·å¼ */
                    .admob-basic-config {
                        padding: 0;
                    }
                    
                    .config-section {
                        display: flex;
                        flex-direction: column;
                        gap: 20px;
                    }
                    
                    .config-item-inline {
                        display: grid;
                        grid-template-columns: 280px 1fr;
                        align-items: center;
                        column-gap: 20px;
                        padding: 16px 20px;
                        background: #ffffff;
                        border-radius: 12px;
                        border: 1px solid #e9ecef;
                        transition: all 0.3s ease;
                    }
                    
                    .config-item-inline:hover {
                        border-color: #667eea;
                        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
                    }
                    
                    .config-label-group { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
                    
                    .config-label {
                        font-size: 1rem;
                        font-weight: 600;
                        color: #333;
                        margin-bottom: 4px;
                    }
                    
                    .config-description { font-size: 0.85rem; color: #666; display: none; }
                    
                    .config-input-group { display: inline-flex; align-items: center; gap: 10px; white-space: nowrap; }
                    
                    .config-input-modern {
                        padding: 10px 15px;
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        font-size: 0.9rem;
                        width: 300px;
                        font-family: 'Courier New', monospace;
                        transition: all 0.3s ease;
                    }
                    
                    .config-input-modern:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
                    }
                    
                    .config-toggle-group { display: inline-flex; align-items: center; gap: 12px; white-space: nowrap; }
                    
                    .admob-units-list { padding: 0; display: grid; gap: 12px; }
                    
                    .ad-unit-row {
                        display: flex;
                        align-items: center;
                        gap: 15px;
                        padding: 16px 18px;
                        background: #ffffff;
                        border: 1px solid #e9ecef;
                        border-radius: 12px;
                        transition: all 0.3s ease;
                        flex-wrap: nowrap;
                    }
                    
                    .ad-unit-row:hover { box-shadow: 0 8px 20px rgba(0,0,0,0.06); }
                    
                    .ad-unit-row:last-child { margin-bottom: 0; }
                    
                    .ad-unit-info-section {
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        flex-shrink: 0;
                        min-width: 200px;
                    }
                    
                    .ad-unit-icon-clean {
                        width: 40px;
                        height: 40px;
                        border-radius: 10px;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 1.2rem;
                        color: white;
                    }
                    
                    .ad-unit-details-clean {
                        flex: 1;
                    }
                    .ad-unit-details-clean.single-line { display: flex; align-items: center; }
                    .ad-unit-line { display: inline-flex; align-items: baseline; gap: 8px; white-space: nowrap; }
                    .ad-unit-line .dot { color: #9ca3af; }
                    
                    .ad-unit-name {
                        font-weight: 600;
                        color: #333;
                        margin-bottom: 2px;
                    }
                    
                    .ad-unit-type { font-size: 0.85rem; color: #6b7280; text-transform: none; letter-spacing: 0.2px; }
                    
                    .ad-unit-config-section { 
                        display: flex; 
                        align-items: center; 
                        gap: 10px; 
                        flex: 1;
                        min-width: 300px;
                    }
                    
                    .ad-unit-config-section .btn {
                        flex-shrink: 0;
                        padding: 10px 12px;
                        border-radius: 8px;
                        white-space: nowrap;
                    }
                    
                    .ad-unit-input-clean {
                        flex: 1;
                        min-width: 200px;
                        padding: 10px 12px;
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        font-size: 0.85rem;
                        font-family: 'Courier New', monospace;
                        transition: all 0.3s ease;
                    }
                    
                    .ad-unit-input-clean:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
                    }
                    
                    .ad-unit-strategy-section {
                        display: flex;
                        align-items: center;
                        flex-shrink: 0;
                        min-width: 130px;
                    }
                    
                    .strategy-select-clean {
                        flex-shrink: 0;
                        width: 130px;
                        padding: 8px 12px;
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        background: white;
                        font-size: 0.85rem;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        white-space: nowrap;
                    }
                    
                    .strategy-select-clean:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
                    }
                    
                    @media (max-width: 768px) {
                        .task-main {
                            grid-template-columns: 1fr;
                            gap: 15px;
                        }
                        
                        .task-config-section {
                            flex-direction: column;
                            gap: 10px;
                        }
                        
                        .ad-unit-row { flex-direction: column; align-items: stretch; gap: 12px; }
                        .ad-unit-info-section { min-width: unset; }
                        .ad-unit-config-section { min-width: unset; }
                        .ad-unit-input-clean { min-width: unset; }
                        .strategy-select-clean { width: 100%; }
                        
                        .config-item-inline { grid-template-columns: 1fr; row-gap: 8px; }
                        .config-description { display: block; }
                        
                        .config-input-modern {
                            width: 100%;
                        }
                    }
                    
                    /* ==================== å…¨æ–°åä¸½ç•Œé¢æ ·å¼ ==================== */
                    
                    /* åä¸½ç»Ÿè®¡å¡ç‰‡ */
                    .premium-stats-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                        gap: 25px;
                        margin-bottom: 40px;
                    }
                    
                    .premium-stat-card {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        border-radius: 20px;
                        padding: 30px;
                        color: white;
                        position: relative;
                        overflow: hidden;
                        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
                        transition: all 0.4s ease;
                    }
                    
                    .premium-stat-card:hover {
                        transform: translateY(-8px);
                        box-shadow: 0 20px 40px rgba(102, 126, 234, 0.4);
                    }
                    
                    .premium-stat-card.gradient-blue {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    }
                    
                    .premium-stat-card.gradient-green {
                        background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
                    }
                    
                    .premium-stat-card.gradient-purple {
                        background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);
                    }
                    
                    .premium-stat-card.gradient-orange {
                        background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
                    }
                    
                    .stat-card-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 20px;
                    }
                    
                    .stat-icon-premium {
                        font-size: 2.5rem;
                        opacity: 0.9;
                    }
                    
                    .stat-trend {
                        background: rgba(255,255,255,0.2);
                        padding: 6px 12px;
                        border-radius: 15px;
                        font-size: 0.85rem;
                        font-weight: 600;
                    }
                    
                    .stat-content {
                        margin-bottom: 20px;
                    }
                    
                    .stat-value-premium {
                        font-size: 3rem;
                        font-weight: 900;
                        line-height: 1;
                        margin-bottom: 8px;
                    }
                    
                    .stat-label-premium {
                        font-size: 1.1rem;
                        font-weight: 600;
                        opacity: 0.9;
                        margin-bottom: 5px;
                    }
                    
                    .stat-description {
                        font-size: 0.9rem;
                        opacity: 0.8;
                    }
                    
                    .stat-progress {
                        height: 4px;
                        background: rgba(255,255,255,0.2);
                        border-radius: 2px;
                        overflow: hidden;
                    }
                    
                    .progress-bar {
                        height: 100%;
                        background: rgba(255,255,255,0.8);
                        border-radius: 2px;
                        transition: width 1s ease;
                    }
                    
                    /* ç°ä»£åŒ–æ“ä½œé¢æ¿ */
                    .premium-action-panel {
                        background: white;
                        border-radius: 25px;
                        padding: 30px;
                        margin-bottom: 30px;
                        box-shadow: 0 8px 30px rgba(0,0,0,0.08);
                        border: 1px solid rgba(102, 126, 234, 0.1);
                    }
                    
                    .panel-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: flex-start;
                        margin-bottom: 25px;
                    }
                    
                    .panel-title h2 {
                        font-size: 1.8rem;
                        font-weight: 700;
                        color: #333;
                        margin: 0 0 8px 0;
                    }
                    
                    .panel-title p {
                        color: #666;
                        margin: 0;
                        font-size: 1rem;
                    }
                    
                    .panel-actions {
                        display: flex;
                        gap: 15px;
                        flex-wrap: wrap;
                    }
                    
                    .premium-btn {
                        display: inline-flex;
                        align-items: center;
                        gap: 8px;
                        padding: 12px 24px;
                        border: none;
                        border-radius: 12px;
                        font-weight: 600;
                        font-size: 0.95rem;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        text-decoration: none;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .premium-btn:before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: -100%;
                        width: 100%;
                        height: 100%;
                        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                        transition: left 0.5s;
                    }
                    
                    .premium-btn:hover:before {
                        left: 100%;
                    }
                    
                    .premium-btn.primary {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                    }
                    
                    .premium-btn.primary:hover {
                        transform: translateY(-3px);
                        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
                    }
                    
                    .premium-btn.secondary {
                        background: #f8f9fa;
                        color: #333;
                        border: 2px solid #e9ecef;
                    }
                    
                    .premium-btn.secondary:hover {
                        background: #e9ecef;
                        transform: translateY(-2px);
                    }
                    
                    .premium-btn.outline {
                        background: transparent;
                        color: #667eea;
                        border: 2px solid #667eea;
                    }
                    
                    .premium-btn.outline:hover {
                        background: #667eea;
                        color: white;
                        transform: translateY(-2px);
                    }
                    
                    /* é«˜çº§ç­›é€‰åŒºåŸŸ */
                    .panel-filters {
                        display: flex;
                        gap: 20px;
                        align-items: center;
                        flex-wrap: wrap;
                        padding: 20px;
                        background: #f8f9fa;
                        border-radius: 15px;
                        border: 1px solid #e9ecef;
                    }
                    
                    .filter-group {
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    }
                    
                    .search-box-modern {
                        position: relative;
                        display: flex;
                        align-items: center;
                    }
                    
                    .search-icon {
                        position: absolute;
                        left: 15px;
                        font-size: 1.1rem;
                        color: #666;
                    }
                    
                    .search-box-modern input {
                        padding: 12px 15px 12px 45px;
                        border: 2px solid #e9ecef;
                        border-radius: 25px;
                        width: 300px;
                        font-size: 0.95rem;
                        transition: all 0.3s ease;
                    }
                    
                    .search-box-modern input:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                    }
                    
                    .filter-select {
                        padding: 10px 15px;
                        border: 2px solid #e9ecef;
                        border-radius: 10px;
                        background: white;
                        font-size: 0.9rem;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    }
                    
                    .filter-select:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                    }
                    
                    .view-toggle {
                        display: flex;
                        background: white;
                        border-radius: 10px;
                        padding: 4px;
                        border: 2px solid #e9ecef;
                    }
                    
                    .view-btn {
                        padding: 8px 16px;
                        border: none;
                        background: transparent;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 0.85rem;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        color: #666;
                    }
                    
                    .view-btn.active {
                        background: #667eea;
                        color: white;
                        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
                    }
                    
                    /* åä¸½ä»»åŠ¡å¡ç‰‡ç½‘æ ¼ */
                    .premium-tasks-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
                        gap: 25px;
                        margin-bottom: 30px;
                    }
                    
                    .premium-tasks-grid.list-view {
                        grid-template-columns: 1fr;
                    }
                    
                    .premium-task-card {
                        background: white;
                        border-radius: 20px;
                        padding: 0;
                        box-shadow: 0 8px 30px rgba(0,0,0,0.1);
                        border: 2px solid transparent;
                        transition: all 0.4s ease;
                        overflow: hidden;
                        position: relative;
                    }
                    
                    .premium-task-card:hover {
                        transform: translateY(-8px);
                        box-shadow: 0 15px 40px rgba(0,0,0,0.15);
                        border-color: #667eea;
                    }
                    
                    .premium-task-card.active {
                        border-color: #4CAF50;
                    }
                    
                    .premium-task-card.inactive {
                        opacity: 0.7;
                        border-color: #f44336;
                    }
                    
                    .task-card-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 15px 20px;
                        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                        border-bottom: 1px solid #dee2e6;
                    }
                    
                    .task-priority-badge {
                        background: #667eea;
                        color: white;
                        padding: 4px 12px;
                        border-radius: 15px;
                        font-size: 0.8rem;
                        font-weight: 600;
                    }
                    
                    .task-actions-dropdown {
                        position: relative;
                    }
                    
                    .action-dots {
                        background: none;
                        border: none;
                        font-size: 1.2rem;
                        color: #666;
                        cursor: pointer;
                        padding: 5px 10px;
                        border-radius: 50%;
                        transition: all 0.3s ease;
                    }
                    
                    .action-dots:hover {
                        background: rgba(102, 126, 234, 0.1);
                        color: #667eea;
                    }
                    
                    .actions-menu {
                        position: absolute;
                        top: 100%;
                        right: 0;
                        background: white;
                        border-radius: 10px;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
                        padding: 8px 0;
                        min-width: 150px;
                        z-index: 1000;
                        display: none;
                        border: 1px solid #e9ecef;
                    }
                    
                    .actions-menu button {
                        width: 100%;
                        padding: 10px 16px;
                        border: none;
                        background: none;
                        text-align: left;
                        cursor: pointer;
                        font-size: 0.9rem;
                        transition: all 0.3s ease;
                        color: #333;
                    }
                    
                    .actions-menu button:hover {
                        background: #f8f9fa;
                        color: #667eea;
                    }
                    
                    .actions-menu button.danger:hover {
                        background: #ffebee;
                        color: #f44336;
                    }
                    
                    .task-card-icon {
                        text-align: center;
                        padding: 20px;
                        position: relative;
                        cursor: pointer;
                    }
                    
                    .icon-display {
                        width: 80px;
                        height: 80px;
                        border-radius: 20px;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 2.5rem;
                        color: white;
                        margin: 0 auto;
                        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
                        transition: all 0.3s ease;
                    }
                    
                    .icon-display.inactive {
                        background: linear-gradient(135deg, #ccc 0%, #999 100%);
                        box-shadow: 0 4px 15px rgba(153, 153, 153, 0.3);
                    }
                    
                    .task-card-icon:hover .icon-display {
                        transform: scale(1.1);
                    }
                    
                    .icon-edit-hint {
                        font-size: 0.75rem;
                        color: #666;
                        margin-top: 8px;
                        opacity: 0;
                        transition: opacity 0.3s ease;
                    }
                    
                    .task-card-icon:hover .icon-edit-hint {
                        opacity: 1;
                    }
                    
                    .task-card-content {
                        padding: 20px;
                    }
                    
                    .task-name-group {
                        margin-bottom: 15px;
                    }
                    
                    .task-name-premium {
                        width: 100%;
                        background: transparent;
                        border: none;
                        font-size: 1.3rem;
                        font-weight: 600;
                        color: #333;
                        padding: 8px;
                        border-radius: 8px;
                        transition: all 0.3s ease;
                    }
                    
                    .task-name-premium:focus {
                        background: #f8f9fa;
                        outline: none;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
                    }
                    
                    .task-desc-group {
                        margin-bottom: 20px;
                    }
                    
                    .task-desc-premium {
                        width: 100%;
                        background: transparent;
                        border: 1px solid #e9ecef;
                        border-radius: 8px;
                        padding: 10px;
                        font-size: 0.9rem;
                        color: #666;
                        resize: vertical;
                        min-height: 60px;
                        transition: all 0.3s ease;
                    }
                    
                    .task-desc-premium:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
                    }
                    
                    .task-stats-beautiful {
                        display: flex;
                        justify-content: space-around;
                        padding: 15px;
                        background: #f8f9fa;
                        border-radius: 12px;
                        margin-bottom: 20px;
                    }
                    
                    .stat-item {
                        text-align: center;
                    }
                    
                    .stat-item .stat-icon {
                        font-size: 1.2rem;
                        display: block;
                        margin-bottom: 5px;
                    }
                    
                    .stat-item .stat-number {
                        font-size: 1.1rem;
                        font-weight: 700;
                        color: #333;
                        display: block;
                    }
                    
                    .stat-item .stat-label {
                        font-size: 0.8rem;
                        color: #666;
                        margin-top: 2px;
                    }
                    
                    .task-card-config {
                        padding: 0 20px 20px;
                    }
                    
                    .config-row-premium {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 15px;
                    }
                    
                    .config-item-premium {
                        text-align: center;
                    }
                    
                    .config-item-premium label {
                        display: block;
                        font-size: 0.85rem;
                        font-weight: 600;
                        color: #666;
                        margin-bottom: 8px;
                    }
                    
                    .number-input-premium {
                        display: flex;
                        align-items: center;
                        background: #f8f9fa;
                        border-radius: 10px;
                        border: 2px solid #e9ecef;
                        overflow: hidden;
                        transition: all 0.3s ease;
                    }
                    
                    .number-input-premium:focus-within {
                        border-color: #667eea;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
                    }
                    
                    .number-input-premium input {
                        border: none;
                        background: transparent;
                        padding: 10px;
                        text-align: center;
                        font-weight: 600;
                        outline: none;
                        flex: 1;
                    }
                    
                    .input-suffix {
                        background: #e9ecef;
                        padding: 10px;
                        font-size: 0.8rem;
                        color: #666;
                        font-weight: 600;
                    }
                    
                    .task-card-footer {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 15px 20px;
                        background: #f8f9fa;
                        border-top: 1px solid #e9ecef;
                    }
                    
                    .status-label {
                        font-size: 0.9rem;
                        font-weight: 600;
                        padding: 6px 12px;
                        border-radius: 15px;
                    }
                    
                    .status-label.active {
                        background: #d4edda;
                        color: #155724;
                    }
                    
                    .status-label.inactive {
                        background: #f8d7da;
                        color: #721c24;
                    }
                    
                    .premium-toggle {
                        position: relative;
                        width: 60px;
                        height: 30px;
                    }
                    
                    .premium-toggle input {
                        opacity: 0;
                        width: 0;
                        height: 0;
                    }
                    
                    .toggle-slider {
                        position: absolute;
                        cursor: pointer;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: #ccc;
                        border-radius: 30px;
                        transition: all 0.4s ease;
                    }
                    
                    .toggle-slider:before {
                        position: absolute;
                        content: "";
                        height: 22px;
                        width: 22px;
                        left: 4px;
                        bottom: 4px;
                        background: white;
                        border-radius: 50%;
                        transition: all 0.4s ease;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                    }
                    
                    .premium-toggle input:checked + label .toggle-slider {
                        background: #667eea;
                    }
                    
                    .premium-toggle input:checked + label .toggle-slider:before {
                        transform: translateX(30px);
                    }
                    
                    /* åä¸½åˆ†é¡µç»„ä»¶ */
                    .premium-pagination {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 25px 30px;
                        background: white;
                        border-radius: 20px;
                        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
                        border: 1px solid #e9ecef;
                        margin-top: 30px;
                    }
                    
                    .pagination-info {
                        color: #666;
                        font-size: 0.95rem;
                        font-weight: 500;
                    }
                    
                    .pagination-controls {
                        display: flex;
                        gap: 8px;
                        align-items: center;
                    }
                    
                    .pagination-btn {
                        padding: 8px 16px;
                        border: 2px solid #e9ecef;
                        background: white;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 0.9rem;
                        font-weight: 600;
                        color: #333;
                        transition: all 0.3s ease;
                    }
                    
                    .pagination-btn:hover:not([disabled]) {
                        border-color: #667eea;
                        color: #667eea;
                        transform: translateY(-2px);
                    }
                    
                    .pagination-btn.active {
                        background: #667eea;
                        color: white;
                        border-color: #667eea;
                    }
                    
                    .pagination-btn[disabled] {
                        opacity: 0.4;
                        cursor: not-allowed;
                    }
                    
                    .pagination-jumper {
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        color: #666;
                        font-size: 0.9rem;
                    }
                    
                    .pagination-jumper input {
                        width: 60px;
                        padding: 6px 8px;
                        border: 2px solid #e9ecef;
                        border-radius: 6px;
                        text-align: center;
                        font-size: 0.9rem;
                    }
                    
                    .pagination-jumper input:focus {
                        outline: none;
                        border-color: #667eea;
                    }
                    
                    /* åä¸½æ¨¡æ€æ¡† */
                    .premium-modal {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        z-index: 10000;
                        opacity: 0;
                        visibility: hidden;
                        transition: all 0.3s ease;
                    }
                    
                    .premium-modal.show {
                        opacity: 1;
                        visibility: visible;
                    }
                    
                    .premium-modal.hide {
                        opacity: 0;
                        visibility: hidden;
                    }
                    
                    .premium-modal-backdrop {
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0,0,0,0.6);
                        backdrop-filter: blur(5px);
                    }
                    
                    .premium-modal-content {
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: white;
                        border-radius: 25px;
                        width: 90%;
                        max-width: 800px;
                        max-height: 90vh;
                        overflow: hidden;
                        box-shadow: 0 25px 60px rgba(0,0,0,0.3);
                    }
                    
                    .premium-modal-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 25px 30px;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                    }
                    
                    .modal-title-section {
                        display: flex;
                        align-items: center;
                        gap: 15px;
                    }
                    
                    .modal-icon {
                        font-size: 2rem;
                    }
                    
                    .modal-title-text h2 {
                        margin: 0 0 5px 0;
                        font-size: 1.5rem;
                        font-weight: 700;
                    }
                    
                    .modal-title-text p {
                        margin: 0;
                        opacity: 0.9;
                        font-size: 0.95rem;
                    }
                    
                    .premium-close-btn {
                        background: rgba(255,255,255,0.2);
                        border: none;
                        width: 40px;
                        height: 40px;
                        border-radius: 50%;
                        color: white;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 1.2rem;
                    }
                    
                    .premium-close-btn:hover {
                        background: rgba(255,255,255,0.3);
                        transform: scale(1.1);
                    }
                    
                    .premium-modal-body {
                        padding: 30px;
                        max-height: 60vh;
                        overflow-y: auto;
                    }
                    
                    .premium-task-form {
                        display: flex;
                        flex-direction: column;
                        gap: 25px;
                    }
                    
                    .form-section {
                        border-bottom: 1px solid #e9ecef;
                        padding-bottom: 25px;
                    }
                    
                    .form-section:last-child {
                        border-bottom: none;
                        padding-bottom: 0;
                    }
                    
                    .form-section h3 {
                        margin: 0 0 20px 0;
                        color: #333;
                        font-size: 1.2rem;
                        font-weight: 600;
                    }
                    
                    .form-grid {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 20px;
                    }
                    
                    .form-field {
                        display: flex;
                        flex-direction: column;
                    }
                    
                    .form-field.full-width {
                        grid-column: 1 / -1;
                    }
                    
                    .field-label {
                        margin-bottom: 8px;
                    }
                    
                    .label-text {
                        display: block;
                        font-weight: 600;
                        color: #333;
                        font-size: 0.95rem;
                        margin-bottom: 4px;
                    }
                    
                    .label-hint {
                        display: block;
                        font-size: 0.8rem;
                        color: #666;
                    }
                    
                    .premium-input, .premium-textarea, .premium-select {
                        padding: 12px 16px;
                        border: 2px solid #e9ecef;
                        border-radius: 10px;
                        font-size: 0.95rem;
                        transition: all 0.3s ease;
                    }
                    
                    .premium-input:focus, .premium-textarea:focus, .premium-select:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                    }
                    
                    .icon-selector {
                        display: flex;
                        flex-direction: column;
                        gap: 10px;
                    }
                    
                    .icon-input {
                        padding: 12px 16px;
                        border: 2px solid #e9ecef;
                        border-radius: 10px;
                        font-size: 1.2rem;
                        text-align: center;
                        transition: all 0.3s ease;
                    }
                    
                    .icon-options {
                        display: grid;
                        grid-template-columns: repeat(8, 1fr);
                        gap: 8px;
                    }
                    
                    .icon-options button {
                        background: #f8f9fa;
                        border: 2px solid #e9ecef;
                        border-radius: 8px;
                        padding: 10px;
                        font-size: 1.2rem;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    }
                    
                    .icon-options button:hover {
                        background: #e9ecef;
                        transform: scale(1.1);
                    }
                    
                    .icon-options button.selected {
                        background: #667eea;
                        border-color: #667eea;
                        color: white;
                    }
                    
                    .number-input-group {
                        display: flex;
                        align-items: center;
                        border: 2px solid #e9ecef;
                        border-radius: 10px;
                        overflow: hidden;
                        transition: all 0.3s ease;
                    }
                    
                    .number-input-group:focus-within {
                        border-color: #667eea;
                        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                    }
                    
                    .premium-number-input {
                        border: none;
                        padding: 12px 16px;
                        flex: 1;
                        font-size: 0.95rem;
                        outline: none;
                    }
                    
                    .premium-modal-footer {
                        display: flex;
                        justify-content: flex-end;
                        gap: 15px;
                        padding: 25px 30px;
                        background: #f8f9fa;
                        border-top: 1px solid #e9ecef;
                    }
                    
                    @media (max-width: 768px) {
                        .premium-stats-grid {
                            grid-template-columns: 1fr;
                        }
                        
                        .premium-tasks-grid {
                            grid-template-columns: 1fr;
                        }
                        
                        .panel-header {
                            flex-direction: column;
                            gap: 20px;
                            align-items: flex-start;
                        }
                        
                        .panel-filters {
                            flex-direction: column;
                            gap: 15px;
                            align-items: stretch;
                        }
                        
                        .search-box-modern input {
                            width: 100%;
                        }
                        
                        .premium-pagination {
                            flex-direction: column;
                            gap: 15px;
                        }
                        
                        .form-grid {
                            grid-template-columns: 1fr;
                        }
                        
                        .premium-modal-content {
                            width: 95%;
                            margin: 20px;
                        }
                        
                        .config-row-premium {
                            grid-template-columns: 1fr;
                        }
                    }
                </style>
                
                <div class="settings-grid">
                    <div class="settings-card">
                        <div class="settings-icon">ğŸ”</div>
                        <h3 class="settings-title">è®¤è¯ç®¡ç†</h3>
                        <p class="settings-desc">ç®¡ç†ç®¡ç†å‘˜è´¦æˆ·ã€è§’è‰²æƒé™å’Œç™»å½•è®¾ç½®</p>
                        <button class="settings-btn btn-auth" onclick="showAuthSettings()">ç®¡ç†è®¤è¯</button>
                    </div>
                    
                    <div class="settings-card">
                        <div class="settings-icon">ğŸ›¡ï¸</div>
                        <h3 class="settings-title">ç³»ç»Ÿå®‰å…¨</h3>
                        <p class="settings-desc">å®‰å…¨ç­–ç•¥é…ç½®ã€è®¿é—®æ§åˆ¶å’Œå®¡è®¡æ—¥å¿—</p>
                        <button class="settings-btn btn-security" onclick="showSecuritySettings()">å®‰å…¨è®¾ç½®</button>
                    </div>
                    
                    <div class="settings-card">
                        <div class="settings-icon">âš™ï¸</div>
                        <h3 class="settings-title">ç³»ç»Ÿé…ç½®</h3>
                        <p class="settings-desc">åŸºæœ¬ç³»ç»Ÿå‚æ•°ã€APIé…ç½®å’Œç¯å¢ƒè®¾ç½®</p>
                        <button class="settings-btn btn-config" onclick="showSystemConfig()">ç³»ç»Ÿé…ç½®</button>
                    </div>
                    
                    <div class="settings-card">
                        <div class="settings-icon">ğŸ’¾</div>
                        <h3 class="settings-title">æ•°æ®ç®¡ç†</h3>
                        <p class="settings-desc">æ•°æ®å¤‡ä»½ã€æ¢å¤ã€å¯¼å…¥å¯¼å‡ºåŠŸèƒ½</p>
                        <button class="settings-btn btn-data" onclick="showDataManagement()">æ•°æ®ç®¡ç†</button>
                    </div>
                </div>
                
                <div class="quick-actions">
                    <h3 class="quick-title">ğŸš€ å¿«é€Ÿæ“ä½œ</h3>
                    <div class="quick-grid">
                        <button class="quick-btn btn-fix" onclick="openDataFix()">ğŸ”§ æ•°æ®ä¿®å¤</button>
                        <button class="quick-btn btn-fix" onclick="openAuthCheck()">ğŸ” è®¤è¯æ£€æŸ¥</button>
                        <button class="quick-btn btn-fix" onclick="openAuthFix()">ğŸ”§ ä¿®å¤è®¤è¯</button>
                        <button class="quick-btn btn-reset" onclick="resetAuth()">ğŸ”„ é‡ç½®è®¤è¯</button>
                        <button class="quick-btn btn-clear" onclick="clearCache()">ğŸ—‘ï¸ æ¸…é™¤ç¼“å­˜</button>
                        <button class="quick-btn btn-export" onclick="exportData()">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
                        <button class="quick-btn btn-info" onclick="systemInfo()">â„¹ï¸ ç³»ç»Ÿä¿¡æ¯</button>
                    </div>
                </div>
            `;
            
            document.getElementById('settingsContent').innerHTML = settingsHTML;
        }
        
        function showAuthSettings() {
            const admin = getAdminData();
            const user = admin?.user || admin?.admin || admin || {};
            const currentUser = user.name || user.username || 'æœªçŸ¥';
            const currentRole = user.role || 'æœªçŸ¥';
            const loginTime = admin?.timestamp ? new Date(admin.timestamp).toLocaleString() : 'æœªçŸ¥';
            const authStatus = authToken ? 'å·²è®¤è¯' : 'æœªè®¤è¯';
            
            const authHTML = `
                <div class="modern-settings-detail">
                    <div class="detail-header">
                        <div class="header-content">
                            <div class="header-icon">ğŸ”</div>
                            <div class="header-text">
                                <h2>è®¤è¯ç®¡ç†ä¸­å¿ƒ</h2>
                                <p>ç®¡ç†ç®¡ç†å‘˜è´¦æˆ·ã€æƒé™å’Œå®‰å…¨è®¾ç½®</p>
                            </div>
                        </div>
                        <button class="back-btn" onclick="loadSettingsData()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="m15 18-6-6 6-6"/>
                            </svg>
                            è¿”å›
                        </button>
                    </div>
                    
                    <div class="detail-content">
                        <div class="dashboard-cards">
                            <div class="dashboard-card user-info">
                                <div class="card-header">
                                    <div class="card-icon">ğŸ‘¤</div>
                                    <h3>ç”¨æˆ·ä¿¡æ¯</h3>
                                </div>
                                <div class="card-content">
                                    <div class="info-row">
                                        <span class="info-label">ç”¨æˆ·å</span>
                                        <span class="info-value ${currentUser === 'æœªçŸ¥' ? 'status-error' : 'status-success'}">${currentUser}</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">è§’è‰²æƒé™</span>
                                        <span class="info-value role-badge ${currentRole}">${currentRole}</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">ç™»å½•æ—¶é—´</span>
                                        <span class="info-value">${loginTime}</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">è®¤è¯çŠ¶æ€</span>
                                        <span class="info-value status ${authStatus === 'å·²è®¤è¯' ? 'status-success' : 'status-error'}">
                                            ${authStatus === 'å·²è®¤è¯' ? 'âœ…' : 'âŒ'} ${authStatus}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="dashboard-card security-panel">
                                <div class="card-header">
                                    <div class="card-icon">ğŸ›¡ï¸</div>
                                    <h3>å®‰å…¨æ“ä½œ</h3>
                                </div>
                                <div class="card-content">
                                    <div class="action-grid">
                                        <button class="modern-btn primary" onclick="openAuthCheck()">
                                            <span class="btn-icon">ğŸ”</span>
                                            <span class="btn-text">è¯¦ç»†æ£€æŸ¥</span>
                                        </button>
                                        <button class="modern-btn success" onclick="refreshAuth()">
                                            <span class="btn-icon">ğŸ”„</span>
                                            <span class="btn-text">åˆ·æ–°è®¤è¯</span>
                                        </button>
                                        <button class="modern-btn warning" onclick="changePassword()">
                                            <span class="btn-icon">ğŸ”‘</span>
                                            <span class="btn-text">ä¿®æ”¹å¯†ç </span>
                                        </button>
                                        <button class="modern-btn danger" onclick="resetAuth()">
                                            <span class="btn-icon">ğŸ—‘ï¸</span>
                                            <span class="btn-text">é‡ç½®è®¤è¯</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="dashboard-card token-panel">
                                <div class="card-header">
                                    <div class="card-icon">ğŸ”</div>
                                    <h3>è®¿é—®ä»¤ç‰Œ</h3>
                                </div>
                                <div class="card-content">
                                    <div class="token-container">
                                        <div class="token-preview">
                                            <code>${authToken ? authToken.substring(0, 50) + '...' : 'æ— Token'}</code>
                                        </div>
                                        <div class="token-actions">
                                            <button class="modern-btn secondary" onclick="copyToken()">
                                                <span class="btn-icon">ğŸ“‹</span>
                                                <span class="btn-text">å¤åˆ¶Token</span>
                                            </button>
                                            <button class="modern-btn secondary" onclick="showFullToken()">
                                                <span class="btn-icon">ğŸ‘ï¸</span>
                                                <span class="btn-text">æŸ¥çœ‹å®Œæ•´</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('settingsContent').innerHTML = authHTML;
        }
        
        function showSecuritySettings() {
            const securityHTML = `
                <div class="settings-detail">
                    <h2>ğŸ›¡ï¸ ç³»ç»Ÿå®‰å…¨</h2>
                    <div class="settings-content">
                        <div class="info-grid">
                            <div class="info-card">
                                <h3>å®‰å…¨ç­–ç•¥</h3>
                                <div class="info-item">
                                    <span class="label">JWT Tokenæœ‰æ•ˆæœŸ:</span>
                                    <span class="value success">24å°æ—¶</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">å¯†ç ç­–ç•¥:</span>
                                    <span class="value success">æœ€å°‘6ä½</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">è®¿é—®æ—¥å¿—:</span>
                                    <span class="value success">å·²å¯ç”¨</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">APIé™æµ:</span>
                                    <span class="value success">å·²å¯ç”¨</span>
                                </div>
                            </div>
                            
                            <div class="info-card">
                                <h3>å®‰å…¨æ“ä½œ</h3>
                                <div class="action-buttons">
                                    <button class="btn btn-primary" onclick="viewSecurityLogs()">ğŸ“‹ æŸ¥çœ‹æ—¥å¿—</button>
                                    <button class="btn btn-warning" onclick="configSecurity()">âš™ï¸ å®‰å…¨é…ç½®</button>
                                    <button class="btn btn-danger" onclick="emergencyLock()">ğŸ”’ ç´§æ€¥é”å®š</button>
                                    <button class="btn btn-success" onclick="securityScan()">ğŸ” å®‰å…¨æ‰«æ</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="token-info">
                            <h3>å®‰å…¨çŠ¶æ€</h3>
                            <div class="security-status">
                                <div class="status-item success">âœ… ç³»ç»Ÿå®‰å…¨çŠ¶æ€: æ­£å¸¸</div>
                                <div class="status-item success">âœ… æœ€åå®‰å…¨æ‰«æ: ${new Date().toLocaleString()}</div>
                                <div class="status-item success">âœ… å¨èƒæ£€æµ‹: æœªå‘ç°å¨èƒ</div>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-back" onclick="loadSettingsData()">â† è¿”å›è®¾ç½®</button>
                </div>
            `;
            
            document.getElementById('settingsContent').innerHTML = securityHTML;
        }
        
        function showSystemConfig() {
            const configHTML = `
                <div class="settings-detail">
                    <h2>âš™ï¸ ç³»ç»Ÿé…ç½®</h2>
                    <div class="settings-content">
                        <div class="info-grid">
                            <div class="info-card">
                                <h3>ç½‘ç»œé…ç½®</h3>
                                <div class="info-item">
                                    <span class="label">APIåœ°å€:</span>
                                    <span class="value">${API_BASE_URL}</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">å‰ç«¯ç«¯å£:</span>
                                    <span class="value success">8080</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">åç«¯ç«¯å£:</span>
                                    <span class="value success">3001</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">åè®®:</span>
                                    <span class="value">HTTP</span>
                                </div>
                            </div>
                            
                            <div class="info-card">
                                <h3>ç³»ç»Ÿç¯å¢ƒ</h3>
                                <div class="info-item">
                                    <span class="label">æ•°æ®åº“:</span>
                                    <span class="value">MySQL (æ¨¡æ‹Ÿ)</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">ç¼“å­˜:</span>
                                    <span class="value success">LocalStorage</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">è¿è¡Œæ¨¡å¼:</span>
                                    <span class="value success">å¼€å‘æ¨¡å¼</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">é…ç½®çŠ¶æ€:</span>
                                    <span class="value success">æ­£å¸¸</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="token-info">
                            <h3>ç³»ç»Ÿä¿¡æ¯</h3>
                            <div class="system-info">
                                <div class="info-item">
                                    <span class="label">æµè§ˆå™¨:</span>
                                    <span class="value">${navigator.userAgent.split(' ')[0]}</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">å¹³å°:</span>
                                    <span class="value">${navigator.platform}</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">è¯­è¨€:</span>
                                    <span class="value">${navigator.language}</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">åœ¨çº¿çŠ¶æ€:</span>
                                    <span class="value ${navigator.onLine ? 'success' : 'error'}">${navigator.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿'}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-back" onclick="loadSettingsData()">â† è¿”å›è®¾ç½®</button>
                </div>
            `;
            
            document.getElementById('settingsContent').innerHTML = configHTML;
        }
        
        function showDataManagement() {
            const dataSize = JSON.stringify(localStorage).length;
            const dataCount = Object.keys(localStorage).length;
            
            const dataHTML = `
                <div class="settings-detail">
                    <h2>ğŸ’¾ æ•°æ®ç®¡ç†</h2>
                    <div class="settings-content">
                        <div class="info-grid">
                            <div class="info-card">
                                <h3>å­˜å‚¨çŠ¶æ€</h3>
                                <div class="info-item">
                                    <span class="label">ç”¨æˆ·æ•°æ®é¡¹:</span>
                                    <span class="value success">${dataCount} é¡¹</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">ç¼“å­˜å¤§å°:</span>
                                    <span class="value">${(dataSize/1024).toFixed(2)} KB</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">æœ€åæ›´æ–°:</span>
                                    <span class="value">${new Date().toLocaleString()}</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">æ•°æ®çŠ¶æ€:</span>
                                    <span class="value success">æ­£å¸¸</span>
                                </div>
                            </div>
                            
                            <div class="info-card">
                                <h3>æ•°æ®æ“ä½œ</h3>
                                <div class="action-buttons">
                                    <button class="btn btn-primary" onclick="backupData()">ğŸ’¾ å¤‡ä»½æ•°æ®</button>
                                    <button class="btn btn-success" onclick="exportData()">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
                                    <button class="btn btn-warning" onclick="importData()">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
                                    <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="token-info">
                            <h3>å­˜å‚¨è¯¦æƒ…</h3>
                            <div class="storage-details">
                                ${Object.keys(localStorage).map(key => 
                                    `<div class="info-item">
                                        <span class="label">${key}:</span>
                                        <span class="value">${localStorage.getItem(key).length} å­—ç¬¦</span>
                                    </div>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-back" onclick="loadSettingsData()">â† è¿”å›è®¾ç½®</button>
                </div>
            `;
            
            document.getElementById('settingsContent').innerHTML = dataHTML;
        }
        
        function resetAuth() {
            if (confirm('ç¡®å®šè¦é‡ç½®è®¤è¯å—ï¼Ÿè¿™å°†æ¸…é™¤æ‰€æœ‰ç™»å½•ä¿¡æ¯ã€‚')) {
                localStorage.removeItem('adminAuth');
                sessionStorage.removeItem('adminAuth');
                localStorage.removeItem('adminToken');
                localStorage.removeItem('adminUser');
                alert('è®¤è¯å·²é‡ç½®ï¼Œé¡µé¢å°†é‡æ–°åŠ è½½');
                window.location.reload();
            }
        }
        
        function clearCache() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ç¼“å­˜å—ï¼Ÿ')) {
                localStorage.clear();
                sessionStorage.clear();
                alert('ç¼“å­˜å·²æ¸…é™¤');
                window.location.reload();
            }
        }
        
        function exportData() {
            const data = {
                timestamp: new Date().toISOString(),
                localStorage: localStorage,
                sessionStorage: sessionStorage,
                userAgent: navigator.userAgent,
                url: window.location.href
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'admin-data-' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function systemInfo() {
            alert('ç³»ç»Ÿä¿¡æ¯ï¼š\n\nâ€¢ æµè§ˆå™¨: ' + navigator.userAgent.split(' ')[0] + '\nâ€¢ å¹³å°: ' + navigator.platform + '\nâ€¢ è¯­è¨€: ' + navigator.language + '\nâ€¢ åœ¨çº¿çŠ¶æ€: ' + (navigator.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿') + '\nâ€¢ å½“å‰æ—¶é—´: ' + new Date().toLocaleString() + '\nâ€¢ é¡µé¢URL: ' + window.location.href);
        }
        
        function openDataFix() {
            window.open('admin-data-fix.html', '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
        }
        
        function openAuthCheck() {
            window.open('admin-auth-check.html', '_blank', 'width=900,height=700,scrollbars=yes,resizable=yes');
        }
        
        function openAuthFix() {
            window.open('admin-auth-fix.html', '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
        }
        
        function showAuthError(message) {
            // åˆ›å»ºè®¤è¯é”™è¯¯æç¤º
            let errorDiv = document.getElementById('authError');
            if (!errorDiv) {
                errorDiv = document.createElement('div');
                errorDiv.id = 'authError';
                errorDiv.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #ff6b6b, #ee5a24);
                    color: white;
                    padding: 15px 20px;
                    border-radius: 10px;
                    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
                    z-index: 10000;
                    font-weight: 600;
                    max-width: 400px;
                `;
                document.body.appendChild(errorDiv);
            }
            
            errorDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 20px;">ğŸ”’</span>
                    <div>
                        <div style="font-size: 16px; margin-bottom: 5px;">è®¤è¯å¤±è´¥</div>
                        <div style="font-size: 14px; opacity: 0.9;">${message}</div>
                        <div style="margin-top: 10px;">
                            <button onclick="openUltimateFix()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-right: 5px;">ä¿®å¤è®¤è¯</button>
                            <button onclick="hideAuthError()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer;">å…³é—­</button>
                        </div>
                    </div>
                </div>
            `;
            
            errorDiv.style.display = 'block';
        }
        
        function hideAuthError() {
            const errorDiv = document.getElementById('authError');
            if (errorDiv) {
                errorDiv.style.display = 'none';
            }
        }
        
        function openUltimateFix() {
            window.open('/admin-ultimate-fix.html', '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
        }
        
        // è®¤è¯ç®¡ç†ç›¸å…³åŠŸèƒ½
        function refreshAuth() {
            if (confirm('ç¡®å®šè¦åˆ·æ–°è®¤è¯ä¿¡æ¯å—ï¼Ÿ')) {
                checkAuth();
                setAuthHeaders();
                showAuthSettings(); // é‡æ–°æ˜¾ç¤ºé¡µé¢
                alert('è®¤è¯ä¿¡æ¯å·²åˆ·æ–°ï¼');
            }
        }
        
        function changePassword() {
            const newPassword = prompt('è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰:');
            if (newPassword && newPassword.length >= 6) {
                alert('å¯†ç ä¿®æ”¹åŠŸèƒ½ï¼š\n\nåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼š:\nâ€¢ éªŒè¯å½“å‰å¯†ç \nâ€¢ æ›´æ–°åç«¯å¯†ç \nâ€¢ é‡æ–°ç”ŸæˆToken\n\næ¨¡æ‹Ÿï¼šå¯†ç å·²ä¿®æ”¹ï¼');
            } else if (newPassword !== null) {
                alert('å¯†ç é•¿åº¦è‡³å°‘6ä½ï¼');
            }
        }
        
        function copyToken() {
            const token = authToken || 'æ— Token';
            navigator.clipboard.writeText(token).then(() => {
                alert('Tokenå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(() => {
                // åˆ›å»ºä¸´æ—¶æ–‡æœ¬åŒºåŸŸä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = token;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Tokenå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }
        
        function showFullToken() {
            const token = authToken || 'æ— Token';
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 80%;
                    max-height: 80%;
                    overflow: auto;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                ">
                    <h3 style="margin-bottom: 20px; color: #333;">å®Œæ•´è®¿é—®ä»¤ç‰Œ</h3>
                    <textarea readonly style="
                        width: 100%;
                        height: 200px;
                        padding: 15px;
                        border: 2px solid #e2e8f0;
                        border-radius: 8px;
                        font-family: monospace;
                        font-size: 0.8rem;
                        resize: none;
                        background: #f8f9fa;
                    ">${token}</textarea>
                    <div style="margin-top: 20px; text-align: center;">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="
                            background: #667eea;
                            color: white;
                            border: none;
                            padding: 12px 24px;
                            border-radius: 8px;
                            cursor: pointer;
                            font-weight: 600;
                        ">å…³é—­</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
        }
        
        // ===================== ç§¯åˆ†ç®¡ç†åŠŸèƒ½ =====================
        
        let currentUser = null;

        // æ˜¾ç¤º/éšè—ç§¯åˆ†ç®¡ç†èœå• (ä»…è¶…çº§ç®¡ç†å‘˜)
        function checkPointsAccess() {
            const adminData = JSON.parse(localStorage.getItem('adminData') || '{}');
            if (adminData.role === 'super_admin') {
                document.getElementById('pointsMenuItem').style.display = 'block';
            }
        }
        
        // ===================== ç§¯åˆ†é…ç½®ç®¡ç†åŠŸèƒ½ =====================
        
        // å°å»¶æ—¶ï¼Œç¡®ä¿éª¨æ¶å±å¯è§
        const uiDelay = (ms = 300) => new Promise(res => setTimeout(res, ms));

        // ç§¯åˆ†é…ç½®åˆ†é¡µå˜é‡
        let pointsCurrentPage = 1;
        let pointsPerPage = 20;
        let allPointsTasks = [];
        
        async function loadPointsConfigData(page = 1) {
            // åœ¨åŠ è½½çœŸå®æ•°æ®å‰æ˜¾ç¤ºéª¨æ¶å±
            const pointsContainer = document.getElementById('pointsConfigContent');
            if (pointsContainer && typeof getPointsSkeletonHTML === 'function') {
                pointsContainer.innerHTML = getPointsSkeletonHTML();
            }
            try {
                const data = await apiRequest('/admin/points/config');
                await uiDelay();
                
                // æŒ‰ä¼˜å…ˆçº§æ’åºä»»åŠ¡
                allPointsTasks = Object.values(data.data).sort((a, b) => (a.priority || 0) - (b.priority || 0));
                pointsCurrentPage = page;
                
                renderPointsConfigPage();
                
            } catch (error) {
                document.getElementById('pointsConfigContent').innerHTML = `
                    <div class="loading">
                        âš ï¸ åŠ è½½ç§¯åˆ†é…ç½®å¤±è´¥: ${error.message}
                        <br><button onclick="loadPointsConfigData()" class="btn btn-primary">é‡è¯•</button>
                    </div>
                `;
            }
        }
        
        function renderPointsConfigPage() {
            const totalTasks = allPointsTasks.length;
            const totalPages = Math.ceil(totalTasks / pointsPerPage);
            const startIndex = (pointsCurrentPage - 1) * pointsPerPage;
            const endIndex = startIndex + pointsPerPage;
            const currentTasks = allPointsTasks.slice(startIndex, endIndex);
            
            let configHTML = `
                <!-- Gentelella Style Header -->
                <div class="page-title">
                    <div class="title_left">
                        <h3>ç§¯åˆ†ç³»ç»Ÿé…ç½® <small>ç®¡ç†ç§¯åˆ†è·å–è§„åˆ™</small></h3>
                    </div>
                    <div class="title_right">
                        <div class="col-md-5 col-sm-5 form-group pull-right top_search">
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="æœç´¢ä»»åŠ¡..." oninput="filterPointsTasks(this.value)">
                                <span class="input-group-btn">
                                    <button class="btn btn-primary" type="button">æœç´¢</button>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="clearfix"></div>
                
                <!-- Stats Overview -->
                <div class="row">
                    <div class="col-md-3 col-sm-6">
                        <div class="x_panel tile fixed_height_320">
                            <div class="x_title">
                                <h2>æ€»ä»»åŠ¡æ•°</h2>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <h4>ç§¯åˆ†ä»»åŠ¡</h4>
                                <div class="widget_summary">
                                    <div class="w_left w_25">
                                        <span class="text-primary">æ€»è®¡</span>
                                    </div>
                                    <div class="w_center w_55">
                                        <div class="progress">
                                            <div class="progress-bar bg-green" role="progressbar" aria-valuenow="60" 
                                                 aria-valuemin="0" aria-valuemax="100" style="width: ${Math.min((totalTasks / 10) * 100, 100)}%">
                                                <span class="sr-only">60% Complete</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="w_right w_20">
                                        <span>${totalTasks}</span>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                        <div class="x_panel tile fixed_height_320">
                            <div class="x_title">
                                <h2>å¯ç”¨çŠ¶æ€</h2>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <h4>ä»»åŠ¡å¯ç”¨ç‡</h4>
                                <div class="widget_summary">
                                    <div class="w_left w_25">
                                        <span class="text-success">å¯ç”¨</span>
                                    </div>
                                    <div class="w_center w_55">
                                        <div class="progress">
                                            <div class="progress-bar bg-green" role="progressbar" 
                                                 style="width: ${((allPointsTasks.filter(t => t.enabled).length / totalTasks) * 100)}%">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="w_right w_20">
                                        <span>${allPointsTasks.filter(t => t.enabled).length}</span>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                        <div class="x_panel tile fixed_height_320">
                            <div class="x_title">
                                <h2>ä»Šæ—¥ç‚¹å‡»</h2>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <h4>ç”¨æˆ·äº’åŠ¨</h4>
                                <div class="widget_summary">
                                    <div class="w_left w_25">
                                        <span class="text-info">ç‚¹å‡»</span>
                                    </div>
                                    <div class="w_center w_55">
                                        <div class="progress">
                                            <div class="progress-bar bg-blue" role="progressbar" style="width: 65%">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="w_right w_20">
                                        <span>${allPointsTasks.reduce((sum, t) => sum + (t.today_clicks || 0), 0).toLocaleString()}</span>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                        <div class="x_panel tile fixed_height_320">
                            <div class="x_title">
                                <h2>æ€»æ”¶ç›Š</h2>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <h4>ç§¯åˆ†æ”¶ç›Š</h4>
                                <div class="widget_summary">
                                    <div class="w_left w_25">
                                        <span class="text-warning">ï¿¥</span>
                                    </div>
                                    <div class="w_center w_55">
                                        <div class="progress">
                                            <div class="progress-bar bg-orange" role="progressbar" style="width: 75%">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="w_right w_20">
                                        <span>Â¥${((allPointsTasks.reduce((sum, t) => sum + (t.total_revenue || 0), 0)) / 100).toFixed(2)}</span>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Task Management Panel -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="x_panel">
                            <div class="x_title">
                                <h2>ç§¯åˆ†ä»»åŠ¡ç®¡ç† <small>é…ç½®ç§¯åˆ†è·å–è§„åˆ™</small></h2>
                                <ul class="nav navbar-right panel_toolbox">
                                    <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
                                    <li><a class="close-link"><i class="fa fa-close"></i></a></li>
                                </ul>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="card-box table-responsive">
                                            <div class="d-flex justify-content-between align-items-center mb-3" role="toolbar">
                                                <div class="btn-group" role="group">
                                                    <button type="button" class="btn btn-primary" onclick="showAddTaskModal()">
                                                        â• æ–°å»ºä»»åŠ¡
                                                    </button>
                                                    <button type="button" class="btn btn-secondary" onclick="loadPointsConfigData()">
                                                        ğŸ”„ åˆ·æ–°
                                                    </button>
                                                    <button type="button" class="btn btn-success" onclick="exportPointsConfig()">
                                                        ğŸ’¾ å¯¼å‡º
                                                    </button>
                                                </div>
                                                <div class="btn-group" role="group">
                                                    <button type="button" class="btn btn-outline-secondary" onclick="filterPointsByStatus('')">ğŸ“‹ å…¨éƒ¨</button>
                                                    <button type="button" class="btn btn-outline-success" onclick="filterPointsByStatus('enabled')">âœ… å·²å¯ç”¨</button>
                                                    <button type="button" class="btn btn-outline-danger" onclick="filterPointsByStatus('disabled')">âŒ å·²ç¦ç”¨</button>
                                                </div>
                                            </div>
                                            
                                            <table class="table table-striped table-bordered" style="width:100%">
                                                <thead>
                                                    <tr>
                                                        <th>æ’åº</th>
                                                        <th>å›¾æ ‡</th>
                                                        <th>ä»»åŠ¡åç§°</th>
                                                        <th>æè¿°</th>
                                                        <th>ç§¯åˆ†å¥–åŠ±</th>
                                                        <th>æ¯æ—¥é™åˆ¶</th>
                                                        <th>çŠ¶æ€</th>
                                                        <th>ç»Ÿè®¡</th>
                                                        <th>æ“ä½œ</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="pointsTasksContainer">
            `;
            
            currentTasks.forEach((config, index) => {
                const trendIcon = config.total_clicks > 1000 ? 'ğŸ“ˆ' : config.total_clicks > 100 ? 'ğŸ“Š' : 'ğŸ“‰';
                const statusClass = config.enabled ? 'active' : 'inactive';
                const globalIndex = startIndex + index;
                
                configHTML += `
                    <tr data-task-id="${config.id}">
                        <td>
                            <div class="text-center">
                                <button class="btn btn-outline-secondary btn-sm mb-1" onclick="moveTaskUp('${config.id}')" title="ä¸Šç§»">
                                    â¬†ï¸
                                </button>
                                <div class="badge badge-primary d-block mb-1">#${config.priority || globalIndex + 1}</div>
                                <button class="btn btn-outline-secondary btn-sm" onclick="moveTaskDown('${config.id}')" title="ä¸‹ç§»">
                                    â¬‡ï¸
                                </button>
                            </div>
                        </td>
                        <td class="text-center">
                            <span class="task-icon-display" onclick="editTaskIcon('${config.id}')" style="font-size: 24px; cursor: pointer;" title="ç‚¹å‡»ç¼–è¾‘å›¾æ ‡">
                                ${config.icon || 'ğŸ¯'}
                            </span>
                        </td>
                        <td>
                            <input type="text" value="${config.name}" 
                                   onchange="updateTaskField('${config.id}', 'name', this.value)"
                                   class="form-control form-control-sm" placeholder="ä»»åŠ¡åç§°">
                        </td>
                        <td>
                            <textarea onchange="updateTaskField('${config.id}', 'description', this.value)"
                                      class="form-control form-control-sm" rows="2" placeholder="ä»»åŠ¡æè¿°...">${config.description || ''}</textarea>
                        </td>
                        <td>
                            <div class="input-group input-group-sm">
                                <input type="number" value="${config.points || 10}" min="1" max="1000"
                                       onchange="updateTaskField('${config.id}', 'points', parseInt(this.value))"
                                       class="form-control">
                                <div class="input-group-append">
                                    <span class="input-group-text">ç§¯åˆ†</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="input-group input-group-sm">
                                <input type="number" value="${config.daily_limit || 3}" min="1" max="100"
                                       onchange="updateTaskField('${config.id}', 'daily_limit', parseInt(this.value))"
                                       class="form-control">
                                <div class="input-group-append">
                                    <span class="input-group-text">æ¬¡/æ—¥</span>
                                </div>
                            </div>
                        </td>
                        <td class="text-center">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" ${config.enabled ? 'checked' : ''} 
                                       onchange="updateTaskField('${config.id}', 'enabled', this.checked)">
                                <label class="form-check-label">
                                    <span class="badge badge-${config.enabled ? 'success' : 'danger'}">${config.enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}</span>
                                </label>
                            </div>
                        </td>
                        <td class="text-center">
                            <div class="btn-group-sm">
                                <small class="text-muted d-block">æ€»ç‚¹å‡»: ${(config.total_clicks || 0).toLocaleString()}</small>
                                <small class="text-muted d-block">ä»Šæ—¥: ${(config.today_clicks || 0).toLocaleString()}</small>
                                <button class="btn btn-outline-info btn-sm mt-1" onclick="viewTaskStats('${config.id}')">
                                    ğŸ“Š æŸ¥çœ‹è¯¦æƒ…
                                </button>
                            </div>
                        </td>
                        <td class="text-center">
                            <div class="btn-group btn-group-sm" role="group">
                                <button class="btn btn-outline-primary btn-sm" onclick="duplicateTask('${config.id}')" title="å¤åˆ¶ä»»åŠ¡">
                                    ğŸ“„ å¤åˆ¶
                                </button>
                                <button class="btn btn-outline-danger btn-sm" onclick="deleteTask('${config.id}')" title="åˆ é™¤ä»»åŠ¡">
                                    ğŸ—‘ï¸ åˆ é™¤
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            configHTML += `
                                                </tbody>
                                            </table>
                                            
                                            <!-- Pagination -->
                                            <div class="d-flex justify-content-between align-items-center mt-3">
                                                <div class="dataTables_info">
                                                    æ˜¾ç¤ºç¬¬ ${startIndex + 1} åˆ° ${Math.min(endIndex, totalTasks)} é¡¹ï¼Œå…± ${totalTasks} é¡¹
                                                </div>
                                                <div class="dataTables_paginate paging_simple_numbers">
                                                    <ul class="pagination mb-0">
                                                        <li class="paginate_button page-item previous ${pointsCurrentPage === 1 ? 'disabled' : ''}">
                                                            <a onclick="loadPointsConfigData(${pointsCurrentPage - 1})" class="page-link">â¬…ï¸ ä¸Šä¸€é¡µ</a>
                                                        </li>
                                                        ${Array.from({length: Math.min(5, totalPages)}, (_, i) => {
                                                            const pageNum = Math.max(1, pointsCurrentPage - 2) + i;
                                                            if (pageNum <= totalPages) {
                                                                return `<li class="paginate_button page-item ${pageNum === pointsCurrentPage ? 'active' : ''}">
                                                                    <a onclick="loadPointsConfigData(${pageNum})" class="page-link">${pageNum}</a>
                                                                </li>`;
                                                            }
                                                            return '';
                                                        }).join('')}
                                                        <li class="paginate_button page-item next ${pointsCurrentPage === totalPages ? 'disabled' : ''}">
                                                            <a onclick="loadPointsConfigData(${pointsCurrentPage + 1})" class="page-link">ä¸‹ä¸€é¡µ â¡ï¸</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('pointsConfigContent').innerHTML = configHTML;
        }

        // éª¨æ¶å±HTML - ç§¯åˆ†é…ç½®
        function getPointsSkeletonHTML() {
            return `
                <div class="page-title">
                    <div class="title_left">
                        <div class='skeleton skeleton-line' style='width:300px;height:36px;'></div>
                    </div>
                    <div class="title_right">
                        <div class="col-md-5 col-sm-5 form-group pull-right top_search">
                            <div class="input-group">
                                <div class='skeleton skeleton-input'></div>
                                <span class="input-group-btn">
                                    <div class='skeleton skeleton-button'></div>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="clearfix"></div>
                
                <!-- Stats Overview Skeleton -->
                <div class="row">
                    ${Array.from({length:4}).map(()=>`
                        <div class="col-md-3 col-sm-6">
                            <div class="x_panel tile fixed_height_320">
                                <div class="x_title">
                                    <div class='skeleton skeleton-line' style='width:120px;height:24px;'></div>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <div class='skeleton skeleton-line' style='width:80px;height:28px;margin-bottom:15px;'></div>
                                    <div class="widget_summary">
                                        <div class="w_left w_25">
                                            <div class='skeleton skeleton-line' style='width:40px;height:16px;'></div>
                                        </div>
                                        <div class="w_center w_55">
                                            <div class="progress">
                                                <div class='skeleton skeleton-line' style='width:100%;height:10px;'></div>
                                            </div>
                                        </div>
                                        <div class="w_right w_20">
                                            <div class='skeleton skeleton-line' style='width:30px;height:20px;'></div>
                                        </div>
                                        <div class="clearfix"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <!-- Table Skeleton -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="x_panel">
                            <div class="x_title">
                                <div class='skeleton skeleton-line' style='width:200px;height:28px;'></div>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="card-box table-responsive">
                                            <div class="btn-toolbar mb-3" role="toolbar">
                                                <div class="btn-group me-2" role="group">
                                                    ${Array.from({length:3}).map(()=>`<div class='skeleton skeleton-button' style='margin-right:5px;'></div>`).join('')}
                                                </div>
                                                <div class="btn-group" role="group">
                                                    ${Array.from({length:3}).map(()=>`<div class='skeleton skeleton-button' style='margin-right:5px;'></div>`).join('')}
                                                </div>
                                            </div>
                                            
                                            <table class="table table-striped table-bordered">
                                                <thead>
                                                    <tr>
                                                        ${Array.from({length:9}).map(()=>`<th><div class='skeleton skeleton-line' style='width:80%;height:20px;'></div></th>`).join('')}
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    ${Array.from({length:8}).map(()=>`
                                                        <tr>
                                                            ${Array.from({length:9}).map(()=>`<td><div class='skeleton skeleton-line' style='width:90%;height:16px;'></div></td>`).join('')}
                                                        </tr>
                                                    `).join('')}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        async function updatePointsConfig(actionType, field, value) {
            try {
                const updateData = {
                    action_type: actionType,
                    [field]: value
                };
                
                const response = await apiRequest('/admin/points/config', {
                    method: 'PUT',
                    body: JSON.stringify(updateData)
                });
                
                if (response.success) {
                    console.log('ç§¯åˆ†é…ç½®æ›´æ–°æˆåŠŸ:', response.message);
                } else {
                    alert('æ›´æ–°å¤±è´¥: ' + response.error);
                }
                
            } catch (error) {
                alert('æ›´æ–°å¤±è´¥: ' + error.message);
            }
        }
        
        // æ›´æ–°ä»»åŠ¡å­—æ®µ
        async function updateTaskField(taskId, field, value) {
            try {
                const updateData = {
                    action_type: taskId,
                    [field]: value
                };
                
                const response = await apiRequest('/admin/points/config', {
                    method: 'PUT',
                    body: JSON.stringify(updateData)
                });
                
                if (response.success) {
                    console.log(`âœ… ä»»åŠ¡ ${taskId} çš„ ${field} æ›´æ–°æˆåŠŸ`);
                } else {
                    alert('æ›´æ–°å¤±è´¥: ' + response.error);
                }
                
            } catch (error) {
                alert('æ›´æ–°å¤±è´¥: ' + error.message);
            }
        }
        
        // ç§»åŠ¨ä»»åŠ¡ä¼˜å…ˆçº§
        async function moveTaskUp(taskId) {
            await moveTask(taskId, 'up');
        }
        
        async function moveTaskDown(taskId) {
            await moveTask(taskId, 'down');
        }
        
        async function moveTask(taskId, direction) {
            try {
                // è·å–å½“å‰æ‰€æœ‰ä»»åŠ¡
                const data = await apiRequest('/admin/points/config');
                const tasks = Object.values(data.data).sort((a, b) => (a.priority || 0) - (b.priority || 0));
                
                const currentIndex = tasks.findIndex(t => t.id === taskId);
                if (currentIndex === -1) return;
                
                let newIndex;
                if (direction === 'up' && currentIndex > 0) {
                    newIndex = currentIndex - 1;
                } else if (direction === 'down' && currentIndex < tasks.length - 1) {
                    newIndex = currentIndex + 1;
                } else {
                    return; // æ— æ³•ç§»åŠ¨
                }
                
                // äº¤æ¢ä¼˜å…ˆçº§
                const currentTask = tasks[currentIndex];
                const targetTask = tasks[newIndex];
                
                const reorderData = [
                    { id: currentTask.id, priority: targetTask.priority },
                    { id: targetTask.id, priority: currentTask.priority }
                ];
                
                const response = await apiRequest('/admin/points/config/reorder', {
                    method: 'POST',
                    body: JSON.stringify({ tasks: reorderData })
                });
                
                if (response.success) {
                    loadPointsConfigData(); // é‡æ–°åŠ è½½
                } else {
                    alert('æ’åºå¤±è´¥: ' + response.error);
                }
                
            } catch (error) {
                alert('æ’åºå¤±è´¥: ' + error.message);
            }
        }
        
        // åˆ é™¤ä»»åŠ¡
        async function deleteTask(taskId) {
            const task = allPointsTasks.find(t => t.id === taskId);
            const taskName = task ? task.name : 'è¯¥ä»»åŠ¡';
            
            if (!confirm(`ç¡®å®šè¦åˆ é™¤ä»»åŠ¡ "${taskName}" å—ï¼Ÿ\n\nâš ï¸ åˆ é™¤åå°†æ— æ³•æ¢å¤ï¼\nâš ï¸ ç”¨æˆ·å°†æ— æ³•å†å®Œæˆæ­¤ä»»åŠ¡è·å¾—ç§¯åˆ†ï¼`)) {
                return;
            }
            
            try {
                const response = await apiRequest(`/admin/points/config/${taskId}`, {
                    method: 'DELETE'
                });
                
                if (response.success) {
                    showMessage(`ğŸ—‘ï¸ ä»»åŠ¡ "${taskName}" åˆ é™¤æˆåŠŸï¼`, 'success');
                    // é‡æ–°åŠ è½½å½“å‰é¡µé¢
                    await loadPointsConfigData(pointsCurrentPage);
                } else {
                    throw new Error(response.error || 'åˆ é™¤å¤±è´¥');
                }
                
            } catch (error) {
                showMessage(`âŒ åˆ é™¤å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æ¶ˆæ¯æç¤ºç³»ç»Ÿ
        function showMessage(message, type = 'info') {
            // ç§»é™¤ç°æœ‰æ¶ˆæ¯
            const existingMessage = document.querySelector('.message-toast');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            // åˆ›å»ºæ–°æ¶ˆæ¯
            const messageEl = document.createElement('div');
            messageEl.className = `message-toast ${type}`;
            messageEl.innerHTML = `
                <div class="message-content">
                    <span class="message-icon">
                        ${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}
                    </span>
                    <span class="message-text">${message}</span>
                </div>
                <button class="message-close" onclick="this.parentElement.remove()">âœ•</button>
            `;
            
            // æ·»åŠ æ ·å¼
            messageEl.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10001;
                background: ${type === 'success' ? '#d4edda' : type === 'error' ? '#f8d7da' : type === 'warning' ? '#fff3cd' : '#d1ecf1'};
                color: ${type === 'success' ? '#155724' : type === 'error' ? '#721c24' : type === 'warning' ? '#856404' : '#0c5460'};
                border: 1px solid ${type === 'success' ? '#c3e6cb' : type === 'error' ? '#f5c6cb' : type === 'warning' ? '#ffeaa7' : '#bee5eb'};
                border-radius: 12px;
                padding: 15px 20px;
                box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                display: flex;
                align-items: center;
                gap: 15px;
                min-width: 300px;
                max-width: 500px;
                animation: slideInRight 0.3s ease;
                backdrop-filter: blur(10px);
            `;
            
            document.body.appendChild(messageEl);
            
            // è‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                if (messageEl.parentElement) {
                    messageEl.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => messageEl.remove(), 300);
                }
            }, 4000);
        }
        
        // æ·»åŠ æ¶ˆæ¯åŠ¨ç”»æ ·å¼
        if (!document.querySelector('#messageStyles')) {
            const style = document.createElement('style');
            style.id = 'messageStyles';
            style.textContent = `
                @keyframes slideInRight {
                    from {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
                
                @keyframes slideOutRight {
                    from {
                        transform: translateX(0);
                        opacity: 1;
                    }
                    to {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                }
                
                .message-content {
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    flex: 1;
                }
                
                .message-icon {
                    font-size: 1.2rem;
                }
                
                .message-text {
                    font-weight: 600;
                    font-size: 0.95rem;
                }
                
                .message-close {
                    background: none;
                    border: none;
                    font-size: 1.1rem;
                    cursor: pointer;
                    opacity: 0.7;
                    transition: opacity 0.3s ease;
                    padding: 2px;
                }
                
                .message-close:hover {
                    opacity: 1;
                }
            `;
            document.head.appendChild(style);
        }
        
        // æŸ¥çœ‹ä»»åŠ¡ç»Ÿè®¡
        async function viewTaskStats(taskId) {
            try {
                const response = await apiRequest(`/admin/points/stats/${taskId}?days=7`);
                
                if (response.success) {
                    showTaskStatsModal(response.data);
                } else {
                    alert('è·å–ç»Ÿè®¡å¤±è´¥: ' + response.error);
                }
                
            } catch (error) {
                alert('è·å–ç»Ÿè®¡å¤±è´¥: ' + error.message);
            }
        }
        
        // æ˜¾ç¤ºä»»åŠ¡ç»Ÿè®¡æ¨¡æ€æ¡†
        function showTaskStatsModal(statsData) {
            const task = statsData.task_info;
            const summary = statsData.summary;
            const dailyStats = statsData.daily_stats;
            
            const modal = document.createElement('div');
            modal.className = 'stats-modal';
            modal.innerHTML = `
                <div class="stats-modal-content">
                    <div class="stats-header">
                        <div class="stats-title">
                            <span class="task-icon-large">${task.icon}</span>
                            <div>
                                <h2>${task.name}</h2>
                                <p>ä»»åŠ¡ç»Ÿè®¡è¯¦æƒ…</p>
                            </div>
                        </div>
                        <button class="close-btn" onclick="this.parentElement.parentElement.parentElement.remove()">âœ•</button>
                    </div>
                    
                    <div class="stats-summary">
                        <div class="stats-card">
                            <div class="stats-icon">ğŸ¯</div>
                            <div class="stats-info">
                                <h3>${summary.total_clicks.toLocaleString()}</h3>
                                <p>æ€»ç‚¹å‡»æ•°</p>
                            </div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-icon">ğŸ’°</div>
                            <div class="stats-info">
                                <h3>Â¥${(summary.total_revenue / 100).toFixed(2)}</h3>
                                <p>æ€»æ”¶ç›Š</p>
                            </div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-icon">ğŸ“Š</div>
                            <div class="stats-info">
                                <h3>${summary.avg_daily_clicks}</h3>
                                <p>æ—¥å‡ç‚¹å‡»</p>
                            </div>
                        </div>
                        <div class="stats-card trend-${summary.trend}">
                            <div class="stats-icon">${summary.trend === 'up' ? 'ğŸ“ˆ' : summary.trend === 'down' ? 'ğŸ“‰' : 'ğŸ“Š'}</div>
                            <div class="stats-info">
                                <h3>${summary.best_day_clicks}</h3>
                                <p>æœ€ä½³å•æ—¥</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stats-chart">
                        <h3>è¿‘7æ—¥è¶‹åŠ¿</h3>
                        <div class="chart-container">
                            ${dailyStats.map(day => `
                                <div class="chart-bar">
                                    <div class="bar" style="height: ${(day.clicks / summary.best_day_clicks) * 100}%"></div>
                                    <div class="bar-label">${day.date.split('-')[2]}</div>
                                    <div class="bar-value">${day.clicks}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
        }
        
        // æ˜¾ç¤ºæ–°å¢ä»»åŠ¡æ¨¡æ€æ¡† - å…¨æ–°è®¾è®¡
        function showAddTaskModal() {
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨æ¨¡æ€æ¡†
            const existingModal = document.querySelector('.premium-modal');
            if (existingModal) {
                existingModal.remove();
            }
            
            const modal = document.createElement('div');
            modal.className = 'premium-modal';
            modal.innerHTML = `
                <div class="premium-modal-backdrop" onclick="closeAddTaskModal()"></div>
                <div class="premium-modal-content">
                    <div class="premium-modal-header">
                        <div class="modal-title-section">
                            <div class="modal-icon">âœ¨</div>
                            <div class="modal-title-text">
                                <h2>åˆ›å»ºæ–°ä»»åŠ¡</h2>
                                <p>é…ç½®æ–°çš„ç§¯åˆ†è·å–ä»»åŠ¡</p>
                            </div>
                        </div>
                        <button class="premium-close-btn" onclick="closeAddTaskModal()">
                            <span>âœ•</span>
                        </button>
                    </div>
                    
                    <div class="premium-modal-body">
                        <form id="addTaskForm" class="premium-task-form">
                            <div class="form-section">
                                <h3>åŸºæœ¬ä¿¡æ¯</h3>
                                <div class="form-grid">
                                    <div class="form-field">
                                        <label class="field-label">
                                            <span class="label-text">ä»»åŠ¡ID *</span>
                                            <span class="label-hint">å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œåªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿</span>
                                        </label>
                                        <input type="text" name="id" required 
                                               placeholder="ä¾‹å¦‚: watch_ads_v2" 
                                               pattern="[a-zA-Z0-9_]+" 
                                               class="premium-input">
                                    </div>
                                    
                                    <div class="form-field">
                                        <label class="field-label">
                                            <span class="label-text">ä»»åŠ¡å›¾æ ‡</span>
                                            <span class="label-hint">é€‰æ‹©ä¸€ä¸ªemojiè¡¨æƒ…</span>
                                        </label>
                                        <div class="icon-selector">
                                            <input type="text" name="icon" value="ğŸ¯" maxlength="2" class="icon-input">
                                            <div class="icon-options">
                                                <button type="button" onclick="selectIcon(this, 'ğŸ¯')">ğŸ¯</button>
                                                <button type="button" onclick="selectIcon(this, 'ğŸ“º')">ğŸ“º</button>
                                                <button type="button" onclick="selectIcon(this, 'ğŸ“±')">ğŸ“±</button>
                                                <button type="button" onclick="selectIcon(this, 'ğŸ’°')">ğŸ’°</button>
                                                <button type="button" onclick="selectIcon(this, 'ğŸ®')">ğŸ®</button>
                                                <button type="button" onclick="selectIcon(this, 'â­')">â­</button>
                                                <button type="button" onclick="selectIcon(this, 'ğŸ”¥')">ğŸ”¥</button>
                                                <button type="button" onclick="selectIcon(this, 'ğŸ’')">ğŸ’</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-field full-width">
                                    <label class="field-label">
                                        <span class="label-text">ä»»åŠ¡åç§° *</span>
                                        <span class="label-hint">ç®€æ´æ˜äº†çš„ä»»åŠ¡åç§°</span>
                                    </label>
                                    <input type="text" name="name" required 
                                           placeholder="ä¾‹å¦‚: è§‚çœ‹æ¿€åŠ±è§†é¢‘" 
                                           class="premium-input">
                                </div>
                                
                                <div class="form-field full-width">
                                    <label class="field-label">
                                        <span class="label-text">ä»»åŠ¡æè¿°</span>
                                        <span class="label-hint">è¯¦ç»†æè¿°ä»»åŠ¡å†…å®¹å’Œè¦æ±‚</span>
                                    </label>
                                    <textarea name="description" 
                                              placeholder="ä¾‹å¦‚: è§‚çœ‹å®Œæ•´çš„æ¿€åŠ±è§†é¢‘å¹¿å‘Šå³å¯è·å¾—ç§¯åˆ†å¥–åŠ±..." 
                                              rows="3" class="premium-textarea"></textarea>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h3>å¥–åŠ±é…ç½®</h3>
                                <div class="form-grid">
                                    <div class="form-field">
                                        <label class="field-label">
                                            <span class="label-text">ç§¯åˆ†å¥–åŠ± *</span>
                                            <span class="label-hint">å®Œæˆä»»åŠ¡å¯è·å¾—çš„ç§¯åˆ†</span>
                                        </label>
                                        <div class="number-input-group">
                                            <input type="number" name="points" required 
                                                   min="1" max="1000" value="10" 
                                                   class="premium-number-input">
                                            <span class="input-unit">ç§¯åˆ†</span>
                                        </div>
                                    </div>
                                    
                                    <div class="form-field">
                                        <label class="field-label">
                                            <span class="label-text">æ¯æ—¥é™åˆ¶</span>
                                            <span class="label-hint">æ¯å¤©æœ€å¤šå¯å®Œæˆæ¬¡æ•°</span>
                                        </label>
                                        <div class="number-input-group">
                                            <input type="number" name="daily_limit" 
                                                   min="1" max="100" value="5" 
                                                   class="premium-number-input">
                                            <span class="input-unit">æ¬¡</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h3>åˆ†ç±»è®¾ç½®</h3>
                                <div class="form-field">
                                    <label class="field-label">
                                        <span class="label-text">ä»»åŠ¡ç±»åˆ«</span>
                                        <span class="label-hint">é€‰æ‹©åˆé€‚çš„ä»»åŠ¡åˆ†ç±»</span>
                                    </label>
                                    <select name="category" class="premium-select">
                                        <option value="custom">ğŸ“ è‡ªå®šä¹‰ä»»åŠ¡</option>
                                        <option value="video">ğŸ“º è§†é¢‘è§‚çœ‹</option>
                                        <option value="download">ğŸ“± åº”ç”¨ä¸‹è½½</option>
                                        <option value="social">ğŸ‘¥ ç¤¾äº¤åˆ†äº«</option>
                                        <option value="daily">ğŸ“… æ¯æ—¥ä»»åŠ¡</option>
                                        <option value="task">âœ… æ™®é€šä»»åŠ¡</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>
                    
                    <div class="premium-modal-footer">
                        <button type="button" class="premium-btn secondary" onclick="closeAddTaskModal()">
                            <span class="btn-icon">âœ–ï¸</span>
                            <span class="btn-text">å–æ¶ˆ</span>
                        </button>
                        <button type="submit" form="addTaskForm" class="premium-btn primary">
                            <span class="btn-icon">âœ¨</span>
                            <span class="btn-text">åˆ›å»ºä»»åŠ¡</span>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
            
            // å¤„ç†è¡¨å•æäº¤
            document.getElementById('addTaskForm').onsubmit = async (e) => {
                e.preventDefault();
                
                const submitBtn = modal.querySelector('.premium-btn.primary');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<span class="btn-icon">â³</span><span class="btn-text">åˆ›å»ºä¸­...</span>';
                submitBtn.disabled = true;
                
                const formData = new FormData(e.target);
                const taskData = Object.fromEntries(formData);
                
                try {
                    const response = await apiRequest('/admin/points/config', {
                        method: 'POST',
                        body: JSON.stringify(taskData)
                    });
                    
                    if (response.success) {
                        showMessage('ğŸ‰ ä»»åŠ¡åˆ›å»ºæˆåŠŸï¼', 'success');
                        closeAddTaskModal();
                        // é‡æ–°åŠ è½½å½“å‰é¡µé¢
                        await loadPointsConfigData(pointsCurrentPage);
                    } else {
                        throw new Error(response.error || 'åˆ›å»ºå¤±è´¥');
                    }
                    
                } catch (error) {
                    showMessage(`âŒ åˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            };
        }
        
        // å…³é—­æ–°å¢ä»»åŠ¡æ¨¡æ€æ¡†
        function closeAddTaskModal() {
            const modal = document.querySelector('.premium-modal');
            if (modal) {
                modal.classList.add('hide');
                setTimeout(() => {
                    modal.remove();
                }, 300);
            }
        }
        
        // é€‰æ‹©å›¾æ ‡
        function selectIcon(button, icon) {
            const iconInput = button.closest('.icon-selector').querySelector('.icon-input');
            iconInput.value = icon;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            button.closest('.icon-options').querySelectorAll('button').forEach(btn => {
                btn.classList.remove('selected');
            });
            button.classList.add('selected');
        }
        
        // ç¼–è¾‘ä»»åŠ¡å›¾æ ‡
        function editTaskIcon(taskId) {
            const newIcon = prompt('è¯·è¾“å…¥æ–°çš„å›¾æ ‡ (emoji):', 'ğŸ¯');
            if (newIcon && newIcon.trim()) {
                updateTaskField(taskId, 'icon', newIcon.trim());
                setTimeout(() => loadPointsConfigData(), 500);
            }
        }
        
        // åˆ†é¡µè¾…åŠ©å‡½æ•°
        function generatePaginationNumbers(currentPage, totalPages, callbackFunction) {
            let paginationHTML = '';
            const maxShowPages = 5;
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + maxShowPages - 1);
            
            if (endPage - startPage < maxShowPages - 1) {
                startPage = Math.max(1, endPage - maxShowPages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <button class="pagination-btn ${i === currentPage ? 'active' : ''}" 
                            onclick="${callbackFunction}(${i})">${i}</button>
                `;
            }
            
            return paginationHTML;
        }
        
        // ç§¯åˆ†ä»»åŠ¡æœç´¢è¿‡æ»¤
        function filterPointsTasks(searchTerm) {
            const cards = document.querySelectorAll('.premium-task-card');
            cards.forEach(card => {
                const taskName = card.querySelector('.task-name-premium').value.toLowerCase();
                const taskDesc = card.querySelector('.task-desc-premium').value.toLowerCase();
                const search = searchTerm.toLowerCase();
                
                if (taskName.includes(search) || taskDesc.includes(search)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // æŒ‰çŠ¶æ€è¿‡æ»¤ä»»åŠ¡
        function filterPointsByStatus(status) {
            const cards = document.querySelectorAll('.premium-task-card');
            cards.forEach(card => {
                if (status === '') {
                    card.style.display = 'block';
                } else if (status === 'enabled' && card.classList.contains('active')) {
                    card.style.display = 'block';
                } else if (status === 'disabled' && card.classList.contains('inactive')) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // åˆ‡æ¢è§†å›¾æ¨¡å¼
        function switchPointsView(viewType) {
            const buttons = document.querySelectorAll('.view-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const container = document.getElementById('pointsTasksContainer');
            if (viewType === 'list') {
                container.classList.add('list-view');
            } else {
                container.classList.remove('list-view');
            }
        }
        
        // ä»»åŠ¡æ“ä½œèœå•
        function toggleTaskActions(taskId) {
            const menu = document.getElementById(`actions_${taskId}`);
            const allMenus = document.querySelectorAll('.actions-menu');
            
            // å…³é—­å…¶ä»–èœå•
            allMenus.forEach(m => {
                if (m !== menu) m.style.display = 'none';
            });
            
            // åˆ‡æ¢å½“å‰èœå•
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }
        
        // å…³é—­æ‰€æœ‰èœå•ï¼ˆç‚¹å‡»å¤–éƒ¨æ—¶ï¼‰
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.task-actions-dropdown')) {
                document.querySelectorAll('.actions-menu').forEach(menu => {
                    menu.style.display = 'none';
                });
            }
        });
        
        // å¤åˆ¶ä»»åŠ¡
        async function duplicateTask(taskId) {
            const task = allPointsTasks.find(t => t.id === taskId);
            if (!task) return;
            
            const newTaskData = {
                id: `${task.id}_copy_${Date.now()}`,
                name: `${task.name} (å‰¯æœ¬)`,
                points: task.points,
                daily_limit: task.daily_limit,
                description: task.description,
                icon: task.icon,
                category: task.category || 'custom'
            };
            
            try {
                const response = await apiRequest('/admin/points/config', {
                    method: 'POST',
                    body: JSON.stringify(newTaskData)
                });
                
                if (response.success) {
                    showMessage('ä»»åŠ¡å¤åˆ¶æˆåŠŸï¼', 'success');
                    await loadPointsConfigData(pointsCurrentPage);
                } else {
                    alert('å¤åˆ¶å¤±è´¥: ' + response.error);
                }
            } catch (error) {
                alert('å¤åˆ¶å¤±è´¥: ' + error.message);
            }
        }
        
        function exportPointsConfig() {
            alert('ç§¯åˆ†é…ç½®å¯¼å‡ºåŠŸèƒ½ï¼š\n\nåœ¨å®é™…åº”ç”¨ä¸­ä¼šå¯¼å‡ºå½“å‰é…ç½®ä¸ºJSONæ–‡ä»¶');
        }
        
        // ===================== AdMobé…ç½®ç®¡ç†åŠŸèƒ½ =====================
        
        async function loadAdMobConfigData() {
            // åœ¨åŠ è½½çœŸå®æ•°æ®å‰æ˜¾ç¤ºéª¨æ¶å±
            const admobContainer = document.getElementById('admobConfigContent');
            if (admobContainer && typeof getAdmobSkeletonHTML === 'function') {
                admobContainer.innerHTML = getAdmobSkeletonHTML();
            }
            try {
                const data = await apiRequest('/admin/admob/config');
                await uiDelay();
                const config = data.data;
                
                const configHTML = `
                    <!-- Gentelella Style Header -->
                    <div class="page-title">
                        <div class="title_left">
                            <h3>AdMobå¹¿å‘Šé…ç½® <small>ç®¡ç†ç§»åŠ¨å¹¿å‘Šè®¾ç½®</small></h3>
                        </div>
                        <div class="title_right">
                            <div class="btn-group" role="group">
                                <button class="btn btn-primary" onclick="testAdMobConfig()">
                                    ğŸ§ª æµ‹è¯•é…ç½®
                                </button>
                                <button class="btn btn-success" onclick="loadAdMobConfigData()">
                                    ğŸ”„ åˆ·æ–°
                                </button>
                                <button class="btn btn-info" onclick="exportAdMobConfig()">
                                    ğŸ’¾ å¯¼å‡º
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="clearfix"></div>
                    
                    <!-- Stats Overview Cards -->
                    <div class="row">
                        <div class="col-md-3 col-sm-6">
                            <div class="x_panel tile fixed_height_320">
                                <div class="x_title">
                                    <h2>å¹¿å‘ŠçŠ¶æ€</h2>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <h4>${config.enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}</h4>
                                    <div class="widget_summary">
                                        <div class="w_left w_25">
                                            <span class="text-${config.enabled ? 'success' : 'danger'}">ğŸ“±</span>
                                        </div>
                                        <div class="w_center w_55">
                                            <div class="progress">
                                                <div class="progress-bar bg-${config.enabled ? 'green' : 'red'}" role="progressbar" 
                                                     style="width: ${config.enabled ? '100' : '0'}%">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="w_right w_20">
                                            <span class="text-${config.enabled ? 'success' : 'danger'}">${config.enabled ? 'ON' : 'OFF'}</span>
                                        </div>
                                        <div class="clearfix"></div>
                                    </div>
                                    <small class="text-muted">${config.enabled ? 'å¹¿å‘Šæ­£å¸¸è¿è¡Œ' : 'å¹¿å‘Šå·²æš‚åœ'}</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-3 col-sm-6">
                            <div class="x_panel tile fixed_height_320">
                                <div class="x_title">
                                    <h2>è¿è¡Œæ¨¡å¼</h2>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <h4>${config.test_mode ? 'æµ‹è¯•æ¨¡å¼' : 'ç”Ÿäº§æ¨¡å¼'}</h4>
                                    <div class="widget_summary">
                                        <div class="w_left w_25">
                                            <span class="text-${config.test_mode ? 'warning' : 'primary'}">ğŸ§ª</span>
                                        </div>
                                        <div class="w_center w_55">
                                            <div class="progress">
                                                <div class="progress-bar bg-${config.test_mode ? 'orange' : 'blue'}" role="progressbar" 
                                                     style="width: 100%">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="w_right w_20">
                                            <span class="text-${config.test_mode ? 'warning' : 'primary'}">${config.test_mode ? 'TEST' : 'PROD'}</span>
                                        </div>
                                        <div class="clearfix"></div>
                                    </div>
                                    <small class="text-muted">${config.test_mode ? 'ä½¿ç”¨æµ‹è¯•å¹¿å‘Š' : 'ä½¿ç”¨çœŸå®å¹¿å‘Š'}</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-3 col-sm-6">
                            <div class="x_panel tile fixed_height_320">
                                <div class="x_title">
                                    <h2>åˆ·æ–°é—´éš”</h2>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <h4>${config.auto_refresh_interval}ç§’</h4>
                                    <div class="widget_summary">
                                        <div class="w_left w_25">
                                            <span class="text-info">â±ï¸</span>
                                        </div>
                                        <div class="w_center w_55">
                                            <div class="progress">
                                                <div class="progress-bar bg-blue" role="progressbar" style="width: 75%">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="w_right w_20">
                                            <span class="text-info">${config.auto_refresh_interval}s</span>
                                        </div>
                                        <div class="clearfix"></div>
                                    </div>
                                    <small class="text-muted">è‡ªåŠ¨åˆ·æ–°å·²é…ç½®</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-3 col-sm-6">
                            <div class="x_panel tile fixed_height_320">
                                <div class="x_title">
                                    <h2>å¹¿å‘Šå•å…ƒ</h2>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <h4>4ä¸ªå•å…ƒ</h4>
                                    <div class="widget_summary">
                                        <div class="w_left w_25">
                                            <span class="text-success">ğŸ“Š</span>
                                        </div>
                                        <div class="w_center w_55">
                                            <div class="progress">
                                                <div class="progress-bar bg-green" role="progressbar" style="width: 100%">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="w_right w_20">
                                            <span class="text-success">4</span>
                                        </div>
                                        <div class="clearfix"></div>
                                    </div>
                                    <small class="text-muted">å…¨éƒ¨å·²é…ç½®</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Basic Configuration Panel -->
                    <div class="row">
                        <div class="col-md-12">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2>åŸºç¡€é…ç½® <small>AdMobæ ¸å¿ƒè®¾ç½®</small></h2>
                                    <ul class="nav navbar-right panel_toolbox">
                                        <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
                                        <li><a class="close-link"><i class="fa fa-close"></i></a></li>
                                    </ul>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <form class="form-horizontal form-label-left">
                                        <div class="form-group row">
                                            <label class="col-form-label col-md-3 col-sm-3">åº”ç”¨ID</label>
                                            <div class="col-md-9 col-sm-9">
                                                <div class="input-group">
                                                    <input type="text" value="${config.app_id}" 
                                                           onchange="updateAdMobConfig('app_id', this.value)"
                                                           class="form-control" placeholder="ca-app-pub-xxxxxxxx~xxxxxxxxx">
                                                    <div class="input-group-append">
                                                                                                <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('${config.app_id}')" title="å¤åˆ¶">
                                            ğŸ“‹
                                        </button>
                                                    </div>
                                                </div>
                                                <small class="form-text text-muted">AdMobåº”ç”¨æ ‡è¯†ç¬¦</small>
                                            </div>
                                        </div>
                                        
                                        <div class="form-group row">
                                            <label class="col-form-label col-md-3 col-sm-3">å¹¿å‘ŠåŠŸèƒ½</label>
                                            <div class="col-md-9 col-sm-9">
                                                <div class="btn-group" data-toggle="buttons">
                                                    <label class="btn btn-${config.enabled ? 'success' : 'outline-success'} ${config.enabled ? 'active' : ''}">
                                                        <input type="radio" name="enabled" ${config.enabled ? 'checked' : ''} 
                                                               onchange="updateAdMobConfig('enabled', true)"> å¯ç”¨
                                                    </label>
                                                    <label class="btn btn-${!config.enabled ? 'danger' : 'outline-danger'} ${!config.enabled ? 'active' : ''}">
                                                        <input type="radio" name="enabled" ${!config.enabled ? 'checked' : ''} 
                                                               onchange="updateAdMobConfig('enabled', false)"> ç¦ç”¨
                                                    </label>
                                                </div>
                                                <small class="form-text text-muted">å¯ç”¨æˆ–ç¦ç”¨æ‰€æœ‰å¹¿å‘Šå±•ç¤º</small>
                                            </div>
                                        </div>
                                        
                                        <div class="form-group row">
                                            <label class="col-form-label col-md-3 col-sm-3">è¿è¡Œæ¨¡å¼</label>
                                            <div class="col-md-9 col-sm-9">
                                                <div class="btn-group" data-toggle="buttons">
                                                    <label class="btn btn-${!config.test_mode ? 'primary' : 'outline-primary'} ${!config.test_mode ? 'active' : ''}">
                                                        <input type="radio" name="test_mode" ${!config.test_mode ? 'checked' : ''} 
                                                               onchange="updateAdMobConfig('test_mode', false)"> ç”Ÿäº§æ¨¡å¼
                                                    </label>
                                                    <label class="btn btn-${config.test_mode ? 'warning' : 'outline-warning'} ${config.test_mode ? 'active' : ''}">
                                                        <input type="radio" name="test_mode" ${config.test_mode ? 'checked' : ''} 
                                                               onchange="updateAdMobConfig('test_mode', true)"> æµ‹è¯•æ¨¡å¼
                                                    </label>
                                                </div>
                                                <small class="form-text text-muted">æµ‹è¯•æ¨¡å¼ä½¿ç”¨æµ‹è¯•å¹¿å‘Šå•å…ƒï¼Œç”Ÿäº§æ¨¡å¼ä½¿ç”¨çœŸå®å¹¿å‘Š</small>
                                            </div>
                                        </div>
                                        
                                        <div class="form-group row">
                                            <label class="col-form-label col-md-3 col-sm-3">åˆ·æ–°é—´éš”</label>
                                            <div class="col-md-9 col-sm-9">
                                                <div class="input-group">
                                                    <input type="number" value="${config.auto_refresh_interval}" min="10" max="300"
                                                           onchange="updateAdMobConfig('auto_refresh_interval', this.value)"
                                                           class="form-control">
                                                    <div class="input-group-append">
                                                        <span class="input-group-text">ç§’</span>
                                                    </div>
                                                </div>
                                                <small class="form-text text-muted">å¹¿å‘Šè‡ªåŠ¨åˆ·æ–°æ—¶é—´é—´éš”ï¼ˆ10-300ç§’ï¼‰</small>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ad Units Configuration Panel -->
                    <div class="row">
                        <div class="col-md-12">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2>å¹¿å‘Šå•å…ƒé…ç½® <small>ç®¡ç†å„ç±»å‹å¹¿å‘Šä½</small></h2>
                                    <ul class="nav navbar-right panel_toolbox">
                                        <li><a onclick="exportAdMobConfig()" class="export-link"><i class="fa fa-download"></i></a></li>
                                        <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
                                        <li><a class="close-link"><i class="fa fa-close"></i></a></li>
                                    </ul>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <table class="table table-striped jambo_table bulk_action">
                                        <thead>
                                            <tr class="headings">
                                                <th class="column-title">å¹¿å‘Šç±»å‹</th>
                                                <th class="column-title">å¹¿å‘Šå•å…ƒID</th>
                                                <th class="column-title">æ˜¾ç¤ºç­–ç•¥</th>
                                                <th class="column-title">çŠ¶æ€</th>
                                                <th class="column-title">æ“ä½œ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                            <tr>
                                <td>
                                    <div class="media">
                                        <div class="media-left">
                                            <span style="font-size: 24px;">ğŸ“Š</span>
                                        </div>
                                        <div class="media-body">
                                            <strong>æ¨ªå¹…å¹¿å‘Š</strong><br>
                                            <small class="text-muted">Banner Ad</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group input-group-sm">
                                        <input type="text" value="${config.banner_ad_unit}" 
                                               onchange="updateAdMobConfig('banner_ad_unit', this.value)"
                                               class="form-control" placeholder="ca-app-pub-xxxxxxxx/xxxxxxxxx">
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" onclick="copyToClipboard('${config.banner_ad_unit}')" title="å¤åˆ¶">
                                                ğŸ“‹
                                            </button>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <select onchange="updateFrequency('banner', this.value)" class="form-control form-control-sm">
                                        <option value="always" ${config.show_frequency?.banner === 'always' ? 'selected' : ''}>å§‹ç»ˆæ˜¾ç¤º</option>
                                        <option value="timed" ${config.show_frequency?.banner === 'timed' ? 'selected' : ''}>å®šæ—¶æ˜¾ç¤º</option>
                                        <option value="manual" ${config.show_frequency?.banner === 'manual' ? 'selected' : ''}>æ‰‹åŠ¨æ§åˆ¶</option>
                                    </select>
                                </td>
                                <td>
                                    <span class="badge badge-success">å·²é…ç½®</span>
                                </td>
                                <td>
                                    <button class="btn btn-info btn-xs" onclick="testAdUnit('banner')">
                                        <i class="fa fa-play"></i> æµ‹è¯•
                                    </button>
                                </td>
                            </tr>
                            
                            <tr>
                                <td>
                                    <div class="media">
                                        <div class="media-left">
                                            <span style="font-size: 24px;">ğŸ–¼ï¸</span>
                                        </div>
                                        <div class="media-body">
                                            <strong>æ’å±å¹¿å‘Š</strong><br>
                                            <small class="text-muted">Interstitial Ad</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group input-group-sm">
                                        <input type="text" value="${config.interstitial_ad_unit}" 
                                               onchange="updateAdMobConfig('interstitial_ad_unit', this.value)"
                                               class="form-control" placeholder="ca-app-pub-xxxxxxxx/xxxxxxxxx">
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" onclick="copyToClipboard('${config.interstitial_ad_unit}')" title="å¤åˆ¶">
                                                ğŸ“‹
                                            </button>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <select onchange="updateFrequency('interstitial', this.value)" class="form-control form-control-sm">
                                        <option value="every_3_actions" ${config.show_frequency?.interstitial === 'every_3_actions' ? 'selected' : ''}>æ¯3æ¬¡æ“ä½œ</option>
                                        <option value="every_5_actions" ${config.show_frequency?.interstitial === 'every_5_actions' ? 'selected' : ''}>æ¯5æ¬¡æ“ä½œ</option>
                                        <option value="on_demand" ${config.show_frequency?.interstitial === 'on_demand' ? 'selected' : ''}>æŒ‰éœ€æ˜¾ç¤º</option>
                                    </select>
                                </td>
                                <td>
                                    <span class="badge badge-success">å·²é…ç½®</span>
                                </td>
                                <td>
                                    <button class="btn btn-info btn-xs" onclick="testAdUnit('interstitial')">
                                        <i class="fa fa-play"></i> æµ‹è¯•
                                    </button>
                                </td>
                            </tr>
                            
                            <tr>
                                <td>
                                    <div class="media">
                                        <div class="media-left">
                                            <span style="font-size: 24px;">ğŸ¥</span>
                                        </div>
                                        <div class="media-body">
                                            <strong>æ¿€åŠ±è§†é¢‘</strong><br>
                                            <small class="text-muted">Rewarded Video</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group input-group-sm">
                                        <input type="text" value="${config.rewarded_ad_unit}" 
                                               onchange="updateAdMobConfig('rewarded_ad_unit', this.value)"
                                               class="form-control" placeholder="ca-app-pub-xxxxxxxx/xxxxxxxxx">
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" onclick="copyToClipboard('${config.rewarded_ad_unit}')" title="å¤åˆ¶">
                                                ğŸ“‹
                                            </button>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <select onchange="updateFrequency('rewarded', this.value)" class="form-control form-control-sm">
                                        <option value="on_demand" ${config.show_frequency?.rewarded === 'on_demand' ? 'selected' : ''}>ç”¨æˆ·ä¸»åŠ¨</option>
                                        <option value="suggested" ${config.show_frequency?.rewarded === 'suggested' ? 'selected' : ''}>æ™ºèƒ½æ¨è</option>
                                    </select>
                                </td>
                                <td>
                                    <span class="badge badge-success">å·²é…ç½®</span>
                                </td>
                                <td>
                                    <button class="btn btn-info btn-xs" onclick="testAdUnit('rewarded')">
                                        <i class="fa fa-play"></i> æµ‹è¯•
                                    </button>
                                </td>
                            </tr>
                            
                            <tr>
                                <td>
                                    <div class="media">
                                        <div class="media-left">
                                            <span style="font-size: 24px;">ğŸ“</span>
                                        </div>
                                        <div class="media-body">
                                            <strong>åŸç”Ÿå¹¿å‘Š</strong><br>
                                            <small class="text-muted">Native Ad</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group input-group-sm">
                                        <input type="text" value="${config.native_ad_unit}" 
                                               onchange="updateAdMobConfig('native_ad_unit', this.value)"
                                               class="form-control" placeholder="ca-app-pub-xxxxxxxx/xxxxxxxxx">
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" onclick="copyToClipboard('${config.native_ad_unit}')" title="å¤åˆ¶">
                                                ğŸ“‹
                                            </button>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <select onchange="updateFrequency('native', this.value)" class="form-control form-control-sm">
                                        <option value="auto" ${config.show_frequency?.native === 'auto' ? 'selected' : ''}>è‡ªåŠ¨å±•ç¤º</option>
                                        <option value="manual" ${config.show_frequency?.native === 'manual' ? 'selected' : ''}>æ‰‹åŠ¨æ§åˆ¶</option>
                                    </select>
                                </td>
                                <td>
                                    <span class="badge badge-success">å·²é…ç½®</span>
                                </td>
                                <td>
                                    <button class="btn btn-info btn-xs" onclick="testAdUnit('native')">
                                        <i class="fa fa-play"></i> æµ‹è¯•
                                    </button>
                                </td>
                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('admobConfigContent').innerHTML = configHTML;
                
            } catch (error) {
                document.getElementById('admobConfigContent').innerHTML = `
                    <div class="loading">
                        âš ï¸ åŠ è½½AdMobé…ç½®å¤±è´¥: ${error.message}
                        <br><button onclick="loadAdMobConfigData()" class="btn btn-primary">é‡è¯•</button>
                    </div>
                `;
            }
        }

        // éª¨æ¶å±HTML - AdMobé…ç½®
        function getAdmobSkeletonHTML() {
            return `
                <div class="page-title">
                    <div class="title_left">
                        <div class='skeleton skeleton-line' style='width:250px;height:36px;'></div>
                    </div>
                    <div class="title_right">
                        <div class="col-md-5 col-sm-5 form-group pull-right top_search">
                            <div class="col-md-7 col-sm-7 form-group">
                                ${Array.from({length:2}).map(()=>`<div class='skeleton skeleton-button' style='margin-right:5px;'></div>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="clearfix"></div>
                
                <!-- Stats Cards Skeleton -->
                <div class="row">
                    ${Array.from({length:4}).map(()=>`
                        <div class="col-md-3 col-sm-6">
                            <div class="x_panel tile fixed_height_320">
                                <div class="x_title">
                                    <div class='skeleton skeleton-line' style='width:100px;height:24px;'></div>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <div class='skeleton skeleton-line' style='width:80px;height:28px;margin-bottom:15px;'></div>
                                    <div class="widget_summary">
                                        <div class="w_left w_25">
                                            <div class='skeleton skeleton-line' style='width:30px;height:16px;'></div>
                                        </div>
                                        <div class="w_center w_55">
                                            <div class="progress">
                                                <div class='skeleton skeleton-line' style='width:100%;height:10px;'></div>
                                            </div>
                                        </div>
                                        <div class="w_right w_20">
                                            <div class='skeleton skeleton-line' style='width:25px;height:20px;'></div>
                                        </div>
                                        <div class="clearfix"></div>
                                    </div>
                                    <div class='skeleton skeleton-line' style='width:70%;height:14px;'></div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <!-- Configuration Form Skeleton -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="x_panel">
                            <div class="x_title">
                                <div class='skeleton skeleton-line' style='width:150px;height:28px;'></div>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <form class="form-horizontal form-label-left">
                                    ${Array.from({length:3}).map(()=>`
                                        <div class="form-group row">
                                            <div class="col-md-3 col-sm-3">
                                                <div class='skeleton skeleton-line' style='width:80%;height:20px;'></div>
                                            </div>
                                            <div class="col-md-9 col-sm-9">
                                                <div class='skeleton skeleton-line' style='width:100%;height:38px;'></div>
                                                <div class='skeleton skeleton-line' style='width:60%;height:14px;margin-top:5px;'></div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Table Skeleton -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="x_panel">
                            <div class="x_title">
                                <div class='skeleton skeleton-line' style='width:180px;height:28px;'></div>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <table class="table table-striped jambo_table">
                                    <thead>
                                        <tr class="headings">
                                            ${Array.from({length:5}).map(()=>`<th><div class='skeleton skeleton-line' style='width:80%;height:20px;'></div></th>`).join('')}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${Array.from({length:4}).map(()=>`
                                            <tr>
                                                ${Array.from({length:5}).map(()=>`<td><div class='skeleton skeleton-line' style='width:90%;height:16px;'></div></td>`).join('')}
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        async function updateAdMobConfig(field, value) {
            try {
                const updateData = { [field]: value };
                
                const response = await apiRequest('/admin/admob/config', {
                    method: 'PUT',
                    body: JSON.stringify(updateData)
                });
                
                if (response.success) {
                    console.log('AdMobé…ç½®æ›´æ–°æˆåŠŸ:', response.message);
                } else {
                    alert('æ›´æ–°å¤±è´¥: ' + response.error);
                }
                
            } catch (error) {
                alert('æ›´æ–°å¤±è´¥: ' + error.message);
            }
        }
        
        function testAdMobConfig() {
            alert('AdMobé…ç½®æµ‹è¯•ï¼š\n\nåœ¨å®é™…åº”ç”¨ä¸­ä¼š:\nâ€¢ éªŒè¯å¹¿å‘Šå•å…ƒIDæœ‰æ•ˆæ€§\nâ€¢ æµ‹è¯•å¹¿å‘ŠåŠ è½½\nâ€¢ æ£€æŸ¥é…ç½®å®Œæ•´æ€§\n\næ¨¡æ‹Ÿï¼šé…ç½®æµ‹è¯•é€šè¿‡ï¼');
        }
        
        // æ›´æ–°æ˜¾ç¤ºé¢‘ç‡ç­–ç•¥
        async function updateFrequency(adType, frequency) {
            try {
                const updateData = {
                    show_frequency: {
                        [adType]: frequency
                    }
                };
                
                const response = await apiRequest('/admin/admob/config', {
                    method: 'PUT',
                    body: JSON.stringify(updateData)
                });
                
                if (response.success) {
                    console.log(`âœ… ${adType} å¹¿å‘Šé¢‘ç‡æ›´æ–°ä¸º: ${frequency}`);
                } else {
                    alert('æ›´æ–°å¤±è´¥: ' + response.error);
                }
                
            } catch (error) {
                alert('æ›´æ–°å¤±è´¥: ' + error.message);
            }
        }
        
        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸçš„æç¤º
                const toast = document.createElement('div');
                toast.className = 'copy-toast';
                toast.textContent = 'å·²å¤åˆ¶åˆ°å‰ªè´´æ¿';
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 2000);
            }).catch(() => {
                // å¤‡é€‰æ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            });
        }
        
        // å¯¼å‡ºAdMobé…ç½®
        function exportAdMobConfig() {
            alert('AdMobé…ç½®å¯¼å‡ºåŠŸèƒ½ï¼š\n\nåœ¨å®é™…åº”ç”¨ä¸­ä¼šå¯¼å‡ºå½“å‰é…ç½®ä¸ºJSONæ–‡ä»¶');
        }
        
        function resetAdMobConfig() {
            if (confirm('ç¡®å®šè¦é‡ç½®AdMobé…ç½®ä¸ºé»˜è®¤å€¼å—ï¼Ÿ')) {
                alert('AdMobé…ç½®é‡ç½®åŠŸèƒ½ï¼š\n\nåœ¨å®é™…åº”ç”¨ä¸­ä¼šæ¢å¤åˆ°é»˜è®¤é…ç½®');
                loadAdMobConfigData();
            }
        }

        // ===================== ç³»ç»Ÿè®¾ç½®ç›¸å…³åŠŸèƒ½ =====================
        
        // å®‰å…¨ç®¡ç†åŠŸèƒ½
        function viewSecurityLogs() {
            alert('å®‰å…¨æ—¥å¿—æŸ¥çœ‹åŠŸèƒ½ï¼š\n\nåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šæ˜¾ç¤º:\nâ€¢ ç™»å½•è®°å½•\nâ€¢ æ“ä½œæ—¥å¿—\nâ€¢ å®‰å…¨äº‹ä»¶\nâ€¢ å¼‚å¸¸è®¿é—®\n\næ¨¡æ‹Ÿï¼šæ˜¾ç¤ºæœ€è¿‘100æ¡å®‰å…¨æ—¥å¿—');
        }
        
        function configSecurity() {
            alert('å®‰å…¨é…ç½®åŠŸèƒ½ï¼š\n\nåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œå¯ä»¥é…ç½®:\nâ€¢ Tokenæœ‰æ•ˆæœŸ\nâ€¢ å¯†ç ç­–ç•¥\nâ€¢ è®¿é—®é™åˆ¶\nâ€¢ APIé™æµè§„åˆ™\n\næ¨¡æ‹Ÿï¼šå®‰å…¨é…ç½®å·²æ›´æ–°ï¼');
        }
        
        function emergencyLock() {
            if (confirm('ç¡®å®šè¦è¿›è¡Œç´§æ€¥é”å®šå—ï¼Ÿè¿™å°†:\nâ€¢ ç¦ç”¨æ‰€æœ‰APIè®¿é—®\nâ€¢ å¼ºåˆ¶æ‰€æœ‰ç”¨æˆ·ä¸‹çº¿\nâ€¢ å¯ç”¨åªè¯»æ¨¡å¼')) {
                alert('ç´§æ€¥é”å®šåŠŸèƒ½ï¼š\n\nåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼š:\nâ€¢ æ¿€æ´»ç´§æ€¥é”å®šæ¨¡å¼\nâ€¢ è®°å½•é”å®šäº‹ä»¶\nâ€¢ é€šçŸ¥ç®¡ç†å‘˜\n\næ¨¡æ‹Ÿï¼šç³»ç»Ÿå·²è¿›å…¥ç´§æ€¥é”å®šæ¨¡å¼ï¼');
            }
        }
        
        function securityScan() {
            alert('å®‰å…¨æ‰«æåŠŸèƒ½ï¼š\n\næ­£åœ¨æ‰§è¡Œå®‰å…¨æ‰«æ...\n\nâœ… æ£€æŸ¥é¡¹ç›®:\nâ€¢ å¯†ç å¼ºåº¦: é€šè¿‡\nâ€¢ æƒé™é…ç½®: é€šè¿‡\nâ€¢ APIå®‰å…¨: é€šè¿‡\nâ€¢ æ•°æ®å®Œæ•´æ€§: é€šè¿‡\n\næ‰«æå®Œæˆï¼æœªå‘ç°å®‰å…¨é—®é¢˜ã€‚');
        }
        
        // æ•°æ®ç®¡ç†åŠŸèƒ½
        function backupData() {
            if (confirm('ç¡®å®šè¦å¤‡ä»½æ‰€æœ‰æ•°æ®å—ï¼Ÿ')) {
                const backupData = {
                    timestamp: new Date().toISOString(),
                    version: '1.0',
                    data: {
                        localStorage: {...localStorage},
                        sessionStorage: {...sessionStorage}
                    }
                };
                
                const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                alert('æ•°æ®å¤‡ä»½å·²å®Œæˆï¼æ–‡ä»¶å·²ä¸‹è½½ã€‚');
            }
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (confirm('ç¡®å®šè¦å¯¼å…¥æ•°æ®å—ï¼Ÿè¿™å°†è¦†ç›–ç°æœ‰æ•°æ®ï¼')) {
                                if (data.data && data.data.localStorage) {
                                    Object.keys(data.data.localStorage).forEach(key => {
                                        localStorage.setItem(key, data.data.localStorage[key]);
                                    });
                                }
                                alert('æ•°æ®å¯¼å…¥æˆåŠŸï¼é¡µé¢å°†é‡æ–°åŠ è½½ã€‚');
                                window.location.reload();
                            }
                        } catch (error) {
                            alert('å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼é”™è¯¯ï¼');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        function clearAllData() {
            if (confirm('âš ï¸ è­¦å‘Šï¼šè¿™å°†æ¸…é™¤æ‰€æœ‰æ•°æ®ï¼\n\nç¡®å®šè¦ç»§ç»­å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                if (confirm('ğŸš¨ æœ€åç¡®è®¤ï¼šçœŸçš„è¦æ¸…é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿ')) {
                    localStorage.clear();
                    sessionStorage.clear();
                    alert('æ‰€æœ‰æ•°æ®å·²æ¸…é™¤ï¼é¡µé¢å°†é‡æ–°åŠ è½½ã€‚');
                    window.location.reload();
                }
            }
        }

        // åŠ è½½ç§¯åˆ†æ¦‚è§ˆæ•°æ®
        async function loadPointsOverview() {
            try {
                const response = await fetch(`${API_BASE}/admin/points/overview`, {
                    headers: getAuthHeaders()
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const data = result.data;
                    
                    // æ›´æ–°ç§¯åˆ†æ¦‚è§ˆç»Ÿè®¡
                    document.getElementById('totalPointsPool').textContent = 
                        data.overview.total_points?.toLocaleString() || '0';
                    document.getElementById('todayPointsEarned').textContent = 
                        data.today.points_earned_today?.toLocaleString() || '0';
                    document.getElementById('todayPointsSpent').textContent = 
                        data.today.points_spent_today?.toLocaleString() || '0';
                    document.getElementById('richUsers').textContent = 
                        data.overview.rich_users || '0';
                    
                    // åŠ è½½ç§¯åˆ†äº¤æ˜“è®°å½•
                    loadPointsTransactions();
                    
                    // ç”Ÿæˆç§¯åˆ†ç±»å‹å›¾è¡¨
                    generatePointsCharts(data.types);
                } else {
                    console.error('åŠ è½½ç§¯åˆ†æ•°æ®å¤±è´¥:', response.status);
                }
            } catch (error) {
                console.error('åŠ è½½ç§¯åˆ†æ•°æ®é”™è¯¯:', error);
            }
        }

        // åŠ è½½ç§¯åˆ†äº¤æ˜“è®°å½•
        async function loadPointsTransactions() {
            try {
                const response = await fetch(`${API_BASE}/admin/points/transactions?limit=20`, {
                    headers: getAuthHeaders()
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const transactions = result.data.transactions || [];
                    
                    const tbody = document.querySelector('#pointsTransactionsTable tbody');
                    if (transactions.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #999;">æš‚æ— ç§¯åˆ†äº¤æ˜“è®°å½•</td></tr>';
                        return;
                    }
                    
                    tbody.innerHTML = transactions.map(tx => `
                        <tr>
                            <td>${new Date(tx.created_at).toLocaleString()}</td>
                            <td>${tx.username || tx.user_id}</td>
                            <td>${getTransactionTypeText(tx.transaction_type)}</td>
                            <td style="color: ${tx.points_change > 0 ? '#28a745' : '#dc3545'};">
                                ${tx.points_change > 0 ? '+' : ''}${tx.points_change.toLocaleString()}
                            </td>
                            <td>${tx.balance_after.toLocaleString()}</td>
                            <td>${tx.description}</td>
                            <td>${tx.admin_username || '-'}</td>
                        </tr>
                    `).join('');
                } else {
                    console.error('åŠ è½½ç§¯åˆ†äº¤æ˜“è®°å½•å¤±è´¥:', response.status);
                }
            } catch (error) {
                console.error('åŠ è½½ç§¯åˆ†äº¤æ˜“è®°å½•é”™è¯¯:', error);
            }
        }

        // è·å–äº¤æ˜“ç±»å‹æ–‡æœ¬
        function getTransactionTypeText(type) {
            const types = {
                'watch_video': 'è§‚çœ‹è§†é¢‘',
                'download_app': 'ä¸‹è½½åº”ç”¨',
                'daily_checkin': 'æ¯æ—¥ç­¾åˆ°',
                'game_reward': 'æ¸¸æˆå¥–åŠ±',
                'referral_bonus': 'é‚€è¯·å¥–åŠ±',
                'admin_adjustment': 'ç®¡ç†å‘˜è°ƒæ•´',
                'admin_batch_adjustment': 'æ‰¹é‡è°ƒæ•´',
                'withdrawal': 'ç§¯åˆ†æç°',
                'purchase': 'ç§¯åˆ†è´­ä¹°'
            };
            return types[type] || type;
        }

        // ç”Ÿæˆç§¯åˆ†ç±»å‹å›¾è¡¨
        function generatePointsCharts(typesData) {
            if (!typesData || typesData.length === 0) return;
            
            // ç§¯åˆ†è·å¾—é€”å¾„å›¾è¡¨
            const earnCtx = document.getElementById('pointsEarnChart')?.getContext('2d');
            if (earnCtx) {
                new Chart(earnCtx, {
                    type: 'doughnut',
                    data: {
                        labels: typesData.map(t => getTransactionTypeText(t.transaction_type)),
                        datasets: [{
                            data: typesData.map(t => t.total_earned),
                            backgroundColor: [
                                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', 
                                '#9966FF', '#FF9F40', '#FF6384', '#C9CBCF'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }
        }

        // æ˜¾ç¤ºç§¯åˆ†è°ƒæ•´æ¨¡æ€æ¡†
        function showPointsAdjustModal() {
            document.getElementById('pointsAdjustModal').style.display = 'flex';
            clearPointsForm();
        }

        // å…³é—­ç§¯åˆ†è°ƒæ•´æ¨¡æ€æ¡†
        function closePointsModal() {
            document.getElementById('pointsAdjustModal').style.display = 'none';
            clearPointsForm();
        }

        // æ¸…ç©ºç§¯åˆ†è°ƒæ•´è¡¨å•
        function clearPointsForm() {
            document.getElementById('searchUserId').value = '';
            document.getElementById('pointsChange').value = '';
            document.getElementById('adjustReason').value = '';
            document.getElementById('userSearchResult').style.display = 'none';
            document.getElementById('pointsWarning').style.display = 'none';
            document.getElementById('pointsSuccess').style.display = 'none';
            document.getElementById('submitAdjust').disabled = true;
            currentUser = null;
        }

        // æœç´¢ç”¨æˆ·
        async function searchUser() {
            const searchTerm = document.getElementById('searchUserId').value.trim();
            if (searchTerm.length < 2) {
                document.getElementById('userSearchResult').style.display = 'none';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/admin/users?search=${encodeURIComponent(searchTerm)}&limit=1`, {
                    headers: getAuthHeaders()
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const users = result.data.users || [];
                    
                    if (users.length > 0) {
                        const user = users[0];
                        currentUser = user;
                        
                        // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
                        document.getElementById('selectedUsername').textContent = user.username;
                        document.getElementById('selectedUserEmail').textContent = user.email;
                        document.getElementById('selectedUserPoints').textContent = user.points_balance.toLocaleString();
                        document.getElementById('selectedUserLevel').textContent = user.membership_level;
                        document.getElementById('selectedUserTotal').textContent = user.total_earned.toLocaleString();
                        document.getElementById('userSearchResult').style.display = 'block';
                        
                        validatePoints();
                    } else {
                        document.getElementById('userSearchResult').style.display = 'none';
                        currentUser = null;
                    }
                }
            } catch (error) {
                console.error('æœç´¢ç”¨æˆ·å¤±è´¥:', error);
            }
        }

        // éªŒè¯ç§¯åˆ†è¾“å…¥
        function validatePoints() {
            const pointsChange = parseInt(document.getElementById('pointsChange').value) || 0;
            const reason = document.getElementById('adjustReason').value.trim();
            const warningDiv = document.getElementById('pointsWarning');
            const submitBtn = document.getElementById('submitAdjust');
            
            warningDiv.style.display = 'none';
            
            if (!currentUser) {
                submitBtn.disabled = true;
                return;
            }
            
            if (pointsChange === 0) {
                submitBtn.disabled = true;
                return;
            }
            
            if (!reason) {
                submitBtn.disabled = true;
                return;
            }
            
            // æ£€æŸ¥è´Ÿæ•°æƒ…å†µ
            if (pointsChange < 0 && currentUser.points_balance + pointsChange < 0) {
                warningDiv.textContent = `è­¦å‘Šï¼šè°ƒæ•´åç§¯åˆ†å°†ä¸ºè´Ÿæ•° (${(currentUser.points_balance + pointsChange).toLocaleString()})`;
                warningDiv.style.display = 'block';
                submitBtn.disabled = true;
                return;
            }
            
            submitBtn.disabled = false;
        }

        // æäº¤ç§¯åˆ†è°ƒæ•´
        function initPointsAdjustForm() {
            const form = document.getElementById('pointsAdjustForm');
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    if (!currentUser) return;
            
            const pointsChange = parseInt(document.getElementById('pointsChange').value);
            const reason = document.getElementById('adjustReason').value.trim();
            
            try {
                const response = await fetch(`${API_BASE}/admin/points/adjust`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        user_id: currentUser.user_id,
                        points_change: pointsChange,
                        reason: reason
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    const successDiv = document.getElementById('pointsSuccess');
                    successDiv.textContent = `ç§¯åˆ†è°ƒæ•´æˆåŠŸï¼${currentUser.username} çš„ç§¯åˆ†ä» ${result.data.old_balance.toLocaleString()} è°ƒæ•´ä¸º ${result.data.new_balance.toLocaleString()}`;
                    successDiv.style.display = 'block';
                    
                    setTimeout(() => {
                        closePointsModal();
                        loadPointsOverview();
                    }, 2000);
                } else {
                    const warningDiv = document.getElementById('pointsWarning');
                    warningDiv.textContent = result.error || 'è°ƒæ•´å¤±è´¥';
                    warningDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('è°ƒæ•´ç§¯åˆ†å¤±è´¥:', error);
            }
                });
            }
        }

        // æ˜¾ç¤ºç”¨æˆ·ç§¯åˆ†æœç´¢
        function showUserPointsSearch() {
            document.getElementById('userPointsModal').style.display = 'flex';
        }

        // å…³é—­ç”¨æˆ·ç§¯åˆ†æ¨¡æ€æ¡†
        function closeUserPointsModal() {
            document.getElementById('userPointsModal').style.display = 'none';
            document.getElementById('searchUserIdDetail').value = '';
            document.getElementById('userDetailResult').style.display = 'none';
        }

        // æœç´¢ç”¨æˆ·è¯¦æƒ…
        async function searchUserDetail() {
            const searchTerm = document.getElementById('searchUserIdDetail').value.trim();
            if (searchTerm.length < 2) {
                document.getElementById('userDetailResult').style.display = 'none';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/admin/users?search=${encodeURIComponent(searchTerm)}&limit=1`, {
                    headers: getAuthHeaders()
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const users = result.data.users || [];
                    
                    if (users.length > 0) {
                        const user = users[0];
                        
                        // æ˜¾ç¤ºç”¨æˆ·è¯¦æƒ…
                        document.getElementById('detailUsername').textContent = user.username;
                        document.getElementById('detailUserEmail').textContent = user.email;
                        document.getElementById('detailUserId').textContent = user.user_id;
                        document.getElementById('detailUserPoints').textContent = user.points_balance.toLocaleString();
                        document.getElementById('detailUserLevel').textContent = user.membership_level;
                        document.getElementById('detailUserTotal').textContent = user.total_earned.toLocaleString();
                        document.getElementById('detailCreateTime').textContent = new Date(user.created_at).toLocaleDateString();
                        document.getElementById('detailLastActive').textContent = new Date(user.last_active).toLocaleDateString();
                        
                        // åŠ è½½ç”¨æˆ·ç§¯åˆ†äº¤æ˜“è®°å½•
                        loadUserTransactions(user.user_id);
                        
                        document.getElementById('userDetailResult').style.display = 'block';
                    } else {
                        document.getElementById('userDetailResult').style.display = 'none';
                    }
                }
            } catch (error) {
                console.error('æœç´¢ç”¨æˆ·è¯¦æƒ…å¤±è´¥:', error);
            }
        }

        // åŠ è½½ç”¨æˆ·ç§¯åˆ†äº¤æ˜“è®°å½•
        async function loadUserTransactions(userId) {
            try {
                const response = await fetch(`${API_BASE}/admin/points/user/${userId}`, {
                    headers: getAuthHeaders()
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const transactions = result.data.transactions || [];
                    
                    const tbody = document.getElementById('userTransactionsList');
                    if (transactions.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 20px; color: #999;">æš‚æ— äº¤æ˜“è®°å½•</td></tr>';
                        return;
                    }
                    
                    tbody.innerHTML = transactions.map(tx => `
                        <tr>
                            <td>${new Date(tx.created_at).toLocaleDateString()}</td>
                            <td>${getTransactionTypeText(tx.transaction_type)}</td>
                            <td style="text-align: right; color: ${tx.points_change > 0 ? '#28a745' : '#dc3545'};">
                                ${tx.points_change > 0 ? '+' : ''}${tx.points_change.toLocaleString()}
                            </td>
                            <td style="text-align: right;">${tx.balance_after.toLocaleString()}</td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·äº¤æ˜“è®°å½•å¤±è´¥:', error);
            }
        }

        // æ˜¾ç¤ºæ‰¹é‡è°ƒæ•´æ¨¡æ€æ¡†
        function showBatchAdjustModal() {
            document.getElementById('batchAdjustModal').style.display = 'flex';
        }

        // å…³é—­æ‰¹é‡è°ƒæ•´æ¨¡æ€æ¡†
        function closeBatchModal() {
            document.getElementById('batchAdjustModal').style.display = 'none';
        }

        // æ·»åŠ æ‰¹é‡è°ƒæ•´è¡Œ
        function addBatchRow() {
            const container = document.getElementById('batchRows');
            const newRow = document.createElement('div');
            newRow.className = 'batch-row';
            newRow.innerHTML = `
                <input type="text" placeholder="ç”¨æˆ·ID" class="batch-user-id">
                <input type="number" placeholder="ç§¯åˆ†å˜åŠ¨" class="batch-points">
                <input type="text" placeholder="å¤‡æ³¨" class="batch-note">
                <button type="button" class="remove-row" onclick="removeBatchRow(this)">åˆ é™¤</button>
            `;
            container.appendChild(newRow);
        }

        // åˆ é™¤æ‰¹é‡è°ƒæ•´è¡Œ
        function removeBatchRow(button) {
            button.parentElement.remove();
        }

        // æäº¤æ‰¹é‡è°ƒæ•´
        async function submitBatchAdjust() {
            const reason = document.getElementById('batchReason').value.trim();
            if (!reason) {
                alert('è¯·è¾“å…¥æ‰¹é‡è°ƒæ•´åŸå› ');
                return;
            }

            const rows = document.querySelectorAll('.batch-row');
            const adjustments = [];
            
            for (const row of rows) {
                const userId = row.querySelector('.batch-user-id').value.trim();
                const pointsChange = parseInt(row.querySelector('.batch-points').value) || 0;
                const note = row.querySelector('.batch-note').value.trim();
                
                if (userId && pointsChange !== 0) {
                    adjustments.push({
                        user_id: userId,
                        points_change: pointsChange,
                        note: note
                    });
                }
            }
            
            if (adjustments.length === 0) {
                alert('è¯·æ·»åŠ è‡³å°‘ä¸€ä¸ªæœ‰æ•ˆçš„è°ƒæ•´é¡¹');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/admin/points/batch-adjust`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        adjustments: adjustments,
                        batch_reason: reason
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    alert(`æ‰¹é‡è°ƒæ•´å®Œæˆï¼æˆåŠŸ: ${result.data.summary.successful}, å¤±è´¥: ${result.data.summary.failed}`);
                    closeBatchModal();
                    loadPointsOverview();
                } else {
                    alert(result.error || 'æ‰¹é‡è°ƒæ•´å¤±è´¥');
                }
            } catch (error) {
                console.error('æ‰¹é‡è°ƒæ•´å¤±è´¥:', error);
                alert('æ‰¹é‡è°ƒæ•´å¤±è´¥');
            }
        }

        // æ˜¾ç¤ºç§¯åˆ†åˆ†æ
        function showPointsAnalytics() {
            alert('ç§¯åˆ†æ•°æ®åˆ†æåŠŸèƒ½å¼€å‘ä¸­...');
        }

        // åˆ·æ–°ç§¯åˆ†æ•°æ®
        function refreshPointsData() {
            loadPointsOverview();
        }

        // å¯¼å‡ºç§¯åˆ†æŠ¥å‘Š
        function exportPointsReport() {
            alert('ç§¯åˆ†æŠ¥å‘Šå¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...');
        }

        // æ·»åŠ æ›´æ–°ç®¡ç†å‘˜ä¿¡æ¯æ˜¾ç¤ºçš„å‡½æ•°
        function updateAdminInfoDisplay() {
            const admin = getAdminData();
            if (admin) {
                const user = admin.user || admin.admin || admin;
                const displayName = user.name || user.username || 'ç®¡ç†å‘˜';
                const displayRole = user.role || 'super_admin';

                const nameEl = document.getElementById('adminName');
                const roleEl = document.getElementById('adminRole');
                if (nameEl) nameEl.textContent = displayName;
                if (roleEl) roleEl.textContent = displayRole;
                
                console.log('âœ… ç®¡ç†å‘˜ä¿¡æ¯å·²æ›´æ–°:', displayName, displayRole);
            }
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç¡®ä¿ç®¡ç†å‘˜æ•°æ®å·²åŠ è½½
            getAdminData();
            
            // åˆå§‹åŒ–è¡¨å•äº‹ä»¶ç›‘å¬å™¨
            initPointsAdjustForm();
            
            if (checkAuth()) {
                if (setAuthHeaders()) {
                    // æ›´æ–°ç•Œé¢ä¸Šçš„ç®¡ç†å‘˜ä¿¡æ¯æ˜¾ç¤º
                    updateAdminInfoDisplay();
                    
                    checkPointsAccess();
                    loadDashboardData();
                } else {
                    showAuthError();
                }
            } else {
                showAuthError();
            }
        });
        
        // æ˜¾ç¤ºè®¤è¯é”™è¯¯
        function showAuthError() {
            document.getElementById('statsGrid').innerHTML = `
                <div class="error-message">
                    âš ï¸ è®¤è¯å¤±è´¥ï¼Œæ— æ³•åŠ è½½æ•°æ®
                    <br><button class="btn btn-primary" style="margin-top:10px;" onclick="window.open('admin-quick-fix.html', '_blank')">ä½¿ç”¨å¿«é€Ÿä¿®å¤å·¥å…·</button>
                    <br><button class="btn btn-secondary" style="margin-top:5px;" onclick="window.location.href='admin-login-simple.html'">é‡æ–°ç™»å½•</button>
                </div>`;
        }
        
        // æ‰“å¼€ä¿®å¤å·¥å…·
        function openUltimateFix() {
            window.open('admin-quick-fix.html', '_blank');
        }
    </script>

    <!-- ç§¯åˆ†è°ƒæ•´æ¨¡æ€æ¡† -->
    <div id="pointsAdjustModal" class="points-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ’ è°ƒæ•´ç”¨æˆ·ç§¯åˆ†</h2>
                <button class="close-btn" onclick="closePointsModal()">&times;</button>
            </div>
            <form id="pointsAdjustForm">
                <div class="form-group">
                    <label for="searchUserId">ç”¨æˆ·IDæˆ–ç”¨æˆ·å</label>
                    <input type="text" id="searchUserId" placeholder="è¾“å…¥ç”¨æˆ·IDæˆ–ç”¨æˆ·å" oninput="searchUser()">
                </div>
                
                <div id="userSearchResult" class="user-search-result">
                    <div class="user-info">
                        <div>
                            <strong id="selectedUsername">-</strong>
                            <br><small id="selectedUserEmail">-</small>
                        </div>
                        <div class="user-points" id="selectedUserPoints">0</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #666;">
                        ä¼šå‘˜ç­‰çº§: <span id="selectedUserLevel">-</span> | 
                        ç´¯è®¡æ”¶ç›Š: <span id="selectedUserTotal">0</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="pointsChange">ç§¯åˆ†å˜åŠ¨</label>
                    <input type="number" id="pointsChange" placeholder="æ­£æ•°ä¸ºå¢åŠ ï¼Œè´Ÿæ•°ä¸ºå‡å°‘" oninput="validatePoints()">
                </div>
                
                <div class="form-group">
                    <label for="adjustReason">è°ƒæ•´åŸå› </label>
                    <textarea id="adjustReason" rows="3" placeholder="è¯·è¾“å…¥ç§¯åˆ†è°ƒæ•´çš„è¯¦ç»†åŸå› ..."></textarea>
                </div>
                
                <div id="pointsWarning" class="points-warning"></div>
                <div id="pointsSuccess" class="points-success"></div>
                
                <div style="display: flex; gap: 10px; margin-top: 25px;">
                    <button type="button" class="btn btn-secondary" onclick="closePointsModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary" id="submitAdjust" disabled>ç¡®è®¤è°ƒæ•´</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ç”¨æˆ·ç§¯åˆ†æŸ¥è¯¢æ¨¡æ€æ¡† -->
    <div id="userPointsModal" class="points-modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>ğŸ” ç”¨æˆ·ç§¯åˆ†è¯¦æƒ…</h2>
                <button class="close-btn" onclick="closeUserPointsModal()">&times;</button>
            </div>
            
            <div class="form-group">
                <label for="searchUserIdDetail">æœç´¢ç”¨æˆ·</label>
                <input type="text" id="searchUserIdDetail" placeholder="è¾“å…¥ç”¨æˆ·IDæˆ–ç”¨æˆ·å" oninput="searchUserDetail()">
            </div>
            
            <div id="userDetailResult" style="display: none;">
                <div class="user-search-result" style="display: block;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <h3 id="detailUsername">-</h3>
                            <p id="detailUserEmail">-</p>
                            <p>ç”¨æˆ·ID: <span id="detailUserId">-</span></p>
                            <p>æ³¨å†Œæ—¶é—´: <span id="detailCreateTime">-</span></p>
                        </div>
                        <div>
                            <div class="user-points" style="font-size: 2rem;" id="detailUserPoints">0</div>
                            <p>ä¼šå‘˜ç­‰çº§: <span id="detailUserLevel">-</span></p>
                            <p>ç´¯è®¡æ”¶ç›Š: <span id="detailUserTotal">0</span></p>
                            <p>æœ€åæ´»è·ƒ: <span id="detailLastActive">-</span></p>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3>ğŸ“‹ ç§¯åˆ†äº¤æ˜“è®°å½•</h3>
                    <div style="max-height: 300px; overflow-y: auto; margin-top: 15px;">
                        <table style="width: 100%; font-size: 0.9rem;">
                            <thead>
                                <tr style="background: #f8f9fa;">
                                    <th style="padding: 8px; text-align: left;">æ—¶é—´</th>
                                    <th style="padding: 8px; text-align: left;">ç±»å‹</th>
                                    <th style="padding: 8px; text-align: right;">å˜åŠ¨</th>
                                    <th style="padding: 8px; text-align: right;">ä½™é¢</th>
                                </tr>
                            </thead>
                            <tbody id="userTransactionsList">
                                <tr><td colspan="4" style="text-align: center; padding: 20px; color: #999;">æš‚æ— æ•°æ®</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ‰¹é‡è°ƒæ•´æ¨¡æ€æ¡† -->
    <div id="batchAdjustModal" class="points-modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>ğŸ“ æ‰¹é‡ç§¯åˆ†è°ƒæ•´</h2>
                <button class="close-btn" onclick="closeBatchModal()">&times;</button>
            </div>
            
            <div class="form-group">
                <label>æ‰¹é‡è°ƒæ•´åŸå› </label>
                <input type="text" id="batchReason" placeholder="è¯·è¾“å…¥æ‰¹é‡è°ƒæ•´çš„åŸå› ">
            </div>
            
            <div id="batchInputContainer">
                <div class="batch-input">
                    <h4>è°ƒæ•´åˆ—è¡¨</h4>
                    <div id="batchRows">
                        <div class="batch-row">
                            <input type="text" placeholder="ç”¨æˆ·ID" class="batch-user-id">
                            <input type="number" placeholder="ç§¯åˆ†å˜åŠ¨" class="batch-points">
                            <input type="text" placeholder="å¤‡æ³¨" class="batch-note">
                            <button type="button" class="remove-row" onclick="removeBatchRow(this)">åˆ é™¤</button>
                        </div>
                    </div>
                    <button type="button" class="add-row" onclick="addBatchRow()">+ æ·»åŠ è¡Œ</button>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 25px;">
                <button type="button" class="btn btn-secondary" onclick="closeBatchModal()">å–æ¶ˆ</button>
                <button type="button" class="btn btn-primary" onclick="submitBatchAdjust()">æ‰¹é‡è°ƒæ•´</button>
            </div>
        </div>
    </div>

</body>
</html>
