<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>积分宝 - 管理后台</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html {
            background: #f5f7fa;
            min-height: 100vh;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f7fa;
            color: #333;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        .admin-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* 侧边栏 */
        .sidebar {
            width: 280px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .logo {
            text-align: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 30px;
        }
        
        .logo h1 {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .logo p {
            opacity: 0.8;
            font-size: 0.9rem;
            color: white;
        }
        
        .admin-info {
            padding: 15px 25px;
            background: rgba(255,255,255,0.1);
            margin: 0 20px 20px 20px;
            border-radius: 10px;
            font-size: 0.9rem;
            color: white;
        }
        
        .menu-item {
            display: block;
            color: white;
            text-decoration: none;
            padding: 15px 25px;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        
        .menu-item:hover {
            background: rgba(255,255,255,0.1);
            color: white;
            border-left-color: #fff;
            text-decoration: none;
        }
        
        .menu-item.active {
            background: rgba(255,255,255,0.15);
            color: white;
            border-left-color: #fff;
        }
        
        .menu-icon {
            display: inline-block;
            width: 20px;
            margin-right: 10px;
            text-align: center;
        }
        
        .logout-btn {
            position: absolute;
            bottom: 20px;
            left: 25px;
            right: 25px;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        /* 主内容区域 */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #4caf50;
            color: white;
        }
        
        .btn-success:hover {
            background: #45a049;
        }
        
        /* 统计卡片 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin-bottom: 15px;
        }
        
        .stat-icon.revenue { background: linear-gradient(135deg, #4caf50, #45a049); }
        .stat-icon.users { background: linear-gradient(135deg, #2196f3, #1976d2); }
        .stat-icon.installs { background: linear-gradient(135deg, #ff9800, #f57c00); }
        .stat-icon.ads { background: linear-gradient(135deg, #9c27b0, #7b1fa2); }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 900;
            color: #333;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .stat-change {
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .stat-change.positive {
            color: #4caf50;
        }
        
        .stat-change.negative {
            color: #f44336;
        }
        
        .positive {
            color: #48bb78;
        }
        
        .negative {
            color: #f56565;
        }
        
        /* 筛选栏样式 */
        .filter-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .filter-group label {
            font-weight: 500;
            color: #4a5568;
        }
        
        .filter-group select {
            padding: 8px 12px;
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            background: white;
            font-size: 0.9rem;
            cursor: pointer;
        }
        
        .filter-actions {
            display: flex;
            gap: 10px;
        }
        
        /* 图表容器 */
        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
        }
        
        /* 表格样式 */
        .table-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .table-header {
            padding: 20px 25px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
        }
        
        .search-box {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            width: 250px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #555;
            border-bottom: 1px solid #eee;
        }
        
        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-active {
            background: #e8f5e8;
            color: #4caf50;
        }
        
        .status-inactive {
            background: #ffebee;
            color: #f44336;
        }
        
        .status-premium {
            background: #fff3e0;
            color: #ff9800;
        }
        
        /* 页面切换 */
        .page {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .page.active {
            display: block;
        }
        
        /* 加载状态 */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 错误状态 */
        .error-message {
            background: #ffebee;
            color: #d32f2f;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #d32f2f;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
        }
        
        /* 积分管理专用样式 */
        .points-operations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .operation-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .operation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #667eea;
        }
        
        .operation-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px auto;
        }
        
        .operation-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .operation-card p {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .points-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .modal-header h2 {
            color: #333;
            margin: 0;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
            padding: 5px;
        }
        
        .close-btn:hover {
            color: #333;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .user-search-result {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            display: none;
        }
        
        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .user-points {
            font-size: 1.2rem;
            font-weight: bold;
            color: #28a745;
        }
        
        .points-warning {
            color: #dc3545;
            font-size: 0.9rem;
            margin-top: 10px;
            padding: 10px;
            background: #f8d7da;
            border-radius: 5px;
            display: none;
        }
        
        .points-success {
            color: #155724;
            font-size: 0.9rem;
            margin-top: 10px;
            padding: 10px;
            background: #d4edda;
            border-radius: 5px;
            display: none;
        }
        
        .batch-input {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .batch-row {
            display: grid;
            grid-template-columns: 2fr 1fr 2fr auto;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .remove-row {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .add-row {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 15px;
            cursor: pointer;
            margin-top: 10px;
        }
    </style>
        
        <style>
            /* 现代化主题系统 */
            :root {
                /* 现代渐变色调 */
                --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
                --accent-gradient: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
                
                /* 圆角系统 */
                --radius-xs: 4px;
                --radius-sm: 8px;
                --radius-md: 16px;
                --radius-lg: 24px;
                --radius-xl: 32px;
                
                /* 现代阴影系统 */
                --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
                --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
                --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
                --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
                --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
                --shadow-glow: 0 0 0 1px rgba(99, 102, 241, 0.05), 0 1px 3px 0 rgba(0, 0, 0, 0.1);
                
                /* 品牌色系 */
                --brand: #667eea;
                --brand-2: #764ba2;
                --brand-light: #eef2ff;
                --accent: #f093fb;
                --accent-light: #fdf2ff;
                
                /* 语义色彩 */
                --success: #10b981;
                --success-light: #ecfdf5;
                --warning: #f59e0b;
                --warning-light: #fffbeb;
                --error: #ef4444;
                --error-light: #fef2f2;
                --info: #3b82f6;
                --info-light: #eff6ff;
                
                /* 文字色系 */
                --text-1: #111827;
                --text-2: #374151;
                --text-3: #6b7280;
                --text-4: #9ca3af;
                
                /* 背景色系 */
                --bg-1: #ffffff;
                --bg-2: #f9fafb;
                --bg-3: #f3f4f6;
                --bg-4: #e5e7eb;
                
                /* 边框色系 */
                --line: #e5e7eb;
                --line-light: #f3f4f6;
                --line-dark: #d1d5db;
                
                /* 过渡动画 */
                --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
                --transition-bounce: 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            }
            body {
                letter-spacing: 0.2px !important;
                color: var(--text-1) !important;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                background-attachment: fixed !important;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
                font-weight: 400 !important;
                line-height: 1.5 !important;
                margin: 0 !important;
                padding: 0 !important;
                min-height: 100vh !important;
            }
            
            /* 主内容区域现代化 */
            .main-content {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(20px);
                border-radius: var(--radius-lg);
                margin: var(--radius-md);
                box-shadow: var(--shadow-xl);
            }
            /* 现代化按钮样式 */
            .btn, .modern-btn, .premium-btn {
                border-radius: var(--radius-md) !important;
                box-shadow: var(--shadow-sm);
                border: none;
                font-weight: 500;
                transition: all var(--transition);
                position: relative;
                overflow: hidden;
            }
            
            .btn-primary {
                background: var(--primary-gradient) !important;
                border: none !important;
                color: white !important;
            }
            
            .btn-success {
                background: var(--success-gradient) !important;
                border: none !important;
                color: white !important;
            }
            
            .btn-warning {
                background: var(--warning-gradient) !important;
                border: none !important;
                color: white !important;
            }
            
            .btn:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-lg);
            }
            
            /* 现代化容器样式 */
            .table-container, .chart-container, .admob-card, .settings-card, .dashboard-card, .premium-action-panel {
                border-radius: var(--radius-lg) !important;
                box-shadow: var(--shadow-md);
                border: 1px solid var(--line-light);
                background: var(--bg-1);
                transition: all var(--transition);
            }
            
            .table-container:hover, .chart-container:hover, .admob-card:hover, .settings-card:hover, .dashboard-card:hover {
                box-shadow: var(--shadow-lg);
                transform: translateY(-2px);
            }
            
            /* 统计卡片现代化 */
            .stat-card, .premium-stat-card {
                border-radius: var(--radius-xl) !important;
                background: var(--bg-1);
                box-shadow: var(--shadow-md);
                border: 1px solid var(--line-light);
                transition: all var(--transition);
                position: relative;
                overflow: hidden;
            }
            
            .stat-card:hover, .premium-stat-card:hover {
                transform: translateY(-4px);
                box-shadow: var(--shadow-xl);
            }
            
            /* 渐变背景装饰 */
            .stat-card::before, .premium-stat-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: var(--primary-gradient);
                opacity: 0;
                transition: opacity var(--transition);
            }
            
            .stat-card:hover::before, .premium-stat-card:hover::before {
                opacity: 1;
            }
            /* 现代化表单元素 */
            input, select, textarea {
                border-radius: var(--radius-md) !important;
                border: 2px solid var(--line-light);
                padding: 12px 16px;
                font-size: 14px;
                transition: all var(--transition);
                background: var(--bg-1);
                color: var(--text-1);
            }
            
            input:focus, select:focus, textarea:focus {
                outline: none;
                border-color: var(--brand);
                box-shadow: var(--shadow-glow);
                transform: translateY(-1px);
            }
            
            /* 表格现代化 */
            .table {
                border-radius: var(--radius-lg);
                overflow: hidden;
                box-shadow: var(--shadow-sm);
                border: none;
            }
            
            .table th {
                background: var(--bg-2);
                border: none;
                font-weight: 600;
                color: var(--text-2);
                padding: 16px 20px;
            }
            
            .table td {
                border: none;
                padding: 16px 20px;
                border-bottom: 1px solid var(--line-light);
                transition: background-color var(--transition);
            }
            
            .table tr:hover td {
                background: var(--bg-2);
            }
            /* 统一按钮配色更轻量 */
            .btn.btn-primary, .modern-btn.primary, .premium-btn.primary { background: linear-gradient(135deg,var(--brand) 0%, var(--brand-2) 100%); }
            .btn.btn-success, .modern-btn.success { background: #16a34a; }
            .btn.btn-secondary, .modern-btn.secondary, .premium-btn.secondary { background: #eef2ff; color: #374151; border: 1px solid #e5e7eb; }
            .btn:hover, .modern-btn:hover, .premium-btn:hover { filter: brightness(1.02); transform: translateY(-1px); }
            
            /* 骨架屏样式 */
            .skeleton { animation: pulse 1.3s ease-in-out infinite; background: linear-gradient(90deg,#f2f3f7 25%, #e6e8ee 37%, #f2f3f7 63%); background-size: 400% 100%; border-radius: var(--radius-sm); }
            .skeleton-card { background: var(--bg-1); border: 1px solid var(--line); border-radius: var(--radius-md); padding: 20px; box-shadow: var(--shadow-sm); }
            .skeleton-line { height: 12px; margin: 8px 0; }
            .skeleton-btn { height: 36px; width: 120px; }
            .skeleton-chip { height: 24px; width: 80px; border-radius: 999px; }
            .skeleton-icon { width: 48px; height: 48px; border-radius: var(--radius-md); }
            .skeleton-grid { display: grid; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); gap: 16px; }
            @keyframes pulse { 0%{background-position:100% 50%} 100%{background-position:0 50%} }
        </style>
        <!-- 现代化UI增强样式 -->
        <style>
            /* === 现代化组件样式覆盖 === */
            
            /* x_panel 现代化 */
            .x_panel {
                background: rgba(255, 255, 255, 0.95) !important;
                backdrop-filter: blur(10px);
                border: 1px solid var(--line-light) !important;
                border-radius: var(--radius-lg) !important;
                box-shadow: var(--shadow-md) !important;
                margin-bottom: 32px !important;
                overflow: hidden;
                transition: all var(--transition);
                position: relative;
            }
            
            .x_panel::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 3px;
                background: var(--primary-gradient);
                opacity: 0;
                transition: opacity var(--transition);
            }
            
            .x_panel:hover {
                box-shadow: var(--shadow-lg) !important;
                transform: translateY(-4px);
            }
            
            .x_panel:hover::before {
                opacity: 1;
            }
            
            /* 面板标题现代化 */
            .x_title h2 {
                color: var(--text-1) !important;
                font-weight: 600 !important;
                font-size: 20px !important;
                margin: 0 !important;
                padding: 20px 24px !important;
                border-bottom: 2px solid var(--line-light) !important;
                background: var(--bg-2) !important;
            }
            
            .x_content {
                padding: 24px !important;
            }
            
            /* page-title 现代化 */
            .page-title h3 {
                color: var(--text-1) !important;
                font-weight: 700 !important;
                font-size: 28px !important;
                margin-bottom: 8px !important;
                background: var(--primary-gradient);
                background-clip: text;
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
            }
            
            .page-title p {
                color: var(--text-3) !important;
                font-size: 16px !important;
                margin: 0 !important;
            }
            
            /* tile 统计卡片现代化 */
            .tile {
                background: rgba(255, 255, 255, 0.95) !important;
                backdrop-filter: blur(10px);
                border: 1px solid var(--line-light) !important;
                border-radius: var(--radius-xl) !important;
                box-shadow: var(--shadow-md) !important;
                transition: all var(--transition);
                position: relative;
                overflow: hidden;
            }
            
            .tile::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: var(--success-gradient);
                opacity: 0.8;
            }
            
            .tile:hover {
                box-shadow: var(--shadow-xl) !important;
                transform: translateY(-6px);
            }
            
            /* count 数字样式现代化 */
            .count {
                font-size: 42px !important;
                font-weight: 700 !important;
                color: var(--text-1) !important;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            
            /* 表格现代化增强 */
            .jambo_table {
                border-radius: var(--radius-lg) !important;
                overflow: hidden;
                box-shadow: var(--shadow-sm) !important;
                border: none !important;
            }
            
            .jambo_table thead th {
                background: var(--primary-gradient) !important;
                color: white !important;
                border: none !important;
                font-weight: 600 !important;
                padding: 20px !important;
                font-size: 14px !important;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            
            .jambo_table tbody td {
                border: none !important;
                padding: 20px !important;
                border-bottom: 1px solid var(--line-light) !important;
                transition: background-color var(--transition);
                color: var(--text-2) !important;
            }
            
            .jambo_table tbody tr:hover td {
                background: var(--bg-2) !important;
            }
            
            /* 表单控件现代化增强 */
            .form-control {
                border: 2px solid var(--line-light) !important;
                border-radius: var(--radius-md) !important;
                padding: 12px 16px !important;
                font-size: 14px !important;
                transition: all var(--transition);
                background: var(--bg-1) !important;
                color: var(--text-1) !important;
            }
            
            .form-control:focus {
                outline: none !important;
                border-color: var(--brand) !important;
                box-shadow: var(--shadow-glow) !important;
                transform: translateY(-1px);
            }
            
            /* 现代化按钮增强 */
            .btn-outline-primary {
                background: transparent !important;
                border: 2px solid var(--brand) !important;
                color: var(--brand) !important;
            }
            
            .btn-outline-primary:hover {
                background: var(--primary-gradient) !important;
                color: white !important;
                transform: translateY(-2px);
            }
            
            /* 开关按钮现代化 */
            .switch {
                position: relative;
                display: inline-block;
                width: 52px;
                height: 28px;
            }
            
            .switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }
            
            .slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: var(--line);
                transition: var(--transition);
                border-radius: 28px;
            }
            
            .slider:before {
                position: absolute;
                content: "";
                height: 22px;
                width: 22px;
                left: 3px;
                bottom: 3px;
                background-color: white;
                transition: var(--transition);
                border-radius: 50%;
                box-shadow: var(--shadow-sm);
            }
            
            input:checked + .slider {
                background: var(--primary-gradient);
            }
            
            input:checked + .slider:before {
                transform: translateX(24px);
            }
            
            /* 侧边栏保持简洁 */
            .sidebar {
                width: 280px !important;
            }
            
            /* 简化背景样式 */
            html, body {
                background: #f5f7fa !important;
            }
            
            .main-content {
                margin-left: 280px !important;
            }
            
        </style>
    </head>
    <body>
    <div class="admin-container">
        <!-- 侧边栏 -->
        <nav class="sidebar">
            <div class="logo">
                <h1>💎 积分宝</h1>
                <p>管理后台</p>
            </div>
            
            <div class="admin-info" id="adminInfo">
                <div>🛡️ <span id="adminName">加载中...</span></div>
                <div style="opacity: 0.7; font-size: 0.8rem;">权限: <span id="adminRole">-</span></div>
                <div id="adminFixHint" style="display:none; margin-top:6px;">
                    <button class="btn btn-primary" style="padding:6px 10px; font-size:12px;" onclick="openUltimateFix()">修复认证</button>
                </div>
            </div>
            
            <a href="#" class="menu-item active" onclick="showPage('dashboard')">
                <span class="menu-icon">📊</span>
                数据概览
            </a>
            
            <a href="#" class="menu-item" onclick="showPage('admob')">
                <span class="menu-icon">📱</span>
                AdMob收益
            </a>
            
            <a href="#" class="menu-item" onclick="showPage('users')">
                <span class="menu-icon">👥</span>
                用户管理
            </a>
            
            <a href="#" class="menu-item" onclick="showPage('points')" id="pointsMenuItem" style="display: none;">
                <span class="menu-icon">💎</span>
                积分管理
            </a>
            
            <a href="#" class="menu-item" onclick="showPage('revenue')">
                <span class="menu-icon">💰</span>
                收益报告
            </a>
            
            <a href="#" class="menu-item" onclick="showPage('analytics')">
                <span class="menu-icon">📈</span>
                数据分析
            </a>
            
            <a href="#" class="menu-item" onclick="showPage('pointsConfig')">
                <span class="menu-icon">🎯</span>
                积分配置
            </a>
            
            <a href="#" class="menu-item" onclick="showPage('admobConfig')">
                <span class="menu-icon">📱</span>
                广告配置
            </a>
            
            <a href="#" class="menu-item" onclick="showPage('settings')">
                <span class="menu-icon">⚙️</span>
                系统设置
            </a>
            
            <button class="logout-btn" onclick="logout()">
                🚪 退出登录
            </button>
        </nav>
        
        <!-- 主内容区域 -->
        <main class="main-content">
            <!-- 数据概览页面 -->
            <div id="dashboard" class="page active">
                <div class="header">
                    <h1>📊 数据概览</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="refreshData()">刷新数据</button>
                        <button class="btn btn-success" onclick="exportReport()">导出报告</button>
                    </div>
                </div>
                
                <!-- 统计卡片 -->
                <div class="stats-grid" id="statsGrid">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>正在加载数据...</div>
                    </div>
                </div>
                
                <!-- 收益趋势图 -->
                <div class="chart-container">
                    <div class="chart-header">
                        <h2 class="chart-title">收益趋势</h2>
                    </div>
                    <canvas id="revenueChart" width="400" height="200"></canvas>
                </div>
            </div>
            
            <!-- AdMob收益页面 -->
            <div id="admob" class="page">
                <div class="header">
                    <h1>📱 AdMob 收益分析</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="syncAdMobData()">同步AdMob数据</button>
                    </div>
                </div>
                
                <div id="admobContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>正在加载AdMob数据...</div>
                    </div>
                </div>
            </div>
            
            <!-- 用户管理页面 -->
            <div id="users" class="page">
                <div class="header">
                    <h1>👥 用户管理</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="addUser()">添加用户</button>
                        <button class="btn btn-success" onclick="exportUsers()">导出用户</button>
                    </div>
                </div>
                
                <div id="usersContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>正在加载用户数据...</div>
                    </div>
                </div>
            </div>
            
            <!-- 收益报告页面 -->
            <div id="revenue" class="page">
                <div class="header">
                    <h1>💰 收益报告</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="generateReport()">生成报告</button>
                    </div>
                </div>
                
                <div id="revenueContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>正在加载收益数据...</div>
                    </div>
                </div>
            </div>
            
            <!-- 积分管理页面 (仅超级管理员) -->
            <div id="points" class="page">
                <div class="header">
                    <h1>💎 积分管理系统</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="refreshPointsData()">刷新数据</button>
                        <button class="btn btn-success" onclick="showPointsAdjustModal()">调整积分</button>
                        <button class="btn btn-info" onclick="exportPointsReport()">导出报告</button>
                    </div>
                </div>

                <!-- 积分概览统计 -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <h3>总积分池</h3>
                        <div class="metric-value" id="totalPointsPool">-</div>
                        <div class="metric-trend">
                            <span class="trend-icon">💎</span>
                            <span>全平台积分总和</span>
                        </div>
                    </div>
                    <div class="metric-card">
                        <h3>今日积分发放</h3>
                        <div class="metric-value" id="todayPointsEarned">-</div>
                        <div class="metric-trend">
                            <span class="trend-icon">⬆️</span>
                            <span>用户今日获得积分</span>
                        </div>
                    </div>
                    <div class="metric-card">
                        <h3>今日积分消耗</h3>
                        <div class="metric-value" id="todayPointsSpent">-</div>
                        <div class="metric-trend">
                            <span class="trend-icon">⬇️</span>
                            <span>用户今日消费积分</span>
                        </div>
                    </div>
                    <div class="metric-card">
                        <h3>富豪用户</h3>
                        <div class="metric-value" id="richUsers">-</div>
                        <div class="metric-trend">
                            <span class="trend-icon">👑</span>
                            <span>积分>10万的用户</span>
                        </div>
                    </div>
                </div>

                <!-- 积分操作面板 -->
                <div class="section">
                    <h2>💰 积分操作面板</h2>
                    <div class="points-operations">
                        <div class="operation-card" onclick="showUserPointsSearch()">
                            <div class="operation-icon">🔍</div>
                            <h3>查看用户积分</h3>
                            <p>查看任意用户的积分详情和历史记录</p>
                        </div>
                        <div class="operation-card" onclick="showPointsAdjustModal()">
                            <div class="operation-icon">⚖️</div>
                            <h3>调整用户积分</h3>
                            <p>手动增加或减少用户积分余额</p>
                        </div>
                        <div class="operation-card" onclick="showBatchAdjustModal()">
                            <div class="operation-icon">📝</div>
                            <h3>批量积分调整</h3>
                            <p>批量调整多个用户的积分</p>
                        </div>
                        <div class="operation-card" onclick="showPointsAnalytics()">
                            <div class="operation-icon">📊</div>
                            <h3>积分数据分析</h3>
                            <p>分析积分流动和用户行为</p>
                        </div>
                    </div>
                </div>

                <!-- 积分交易记录 -->
                <div class="section">
                    <h2>📋 最近积分交易</h2>
                    <div class="table-container">
                        <table id="pointsTransactionsTable">
                            <thead>
                                <tr>
                                    <th>时间</th>
                                    <th>用户</th>
                                    <th>类型</th>
                                    <th>积分变动</th>
                                    <th>余额</th>
                                    <th>说明</th>
                                    <th>操作员</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 40px; color: #999;">
                                        正在加载积分交易数据...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 积分类型统计 -->
                <div class="section">
                    <h2>📈 积分类型分析</h2>
                    <div class="chart-grid">
                        <div class="chart-card">
                            <h3>积分获得途径</h3>
                            <canvas id="pointsEarnChart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>积分消费类型</h3>
                            <canvas id="pointsSpendChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 数据分析页面 -->
            <div id="analytics" class="page">
                <div class="header">
                    <h1>📈 数据分析</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="loadAnalyticsData()">刷新数据</button>
                        <button class="btn btn-success" onclick="exportAnalyticsReport()">导出分析报告</button>
                    </div>
                </div>
                
                <div id="analyticsContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>正在加载分析数据...</div>
                    </div>
                </div>
            </div>
            
            <!-- 积分配置页面 -->
            <div id="pointsConfig" class="page">
                <div class="header">
                    <h1>🎯 积分配置管理</h1>
                    <p>配置各种积分获取方式的数值和规则</p>
                </div>
                
                <div id="pointsConfigContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>正在加载积分配置...</div>
                    </div>
                </div>
            </div>
            
            <!-- 广告配置页面 -->
            <div id="admobConfig" class="page">
                <div class="header">
                    <h1>📱 AdMob广告配置</h1>
                    <p>管理应用内广告单元和显示策略</p>
                </div>
                
                <div id="admobConfigContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>正在加载广告配置...</div>
                    </div>
                </div>
            </div>

            <!-- 系统设置页面 -->
            <div id="settings" class="page">
                <div class="header">
                    <h1>⚙️ 系统设置</h1>
                </div>
                
                <div id="settingsContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>正在加载系统配置...</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // API配置
        const API_BASE_URL = 'http://192.168.1.29:3001/api';
        let authToken = null;
        let adminData = null;
        
        // 认证相关（兼容多种本地结构）
        function getAuthToken() {
            const candidateKeys = ['adminAuth', 'admin_auth', 'auth_data', 'session_data'];
            for (const key of candidateKeys) {
                const raw = localStorage.getItem(key) || sessionStorage.getItem(key);
                if (!raw) continue;
                try {
                    const parsed = JSON.parse(raw);
                    if (parsed?.token) return parsed.token;
                    if (parsed?.access_token) return parsed.access_token;
                } catch (_) {}
            }
            return localStorage.getItem('adminToken') || sessionStorage.getItem('adminToken') || null;
        }
        
        function setAuthHeaders() {
            authToken = getAuthToken();
            if (!authToken) {
                const hint = document.getElementById('adminFixHint');
                if (hint) hint.style.display = 'block';
                if (typeof showAuthError === 'function') {
                    showAuthError('未认证，请点击“修复认证”或前往系统设置执行修复');
                }
                return false;
            }
            return true;
        }
        
        // API请求函数
        async function apiRequest(endpoint, options = {}) {
            if (!authToken) {
                authToken = getAuthToken();
                if (!authToken) throw new Error('未认证');
            }
            
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`,
                    ...options.headers
                },
                ...options
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}${endpoint}`, config);
                const data = await response.json();
                
                if (!response.ok) {
                    if (response.status === 401 || response.status === 403) {
                        if (typeof showAuthError === 'function') {
                            showAuthError('认证失效，请点击“修复认证”重新获取Token');
                        }
                        throw new Error('未认证');
                    }
                    throw new Error(data.error || `HTTP ${response.status}`);
                }
                
                return data;
            } catch (error) {
                console.error('API请求失败:', error);
                throw error;
            }
        }
        
        // 加载仪表板数据
        async function loadDashboardData() {
            try {
                const data = await apiRequest('/admin/dashboard');
                
                const statsHtml = `
                    <div class="stat-card">
                        <div class="stat-icon revenue">💰</div>
                        <div class="stat-value">$${data.data.revenue.today.toFixed(2)}</div>
                        <div class="stat-label">今日总收益</div>
                        <div class="stat-change positive">↗ +${data.data.revenue.growth}% 较昨日</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon users">👥</div>
                        <div class="stat-value">${data.data.activeUsers.count.toLocaleString()}</div>
                        <div class="stat-label">活跃用户</div>
                        <div class="stat-change positive">↗ +${data.data.activeUsers.growth}% 较昨日</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon installs">📱</div>
                        <div class="stat-value">${data.data.newUsers.today.toLocaleString()}</div>
                        <div class="stat-label">今日新增用户</div>
                        <div class="stat-change positive">↗ +${data.data.newUsers.growth}% 较昨日</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon ads">📺</div>
                        <div class="stat-value">${data.data.adImpressions.today.toLocaleString()}</div>
                        <div class="stat-label">广告展示次数</div>
                        <div class="stat-change positive">↗ +${data.data.adImpressions.growth}% 较昨日</div>
                    </div>
                `;
                
                document.getElementById('statsGrid').innerHTML = statsHtml;
                
                // 加载收益趋势图
                loadRevenueChart();
                
            } catch (error) {
                console.error('加载仪表板数据失败:', error);
                document.getElementById('statsGrid').innerHTML = `
                    <div class="error-message">
                        ⚠️ 加载数据失败: ${error.message}
                        <br><button onclick="loadDashboardData()" style="margin-top:10px;" class="btn btn-primary">重试</button>
                        <br><button onclick="openDataFix()" style="margin-top:5px;" class="btn btn-success">🔧 数据修复工具</button>
                    </div>
                `;
            }
        }
        
        // 加载收益趋势图
        async function loadRevenueChart() {
            try {
                const data = await apiRequest('/admin/revenue-trend?days=7');
                
                const ctx = document.getElementById('revenueChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.data.map(item => new Date(item.date).toLocaleDateString('zh-CN')),
                        datasets: [{
                            label: '每日收益 ($)',
                            data: data.data.map(item => item.revenue),
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value;
                                    }
                                }
                            }
                        }
                    }
                });
                
            } catch (error) {
                console.error('加载收益趋势图失败:', error);
            }
        }
        
        // 页面切换
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');

            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            if (event && event.target && event.target.classList) event.target.classList.add('active');

            // 如果未认证，给出友好提示并阻止加载
            if (!setAuthHeaders()) {
                const containerMap = { dashboard: 'statsGrid', admob: 'admobContent', users: 'usersContent', revenue: 'revenueContent' };
                const cid = containerMap[pageId];
                if (cid && document.getElementById(cid)) {
                    document.getElementById(cid).innerHTML = `
                        <div class="error-message">⚠️ 未认证，无法加载数据。
                        <br><button class="btn btn-primary" style="margin-top:10px;" onclick="openUltimateFix()">修复认证</button></div>`;
                }
                return;
            }

            if (pageId === 'dashboard') {
                loadDashboardData();
            } else if (pageId === 'admob') {
                loadAdMobData();
            } else if (pageId === 'users') {
                loadUsersData();
            } else if (pageId === 'revenue') {
                loadRevenueData();
            } else if (pageId === 'points') {
                loadPointsOverview();
            } else if (pageId === 'analytics') {
                loadAnalyticsData();
            } else if (pageId === 'pointsConfig') {
                loadPointsConfigData();
            } else if (pageId === 'admobConfig') {
                loadAdMobConfigData();
            } else if (pageId === 'settings') {
                loadSettingsData();
            }
        }
        
        // 加载AdMob数据
        async function loadAdMobData() {
            try {
                const data = await apiRequest('/admin/admob/revenue');
                
                const admobHtml = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon revenue">💵</div>
                            <div class="stat-value">$${data.data.totalRevenue.toFixed(2)}</div>
                            <div class="stat-label">今日AdMob收益</div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">广告单元详细数据</h3>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>广告单元ID</th>
                                    <th>广告类型</th>
                                    <th>展示次数</th>
                                    <th>点击次数</th>
                                    <th>收益</th>
                                    <th>eCPM</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.data.adUnits.map(unit => `
                                    <tr>
                                        <td>${unit.ad_unit_id}</td>
                                        <td>${unit.ad_type}</td>
                                        <td>${unit.impressions.toLocaleString()}</td>
                                        <td>${unit.clicks.toLocaleString()}</td>
                                        <td>$${unit.revenue.toFixed(2)}</td>
                                        <td>$${unit.ecpm.toFixed(2)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                
                document.getElementById('admobContent').innerHTML = admobHtml;
                
            } catch (error) {
                console.error('加载AdMob数据失败:', error);
                document.getElementById('admobContent').innerHTML = `
                    <div class="error-message">
                        ⚠️ 加载AdMob数据失败: ${error.message}
                    </div>
                `;
            }
        }
        
        // 加载用户数据
        async function loadUsersData() {
            try {
                const [usersData, statsData] = await Promise.all([
                    apiRequest('/admin/users'),
                    apiRequest('/admin/users/stats')
                ]);
                
                const usersHtml = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon users">👥</div>
                            <div class="stat-value">${statsData.data.total_users.toLocaleString()}</div>
                            <div class="stat-label">总用户数</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon revenue">⚡</div>
                            <div class="stat-value">${statsData.data.active_users.toLocaleString()}</div>
                            <div class="stat-label">活跃用户</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon installs">💎</div>
                            <div class="stat-value">${statsData.data.vip_users.toLocaleString()}</div>
                            <div class="stat-label">VIP用户</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon ads">📊</div>
                            <div class="stat-value">${statsData.data.daily_new_users.toLocaleString()}</div>
                            <div class="stat-label">今日新增</div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">用户列表</h3>
                            <input type="text" class="search-box" placeholder="搜索用户..." onkeyup="searchUsers(this.value)">
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>用户ID</th>
                                    <th>用户名</th>
                                    <th>邮箱</th>
                                    <th>积分余额</th>
                                    <th>会员等级</th>
                                    <th>状态</th>
                                    <th>注册时间</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${usersData.data.users.map(user => `
                                    <tr>
                                        <td>${user.user_id}</td>
                                        <td>${user.username || '-'}</td>
                                        <td>${user.email || '-'}</td>
                                        <td>${parseInt(user.points_balance).toLocaleString()}</td>
                                        <td><span class="status-badge status-premium">${user.membership_level}</span></td>
                                        <td><span class="status-badge ${user.status === 'active' ? 'status-active' : 'status-inactive'}">${user.status === 'active' ? '活跃' : '非活跃'}</span></td>
                                        <td>${new Date(user.created_at).toLocaleDateString('zh-CN')}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                
                document.getElementById('usersContent').innerHTML = usersHtml;
                
            } catch (error) {
                console.error('加载用户数据失败:', error);
                document.getElementById('usersContent').innerHTML = `
                    <div class="error-message">
                        ⚠️ 加载用户数据失败: ${error.message}
                    </div>
                `;
            }
        }
        
        // 退出登录
        function logout() {
            localStorage.removeItem('adminAuth');
            sessionStorage.removeItem('adminAuth');
            window.location.href = 'admin-test.html';
        }
        
        // 刷新数据
        function refreshData() {
            loadDashboardData();
            alert('📊 数据已刷新！');
        }
        
        // 检查认证状态
        function checkAuth() {
            const authData = localStorage.getItem('adminAuth') || sessionStorage.getItem('adminAuth');
            
            if (!authData) {
                console.log('❌ 未找到认证数据');
                showAuthError('未找到认证数据，请点击修复认证');
                return false;
            }
            
            try {
                const auth = JSON.parse(authData);
                adminData = auth;

                const user = auth.user || auth.admin || auth;
                const displayName = user.name || user.username || '管理员';
                const displayRole = user.role || 'super_admin';

                const nameEl = document.getElementById('adminName');
                const roleEl = document.getElementById('adminRole');
                if (nameEl) nameEl.textContent = displayName;
                if (roleEl) roleEl.textContent = displayRole;

                return true;
            } catch (error) {
                console.error('解析认证数据失败:', error);
                logout();
                return false;
            }
        }
        
        // 获取管理员信息（确保adminData已初始化）
        function getAdminData() {
            if (!adminData) {
                const authData = localStorage.getItem('adminAuth') || sessionStorage.getItem('adminAuth');
                if (authData) {
                    try {
                        adminData = JSON.parse(authData);
                    } catch (error) {
                        console.error('解析管理员数据失败:', error);
                    }
                }
            }
            return adminData;
        }
        
        // 其他功能函数
        function syncAdMobData() {
            alert('🔄 AdMob数据同步中...');
        }
        
        function exportReport() {
            alert('📄 报告已导出！');
        }
        
        function addUser() {
            alert('➕ 添加用户功能');
        }
        
        function exportUsers() {
            alert('📄 用户数据已导出！');
        }
        
        function generateReport() {
            alert('📊 正在生成收益报告...');
        }
        
        function searchUsers(query) {
            // 实现用户搜索功能
            console.log('搜索用户:', query);
        }
        
        // 加载收益报告数据
        async function loadRevenueData(period = '30') {
            try {
                const data = await apiRequest(`/admin/revenue/report?period=${period}`);
                
                const revenueHtml = `
                    <!-- 收益概览卡片 -->
                    <div class="stats-grid" style="margin-bottom: 30px;">
                        <div class="stat-card">
                            <div class="stat-icon revenue">💰</div>
                            <div class="stat-value">$${data.data.summary.total_revenue.toFixed(2)}</div>
                            <div class="stat-label">总收益 (${period}天)</div>
                            <div class="stat-change ${data.data.summary.growth_rate >= 0 ? 'positive' : 'negative'}">
                                ${data.data.summary.growth_rate >= 0 ? '↗' : '↘'} ${Math.abs(data.data.summary.growth_rate).toFixed(1)}%
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">📱</div>
                            <div class="stat-value">$${data.data.summary.admob_total.toFixed(2)}</div>
                            <div class="stat-label">AdMob收益</div>
                            <div class="stat-change">${((data.data.summary.admob_total / data.data.summary.total_revenue) * 100).toFixed(1)}%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">🛒</div>
                            <div class="stat-value">$${data.data.summary.iap_total.toFixed(2)}</div>
                            <div class="stat-label">应用内购买</div>
                            <div class="stat-change">${((data.data.summary.iap_total / data.data.summary.total_revenue) * 100).toFixed(1)}%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">📊</div>
                            <div class="stat-value">$${data.data.summary.avg_daily_revenue.toFixed(2)}</div>
                            <div class="stat-label">日均收益</div>
                        </div>
                    </div>
                    
                    <!-- 时间范围选择器 -->
                    <div class="filter-bar" style="margin-bottom: 20px;">
                        <div class="filter-group">
                            <label>时间范围:</label>
                            <select id="revenuePeriodSelect" onchange="loadRevenueData(this.value)">
                                <option value="7" ${period === '7' ? 'selected' : ''}>最近7天</option>
                                <option value="30" ${period === '30' ? 'selected' : ''}>最近30天</option>
                                <option value="90" ${period === '90' ? 'selected' : ''}>最近90天</option>
                            </select>
                        </div>
                        <div class="filter-actions">
                            <button class="btn btn-primary" onclick="exportRevenueReport()">导出报告</button>
                        </div>
                    </div>
                    
                    <!-- 收益趋势图 -->
                    <div class="chart-container" style="margin-bottom: 30px;">
                        <div class="chart-header">
                            <h3 class="chart-title">收益趋势图</h3>
                        </div>
                        <canvas id="revenueLineChart" width="400" height="200"></canvas>
                    </div>
                    
                    <!-- 收益来源饼图 -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">收益来源分布</h3>
                            </div>
                            <canvas id="revenueSourceChart" width="300" height="300"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">地区收益分布</h3>
                            </div>
                            <canvas id="revenueCountryChart" width="300" height="300"></canvas>
                        </div>
                    </div>
                    
                    <!-- 详细数据表格 -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">每日收益明细</h3>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>日期</th>
                                    <th>AdMob收益</th>
                                    <th>应用内购买</th>
                                    <th>总收益</th>
                                    <th>同比增长</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.data.daily_data.map((item, index) => {
                                    const prevRevenue = index > 0 ? data.data.daily_data[index - 1].total_revenue : item.total_revenue;
                                    const growth = ((item.total_revenue - prevRevenue) / prevRevenue * 100).toFixed(1);
                                    return `
                                        <tr>
                                            <td>${item.date}</td>
                                            <td>$${item.admob_revenue.toFixed(2)}</td>
                                            <td>$${item.in_app_purchases.toFixed(2)}</td>
                                            <td><strong>$${item.total_revenue.toFixed(2)}</strong></td>
                                            <td class="${growth >= 0 ? 'positive' : 'negative'}">
                                                ${growth >= 0 ? '↗' : '↘'} ${Math.abs(growth)}%
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                
                document.getElementById('revenueContent').innerHTML = revenueHtml;
                
                // 绘制图表
                drawRevenueCharts(data.data);
                
            } catch (error) {
                console.error('加载收益数据失败:', error);
                document.getElementById('revenueContent').innerHTML = `
                    <div class="error-message">
                        ⚠️ 加载收益数据失败: ${error.message}
                        <br><button onclick="loadRevenueData()" style="margin-top:10px;" class="btn btn-primary">重试</button>
                    </div>
                `;
            }
        }
        
        // 绘制收益图表
        function drawRevenueCharts(data) {
            // 收益趋势图
            const lineCtx = document.getElementById('revenueLineChart').getContext('2d');
            new Chart(lineCtx, {
                type: 'line',
                data: {
                    labels: data.daily_data.map(item => item.date.substring(5)),
                    datasets: [{
                        label: 'AdMob收益',
                        data: data.daily_data.map(item => item.admob_revenue),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }, {
                        label: '应用内购买',
                        data: data.daily_data.map(item => item.in_app_purchases),
                        borderColor: '#f093fb',
                        backgroundColor: 'rgba(240, 147, 251, 0.1)',
                        tension: 0.4
                    }, {
                        label: '总收益',
                        data: data.daily_data.map(item => item.total_revenue),
                        borderColor: '#48bb78',
                        backgroundColor: 'rgba(72, 187, 120, 0.1)',
                        tension: 0.4,
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(0);
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': $' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });
            
            // 收益来源饼图
            const sourceCtx = document.getElementById('revenueSourceChart').getContext('2d');
            new Chart(sourceCtx, {
                type: 'doughnut',
                data: {
                    labels: data.breakdown.by_source.map(item => item.source),
                    datasets: [{
                        data: data.breakdown.by_source.map(item => item.revenue),
                        backgroundColor: ['#667eea', '#f093fb', '#48bb78', '#ed8936'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed;
                                    const percentage = data.breakdown.by_source[context.dataIndex].percentage;
                                    return context.label + ': $' + value.toFixed(2) + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
            
            // 地区收益饼图
            const countryCtx = document.getElementById('revenueCountryChart').getContext('2d');
            new Chart(countryCtx, {
                type: 'doughnut',
                data: {
                    labels: data.breakdown.by_country.map(item => item.country),
                    datasets: [{
                        data: data.breakdown.by_country.map(item => item.revenue),
                        backgroundColor: ['#e53e3e', '#3182ce', '#38a169', '#d69e2e'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed;
                                    const percentage = data.breakdown.by_country[context.dataIndex].percentage;
                                    return context.label + ': $' + value.toFixed(2) + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // 导出收益报告
        function exportRevenueReport() {
            alert('📊 收益报告导出功能已触发！在实际应用中，这里会生成并下载Excel/PDF报告。');
        }
        
        // 加载数据分析数据
        async function loadAnalyticsData(period = '30') {
            try {
                const [overviewData, behaviorData] = await Promise.all([
                    apiRequest(`/admin/analytics/overview?period=${period}`),
                    apiRequest('/admin/analytics/user-behavior')
                ]);
                
                const analyticsHtml = `
                    <!-- 关键指标卡片 -->
                    <div class="stats-grid" style="margin-bottom: 30px;">
                        <div class="stat-card">
                            <div class="stat-icon">👥</div>
                            <div class="stat-value">${overviewData.data.user_metrics.total_users.toLocaleString()}</div>
                            <div class="stat-label">总用户数</div>
                            <div class="stat-change positive">+${overviewData.data.user_metrics.new_users_today} 今日新增</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">📱</div>
                            <div class="stat-value">${overviewData.data.user_metrics.active_users_today.toLocaleString()}</div>
                            <div class="stat-label">今日活跃用户</div>
                            <div class="stat-change">${overviewData.data.user_metrics.avg_retention_rate.toFixed(1)}% 留存率</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon revenue">💰</div>
                            <div class="stat-value">$${overviewData.data.revenue_metrics.total_revenue.toFixed(2)}</div>
                            <div class="stat-label">总收益 (${period}天)</div>
                            <div class="stat-change ${overviewData.data.revenue_metrics.revenue_growth >= 0 ? 'positive' : 'negative'}">
                                ${overviewData.data.revenue_metrics.revenue_growth >= 0 ? '↗' : '↘'} ${Math.abs(overviewData.data.revenue_metrics.revenue_growth).toFixed(1)}%
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">🎯</div>
                            <div class="stat-value">${overviewData.data.activity_metrics.total_sessions.toLocaleString()}</div>
                            <div class="stat-label">总会话数</div>
                            <div class="stat-change">${Math.floor(overviewData.data.activity_metrics.avg_session_time)}s 平均时长</div>
                        </div>
                    </div>
                    
                    <!-- 时间范围选择 -->
                    <div class="filter-bar" style="margin-bottom: 20px;">
                        <div class="filter-group">
                            <label>分析周期:</label>
                            <select id="analyticsPeriodSelect" onchange="loadAnalyticsData(this.value)">
                                <option value="7" ${period === '7' ? 'selected' : ''}>最近7天</option>
                                <option value="30" ${period === '30' ? 'selected' : ''}>最近30天</option>
                                <option value="90" ${period === '90' ? 'selected' : ''}>最近90天</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- 图表区域 -->
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 30px;">
                        <!-- 用户活跃度趋势 -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">用户活跃度趋势</h3>
                            </div>
                            <canvas id="userActivityChart" width="600" height="300"></canvas>
                        </div>
                        
                        <!-- 用户分群 -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">用户分群分析</h3>
                            </div>
                            <canvas id="userSegmentChart" width="300" height="300"></canvas>
                        </div>
                    </div>
                    
                    <!-- 功能使用率和转化漏斗 -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                        <!-- 功能使用率 -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">功能使用率排行</h3>
                            </div>
                            <div style="padding: 20px;">
                                ${overviewData.data.top_features.map(feature => `
                                    <div style="margin-bottom: 15px;">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                            <span>${feature.feature}</span>
                                            <span><strong>${feature.usage_rate}%</strong></span>
                                        </div>
                                        <div style="background: #f1f5f9; border-radius: 10px; height: 8px;">
                                            <div style="background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 10px; height: 100%; width: ${feature.usage_rate}%;"></div>
                                        </div>
                                        <div style="font-size: 0.8rem; color: #666; margin-top: 2px;">${feature.user_count.toLocaleString()} 用户使用</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- 用户转化漏斗 -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">用户转化漏斗</h3>
                            </div>
                            <canvas id="conversionFunnelChart" width="400" height="300"></canvas>
                        </div>
                    </div>
                    
                    <!-- 留存分析 -->
                    <div class="chart-container" style="margin-bottom: 30px;">
                        <div class="chart-header">
                            <h3 class="chart-title">用户留存分析</h3>
                        </div>
                        <canvas id="retentionChart" width="800" height="300"></canvas>
                    </div>
                    
                    <!-- 用户分群详细表格 -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">用户分群详细数据</h3>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>用户分群</th>
                                    <th>用户数量</th>
                                    <th>占比</th>
                                    <th>平均收益</th>
                                    <th>活跃度</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${behaviorData.data.user_segments.map(segment => `
                                    <tr>
                                        <td><strong>${segment.segment}</strong></td>
                                        <td>${segment.count.toLocaleString()}</td>
                                        <td>${segment.percentage}%</td>
                                        <td>$${segment.avg_revenue.toFixed(2)}</td>
                                        <td>
                                            <div style="background: #f1f5f9; border-radius: 10px; height: 6px; width: 100px;">
                                                <div style="background: #48bb78; border-radius: 10px; height: 100%; width: ${segment.percentage}%;"></div>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                
                document.getElementById('analyticsContent').innerHTML = analyticsHtml;
                
                // 绘制分析图表
                drawAnalyticsCharts(overviewData.data, behaviorData.data);
                
            } catch (error) {
                console.error('加载分析数据失败:', error);
                document.getElementById('analyticsContent').innerHTML = `
                    <div class="error-message">
                        ⚠️ 加载分析数据失败: ${error.message}
                        <br><button onclick="loadAnalyticsData()" style="margin-top:10px;" class="btn btn-primary">重试</button>
                    </div>
                `;
            }
        }
        
        // 绘制分析图表
        function drawAnalyticsCharts(overviewData, behaviorData) {
            // 用户活跃度趋势图
            const activityCtx = document.getElementById('userActivityChart').getContext('2d');
            new Chart(activityCtx, {
                type: 'line',
                data: {
                    labels: overviewData.time_series.users.map(item => item.date.substring(5)),
                    datasets: [{
                        label: '新增用户',
                        data: overviewData.time_series.users.map(item => item.new_users),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }, {
                        label: '活跃用户',
                        data: overviewData.time_series.users.map(item => item.active_users),
                        borderColor: '#48bb78',
                        backgroundColor: 'rgba(72, 187, 120, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // 用户分群饼图
            const segmentCtx = document.getElementById('userSegmentChart').getContext('2d');
            new Chart(segmentCtx, {
                type: 'doughnut',
                data: {
                    labels: behaviorData.user_segments.map(item => item.segment),
                    datasets: [{
                        data: behaviorData.user_segments.map(item => item.count),
                        backgroundColor: ['#e53e3e', '#3182ce', '#38a169', '#d69e2e'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const segment = behaviorData.user_segments[context.dataIndex];
                                    return context.label + ': ' + segment.count.toLocaleString() + ' (' + segment.percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
            
            // 转化漏斗图
            const funnelCtx = document.getElementById('conversionFunnelChart').getContext('2d');
            new Chart(funnelCtx, {
                type: 'bar',
                data: {
                    labels: behaviorData.funnel_analysis.map(item => item.step),
                    datasets: [{
                        label: '用户数',
                        data: behaviorData.funnel_analysis.map(item => item.users),
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: '#667eea',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const funnel = behaviorData.funnel_analysis[context.dataIndex];
                                    return context.dataset.label + ': ' + funnel.users.toLocaleString() + ' (' + funnel.conversion + '%)';
                                }
                            }
                        }
                    }
                }
            });
            
            // 留存分析图
            const retentionCtx = document.getElementById('retentionChart').getContext('2d');
            new Chart(retentionCtx, {
                type: 'line',
                data: {
                    labels: behaviorData.cohort_analysis.retention_by_week.map(item => item.week),
                    datasets: [{
                        label: '留存率 (%)',
                        data: behaviorData.cohort_analysis.retention_by_week.map(item => item.retention),
                        borderColor: '#f093fb',
                        backgroundColor: 'rgba(240, 147, 251, 0.1)',
                        tension: 0.4,
                        borderWidth: 3,
                        pointBackgroundColor: '#f093fb',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return '留存率: ' + context.parsed.y + '%';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // 导出分析报告
        function exportAnalyticsReport() {
            alert('📈 数据分析报告导出功能已触发！在实际应用中，这里会生成详细的分析报告。');
        }
        
        function loadSettingsData() {
            // 确保管理员数据已加载
            const admin = getAdminData();
            const user = admin?.user || admin?.admin || admin || {};
            const displayName = user.name || user.username || '未知';
            const displayRole = user.role || '未知';
            const loginTime = admin?.timestamp ? new Date(admin.timestamp).toLocaleString() : '未知';
            
            const settingsHTML = `
                <style>
                    .settings-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                        gap: 25px;
                        margin-bottom: 30px;
                    }
                    
                    .settings-card {
                        background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
                        border-radius: 20px;
                        padding: 25px;
                        border: 1px solid rgba(255,255,255,0.1);
                        backdrop-filter: blur(10px);
                        transition: all 0.3s ease;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .settings-card:hover {
                        transform: translateY(-5px);
                        box-shadow: 0 15px 40px rgba(0,0,0,0.1);
                    }
                    
                    .settings-card::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 4px;
                        background: linear-gradient(90deg, #4CAF50, #2196F3, #FF9800, #9C27B0);
                        background-size: 400% 400%;
                        animation: gradientShift 3s ease infinite;
                    }
                    
                    @keyframes gradientShift {
                        0% { background-position: 0% 50%; }
                        50% { background-position: 100% 50%; }
                        100% { background-position: 0% 50%; }
                    }
                    
                    .settings-icon {
                        font-size: 48px;
                        margin-bottom: 15px;
                        display: block;
                        text-align: center;
                        filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
                    }
                    
                    .settings-title {
                        font-size: 20px;
                        font-weight: 700;
                        margin-bottom: 10px;
                        text-align: center;
                        background: linear-gradient(135deg, #333, #666);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                    }
                    
                    .settings-desc {
                        color: #666;
                        text-align: center;
                        margin-bottom: 20px;
                        line-height: 1.5;
                    }
                    
                    .settings-btn {
                        width: 100%;
                        padding: 12px 20px;
                        border: none;
                        border-radius: 12px;
                        font-size: 14px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        position: relative;
                        overflow: hidden;
                        text-transform: uppercase;
                        letter-spacing: 1px;
                    }
                    
                    .btn-auth { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
                    .btn-security { background: linear-gradient(135deg, #f093fb, #f5576c); color: white; }
                    .btn-config { background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; }
                    .btn-data { background: linear-gradient(135deg, #43e97b, #38f9d7); color: white; }
                    
                    .settings-btn:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                    }
                    
                    .quick-actions {
                        background: linear-gradient(135deg, rgba(0,0,0,0.05) 0%, rgba(0,0,0,0.02) 100%);
                        border-radius: 20px;
                        padding: 30px;
                        margin-top: 30px;
                        border: 1px solid rgba(0,0,0,0.05);
                    }
                    
                    .quick-title {
                        font-size: 24px;
                        font-weight: 700;
                        margin-bottom: 20px;
                        text-align: center;
                        background: linear-gradient(135deg, #667eea, #764ba2);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                    }
                    
                    .quick-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                        gap: 15px;
                    }
                    
                    .quick-btn {
                        padding: 15px 20px;
                        border: none;
                        border-radius: 12px;
                        font-size: 14px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }
                    
                    .quick-btn:hover {
                        transform: translateY(-3px);
                        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
                    }
                    
                    .btn-reset { background: linear-gradient(135deg, #ff6b6b, #ee5a24); color: white; }
                    .btn-clear { background: linear-gradient(135deg, #feca57, #ff9ff3); color: white; }
                    .btn-export { background: linear-gradient(135deg, #48dbfb, #0abde3); color: white; }
                    .btn-info { background: linear-gradient(135deg, #1dd1a1, #55a3ff); color: white; }
                    .btn-fix { background: linear-gradient(135deg, #ffecd2, #fcb69f); color: #333; }
                    
                    /* 设置详情页面样式 */
                    .settings-detail {
                        max-width: 1000px;
                        margin: 0 auto;
                    }
                    
                    .settings-detail h2 {
                        color: #333;
                        margin-bottom: 30px;
                        font-size: 1.8rem;
                        text-align: center;
                    }
                    
                    .settings-content {
                        background: white;
                        border-radius: 15px;
                        padding: 30px;
                        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
                        margin-bottom: 20px;
                    }
                    
                    .info-grid {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 30px;
                        margin-bottom: 30px;
                    }
                    
                    .info-card {
                        background: #f8f9fa;
                        padding: 20px;
                        border-radius: 12px;
                        border-left: 4px solid #667eea;
                    }
                    
                    .info-card h3 {
                        color: #333;
                        margin-bottom: 20px;
                        font-size: 1.2rem;
                    }
                    
                    .info-item {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 10px 0;
                        border-bottom: 1px solid #e9ecef;
                    }
                    
                    .info-item:last-child {
                        border-bottom: none;
                    }
                    
                    .label {
                        font-weight: 600;
                        color: #495057;
                    }
                    
                    .value {
                        font-family: monospace;
                        padding: 4px 8px;
                        border-radius: 4px;
                        background: white;
                    }
                    
                    .value.success {
                        color: #28a745;
                        background: #d4edda;
                    }
                    
                    .value.error {
                        color: #dc3545;
                        background: #f8d7da;
                    }
                    
                    .action-buttons {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 10px;
                    }
                    
                    .action-buttons .btn {
                        padding: 10px 15px;
                        font-size: 0.9rem;
                    }
                    
                    .token-info {
                        margin-top: 30px;
                    }
                    
                    .token-info h3 {
                        color: #333;
                        margin-bottom: 15px;
                    }
                    
                    .token-display {
                        display: flex;
                        gap: 10px;
                        align-items: flex-start;
                    }
                    
                    .token-display textarea {
                        flex: 1;
                        height: 100px;
                        padding: 15px;
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        font-family: monospace;
                        font-size: 0.8rem;
                        resize: vertical;
                        background: #f8f9fa;
                    }
                    
                    .btn-back {
                        background: #6c757d;
                        color: white;
                        border: none;
                        padding: 12px 24px;
                        border-radius: 25px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    }
                    
                    .btn-back:hover {
                        background: #5a6268;
                        transform: translateY(-2px);
                    }
                    
                    .security-status, .system-info, .storage-details {
                        background: #f8f9fa;
                        padding: 20px;
                        border-radius: 12px;
                        border-left: 4px solid #28a745;
                    }
                    
                    .status-item {
                        padding: 8px 0;
                        border-bottom: 1px solid #e9ecef;
                    }
                    
                    .status-item:last-child {
                        border-bottom: none;
                    }
                    
                    .status-item.success {
                        color: #28a745;
                    }
                    
                    .status-item.error {
                        color: #dc3545;
                    }
                    
                    .status-item.warning {
                        color: #ffc107;
                    }
                    
                    /* 配置页面样式 */
                    .config-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
                        gap: 25px;
                        margin-bottom: 30px;
                    }
                    
                    .config-grid-2 {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 20px;
                    }
                    
                    .config-card {
                        background: white;
                        border-radius: 15px;
                        padding: 25px;
                        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                        border-left: 5px solid #667eea;
                        transition: all 0.3s ease;
                    }
                    
                    .config-card:hover {
                        transform: translateY(-5px);
                        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                    }
                    
                    .config-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 20px;
                        padding-bottom: 15px;
                        border-bottom: 2px solid #f8f9fa;
                    }
                    
                    .config-header h3 {
                        color: #333;
                        font-size: 1.3rem;
                        margin: 0;
                    }
                    
                    .config-body {
                        display: flex;
                        flex-direction: column;
                        gap: 15px;
                    }
                    
                    .config-item {
                        display: flex;
                        flex-direction: column;
                        gap: 8px;
                    }
                    
                    .config-item label {
                        font-weight: 600;
                        color: #495057;
                        font-size: 0.9rem;
                    }
                    
                    .config-input, .config-textarea {
                        padding: 12px 15px;
                        border: 2px solid #e9ecef;
                        border-radius: 8px;
                        font-size: 0.95rem;
                        transition: all 0.3s ease;
                        background: #f8f9fa;
                    }
                    
                    .config-input:focus, .config-textarea:focus {
                        outline: none;
                        border-color: #667eea;
                        background: white;
                        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                    }
                    
                    .config-textarea {
                        resize: vertical;
                        min-height: 80px;
                    }
                    
                    .toggle-switch {
                        position: relative;
                        display: inline-block;
                        width: 60px;
                        height: 30px;
                    }
                    
                    .toggle-switch input {
                        opacity: 0;
                        width: 0;
                        height: 0;
                    }
                    
                    .toggle-switch label {
                        position: absolute;
                        cursor: pointer;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background-color: #ccc;
                        border-radius: 30px;
                        transition: 0.4s;
                    }
                    
                    .toggle-switch label:before {
                        position: absolute;
                        content: "";
                        height: 22px;
                        width: 22px;
                        left: 4px;
                        bottom: 4px;
                        background-color: white;
                        border-radius: 50%;
                        transition: 0.4s;
                    }
                    
                    .toggle-switch input:checked + label {
                        background-color: #667eea;
                    }
                    
                    .toggle-switch input:checked + label:before {
                        transform: translateX(30px);
                    }
                    
                    .config-actions {
                        text-align: center;
                        margin-top: 30px;
                        padding: 20px;
                        background: white;
                        border-radius: 15px;
                        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                    }
                    
                    .config-actions .btn {
                        margin: 0 10px;
                    }
                    
                    .config-section {
                        background: white;
                        border-radius: 15px;
                        padding: 25px;
                        margin-bottom: 25px;
                        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                        border-left: 5px solid #48bb78;
                    }
                    
                    .config-section h3 {
                        color: #333;
                        margin-bottom: 20px;
                        font-size: 1.2rem;
                    }
                    
                    .admob-config {
                        max-width: 1000px;
                        margin: 0 auto;
                    }
                    
                    @media (max-width: 768px) {
                        .config-grid {
                            grid-template-columns: 1fr;
                        }
                        
                        .config-grid-2 {
                            grid-template-columns: 1fr;
                        }
                        
                        .config-header {
                            flex-direction: column;
                            gap: 15px;
                            align-items: flex-start;
                        }
                    }
                    
                    /* 现代化设置详情页面样式 */
                    .modern-settings-detail {
                        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                        min-height: 100vh;
                        padding: 0;
                        margin: -20px;
                    }
                    
                    .detail-header {
                        background: white;
                        padding: 30px 40px;
                        box-shadow: 0 2px 20px rgba(0,0,0,0.1);
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 30px;
                    }
                    
                    .header-content {
                        display: flex;
                        align-items: center;
                        gap: 20px;
                    }
                    
                    .header-icon {
                        font-size: 3rem;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        background-clip: text;
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.1));
                    }
                    
                    .header-text h2 {
                        font-size: 2.2rem;
                        font-weight: 700;
                        color: #2d3748;
                        margin: 0 0 5px 0;
                    }
                    
                    .header-text p {
                        color: #718096;
                        font-size: 1.1rem;
                        margin: 0;
                    }
                    
                    .back-btn {
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
                        border: none;
                        padding: 12px 20px;
                        border-radius: 12px;
                        color: #4a5568;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    }
                    
                    .back-btn:hover {
                        background: linear-gradient(135deg, #cbd5e0 0%, #a0aec0 100%);
                        transform: translateY(-2px);
                        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    }
                    
                    .detail-content {
                        padding: 0 40px 40px;
                    }
                    
                    .dashboard-cards {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 30px;
                        margin-bottom: 30px;
                    }
                    
                    .dashboard-card {
                        background: white;
                        border-radius: 20px;
                        box-shadow: 0 8px 30px rgba(0,0,0,0.1);
                        overflow: hidden;
                        transition: all 0.3s ease;
                    }
                    
                    .dashboard-card:hover {
                        transform: translateY(-5px);
                        box-shadow: 0 15px 40px rgba(0,0,0,0.15);
                    }
                    
                    .dashboard-card.token-panel {
                        grid-column: 1 / -1;
                    }
                    
                    .card-header {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        padding: 20px 25px;
                        display: flex;
                        align-items: center;
                        gap: 15px;
                    }
                    
                    .card-icon {
                        font-size: 1.5rem;
                    }
                    
                    .card-header h3 {
                        font-size: 1.3rem;
                        font-weight: 600;
                        margin: 0;
                    }
                    
                    .card-content {
                        padding: 25px;
                    }
                    
                    .info-row {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 15px 0;
                        border-bottom: 1px solid #e2e8f0;
                    }
                    
                    .info-row:last-child {
                        border-bottom: none;
                    }
                    
                    .info-label {
                        font-weight: 600;
                        color: #4a5568;
                        font-size: 0.95rem;
                    }
                    
                    .info-value {
                        font-weight: 500;
                        padding: 6px 12px;
                        border-radius: 8px;
                        font-size: 0.9rem;
                    }
                    
                    .status-success {
                        background: #c6f6d5;
                        color: #22543d;
                    }
                    
                    .status-error {
                        background: #fed7d7;
                        color: #c53030;
                    }
                    
                    .role-badge {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        font-weight: 600;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }
                    
                    .action-grid {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 15px;
                    }
                    
                    .modern-btn {
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 8px;
                        padding: 15px 20px;
                        border: none;
                        border-radius: 12px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        text-decoration: none;
                        font-size: 0.9rem;
                    }
                    
                    .modern-btn.primary {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                    }
                    
                    .modern-btn.success {
                        background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
                        color: white;
                    }
                    
                    .modern-btn.warning {
                        background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
                        color: white;
                    }
                    
                    .modern-btn.danger {
                        background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
                        color: white;
                    }
                    
                    .modern-btn.secondary {
                        background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
                        color: #4a5568;
                    }
                    
                    .modern-btn:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    }
                    
                    .btn-icon {
                        font-size: 1.1rem;
                    }
                    
                    .token-container {
                        background: #f7fafc;
                        border-radius: 12px;
                        padding: 20px;
                    }
                    
                    .token-preview {
                        background: #2d3748;
                        color: #e2e8f0;
                        padding: 15px;
                        border-radius: 8px;
                        margin-bottom: 15px;
                        font-family: 'Courier New', monospace;
                        word-break: break-all;
                        font-size: 0.85rem;
                    }
                    
                    .token-actions {
                        display: flex;
                        gap: 10px;
                    }
                    
                    @media (max-width: 768px) {
                        .modern-settings-detail {
                            margin: -10px;
                        }
                        
                        .detail-header {
                            padding: 20px;
                            flex-direction: column;
                            gap: 20px;
                            align-items: flex-start;
                        }
                        
                        .detail-content {
                            padding: 0 20px 20px;
                        }
                        
                        .dashboard-cards {
                            grid-template-columns: 1fr;
                            gap: 20px;
                        }
                        
                        .action-grid {
                            grid-template-columns: 1fr;
                        }
                        
                        .token-actions {
                            flex-direction: column;
                        }
                    }
                    
                    /* 高级积分配置样式 */
                    .points-config-header {
                        margin-bottom: 30px;
                    }
                    
                    .config-summary {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                        gap: 20px;
                        margin-bottom: 25px;
                    }
                    
                    .summary-card {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        padding: 25px;
                        border-radius: 15px;
                        display: flex;
                        align-items: center;
                        gap: 15px;
                        box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
                    }
                    
                    .summary-icon {
                        font-size: 2.5rem;
                        opacity: 0.9;
                    }
                    
                    .summary-info h3 {
                        font-size: 2rem;
                        font-weight: 700;
                        margin: 0 0 5px 0;
                    }
                    
                    .summary-info p {
                        margin: 0;
                        opacity: 0.9;
                        font-size: 0.9rem;
                    }
                    
                    .config-toolbar {
                        display: flex;
                        gap: 15px;
                        flex-wrap: wrap;
                    }
                    
                    .points-config-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
                        gap: 25px;
                    }
                    
                    .advanced-config-card {
                        background: white;
                        border-radius: 20px;
                        box-shadow: 0 8px 30px rgba(0,0,0,0.1);
                        overflow: hidden;
                        transition: all 0.3s ease;
                        border: 2px solid transparent;
                    }
                    
                    .advanced-config-card:hover {
                        transform: translateY(-5px);
                        box-shadow: 0 15px 40px rgba(0,0,0,0.2);
                        border-color: #667eea;
                    }
                    
                    .card-priority {
                        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                        padding: 15px 20px;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        border-bottom: 1px solid #dee2e6;
                    }
                    
                    .priority-badge {
                        background: #667eea;
                        color: white;
                        padding: 5px 12px;
                        border-radius: 20px;
                        font-weight: 600;
                        font-size: 0.8rem;
                    }
                    
                    .card-actions {
                        display: flex;
                        gap: 8px;
                    }
                    
                    .action-btn {
                        background: transparent;
                        border: none;
                        padding: 8px;
                        border-radius: 50%;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        font-size: 1rem;
                    }
                    
                    .action-btn:hover {
                        background: rgba(102, 126, 234, 0.1);
                        transform: scale(1.1);
                    }
                    
                    .action-btn.danger:hover {
                        background: rgba(220, 53, 69, 0.1);
                    }
                    
                    .card-header-advanced {
                        padding: 20px;
                        display: flex;
                        align-items: center;
                        gap: 15px;
                    }
                    
                    .task-icon {
                        font-size: 2.5rem;
                        cursor: pointer;
                        transition: transform 0.3s ease;
                        padding: 10px;
                        border-radius: 10px;
                        background: rgba(102, 126, 234, 0.1);
                    }
                    
                    .task-icon:hover {
                        transform: scale(1.1);
                        background: rgba(102, 126, 234, 0.2);
                    }
                    
                    .task-info {
                        flex: 1;
                    }
                    
                    .task-name-input {
                        background: transparent;
                        border: none;
                        font-size: 1.3rem;
                        font-weight: 600;
                        color: #333;
                        width: 100%;
                        padding: 5px;
                        border-radius: 5px;
                        transition: all 0.3s ease;
                    }
                    
                    .task-name-input:focus {
                        background: #f8f9fa;
                        outline: none;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.3);
                    }
                    
                    .task-stats {
                        color: #6c757d;
                        font-size: 0.9rem;
                        margin-top: 5px;
                    }
                    
                    .card-body-advanced {
                        padding: 20px;
                        background: #f8f9fa;
                    }
                    
                    .config-row {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 20px;
                        margin-bottom: 20px;
                    }
                    
                    .config-col label {
                        display: block;
                        font-weight: 600;
                        color: #495057;
                        margin-bottom: 8px;
                        font-size: 0.9rem;
                    }
                    
                    .input-with-unit {
                        display: flex;
                        align-items: center;
                        background: white;
                        border: 2px solid #e9ecef;
                        border-radius: 8px;
                        overflow: hidden;
                        transition: border-color 0.3s ease;
                    }
                    
                    .input-with-unit:focus-within {
                        border-color: #667eea;
                    }
                    
                    .config-input-small {
                        border: none;
                        padding: 12px 15px;
                        flex: 1;
                        outline: none;
                        font-size: 0.95rem;
                    }
                    
                    .unit {
                        background: #e9ecef;
                        padding: 12px 15px;
                        color: #6c757d;
                        font-weight: 600;
                        font-size: 0.85rem;
                    }
                    
                    .task-metrics {
                        display: grid;
                        grid-template-columns: repeat(3, 1fr);
                        gap: 15px;
                        margin-top: 20px;
                        padding-top: 20px;
                        border-top: 1px solid #dee2e6;
                    }
                    
                    .metric {
                        text-align: center;
                    }
                    
                    .metric-label {
                        display: block;
                        font-size: 0.8rem;
                        color: #6c757d;
                        margin-bottom: 5px;
                    }
                    
                    .metric-value {
                        font-size: 1.1rem;
                        font-weight: 600;
                        color: #333;
                    }
                    
                    /* 模态框样式 */
                    .stats-modal, .add-task-modal {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0,0,0,0.8);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        z-index: 10000;
                        animation: fadeIn 0.3s ease;
                    }
                    
                    .stats-modal-content, .add-task-modal-content {
                        background: white;
                        border-radius: 20px;
                        max-width: 90%;
                        max-height: 90%;
                        overflow: auto;
                        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                        animation: slideUp 0.3s ease;
                    }
                    
                    .stats-modal-content {
                        width: 800px;
                    }
                    
                    .add-task-modal-content {
                        width: 600px;
                    }
                    
                    .stats-header, .modal-header {
                        padding: 25px 30px;
                        border-bottom: 1px solid #dee2e6;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    }
                    
                    .stats-title {
                        display: flex;
                        align-items: center;
                        gap: 15px;
                    }
                    
                    .task-icon-large {
                        font-size: 3rem;
                    }
                    
                    .stats-title h2, .modal-header h2 {
                        margin: 0;
                        color: #333;
                        font-size: 1.5rem;
                    }
                    
                    .stats-title p {
                        margin: 5px 0 0 0;
                        color: #6c757d;
                    }
                    
                    .close-btn {
                        background: #f8f9fa;
                        border: none;
                        width: 40px;
                        height: 40px;
                        border-radius: 50%;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 1.2rem;
                        color: #6c757d;
                        transition: all 0.3s ease;
                    }
                    
                    .close-btn:hover {
                        background: #dc3545;
                        color: white;
                    }
                    
                    .stats-summary {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                        gap: 20px;
                        padding: 30px;
                    }
                    
                    .stats-card {
                        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                        padding: 20px;
                        border-radius: 15px;
                        text-align: center;
                        transition: all 0.3s ease;
                    }
                    
                    .stats-card:hover {
                        transform: translateY(-3px);
                        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
                    }
                    
                    .stats-card.trend-up {
                        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
                    }
                    
                    .stats-card.trend-down {
                        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
                    }
                    
                    .stats-icon {
                        font-size: 2rem;
                        margin-bottom: 10px;
                    }
                    
                    .stats-info h3 {
                        font-size: 1.8rem;
                        font-weight: 700;
                        margin: 0 0 5px 0;
                        color: #333;
                    }
                    
                    .stats-info p {
                        margin: 0;
                        color: #6c757d;
                        font-size: 0.9rem;
                    }
                    
                    .stats-chart {
                        padding: 30px;
                        border-top: 1px solid #dee2e6;
                    }
                    
                    .stats-chart h3 {
                        margin: 0 0 20px 0;
                        color: #333;
                        font-size: 1.2rem;
                    }
                    
                    .chart-container {
                        display: flex;
                        align-items: end;
                        gap: 15px;
                        height: 200px;
                        padding: 20px 0;
                        border-bottom: 2px solid #dee2e6;
                    }
                    
                    .chart-bar {
                        flex: 1;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        position: relative;
                    }
                    
                    .bar {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        width: 100%;
                        border-radius: 4px 4px 0 0;
                        min-height: 20px;
                        transition: all 0.3s ease;
                        position: relative;
                    }
                    
                    .bar:hover {
                        background: linear-gradient(135deg, #5a6fd8 0%, #6b4190 100%);
                        transform: scale(1.05);
                    }
                    
                    .bar-label {
                        margin-top: 10px;
                        font-size: 0.8rem;
                        color: #6c757d;
                        font-weight: 600;
                    }
                    
                    .bar-value {
                        position: absolute;
                        top: -25px;
                        left: 50%;
                        transform: translateX(-50%);
                        font-size: 0.7rem;
                        color: #333;
                        font-weight: 600;
                        opacity: 0;
                        transition: opacity 0.3s ease;
                    }
                    
                    .chart-bar:hover .bar-value {
                        opacity: 1;
                    }
                    
                    /* 新增任务表单样式 */
                    .add-task-form {
                        padding: 30px;
                    }
                    
                    .form-row {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 20px;
                        margin-bottom: 20px;
                    }
                    
                    .form-group {
                        margin-bottom: 20px;
                    }
                    
                    .form-group label {
                        display: block;
                        font-weight: 600;
                        color: #495057;
                        margin-bottom: 8px;
                        font-size: 0.9rem;
                    }
                    
                    .form-group input, .form-group textarea, .form-group select {
                        width: 100%;
                        padding: 12px 15px;
                        border: 2px solid #e9ecef;
                        border-radius: 8px;
                        font-size: 0.95rem;
                        transition: all 0.3s ease;
                        box-sizing: border-box;
                    }
                    
                    .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                    }
                    
                    .form-actions {
                        display: flex;
                        gap: 15px;
                        justify-content: flex-end;
                        margin-top: 30px;
                        padding-top: 20px;
                        border-top: 1px solid #dee2e6;
                    }
                    
                    .btn-primary, .btn-secondary {
                        padding: 12px 24px;
                        border: none;
                        border-radius: 8px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        font-size: 0.9rem;
                    }
                    
                    .btn-primary {
                        background: #667eea;
                        color: white;
                    }
                    
                    .btn-primary:hover {
                        background: #5a6fd8;
                        transform: translateY(-2px);
                    }
                    
                    .btn-secondary {
                        background: #6c757d;
                        color: white;
                    }
                    
                    .btn-secondary:hover {
                        background: #5a6268;
                        transform: translateY(-2px);
                    }
                    
                    @keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    
                    @keyframes slideUp {
                        from { transform: translateY(30px); opacity: 0; }
                        to { transform: translateY(0); opacity: 1; }
                    }
                    
                    @media (max-width: 768px) {
                        .config-summary {
                            grid-template-columns: 1fr;
                        }
                        
                        .points-config-grid {
                            grid-template-columns: 1fr;
                        }
                        
                        .config-row {
                            grid-template-columns: 1fr;
                        }
                        
                        .task-metrics {
                            grid-template-columns: 1fr;
                        }
                        
                        .form-row {
                            grid-template-columns: 1fr;
                        }
                        
                        .stats-modal-content, .add-task-modal-content {
                            width: 95%;
                        }
                        
                        .stats-summary {
                            grid-template-columns: 1fr;
                        }
                    }
                    
                    /* AdMob配置现代化样式 */
                    .admob-config-modern {
                        max-width: 1200px;
                        margin: 0 auto;
                    }
                    
                    .admob-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 30px;
                        padding: 25px;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        border-radius: 20px;
                        color: white;
                    }
                    
                    .admob-status {
                        display: flex;
                        align-items: center;
                        gap: 20px;
                    }
                    
                    .status-indicator {
                        display: flex;
                        align-items: center;
                        gap: 10px;
                        padding: 10px 20px;
                        border-radius: 25px;
                        background: rgba(255,255,255,0.2);
                        backdrop-filter: blur(10px);
                    }
                    
                    .status-indicator.active .status-dot {
                        background: #4CAF50;
                        box-shadow: 0 0 10px #4CAF50;
                    }
                    
                    .status-indicator.inactive .status-dot {
                        background: #f44336;
                        box-shadow: 0 0 10px #f44336;
                    }
                    
                    .status-dot {
                        width: 12px;
                        height: 12px;
                        border-radius: 50%;
                        animation: pulse 2s infinite;
                    }
                    
                    .status-text {
                        font-weight: 600;
                        font-size: 0.9rem;
                    }
                    
                    .test-mode-badge {
                        padding: 8px 16px;
                        border-radius: 20px;
                        font-weight: 600;
                        font-size: 0.85rem;
                    }
                    
                    .test-mode-badge.test {
                        background: rgba(255, 193, 7, 0.2);
                        color: #ffd700;
                    }
                    
                    .test-mode-badge.production {
                        background: rgba(76, 175, 80, 0.2);
                        color: #4CAF50;
                    }
                    
                    .admob-actions {
                        display: flex;
                        gap: 15px;
                    }
                    
                    .admob-config-grid {
                        display: grid;
                        grid-template-columns: 1fr 1fr 1fr;
                        gap: 25px;
                    }
                    
                    .admob-card {
                        background: white;
                        border-radius: 20px;
                        box-shadow: 0 8px 30px rgba(0,0,0,0.1);
                        overflow: hidden;
                        transition: all 0.3s ease;
                    }
                    
                    .admob-card:hover {
                        transform: translateY(-5px);
                        box-shadow: 0 15px 40px rgba(0,0,0,0.15);
                    }
                    
                    .admob-card-header {
                        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                        padding: 20px;
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        border-bottom: 1px solid #dee2e6;
                    }
                    
                    .admob-card-header .card-icon {
                        font-size: 1.5rem;
                        margin-right: 10px;
                    }
                    
                    .admob-card-header h3 {
                        font-size: 1.2rem;
                        font-weight: 600;
                        color: #333;
                        margin: 0;
                    }
                    
                    .card-info, .card-status {
                        background: #667eea;
                        color: white;
                        padding: 5px 12px;
                        border-radius: 15px;
                        font-size: 0.8rem;
                        font-weight: 600;
                    }
                    
                    .card-status {
                        background: #28a745;
                    }
                    
                    .admob-card-body {
                        padding: 25px;
                    }
                    
                    .config-input-modern {
                        width: 100%;
                        padding: 12px 15px;
                        border: 2px solid #e9ecef;
                        border-radius: 8px;
                        font-size: 0.9rem;
                        transition: all 0.3s ease;
                        font-family: 'Courier New', monospace;
                    }
                    
                    .config-input-modern:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                    }
                    
                    .input-copy-group {
                        display: flex;
                        gap: 10px;
                        align-items: center;
                    }
                    
                    .copy-btn {
                        background: #667eea;
                        color: white;
                        border: none;
                        padding: 12px;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        font-size: 0.9rem;
                        min-width: 45px;
                    }
                    
                    .copy-btn:hover {
                        background: #5a6fd8;
                        transform: scale(1.05);
                    }
                    
                    .toggle-group {
                        display: flex;
                        align-items: center;
                        gap: 15px;
                    }
                    
                    .toggle-description {
                        color: #6c757d;
                        font-size: 0.85rem;
                        font-style: italic;
                    }
                    
                    .ad-unit-list {
                        display: flex;
                        flex-direction: column;
                        gap: 20px;
                    }
                    
                    .ad-unit-item {
                        display: flex;
                        align-items: center;
                        gap: 15px;
                        padding: 15px;
                        background: #f8f9fa;
                        border-radius: 12px;
                        transition: all 0.3s ease;
                    }
                    
                    .ad-unit-item:hover {
                        background: #e9ecef;
                        transform: translateX(5px);
                    }
                    
                    .ad-unit-info {
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        min-width: 120px;
                    }
                    
                    .ad-unit-icon {
                        font-size: 1.5rem;
                        width: 40px;
                        height: 40px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        background: white;
                        border-radius: 10px;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                    }
                    
                    .ad-unit-details {
                        display: flex;
                        flex-direction: column;
                    }
                    
                    .ad-unit-name {
                        font-weight: 600;
                        color: #333;
                        font-size: 0.9rem;
                    }
                    
                    .ad-unit-type {
                        color: #6c757d;
                        font-size: 0.8rem;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }
                    
                    .ad-unit-config {
                        display: flex;
                        flex: 1;
                        gap: 10px;
                        align-items: center;
                    }
                    
                    .ad-unit-input {
                        flex: 1;
                        padding: 10px 12px;
                        border: 1px solid #dee2e6;
                        border-radius: 6px;
                        font-size: 0.85rem;
                        font-family: 'Courier New', monospace;
                        transition: all 0.3s ease;
                    }
                    
                    .ad-unit-input:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
                    }
                    
                    .strategy-grid {
                        display: flex;
                        flex-direction: column;
                        gap: 20px;
                    }
                    
                    .strategy-item {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 15px;
                        background: #f8f9fa;
                        border-radius: 10px;
                    }
                    
                    .strategy-label {
                        font-weight: 600;
                        color: #333;
                        font-size: 0.9rem;
                    }
                    
                    .strategy-select {
                        padding: 8px 12px;
                        border: 1px solid #dee2e6;
                        border-radius: 6px;
                        background: white;
                        font-size: 0.85rem;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    }
                    
                    .strategy-select:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
                    }
                    
                    .copy-toast {
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: #333;
                        color: white;
                        padding: 12px 24px;
                        border-radius: 25px;
                        font-size: 0.9rem;
                        font-weight: 600;
                        z-index: 10001;
                        animation: fadeInOut 2s ease;
                    }
                    
                    @keyframes pulse {
                        0% { opacity: 1; }
                        50% { opacity: 0.5; }
                        100% { opacity: 1; }
                    }
                    
                    @keyframes fadeInOut {
                        0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                        20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                        80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                        100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                    }
                    
                    @media (max-width: 1024px) {
                        .admob-config-grid {
                            grid-template-columns: 1fr 1fr;
                        }
                    }
                    
                    @media (max-width: 768px) {
                        .admob-config-grid {
                            grid-template-columns: 1fr;
                        }
                        
                        .admob-header {
                            flex-direction: column;
                            gap: 20px;
                            align-items: flex-start;
                        }
                        
                        .admob-status {
                            flex-direction: column;
                            align-items: flex-start;
                            gap: 15px;
                        }
                        
                        .ad-unit-item {
                            flex-direction: column;
                            align-items: flex-start;
                            gap: 15px;
                        }
                        
                        .ad-unit-config {
                            width: 100%;
                        }
                    }
                    
                    /* 新界面样式 - 积分配置 */
                    .points-task-list {
                        padding: 0;
                    }
                    
                    .task-item {
                        background: white;
                        border-radius: 12px;
                        margin-bottom: 15px;
                        border: 1px solid #e9ecef;
                        transition: all 0.3s ease;
                    }
                    
                    .task-item:hover {
                        border-color: #667eea;
                        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
                        transform: translateY(-2px);
                    }
                    
                    .task-main {
                        display: grid;
                        grid-template-columns: 1fr auto auto;
                        gap: 20px;
                        padding: 20px;
                        align-items: center;
                    }
                    
                    .task-info-section {
                        display: flex;
                        align-items: center;
                        gap: 15px;
                    }
                    
                    .task-icon-wrapper {
                        cursor: pointer;
                        transition: transform 0.3s ease;
                    }
                    
                    .task-icon-wrapper:hover {
                        transform: scale(1.1);
                    }
                    
                    .task-icon-display {
                        width: 50px;
                        height: 50px;
                        border-radius: 12px;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 1.5rem;
                        color: white;
                        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                    }
                    
                    .task-details {
                        flex: 1;
                    }
                    
                    .task-name-section {
                        display: flex;
                        align-items: center;
                        gap: 10px;
                        margin-bottom: 5px;
                    }
                    
                    .task-name-edit {
                        background: transparent;
                        border: none;
                        font-size: 1.2rem;
                        font-weight: 600;
                        color: #333;
                        padding: 5px;
                        border-radius: 4px;
                        transition: all 0.3s ease;
                    }
                    
                    .task-name-edit:focus {
                        background: #f8f9fa;
                        outline: none;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
                    }
                    
                    .priority-indicator {
                        background: #667eea;
                        color: white;
                        padding: 2px 8px;
                        border-radius: 12px;
                        font-size: 0.75rem;
                        font-weight: 600;
                    }
                    
                    .task-desc-edit {
                        background: transparent;
                        border: none;
                        color: #666;
                        font-size: 0.9rem;
                        padding: 3px;
                        border-radius: 4px;
                        width: 100%;
                        transition: all 0.3s ease;
                    }
                    
                    .task-desc-edit:focus {
                        background: #f8f9fa;
                        outline: none;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
                    }
                    
                    .task-stats-inline {
                        font-size: 0.85rem;
                        color: #888;
                        margin-top: 8px;
                    }
                    
                    .task-config-section {
                        display: flex;
                        gap: 20px;
                        align-items: center;
                    }
                    
                    .config-group {
                        text-align: center;
                    }
                    
                    .config-group label {
                        display: block;
                        font-size: 0.8rem;
                        color: #666;
                        margin-bottom: 5px;
                        font-weight: 600;
                    }
                    
                    .input-unit-group {
                        display: flex;
                        align-items: center;
                        background: #f8f9fa;
                        border-radius: 8px;
                        padding: 2px;
                        border: 1px solid #e9ecef;
                        transition: all 0.3s ease;
                    }
                    
                    .input-unit-group:focus-within {
                        border-color: #667eea;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
                    }
                    
                    .config-number-input {
                        border: none;
                        background: transparent;
                        padding: 8px 10px;
                        width: 60px;
                        text-align: center;
                        font-weight: 600;
                        outline: none;
                    }
                    
                    .input-unit {
                        background: #e9ecef;
                        padding: 6px 10px;
                        border-radius: 6px;
                        font-size: 0.8rem;
                        color: #666;
                        font-weight: 600;
                    }
                    
                    .status-toggle {
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    }
                    
                    .toggle-switch-simple {
                        position: relative;
                        width: 44px;
                        height: 24px;
                    }
                    
                    .toggle-switch-simple input {
                        opacity: 0;
                        width: 0;
                        height: 0;
                    }
                    
                    .toggle-switch-simple label {
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: #ccc;
                        border-radius: 24px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    }
                    
                    .toggle-switch-simple label::before {
                        content: '';
                        position: absolute;
                        width: 18px;
                        height: 18px;
                        border-radius: 50%;
                        background: white;
                        top: 3px;
                        left: 3px;
                        transition: all 0.3s ease;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                    }
                    
                    .toggle-switch-simple input:checked + label {
                        background: #667eea;
                    }
                    
                    .toggle-switch-simple input:checked + label::before {
                        transform: translateX(20px);
                    }
                    
                    .task-actions-section {
                        display: flex;
                        gap: 8px;
                    }
                    
                    .action-btn-clean {
                        background: #f8f9fa;
                        border: none;
                        width: 36px;
                        height: 36px;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 0.9rem;
                    }
                    
                    .action-btn-clean:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    }
                    
                    .action-btn-clean.primary:hover {
                        background: #667eea;
                        color: white;
                    }
                    
                    .action-btn-clean.success:hover {
                        background: #4caf50;
                        color: white;
                    }
                    
                    .action-btn-clean.danger:hover {
                        background: #f44336;
                        color: white;
                    }
                    
                    /* AdMob 新界面样式 */
                    .admob-basic-config {
                        padding: 0;
                    }
                    
                    .config-section {
                        display: flex;
                        flex-direction: column;
                        gap: 20px;
                    }
                    
                    .config-item-inline {
                        display: grid;
                        grid-template-columns: 280px 1fr;
                        align-items: center;
                        column-gap: 20px;
                        padding: 16px 20px;
                        background: #ffffff;
                        border-radius: 12px;
                        border: 1px solid #e9ecef;
                        transition: all 0.3s ease;
                    }
                    
                    .config-item-inline:hover {
                        border-color: #667eea;
                        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
                    }
                    
                    .config-label-group { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
                    
                    .config-label {
                        font-size: 1rem;
                        font-weight: 600;
                        color: #333;
                        margin-bottom: 4px;
                    }
                    
                    .config-description { font-size: 0.85rem; color: #666; display: none; }
                    
                    .config-input-group { display: inline-flex; align-items: center; gap: 10px; white-space: nowrap; }
                    
                    .config-input-modern {
                        padding: 10px 15px;
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        font-size: 0.9rem;
                        width: 300px;
                        font-family: 'Courier New', monospace;
                        transition: all 0.3s ease;
                    }
                    
                    .config-input-modern:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
                    }
                    
                    .config-toggle-group { display: inline-flex; align-items: center; gap: 12px; white-space: nowrap; }
                    
                    .admob-units-list { padding: 0; display: grid; gap: 12px; }
                    
                    .ad-unit-row {
                        display: flex;
                        align-items: center;
                        gap: 15px;
                        padding: 16px 18px;
                        background: #ffffff;
                        border: 1px solid #e9ecef;
                        border-radius: 12px;
                        transition: all 0.3s ease;
                        flex-wrap: nowrap;
                    }
                    
                    .ad-unit-row:hover { box-shadow: 0 8px 20px rgba(0,0,0,0.06); }
                    
                    .ad-unit-row:last-child { margin-bottom: 0; }
                    
                    .ad-unit-info-section {
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        flex-shrink: 0;
                        min-width: 200px;
                    }
                    
                    .ad-unit-icon-clean {
                        width: 40px;
                        height: 40px;
                        border-radius: 10px;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 1.2rem;
                        color: white;
                    }
                    
                    .ad-unit-details-clean {
                        flex: 1;
                    }
                    .ad-unit-details-clean.single-line { display: flex; align-items: center; }
                    .ad-unit-line { display: inline-flex; align-items: baseline; gap: 8px; white-space: nowrap; }
                    .ad-unit-line .dot { color: #9ca3af; }
                    
                    .ad-unit-name {
                        font-weight: 600;
                        color: #333;
                        margin-bottom: 2px;
                    }
                    
                    .ad-unit-type { font-size: 0.85rem; color: #6b7280; text-transform: none; letter-spacing: 0.2px; }
                    
                    .ad-unit-config-section { 
                        display: flex; 
                        align-items: center; 
                        gap: 10px; 
                        flex: 1;
                        min-width: 300px;
                    }
                    
                    .ad-unit-config-section .btn {
                        flex-shrink: 0;
                        padding: 10px 12px;
                        border-radius: 8px;
                        white-space: nowrap;
                    }
                    
                    .ad-unit-input-clean {
                        flex: 1;
                        min-width: 200px;
                        padding: 10px 12px;
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        font-size: 0.85rem;
                        font-family: 'Courier New', monospace;
                        transition: all 0.3s ease;
                    }
                    
                    .ad-unit-input-clean:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
                    }
                    
                    .ad-unit-strategy-section {
                        display: flex;
                        align-items: center;
                        flex-shrink: 0;
                        min-width: 130px;
                    }
                    
                    .strategy-select-clean {
                        flex-shrink: 0;
                        width: 130px;
                        padding: 8px 12px;
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        background: white;
                        font-size: 0.85rem;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        white-space: nowrap;
                    }
                    
                    .strategy-select-clean:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
                    }
                    
                    @media (max-width: 768px) {
                        .task-main {
                            grid-template-columns: 1fr;
                            gap: 15px;
                        }
                        
                        .task-config-section {
                            flex-direction: column;
                            gap: 10px;
                        }
                        
                        .ad-unit-row { flex-direction: column; align-items: stretch; gap: 12px; }
                        .ad-unit-info-section { min-width: unset; }
                        .ad-unit-config-section { min-width: unset; }
                        .ad-unit-input-clean { min-width: unset; }
                        .strategy-select-clean { width: 100%; }
                        
                        .config-item-inline { grid-template-columns: 1fr; row-gap: 8px; }
                        .config-description { display: block; }
                        
                        .config-input-modern {
                            width: 100%;
                        }
                    }
                    
                    /* ==================== 全新华丽界面样式 ==================== */
                    
                    /* 华丽统计卡片 */
                    .premium-stats-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                        gap: 25px;
                        margin-bottom: 40px;
                    }
                    
                    .premium-stat-card {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        border-radius: 20px;
                        padding: 30px;
                        color: white;
                        position: relative;
                        overflow: hidden;
                        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
                        transition: all 0.4s ease;
                    }
                    
                    .premium-stat-card:hover {
                        transform: translateY(-8px);
                        box-shadow: 0 20px 40px rgba(102, 126, 234, 0.4);
                    }
                    
                    .premium-stat-card.gradient-blue {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    }
                    
                    .premium-stat-card.gradient-green {
                        background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
                    }
                    
                    .premium-stat-card.gradient-purple {
                        background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);
                    }
                    
                    .premium-stat-card.gradient-orange {
                        background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
                    }
                    
                    .stat-card-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 20px;
                    }
                    
                    .stat-icon-premium {
                        font-size: 2.5rem;
                        opacity: 0.9;
                    }
                    
                    .stat-trend {
                        background: rgba(255,255,255,0.2);
                        padding: 6px 12px;
                        border-radius: 15px;
                        font-size: 0.85rem;
                        font-weight: 600;
                    }
                    
                    .stat-content {
                        margin-bottom: 20px;
                    }
                    
                    .stat-value-premium {
                        font-size: 3rem;
                        font-weight: 900;
                        line-height: 1;
                        margin-bottom: 8px;
                    }
                    
                    .stat-label-premium {
                        font-size: 1.1rem;
                        font-weight: 600;
                        opacity: 0.9;
                        margin-bottom: 5px;
                    }
                    
                    .stat-description {
                        font-size: 0.9rem;
                        opacity: 0.8;
                    }
                    
                    .stat-progress {
                        height: 4px;
                        background: rgba(255,255,255,0.2);
                        border-radius: 2px;
                        overflow: hidden;
                    }
                    
                    .progress-bar {
                        height: 100%;
                        background: rgba(255,255,255,0.8);
                        border-radius: 2px;
                        transition: width 1s ease;
                    }
                    
                    /* 现代化操作面板 */
                    .premium-action-panel {
                        background: white;
                        border-radius: 25px;
                        padding: 30px;
                        margin-bottom: 30px;
                        box-shadow: 0 8px 30px rgba(0,0,0,0.08);
                        border: 1px solid rgba(102, 126, 234, 0.1);
                    }
                    
                    .panel-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: flex-start;
                        margin-bottom: 25px;
                    }
                    
                    .panel-title h2 {
                        font-size: 1.8rem;
                        font-weight: 700;
                        color: #333;
                        margin: 0 0 8px 0;
                    }
                    
                    .panel-title p {
                        color: #666;
                        margin: 0;
                        font-size: 1rem;
                    }
                    
                    .panel-actions {
                        display: flex;
                        gap: 15px;
                        flex-wrap: wrap;
                    }
                    
                    .premium-btn {
                        display: inline-flex;
                        align-items: center;
                        gap: 8px;
                        padding: 12px 24px;
                        border: none;
                        border-radius: 12px;
                        font-weight: 600;
                        font-size: 0.95rem;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        text-decoration: none;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .premium-btn:before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: -100%;
                        width: 100%;
                        height: 100%;
                        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                        transition: left 0.5s;
                    }
                    
                    .premium-btn:hover:before {
                        left: 100%;
                    }
                    
                    .premium-btn.primary {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                    }
                    
                    .premium-btn.primary:hover {
                        transform: translateY(-3px);
                        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
                    }
                    
                    .premium-btn.secondary {
                        background: #f8f9fa;
                        color: #333;
                        border: 2px solid #e9ecef;
                    }
                    
                    .premium-btn.secondary:hover {
                        background: #e9ecef;
                        transform: translateY(-2px);
                    }
                    
                    .premium-btn.outline {
                        background: transparent;
                        color: #667eea;
                        border: 2px solid #667eea;
                    }
                    
                    .premium-btn.outline:hover {
                        background: #667eea;
                        color: white;
                        transform: translateY(-2px);
                    }
                    
                    /* 高级筛选区域 */
                    .panel-filters {
                        display: flex;
                        gap: 20px;
                        align-items: center;
                        flex-wrap: wrap;
                        padding: 20px;
                        background: #f8f9fa;
                        border-radius: 15px;
                        border: 1px solid #e9ecef;
                    }
                    
                    .filter-group {
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    }
                    
                    .search-box-modern {
                        position: relative;
                        display: flex;
                        align-items: center;
                    }
                    
                    .search-icon {
                        position: absolute;
                        left: 15px;
                        font-size: 1.1rem;
                        color: #666;
                    }
                    
                    .search-box-modern input {
                        padding: 12px 15px 12px 45px;
                        border: 2px solid #e9ecef;
                        border-radius: 25px;
                        width: 300px;
                        font-size: 0.95rem;
                        transition: all 0.3s ease;
                    }
                    
                    .search-box-modern input:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                    }
                    
                    .filter-select {
                        padding: 10px 15px;
                        border: 2px solid #e9ecef;
                        border-radius: 10px;
                        background: white;
                        font-size: 0.9rem;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    }
                    
                    .filter-select:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                    }
                    
                    .view-toggle {
                        display: flex;
                        background: white;
                        border-radius: 10px;
                        padding: 4px;
                        border: 2px solid #e9ecef;
                    }
                    
                    .view-btn {
                        padding: 8px 16px;
                        border: none;
                        background: transparent;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 0.85rem;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        color: #666;
                    }
                    
                    .view-btn.active {
                        background: #667eea;
                        color: white;
                        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
                    }
                    
                    /* 华丽任务卡片网格 */
                    .premium-tasks-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
                        gap: 25px;
                        margin-bottom: 30px;
                    }
                    
                    .premium-tasks-grid.list-view {
                        grid-template-columns: 1fr;
                    }
                    
                    .premium-task-card {
                        background: white;
                        border-radius: 20px;
                        padding: 0;
                        box-shadow: 0 8px 30px rgba(0,0,0,0.1);
                        border: 2px solid transparent;
                        transition: all 0.4s ease;
                        overflow: hidden;
                        position: relative;
                    }
                    
                    .premium-task-card:hover {
                        transform: translateY(-8px);
                        box-shadow: 0 15px 40px rgba(0,0,0,0.15);
                        border-color: #667eea;
                    }
                    
                    .premium-task-card.active {
                        border-color: #4CAF50;
                    }
                    
                    .premium-task-card.inactive {
                        opacity: 0.7;
                        border-color: #f44336;
                    }
                    
                    .task-card-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 15px 20px;
                        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                        border-bottom: 1px solid #dee2e6;
                    }
                    
                    .task-priority-badge {
                        background: #667eea;
                        color: white;
                        padding: 4px 12px;
                        border-radius: 15px;
                        font-size: 0.8rem;
                        font-weight: 600;
                    }
                    
                    .task-actions-dropdown {
                        position: relative;
                    }
                    
                    .action-dots {
                        background: none;
                        border: none;
                        font-size: 1.2rem;
                        color: #666;
                        cursor: pointer;
                        padding: 5px 10px;
                        border-radius: 50%;
                        transition: all 0.3s ease;
                    }
                    
                    .action-dots:hover {
                        background: rgba(102, 126, 234, 0.1);
                        color: #667eea;
                    }
                    
                    .actions-menu {
                        position: absolute;
                        top: 100%;
                        right: 0;
                        background: white;
                        border-radius: 10px;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
                        padding: 8px 0;
                        min-width: 150px;
                        z-index: 1000;
                        display: none;
                        border: 1px solid #e9ecef;
                    }
                    
                    .actions-menu button {
                        width: 100%;
                        padding: 10px 16px;
                        border: none;
                        background: none;
                        text-align: left;
                        cursor: pointer;
                        font-size: 0.9rem;
                        transition: all 0.3s ease;
                        color: #333;
                    }
                    
                    .actions-menu button:hover {
                        background: #f8f9fa;
                        color: #667eea;
                    }
                    
                    .actions-menu button.danger:hover {
                        background: #ffebee;
                        color: #f44336;
                    }
                    
                    .task-card-icon {
                        text-align: center;
                        padding: 20px;
                        position: relative;
                        cursor: pointer;
                    }
                    
                    .icon-display {
                        width: 80px;
                        height: 80px;
                        border-radius: 20px;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 2.5rem;
                        color: white;
                        margin: 0 auto;
                        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
                        transition: all 0.3s ease;
                    }
                    
                    .icon-display.inactive {
                        background: linear-gradient(135deg, #ccc 0%, #999 100%);
                        box-shadow: 0 4px 15px rgba(153, 153, 153, 0.3);
                    }
                    
                    .task-card-icon:hover .icon-display {
                        transform: scale(1.1);
                    }
                    
                    .icon-edit-hint {
                        font-size: 0.75rem;
                        color: #666;
                        margin-top: 8px;
                        opacity: 0;
                        transition: opacity 0.3s ease;
                    }
                    
                    .task-card-icon:hover .icon-edit-hint {
                        opacity: 1;
                    }
                    
                    .task-card-content {
                        padding: 20px;
                    }
                    
                    .task-name-group {
                        margin-bottom: 15px;
                    }
                    
                    .task-name-premium {
                        width: 100%;
                        background: transparent;
                        border: none;
                        font-size: 1.3rem;
                        font-weight: 600;
                        color: #333;
                        padding: 8px;
                        border-radius: 8px;
                        transition: all 0.3s ease;
                    }
                    
                    .task-name-premium:focus {
                        background: #f8f9fa;
                        outline: none;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
                    }
                    
                    .task-desc-group {
                        margin-bottom: 20px;
                    }
                    
                    .task-desc-premium {
                        width: 100%;
                        background: transparent;
                        border: 1px solid #e9ecef;
                        border-radius: 8px;
                        padding: 10px;
                        font-size: 0.9rem;
                        color: #666;
                        resize: vertical;
                        min-height: 60px;
                        transition: all 0.3s ease;
                    }
                    
                    .task-desc-premium:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
                    }
                    
                    .task-stats-beautiful {
                        display: flex;
                        justify-content: space-around;
                        padding: 15px;
                        background: #f8f9fa;
                        border-radius: 12px;
                        margin-bottom: 20px;
                    }
                    
                    .stat-item {
                        text-align: center;
                    }
                    
                    .stat-item .stat-icon {
                        font-size: 1.2rem;
                        display: block;
                        margin-bottom: 5px;
                    }
                    
                    .stat-item .stat-number {
                        font-size: 1.1rem;
                        font-weight: 700;
                        color: #333;
                        display: block;
                    }
                    
                    .stat-item .stat-label {
                        font-size: 0.8rem;
                        color: #666;
                        margin-top: 2px;
                    }
                    
                    .task-card-config {
                        padding: 0 20px 20px;
                    }
                    
                    .config-row-premium {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 15px;
                    }
                    
                    .config-item-premium {
                        text-align: center;
                    }
                    
                    .config-item-premium label {
                        display: block;
                        font-size: 0.85rem;
                        font-weight: 600;
                        color: #666;
                        margin-bottom: 8px;
                    }
                    
                    .number-input-premium {
                        display: flex;
                        align-items: center;
                        background: #f8f9fa;
                        border-radius: 10px;
                        border: 2px solid #e9ecef;
                        overflow: hidden;
                        transition: all 0.3s ease;
                    }
                    
                    .number-input-premium:focus-within {
                        border-color: #667eea;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
                    }
                    
                    .number-input-premium input {
                        border: none;
                        background: transparent;
                        padding: 10px;
                        text-align: center;
                        font-weight: 600;
                        outline: none;
                        flex: 1;
                    }
                    
                    .input-suffix {
                        background: #e9ecef;
                        padding: 10px;
                        font-size: 0.8rem;
                        color: #666;
                        font-weight: 600;
                    }
                    
                    .task-card-footer {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 15px 20px;
                        background: #f8f9fa;
                        border-top: 1px solid #e9ecef;
                    }
                    
                    .status-label {
                        font-size: 0.9rem;
                        font-weight: 600;
                        padding: 6px 12px;
                        border-radius: 15px;
                    }
                    
                    .status-label.active {
                        background: #d4edda;
                        color: #155724;
                    }
                    
                    .status-label.inactive {
                        background: #f8d7da;
                        color: #721c24;
                    }
                    
                    .premium-toggle {
                        position: relative;
                        width: 60px;
                        height: 30px;
                    }
                    
                    .premium-toggle input {
                        opacity: 0;
                        width: 0;
                        height: 0;
                    }
                    
                    .toggle-slider {
                        position: absolute;
                        cursor: pointer;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: #ccc;
                        border-radius: 30px;
                        transition: all 0.4s ease;
                    }
                    
                    .toggle-slider:before {
                        position: absolute;
                        content: "";
                        height: 22px;
                        width: 22px;
                        left: 4px;
                        bottom: 4px;
                        background: white;
                        border-radius: 50%;
                        transition: all 0.4s ease;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                    }
                    
                    .premium-toggle input:checked + label .toggle-slider {
                        background: #667eea;
                    }
                    
                    .premium-toggle input:checked + label .toggle-slider:before {
                        transform: translateX(30px);
                    }
                    
                    /* 华丽分页组件 */
                    .premium-pagination {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 25px 30px;
                        background: white;
                        border-radius: 20px;
                        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
                        border: 1px solid #e9ecef;
                        margin-top: 30px;
                    }
                    
                    .pagination-info {
                        color: #666;
                        font-size: 0.95rem;
                        font-weight: 500;
                    }
                    
                    .pagination-controls {
                        display: flex;
                        gap: 8px;
                        align-items: center;
                    }
                    
                    .pagination-btn {
                        padding: 8px 16px;
                        border: 2px solid #e9ecef;
                        background: white;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 0.9rem;
                        font-weight: 600;
                        color: #333;
                        transition: all 0.3s ease;
                    }
                    
                    .pagination-btn:hover:not([disabled]) {
                        border-color: #667eea;
                        color: #667eea;
                        transform: translateY(-2px);
                    }
                    
                    .pagination-btn.active {
                        background: #667eea;
                        color: white;
                        border-color: #667eea;
                    }
                    
                    .pagination-btn[disabled] {
                        opacity: 0.4;
                        cursor: not-allowed;
                    }
                    
                    .pagination-jumper {
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        color: #666;
                        font-size: 0.9rem;
                    }
                    
                    .pagination-jumper input {
                        width: 60px;
                        padding: 6px 8px;
                        border: 2px solid #e9ecef;
                        border-radius: 6px;
                        text-align: center;
                        font-size: 0.9rem;
                    }
                    
                    .pagination-jumper input:focus {
                        outline: none;
                        border-color: #667eea;
                    }
                    
                    /* 华丽模态框 */
                    .premium-modal {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        z-index: 10000;
                        opacity: 0;
                        visibility: hidden;
                        transition: all 0.3s ease;
                    }
                    
                    .premium-modal.show {
                        opacity: 1;
                        visibility: visible;
                    }
                    
                    .premium-modal.hide {
                        opacity: 0;
                        visibility: hidden;
                    }
                    
                    .premium-modal-backdrop {
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0,0,0,0.6);
                        backdrop-filter: blur(5px);
                    }
                    
                    .premium-modal-content {
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: white;
                        border-radius: 25px;
                        width: 90%;
                        max-width: 800px;
                        max-height: 90vh;
                        overflow: hidden;
                        box-shadow: 0 25px 60px rgba(0,0,0,0.3);
                    }
                    
                    .premium-modal-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 25px 30px;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                    }
                    
                    .modal-title-section {
                        display: flex;
                        align-items: center;
                        gap: 15px;
                    }
                    
                    .modal-icon {
                        font-size: 2rem;
                    }
                    
                    .modal-title-text h2 {
                        margin: 0 0 5px 0;
                        font-size: 1.5rem;
                        font-weight: 700;
                    }
                    
                    .modal-title-text p {
                        margin: 0;
                        opacity: 0.9;
                        font-size: 0.95rem;
                    }
                    
                    .premium-close-btn {
                        background: rgba(255,255,255,0.2);
                        border: none;
                        width: 40px;
                        height: 40px;
                        border-radius: 50%;
                        color: white;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 1.2rem;
                    }
                    
                    .premium-close-btn:hover {
                        background: rgba(255,255,255,0.3);
                        transform: scale(1.1);
                    }
                    
                    .premium-modal-body {
                        padding: 30px;
                        max-height: 60vh;
                        overflow-y: auto;
                    }
                    
                    .premium-task-form {
                        display: flex;
                        flex-direction: column;
                        gap: 25px;
                    }
                    
                    .form-section {
                        border-bottom: 1px solid #e9ecef;
                        padding-bottom: 25px;
                    }
                    
                    .form-section:last-child {
                        border-bottom: none;
                        padding-bottom: 0;
                    }
                    
                    .form-section h3 {
                        margin: 0 0 20px 0;
                        color: #333;
                        font-size: 1.2rem;
                        font-weight: 600;
                    }
                    
                    .form-grid {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 20px;
                    }
                    
                    .form-field {
                        display: flex;
                        flex-direction: column;
                    }
                    
                    .form-field.full-width {
                        grid-column: 1 / -1;
                    }
                    
                    .field-label {
                        margin-bottom: 8px;
                    }
                    
                    .label-text {
                        display: block;
                        font-weight: 600;
                        color: #333;
                        font-size: 0.95rem;
                        margin-bottom: 4px;
                    }
                    
                    .label-hint {
                        display: block;
                        font-size: 0.8rem;
                        color: #666;
                    }
                    
                    .premium-input, .premium-textarea, .premium-select {
                        padding: 12px 16px;
                        border: 2px solid #e9ecef;
                        border-radius: 10px;
                        font-size: 0.95rem;
                        transition: all 0.3s ease;
                    }
                    
                    .premium-input:focus, .premium-textarea:focus, .premium-select:focus {
                        outline: none;
                        border-color: #667eea;
                        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                    }
                    
                    .icon-selector {
                        display: flex;
                        flex-direction: column;
                        gap: 10px;
                    }
                    
                    .icon-input {
                        padding: 12px 16px;
                        border: 2px solid #e9ecef;
                        border-radius: 10px;
                        font-size: 1.2rem;
                        text-align: center;
                        transition: all 0.3s ease;
                    }
                    
                    .icon-options {
                        display: grid;
                        grid-template-columns: repeat(8, 1fr);
                        gap: 8px;
                    }
                    
                    .icon-options button {
                        background: #f8f9fa;
                        border: 2px solid #e9ecef;
                        border-radius: 8px;
                        padding: 10px;
                        font-size: 1.2rem;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    }
                    
                    .icon-options button:hover {
                        background: #e9ecef;
                        transform: scale(1.1);
                    }
                    
                    .icon-options button.selected {
                        background: #667eea;
                        border-color: #667eea;
                        color: white;
                    }
                    
                    .number-input-group {
                        display: flex;
                        align-items: center;
                        border: 2px solid #e9ecef;
                        border-radius: 10px;
                        overflow: hidden;
                        transition: all 0.3s ease;
                    }
                    
                    .number-input-group:focus-within {
                        border-color: #667eea;
                        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                    }
                    
                    .premium-number-input {
                        border: none;
                        padding: 12px 16px;
                        flex: 1;
                        font-size: 0.95rem;
                        outline: none;
                    }
                    
                    .premium-modal-footer {
                        display: flex;
                        justify-content: flex-end;
                        gap: 15px;
                        padding: 25px 30px;
                        background: #f8f9fa;
                        border-top: 1px solid #e9ecef;
                    }
                    
                    @media (max-width: 768px) {
                        .premium-stats-grid {
                            grid-template-columns: 1fr;
                        }
                        
                        .premium-tasks-grid {
                            grid-template-columns: 1fr;
                        }
                        
                        .panel-header {
                            flex-direction: column;
                            gap: 20px;
                            align-items: flex-start;
                        }
                        
                        .panel-filters {
                            flex-direction: column;
                            gap: 15px;
                            align-items: stretch;
                        }
                        
                        .search-box-modern input {
                            width: 100%;
                        }
                        
                        .premium-pagination {
                            flex-direction: column;
                            gap: 15px;
                        }
                        
                        .form-grid {
                            grid-template-columns: 1fr;
                        }
                        
                        .premium-modal-content {
                            width: 95%;
                            margin: 20px;
                        }
                        
                        .config-row-premium {
                            grid-template-columns: 1fr;
                        }
                    }
                </style>
                
                <div class="settings-grid">
                    <div class="settings-card">
                        <div class="settings-icon">🔐</div>
                        <h3 class="settings-title">认证管理</h3>
                        <p class="settings-desc">管理管理员账户、角色权限和登录设置</p>
                        <button class="settings-btn btn-auth" onclick="showAuthSettings()">管理认证</button>
                    </div>
                    
                    <div class="settings-card">
                        <div class="settings-icon">🛡️</div>
                        <h3 class="settings-title">系统安全</h3>
                        <p class="settings-desc">安全策略配置、访问控制和审计日志</p>
                        <button class="settings-btn btn-security" onclick="showSecuritySettings()">安全设置</button>
                    </div>
                    
                    <div class="settings-card">
                        <div class="settings-icon">⚙️</div>
                        <h3 class="settings-title">系统配置</h3>
                        <p class="settings-desc">基本系统参数、API配置和环境设置</p>
                        <button class="settings-btn btn-config" onclick="showSystemConfig()">系统配置</button>
                    </div>
                    
                    <div class="settings-card">
                        <div class="settings-icon">💾</div>
                        <h3 class="settings-title">数据管理</h3>
                        <p class="settings-desc">数据备份、恢复、导入导出功能</p>
                        <button class="settings-btn btn-data" onclick="showDataManagement()">数据管理</button>
                    </div>
                </div>
                
                <div class="quick-actions">
                    <h3 class="quick-title">🚀 快速操作</h3>
                    <div class="quick-grid">
                        <button class="quick-btn btn-fix" onclick="openDataFix()">🔧 数据修复</button>
                        <button class="quick-btn btn-fix" onclick="openAuthCheck()">🔍 认证检查</button>
                        <button class="quick-btn btn-fix" onclick="openAuthFix()">🔧 修复认证</button>
                        <button class="quick-btn btn-reset" onclick="resetAuth()">🔄 重置认证</button>
                        <button class="quick-btn btn-clear" onclick="clearCache()">🗑️ 清除缓存</button>
                        <button class="quick-btn btn-export" onclick="exportData()">📤 导出数据</button>
                        <button class="quick-btn btn-info" onclick="systemInfo()">ℹ️ 系统信息</button>
                    </div>
                </div>
            `;
            
            document.getElementById('settingsContent').innerHTML = settingsHTML;
        }
        
        function showAuthSettings() {
            const admin = getAdminData();
            const user = admin?.user || admin?.admin || admin || {};
            const currentUser = user.name || user.username || '未知';
            const currentRole = user.role || '未知';
            const loginTime = admin?.timestamp ? new Date(admin.timestamp).toLocaleString() : '未知';
            const authStatus = authToken ? '已认证' : '未认证';
            
            const authHTML = `
                <div class="modern-settings-detail">
                    <div class="detail-header">
                        <div class="header-content">
                            <div class="header-icon">🔐</div>
                            <div class="header-text">
                                <h2>认证管理中心</h2>
                                <p>管理管理员账户、权限和安全设置</p>
                            </div>
                        </div>
                        <button class="back-btn" onclick="loadSettingsData()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="m15 18-6-6 6-6"/>
                            </svg>
                            返回
                        </button>
                    </div>
                    
                    <div class="detail-content">
                        <div class="dashboard-cards">
                            <div class="dashboard-card user-info">
                                <div class="card-header">
                                    <div class="card-icon">👤</div>
                                    <h3>用户信息</h3>
                                </div>
                                <div class="card-content">
                                    <div class="info-row">
                                        <span class="info-label">用户名</span>
                                        <span class="info-value ${currentUser === '未知' ? 'status-error' : 'status-success'}">${currentUser}</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">角色权限</span>
                                        <span class="info-value role-badge ${currentRole}">${currentRole}</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">登录时间</span>
                                        <span class="info-value">${loginTime}</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">认证状态</span>
                                        <span class="info-value status ${authStatus === '已认证' ? 'status-success' : 'status-error'}">
                                            ${authStatus === '已认证' ? '✅' : '❌'} ${authStatus}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="dashboard-card security-panel">
                                <div class="card-header">
                                    <div class="card-icon">🛡️</div>
                                    <h3>安全操作</h3>
                                </div>
                                <div class="card-content">
                                    <div class="action-grid">
                                        <button class="modern-btn primary" onclick="openAuthCheck()">
                                            <span class="btn-icon">🔍</span>
                                            <span class="btn-text">详细检查</span>
                                        </button>
                                        <button class="modern-btn success" onclick="refreshAuth()">
                                            <span class="btn-icon">🔄</span>
                                            <span class="btn-text">刷新认证</span>
                                        </button>
                                        <button class="modern-btn warning" onclick="changePassword()">
                                            <span class="btn-icon">🔑</span>
                                            <span class="btn-text">修改密码</span>
                                        </button>
                                        <button class="modern-btn danger" onclick="resetAuth()">
                                            <span class="btn-icon">🗑️</span>
                                            <span class="btn-text">重置认证</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="dashboard-card token-panel">
                                <div class="card-header">
                                    <div class="card-icon">🔐</div>
                                    <h3>访问令牌</h3>
                                </div>
                                <div class="card-content">
                                    <div class="token-container">
                                        <div class="token-preview">
                                            <code>${authToken ? authToken.substring(0, 50) + '...' : '无Token'}</code>
                                        </div>
                                        <div class="token-actions">
                                            <button class="modern-btn secondary" onclick="copyToken()">
                                                <span class="btn-icon">📋</span>
                                                <span class="btn-text">复制Token</span>
                                            </button>
                                            <button class="modern-btn secondary" onclick="showFullToken()">
                                                <span class="btn-icon">👁️</span>
                                                <span class="btn-text">查看完整</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('settingsContent').innerHTML = authHTML;
        }
        
        function showSecuritySettings() {
            const securityHTML = `
                <div class="settings-detail">
                    <h2>🛡️ 系统安全</h2>
                    <div class="settings-content">
                        <div class="info-grid">
                            <div class="info-card">
                                <h3>安全策略</h3>
                                <div class="info-item">
                                    <span class="label">JWT Token有效期:</span>
                                    <span class="value success">24小时</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">密码策略:</span>
                                    <span class="value success">最少6位</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">访问日志:</span>
                                    <span class="value success">已启用</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">API限流:</span>
                                    <span class="value success">已启用</span>
                                </div>
                            </div>
                            
                            <div class="info-card">
                                <h3>安全操作</h3>
                                <div class="action-buttons">
                                    <button class="btn btn-primary" onclick="viewSecurityLogs()">📋 查看日志</button>
                                    <button class="btn btn-warning" onclick="configSecurity()">⚙️ 安全配置</button>
                                    <button class="btn btn-danger" onclick="emergencyLock()">🔒 紧急锁定</button>
                                    <button class="btn btn-success" onclick="securityScan()">🔍 安全扫描</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="token-info">
                            <h3>安全状态</h3>
                            <div class="security-status">
                                <div class="status-item success">✅ 系统安全状态: 正常</div>
                                <div class="status-item success">✅ 最后安全扫描: ${new Date().toLocaleString()}</div>
                                <div class="status-item success">✅ 威胁检测: 未发现威胁</div>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-back" onclick="loadSettingsData()">← 返回设置</button>
                </div>
            `;
            
            document.getElementById('settingsContent').innerHTML = securityHTML;
        }
        
        function showSystemConfig() {
            const configHTML = `
                <div class="settings-detail">
                    <h2>⚙️ 系统配置</h2>
                    <div class="settings-content">
                        <div class="info-grid">
                            <div class="info-card">
                                <h3>网络配置</h3>
                                <div class="info-item">
                                    <span class="label">API地址:</span>
                                    <span class="value">${API_BASE_URL}</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">前端端口:</span>
                                    <span class="value success">8080</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">后端端口:</span>
                                    <span class="value success">3001</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">协议:</span>
                                    <span class="value">HTTP</span>
                                </div>
                            </div>
                            
                            <div class="info-card">
                                <h3>系统环境</h3>
                                <div class="info-item">
                                    <span class="label">数据库:</span>
                                    <span class="value">MySQL (模拟)</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">缓存:</span>
                                    <span class="value success">LocalStorage</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">运行模式:</span>
                                    <span class="value success">开发模式</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">配置状态:</span>
                                    <span class="value success">正常</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="token-info">
                            <h3>系统信息</h3>
                            <div class="system-info">
                                <div class="info-item">
                                    <span class="label">浏览器:</span>
                                    <span class="value">${navigator.userAgent.split(' ')[0]}</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">平台:</span>
                                    <span class="value">${navigator.platform}</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">语言:</span>
                                    <span class="value">${navigator.language}</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">在线状态:</span>
                                    <span class="value ${navigator.onLine ? 'success' : 'error'}">${navigator.onLine ? '在线' : '离线'}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-back" onclick="loadSettingsData()">← 返回设置</button>
                </div>
            `;
            
            document.getElementById('settingsContent').innerHTML = configHTML;
        }
        
        function showDataManagement() {
            const dataSize = JSON.stringify(localStorage).length;
            const dataCount = Object.keys(localStorage).length;
            
            const dataHTML = `
                <div class="settings-detail">
                    <h2>💾 数据管理</h2>
                    <div class="settings-content">
                        <div class="info-grid">
                            <div class="info-card">
                                <h3>存储状态</h3>
                                <div class="info-item">
                                    <span class="label">用户数据项:</span>
                                    <span class="value success">${dataCount} 项</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">缓存大小:</span>
                                    <span class="value">${(dataSize/1024).toFixed(2)} KB</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">最后更新:</span>
                                    <span class="value">${new Date().toLocaleString()}</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">数据状态:</span>
                                    <span class="value success">正常</span>
                                </div>
                            </div>
                            
                            <div class="info-card">
                                <h3>数据操作</h3>
                                <div class="action-buttons">
                                    <button class="btn btn-primary" onclick="backupData()">💾 备份数据</button>
                                    <button class="btn btn-success" onclick="exportData()">📤 导出数据</button>
                                    <button class="btn btn-warning" onclick="importData()">📥 导入数据</button>
                                    <button class="btn btn-danger" onclick="clearAllData()">🗑️ 清空数据</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="token-info">
                            <h3>存储详情</h3>
                            <div class="storage-details">
                                ${Object.keys(localStorage).map(key => 
                                    `<div class="info-item">
                                        <span class="label">${key}:</span>
                                        <span class="value">${localStorage.getItem(key).length} 字符</span>
                                    </div>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-back" onclick="loadSettingsData()">← 返回设置</button>
                </div>
            `;
            
            document.getElementById('settingsContent').innerHTML = dataHTML;
        }
        
        function resetAuth() {
            if (confirm('确定要重置认证吗？这将清除所有登录信息。')) {
                localStorage.removeItem('adminAuth');
                sessionStorage.removeItem('adminAuth');
                localStorage.removeItem('adminToken');
                localStorage.removeItem('adminUser');
                alert('认证已重置，页面将重新加载');
                window.location.reload();
            }
        }
        
        function clearCache() {
            if (confirm('确定要清除所有缓存吗？')) {
                localStorage.clear();
                sessionStorage.clear();
                alert('缓存已清除');
                window.location.reload();
            }
        }
        
        function exportData() {
            const data = {
                timestamp: new Date().toISOString(),
                localStorage: localStorage,
                sessionStorage: sessionStorage,
                userAgent: navigator.userAgent,
                url: window.location.href
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'admin-data-' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function systemInfo() {
            alert('系统信息：\n\n• 浏览器: ' + navigator.userAgent.split(' ')[0] + '\n• 平台: ' + navigator.platform + '\n• 语言: ' + navigator.language + '\n• 在线状态: ' + (navigator.onLine ? '在线' : '离线') + '\n• 当前时间: ' + new Date().toLocaleString() + '\n• 页面URL: ' + window.location.href);
        }
        
        function openDataFix() {
            window.open('admin-data-fix.html', '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
        }
        
        function openAuthCheck() {
            window.open('admin-auth-check.html', '_blank', 'width=900,height=700,scrollbars=yes,resizable=yes');
        }
        
        function openAuthFix() {
            window.open('admin-auth-fix.html', '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
        }
        
        function showAuthError(message) {
            // 创建认证错误提示
            let errorDiv = document.getElementById('authError');
            if (!errorDiv) {
                errorDiv = document.createElement('div');
                errorDiv.id = 'authError';
                errorDiv.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #ff6b6b, #ee5a24);
                    color: white;
                    padding: 15px 20px;
                    border-radius: 10px;
                    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
                    z-index: 10000;
                    font-weight: 600;
                    max-width: 400px;
                `;
                document.body.appendChild(errorDiv);
            }
            
            errorDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 20px;">🔒</span>
                    <div>
                        <div style="font-size: 16px; margin-bottom: 5px;">认证失败</div>
                        <div style="font-size: 14px; opacity: 0.9;">${message}</div>
                        <div style="margin-top: 10px;">
                            <button onclick="openUltimateFix()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-right: 5px;">修复认证</button>
                            <button onclick="hideAuthError()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer;">关闭</button>
                        </div>
                    </div>
                </div>
            `;
            
            errorDiv.style.display = 'block';
        }
        
        function hideAuthError() {
            const errorDiv = document.getElementById('authError');
            if (errorDiv) {
                errorDiv.style.display = 'none';
            }
        }
        
        function openUltimateFix() {
            window.open('/admin-ultimate-fix.html', '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
        }
        
        // 认证管理相关功能
        function refreshAuth() {
            if (confirm('确定要刷新认证信息吗？')) {
                checkAuth();
                setAuthHeaders();
                showAuthSettings(); // 重新显示页面
                alert('认证信息已刷新！');
            }
        }
        
        function changePassword() {
            const newPassword = prompt('请输入新密码（至少6位）:');
            if (newPassword && newPassword.length >= 6) {
                alert('密码修改功能：\n\n在实际应用中，这里会:\n• 验证当前密码\n• 更新后端密码\n• 重新生成Token\n\n模拟：密码已修改！');
            } else if (newPassword !== null) {
                alert('密码长度至少6位！');
            }
        }
        
        function copyToken() {
            const token = authToken || '无Token';
            navigator.clipboard.writeText(token).then(() => {
                alert('Token已复制到剪贴板！');
            }).catch(() => {
                // 创建临时文本区域作为备选方案
                const textArea = document.createElement('textarea');
                textArea.value = token;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Token已复制到剪贴板！');
            });
        }
        
        function showFullToken() {
            const token = authToken || '无Token';
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 80%;
                    max-height: 80%;
                    overflow: auto;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                ">
                    <h3 style="margin-bottom: 20px; color: #333;">完整访问令牌</h3>
                    <textarea readonly style="
                        width: 100%;
                        height: 200px;
                        padding: 15px;
                        border: 2px solid #e2e8f0;
                        border-radius: 8px;
                        font-family: monospace;
                        font-size: 0.8rem;
                        resize: none;
                        background: #f8f9fa;
                    ">${token}</textarea>
                    <div style="margin-top: 20px; text-align: center;">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="
                            background: #667eea;
                            color: white;
                            border: none;
                            padding: 12px 24px;
                            border-radius: 8px;
                            cursor: pointer;
                            font-weight: 600;
                        ">关闭</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
        }
        
        // ===================== 积分管理功能 =====================
        
        let currentUser = null;

        // 显示/隐藏积分管理菜单 (仅超级管理员)
        function checkPointsAccess() {
            const adminData = JSON.parse(localStorage.getItem('adminData') || '{}');
            if (adminData.role === 'super_admin') {
                document.getElementById('pointsMenuItem').style.display = 'block';
            }
        }
        
        // ===================== 积分配置管理功能 =====================
        
        // 小延时，确保骨架屏可见
        const uiDelay = (ms = 300) => new Promise(res => setTimeout(res, ms));

        // 积分配置分页变量
        let pointsCurrentPage = 1;
        let pointsPerPage = 20;
        let allPointsTasks = [];
        
        async function loadPointsConfigData(page = 1) {
            // 在加载真实数据前显示骨架屏
            const pointsContainer = document.getElementById('pointsConfigContent');
            if (pointsContainer && typeof getPointsSkeletonHTML === 'function') {
                pointsContainer.innerHTML = getPointsSkeletonHTML();
            }
            try {
                const data = await apiRequest('/admin/points/config');
                await uiDelay();
                
                // 按优先级排序任务
                allPointsTasks = Object.values(data.data).sort((a, b) => (a.priority || 0) - (b.priority || 0));
                pointsCurrentPage = page;
                
                renderPointsConfigPage();
                
            } catch (error) {
                document.getElementById('pointsConfigContent').innerHTML = `
                    <div class="loading">
                        ⚠️ 加载积分配置失败: ${error.message}
                        <br><button onclick="loadPointsConfigData()" class="btn btn-primary">重试</button>
                    </div>
                `;
            }
        }
        
        function renderPointsConfigPage() {
            const totalTasks = allPointsTasks.length;
            const totalPages = Math.ceil(totalTasks / pointsPerPage);
            const startIndex = (pointsCurrentPage - 1) * pointsPerPage;
            const endIndex = startIndex + pointsPerPage;
            const currentTasks = allPointsTasks.slice(startIndex, endIndex);
            
            let configHTML = `
                <!-- Gentelella Style Header -->
                <div class="page-title">
                    <div class="title_left">
                        <h3>积分系统配置 <small>管理积分获取规则</small></h3>
                    </div>
                    <div class="title_right">
                        <div class="col-md-5 col-sm-5 form-group pull-right top_search">
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="搜索任务..." oninput="filterPointsTasks(this.value)">
                                <span class="input-group-btn">
                                    <button class="btn btn-primary" type="button">搜索</button>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="clearfix"></div>
                
                <!-- Stats Overview -->
                <div class="row">
                    <div class="col-md-3 col-sm-6">
                        <div class="x_panel tile fixed_height_320">
                            <div class="x_title">
                                <h2>总任务数</h2>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <h4>积分任务</h4>
                                <div class="widget_summary">
                                    <div class="w_left w_25">
                                        <span class="text-primary">总计</span>
                                    </div>
                                    <div class="w_center w_55">
                                        <div class="progress">
                                            <div class="progress-bar bg-green" role="progressbar" aria-valuenow="60" 
                                                 aria-valuemin="0" aria-valuemax="100" style="width: ${Math.min((totalTasks / 10) * 100, 100)}%">
                                                <span class="sr-only">60% Complete</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="w_right w_20">
                                        <span>${totalTasks}</span>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                        <div class="x_panel tile fixed_height_320">
                            <div class="x_title">
                                <h2>启用状态</h2>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <h4>任务启用率</h4>
                                <div class="widget_summary">
                                    <div class="w_left w_25">
                                        <span class="text-success">启用</span>
                                    </div>
                                    <div class="w_center w_55">
                                        <div class="progress">
                                            <div class="progress-bar bg-green" role="progressbar" 
                                                 style="width: ${((allPointsTasks.filter(t => t.enabled).length / totalTasks) * 100)}%">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="w_right w_20">
                                        <span>${allPointsTasks.filter(t => t.enabled).length}</span>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                        <div class="x_panel tile fixed_height_320">
                            <div class="x_title">
                                <h2>今日点击</h2>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <h4>用户互动</h4>
                                <div class="widget_summary">
                                    <div class="w_left w_25">
                                        <span class="text-info">点击</span>
                                    </div>
                                    <div class="w_center w_55">
                                        <div class="progress">
                                            <div class="progress-bar bg-blue" role="progressbar" style="width: 65%">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="w_right w_20">
                                        <span>${allPointsTasks.reduce((sum, t) => sum + (t.today_clicks || 0), 0).toLocaleString()}</span>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                        <div class="x_panel tile fixed_height_320">
                            <div class="x_title">
                                <h2>总收益</h2>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <h4>积分收益</h4>
                                <div class="widget_summary">
                                    <div class="w_left w_25">
                                        <span class="text-warning">￥</span>
                                    </div>
                                    <div class="w_center w_55">
                                        <div class="progress">
                                            <div class="progress-bar bg-orange" role="progressbar" style="width: 75%">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="w_right w_20">
                                        <span>¥${((allPointsTasks.reduce((sum, t) => sum + (t.total_revenue || 0), 0)) / 100).toFixed(2)}</span>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Task Management Panel -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="x_panel">
                            <div class="x_title">
                                <h2>积分任务管理 <small>配置积分获取规则</small></h2>
                                <ul class="nav navbar-right panel_toolbox">
                                    <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
                                    <li><a class="close-link"><i class="fa fa-close"></i></a></li>
                                </ul>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="card-box table-responsive">
                                            <div class="d-flex justify-content-between align-items-center mb-3" role="toolbar">
                                                <div class="btn-group" role="group">
                                                    <button type="button" class="btn btn-primary" onclick="showAddTaskModal()">
                                                        ➕ 新建任务
                                                    </button>
                                                    <button type="button" class="btn btn-secondary" onclick="loadPointsConfigData()">
                                                        🔄 刷新
                                                    </button>
                                                    <button type="button" class="btn btn-success" onclick="exportPointsConfig()">
                                                        💾 导出
                                                    </button>
                                                </div>
                                                <div class="btn-group" role="group">
                                                    <button type="button" class="btn btn-outline-secondary" onclick="filterPointsByStatus('')">📋 全部</button>
                                                    <button type="button" class="btn btn-outline-success" onclick="filterPointsByStatus('enabled')">✅ 已启用</button>
                                                    <button type="button" class="btn btn-outline-danger" onclick="filterPointsByStatus('disabled')">❌ 已禁用</button>
                                                </div>
                                            </div>
                                            
                                            <table class="table table-striped table-bordered" style="width:100%">
                                                <thead>
                                                    <tr>
                                                        <th>排序</th>
                                                        <th>图标</th>
                                                        <th>任务名称</th>
                                                        <th>描述</th>
                                                        <th>积分奖励</th>
                                                        <th>每日限制</th>
                                                        <th>状态</th>
                                                        <th>统计</th>
                                                        <th>操作</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="pointsTasksContainer">
            `;
            
            currentTasks.forEach((config, index) => {
                const trendIcon = config.total_clicks > 1000 ? '📈' : config.total_clicks > 100 ? '📊' : '📉';
                const statusClass = config.enabled ? 'active' : 'inactive';
                const globalIndex = startIndex + index;
                
                configHTML += `
                    <tr data-task-id="${config.id}">
                        <td>
                            <div class="text-center">
                                <button class="btn btn-outline-secondary btn-sm mb-1" onclick="moveTaskUp('${config.id}')" title="上移">
                                    ⬆️
                                </button>
                                <div class="badge badge-primary d-block mb-1">#${config.priority || globalIndex + 1}</div>
                                <button class="btn btn-outline-secondary btn-sm" onclick="moveTaskDown('${config.id}')" title="下移">
                                    ⬇️
                                </button>
                            </div>
                        </td>
                        <td class="text-center">
                            <span class="task-icon-display" onclick="editTaskIcon('${config.id}')" style="font-size: 24px; cursor: pointer;" title="点击编辑图标">
                                ${config.icon || '🎯'}
                            </span>
                        </td>
                        <td>
                            <input type="text" value="${config.name}" 
                                   onchange="updateTaskField('${config.id}', 'name', this.value)"
                                   class="form-control form-control-sm" placeholder="任务名称">
                        </td>
                        <td>
                            <textarea onchange="updateTaskField('${config.id}', 'description', this.value)"
                                      class="form-control form-control-sm" rows="2" placeholder="任务描述...">${config.description || ''}</textarea>
                        </td>
                        <td>
                            <div class="input-group input-group-sm">
                                <input type="number" value="${config.points || 10}" min="1" max="1000"
                                       onchange="updateTaskField('${config.id}', 'points', parseInt(this.value))"
                                       class="form-control">
                                <div class="input-group-append">
                                    <span class="input-group-text">积分</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="input-group input-group-sm">
                                <input type="number" value="${config.daily_limit || 3}" min="1" max="100"
                                       onchange="updateTaskField('${config.id}', 'daily_limit', parseInt(this.value))"
                                       class="form-control">
                                <div class="input-group-append">
                                    <span class="input-group-text">次/日</span>
                                </div>
                            </div>
                        </td>
                        <td class="text-center">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" ${config.enabled ? 'checked' : ''} 
                                       onchange="updateTaskField('${config.id}', 'enabled', this.checked)">
                                <label class="form-check-label">
                                    <span class="badge badge-${config.enabled ? 'success' : 'danger'}">${config.enabled ? '启用' : '禁用'}</span>
                                </label>
                            </div>
                        </td>
                        <td class="text-center">
                            <div class="btn-group-sm">
                                <small class="text-muted d-block">总点击: ${(config.total_clicks || 0).toLocaleString()}</small>
                                <small class="text-muted d-block">今日: ${(config.today_clicks || 0).toLocaleString()}</small>
                                <button class="btn btn-outline-info btn-sm mt-1" onclick="viewTaskStats('${config.id}')">
                                    📊 查看详情
                                </button>
                            </div>
                        </td>
                        <td class="text-center">
                            <div class="btn-group btn-group-sm" role="group">
                                <button class="btn btn-outline-primary btn-sm" onclick="duplicateTask('${config.id}')" title="复制任务">
                                    📄 复制
                                </button>
                                <button class="btn btn-outline-danger btn-sm" onclick="deleteTask('${config.id}')" title="删除任务">
                                    🗑️ 删除
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            configHTML += `
                                                </tbody>
                                            </table>
                                            
                                            <!-- Pagination -->
                                            <div class="d-flex justify-content-between align-items-center mt-3">
                                                <div class="dataTables_info">
                                                    显示第 ${startIndex + 1} 到 ${Math.min(endIndex, totalTasks)} 项，共 ${totalTasks} 项
                                                </div>
                                                <div class="dataTables_paginate paging_simple_numbers">
                                                    <ul class="pagination mb-0">
                                                        <li class="paginate_button page-item previous ${pointsCurrentPage === 1 ? 'disabled' : ''}">
                                                            <a onclick="loadPointsConfigData(${pointsCurrentPage - 1})" class="page-link">⬅️ 上一页</a>
                                                        </li>
                                                        ${Array.from({length: Math.min(5, totalPages)}, (_, i) => {
                                                            const pageNum = Math.max(1, pointsCurrentPage - 2) + i;
                                                            if (pageNum <= totalPages) {
                                                                return `<li class="paginate_button page-item ${pageNum === pointsCurrentPage ? 'active' : ''}">
                                                                    <a onclick="loadPointsConfigData(${pageNum})" class="page-link">${pageNum}</a>
                                                                </li>`;
                                                            }
                                                            return '';
                                                        }).join('')}
                                                        <li class="paginate_button page-item next ${pointsCurrentPage === totalPages ? 'disabled' : ''}">
                                                            <a onclick="loadPointsConfigData(${pointsCurrentPage + 1})" class="page-link">下一页 ➡️</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('pointsConfigContent').innerHTML = configHTML;
        }

        // 骨架屏HTML - 积分配置
        function getPointsSkeletonHTML() {
            return `
                <div class="page-title">
                    <div class="title_left">
                        <div class='skeleton skeleton-line' style='width:300px;height:36px;'></div>
                    </div>
                    <div class="title_right">
                        <div class="col-md-5 col-sm-5 form-group pull-right top_search">
                            <div class="input-group">
                                <div class='skeleton skeleton-input'></div>
                                <span class="input-group-btn">
                                    <div class='skeleton skeleton-button'></div>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="clearfix"></div>
                
                <!-- Stats Overview Skeleton -->
                <div class="row">
                    ${Array.from({length:4}).map(()=>`
                        <div class="col-md-3 col-sm-6">
                            <div class="x_panel tile fixed_height_320">
                                <div class="x_title">
                                    <div class='skeleton skeleton-line' style='width:120px;height:24px;'></div>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <div class='skeleton skeleton-line' style='width:80px;height:28px;margin-bottom:15px;'></div>
                                    <div class="widget_summary">
                                        <div class="w_left w_25">
                                            <div class='skeleton skeleton-line' style='width:40px;height:16px;'></div>
                                        </div>
                                        <div class="w_center w_55">
                                            <div class="progress">
                                                <div class='skeleton skeleton-line' style='width:100%;height:10px;'></div>
                                            </div>
                                        </div>
                                        <div class="w_right w_20">
                                            <div class='skeleton skeleton-line' style='width:30px;height:20px;'></div>
                                        </div>
                                        <div class="clearfix"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <!-- Table Skeleton -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="x_panel">
                            <div class="x_title">
                                <div class='skeleton skeleton-line' style='width:200px;height:28px;'></div>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="card-box table-responsive">
                                            <div class="btn-toolbar mb-3" role="toolbar">
                                                <div class="btn-group me-2" role="group">
                                                    ${Array.from({length:3}).map(()=>`<div class='skeleton skeleton-button' style='margin-right:5px;'></div>`).join('')}
                                                </div>
                                                <div class="btn-group" role="group">
                                                    ${Array.from({length:3}).map(()=>`<div class='skeleton skeleton-button' style='margin-right:5px;'></div>`).join('')}
                                                </div>
                                            </div>
                                            
                                            <table class="table table-striped table-bordered">
                                                <thead>
                                                    <tr>
                                                        ${Array.from({length:9}).map(()=>`<th><div class='skeleton skeleton-line' style='width:80%;height:20px;'></div></th>`).join('')}
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    ${Array.from({length:8}).map(()=>`
                                                        <tr>
                                                            ${Array.from({length:9}).map(()=>`<td><div class='skeleton skeleton-line' style='width:90%;height:16px;'></div></td>`).join('')}
                                                        </tr>
                                                    `).join('')}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        async function updatePointsConfig(actionType, field, value) {
            try {
                const updateData = {
                    action_type: actionType,
                    [field]: value
                };
                
                const response = await apiRequest('/admin/points/config', {
                    method: 'PUT',
                    body: JSON.stringify(updateData)
                });
                
                if (response.success) {
                    console.log('积分配置更新成功:', response.message);
                } else {
                    alert('更新失败: ' + response.error);
                }
                
            } catch (error) {
                alert('更新失败: ' + error.message);
            }
        }
        
        // 更新任务字段
        async function updateTaskField(taskId, field, value) {
            try {
                const updateData = {
                    action_type: taskId,
                    [field]: value
                };
                
                const response = await apiRequest('/admin/points/config', {
                    method: 'PUT',
                    body: JSON.stringify(updateData)
                });
                
                if (response.success) {
                    console.log(`✅ 任务 ${taskId} 的 ${field} 更新成功`);
                } else {
                    alert('更新失败: ' + response.error);
                }
                
            } catch (error) {
                alert('更新失败: ' + error.message);
            }
        }
        
        // 移动任务优先级
        async function moveTaskUp(taskId) {
            await moveTask(taskId, 'up');
        }
        
        async function moveTaskDown(taskId) {
            await moveTask(taskId, 'down');
        }
        
        async function moveTask(taskId, direction) {
            try {
                // 获取当前所有任务
                const data = await apiRequest('/admin/points/config');
                const tasks = Object.values(data.data).sort((a, b) => (a.priority || 0) - (b.priority || 0));
                
                const currentIndex = tasks.findIndex(t => t.id === taskId);
                if (currentIndex === -1) return;
                
                let newIndex;
                if (direction === 'up' && currentIndex > 0) {
                    newIndex = currentIndex - 1;
                } else if (direction === 'down' && currentIndex < tasks.length - 1) {
                    newIndex = currentIndex + 1;
                } else {
                    return; // 无法移动
                }
                
                // 交换优先级
                const currentTask = tasks[currentIndex];
                const targetTask = tasks[newIndex];
                
                const reorderData = [
                    { id: currentTask.id, priority: targetTask.priority },
                    { id: targetTask.id, priority: currentTask.priority }
                ];
                
                const response = await apiRequest('/admin/points/config/reorder', {
                    method: 'POST',
                    body: JSON.stringify({ tasks: reorderData })
                });
                
                if (response.success) {
                    loadPointsConfigData(); // 重新加载
                } else {
                    alert('排序失败: ' + response.error);
                }
                
            } catch (error) {
                alert('排序失败: ' + error.message);
            }
        }
        
        // 删除任务
        async function deleteTask(taskId) {
            const task = allPointsTasks.find(t => t.id === taskId);
            const taskName = task ? task.name : '该任务';
            
            if (!confirm(`确定要删除任务 "${taskName}" 吗？\n\n⚠️ 删除后将无法恢复！\n⚠️ 用户将无法再完成此任务获得积分！`)) {
                return;
            }
            
            try {
                const response = await apiRequest(`/admin/points/config/${taskId}`, {
                    method: 'DELETE'
                });
                
                if (response.success) {
                    showMessage(`🗑️ 任务 "${taskName}" 删除成功！`, 'success');
                    // 重新加载当前页面
                    await loadPointsConfigData(pointsCurrentPage);
                } else {
                    throw new Error(response.error || '删除失败');
                }
                
            } catch (error) {
                showMessage(`❌ 删除失败: ${error.message}`, 'error');
            }
        }
        
        // 消息提示系统
        function showMessage(message, type = 'info') {
            // 移除现有消息
            const existingMessage = document.querySelector('.message-toast');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            // 创建新消息
            const messageEl = document.createElement('div');
            messageEl.className = `message-toast ${type}`;
            messageEl.innerHTML = `
                <div class="message-content">
                    <span class="message-icon">
                        ${type === 'success' ? '✅' : type === 'error' ? '❌' : type === 'warning' ? '⚠️' : 'ℹ️'}
                    </span>
                    <span class="message-text">${message}</span>
                </div>
                <button class="message-close" onclick="this.parentElement.remove()">✕</button>
            `;
            
            // 添加样式
            messageEl.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10001;
                background: ${type === 'success' ? '#d4edda' : type === 'error' ? '#f8d7da' : type === 'warning' ? '#fff3cd' : '#d1ecf1'};
                color: ${type === 'success' ? '#155724' : type === 'error' ? '#721c24' : type === 'warning' ? '#856404' : '#0c5460'};
                border: 1px solid ${type === 'success' ? '#c3e6cb' : type === 'error' ? '#f5c6cb' : type === 'warning' ? '#ffeaa7' : '#bee5eb'};
                border-radius: 12px;
                padding: 15px 20px;
                box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                display: flex;
                align-items: center;
                gap: 15px;
                min-width: 300px;
                max-width: 500px;
                animation: slideInRight 0.3s ease;
                backdrop-filter: blur(10px);
            `;
            
            document.body.appendChild(messageEl);
            
            // 自动消失
            setTimeout(() => {
                if (messageEl.parentElement) {
                    messageEl.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => messageEl.remove(), 300);
                }
            }, 4000);
        }
        
        // 添加消息动画样式
        if (!document.querySelector('#messageStyles')) {
            const style = document.createElement('style');
            style.id = 'messageStyles';
            style.textContent = `
                @keyframes slideInRight {
                    from {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
                
                @keyframes slideOutRight {
                    from {
                        transform: translateX(0);
                        opacity: 1;
                    }
                    to {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                }
                
                .message-content {
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    flex: 1;
                }
                
                .message-icon {
                    font-size: 1.2rem;
                }
                
                .message-text {
                    font-weight: 600;
                    font-size: 0.95rem;
                }
                
                .message-close {
                    background: none;
                    border: none;
                    font-size: 1.1rem;
                    cursor: pointer;
                    opacity: 0.7;
                    transition: opacity 0.3s ease;
                    padding: 2px;
                }
                
                .message-close:hover {
                    opacity: 1;
                }
            `;
            document.head.appendChild(style);
        }
        
        // 查看任务统计
        async function viewTaskStats(taskId) {
            try {
                const response = await apiRequest(`/admin/points/stats/${taskId}?days=7`);
                
                if (response.success) {
                    showTaskStatsModal(response.data);
                } else {
                    alert('获取统计失败: ' + response.error);
                }
                
            } catch (error) {
                alert('获取统计失败: ' + error.message);
            }
        }
        
        // 显示任务统计模态框
        function showTaskStatsModal(statsData) {
            const task = statsData.task_info;
            const summary = statsData.summary;
            const dailyStats = statsData.daily_stats;
            
            const modal = document.createElement('div');
            modal.className = 'stats-modal';
            modal.innerHTML = `
                <div class="stats-modal-content">
                    <div class="stats-header">
                        <div class="stats-title">
                            <span class="task-icon-large">${task.icon}</span>
                            <div>
                                <h2>${task.name}</h2>
                                <p>任务统计详情</p>
                            </div>
                        </div>
                        <button class="close-btn" onclick="this.parentElement.parentElement.parentElement.remove()">✕</button>
                    </div>
                    
                    <div class="stats-summary">
                        <div class="stats-card">
                            <div class="stats-icon">🎯</div>
                            <div class="stats-info">
                                <h3>${summary.total_clicks.toLocaleString()}</h3>
                                <p>总点击数</p>
                            </div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-icon">💰</div>
                            <div class="stats-info">
                                <h3>¥${(summary.total_revenue / 100).toFixed(2)}</h3>
                                <p>总收益</p>
                            </div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-icon">📊</div>
                            <div class="stats-info">
                                <h3>${summary.avg_daily_clicks}</h3>
                                <p>日均点击</p>
                            </div>
                        </div>
                        <div class="stats-card trend-${summary.trend}">
                            <div class="stats-icon">${summary.trend === 'up' ? '📈' : summary.trend === 'down' ? '📉' : '📊'}</div>
                            <div class="stats-info">
                                <h3>${summary.best_day_clicks}</h3>
                                <p>最佳单日</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stats-chart">
                        <h3>近7日趋势</h3>
                        <div class="chart-container">
                            ${dailyStats.map(day => `
                                <div class="chart-bar">
                                    <div class="bar" style="height: ${(day.clicks / summary.best_day_clicks) * 100}%"></div>
                                    <div class="bar-label">${day.date.split('-')[2]}</div>
                                    <div class="bar-value">${day.clicks}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // 点击模态框外部关闭
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
        }
        
        // 显示新增任务模态框 - 全新设计
        function showAddTaskModal() {
            // 检查是否已存在模态框
            const existingModal = document.querySelector('.premium-modal');
            if (existingModal) {
                existingModal.remove();
            }
            
            const modal = document.createElement('div');
            modal.className = 'premium-modal';
            modal.innerHTML = `
                <div class="premium-modal-backdrop" onclick="closeAddTaskModal()"></div>
                <div class="premium-modal-content">
                    <div class="premium-modal-header">
                        <div class="modal-title-section">
                            <div class="modal-icon">✨</div>
                            <div class="modal-title-text">
                                <h2>创建新任务</h2>
                                <p>配置新的积分获取任务</p>
                            </div>
                        </div>
                        <button class="premium-close-btn" onclick="closeAddTaskModal()">
                            <span>✕</span>
                        </button>
                    </div>
                    
                    <div class="premium-modal-body">
                        <form id="addTaskForm" class="premium-task-form">
                            <div class="form-section">
                                <h3>基本信息</h3>
                                <div class="form-grid">
                                    <div class="form-field">
                                        <label class="field-label">
                                            <span class="label-text">任务ID *</span>
                                            <span class="label-hint">唯一标识符，只能包含字母、数字和下划线</span>
                                        </label>
                                        <input type="text" name="id" required 
                                               placeholder="例如: watch_ads_v2" 
                                               pattern="[a-zA-Z0-9_]+" 
                                               class="premium-input">
                                    </div>
                                    
                                    <div class="form-field">
                                        <label class="field-label">
                                            <span class="label-text">任务图标</span>
                                            <span class="label-hint">选择一个emoji表情</span>
                                        </label>
                                        <div class="icon-selector">
                                            <input type="text" name="icon" value="🎯" maxlength="2" class="icon-input">
                                            <div class="icon-options">
                                                <button type="button" onclick="selectIcon(this, '🎯')">🎯</button>
                                                <button type="button" onclick="selectIcon(this, '📺')">📺</button>
                                                <button type="button" onclick="selectIcon(this, '📱')">📱</button>
                                                <button type="button" onclick="selectIcon(this, '💰')">💰</button>
                                                <button type="button" onclick="selectIcon(this, '🎮')">🎮</button>
                                                <button type="button" onclick="selectIcon(this, '⭐')">⭐</button>
                                                <button type="button" onclick="selectIcon(this, '🔥')">🔥</button>
                                                <button type="button" onclick="selectIcon(this, '💎')">💎</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-field full-width">
                                    <label class="field-label">
                                        <span class="label-text">任务名称 *</span>
                                        <span class="label-hint">简洁明了的任务名称</span>
                                    </label>
                                    <input type="text" name="name" required 
                                           placeholder="例如: 观看激励视频" 
                                           class="premium-input">
                                </div>
                                
                                <div class="form-field full-width">
                                    <label class="field-label">
                                        <span class="label-text">任务描述</span>
                                        <span class="label-hint">详细描述任务内容和要求</span>
                                    </label>
                                    <textarea name="description" 
                                              placeholder="例如: 观看完整的激励视频广告即可获得积分奖励..." 
                                              rows="3" class="premium-textarea"></textarea>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h3>奖励配置</h3>
                                <div class="form-grid">
                                    <div class="form-field">
                                        <label class="field-label">
                                            <span class="label-text">积分奖励 *</span>
                                            <span class="label-hint">完成任务可获得的积分</span>
                                        </label>
                                        <div class="number-input-group">
                                            <input type="number" name="points" required 
                                                   min="1" max="1000" value="10" 
                                                   class="premium-number-input">
                                            <span class="input-unit">积分</span>
                                        </div>
                                    </div>
                                    
                                    <div class="form-field">
                                        <label class="field-label">
                                            <span class="label-text">每日限制</span>
                                            <span class="label-hint">每天最多可完成次数</span>
                                        </label>
                                        <div class="number-input-group">
                                            <input type="number" name="daily_limit" 
                                                   min="1" max="100" value="5" 
                                                   class="premium-number-input">
                                            <span class="input-unit">次</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h3>分类设置</h3>
                                <div class="form-field">
                                    <label class="field-label">
                                        <span class="label-text">任务类别</span>
                                        <span class="label-hint">选择合适的任务分类</span>
                                    </label>
                                    <select name="category" class="premium-select">
                                        <option value="custom">📝 自定义任务</option>
                                        <option value="video">📺 视频观看</option>
                                        <option value="download">📱 应用下载</option>
                                        <option value="social">👥 社交分享</option>
                                        <option value="daily">📅 每日任务</option>
                                        <option value="task">✅ 普通任务</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>
                    
                    <div class="premium-modal-footer">
                        <button type="button" class="premium-btn secondary" onclick="closeAddTaskModal()">
                            <span class="btn-icon">✖️</span>
                            <span class="btn-text">取消</span>
                        </button>
                        <button type="submit" form="addTaskForm" class="premium-btn primary">
                            <span class="btn-icon">✨</span>
                            <span class="btn-text">创建任务</span>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // 显示动画
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
            
            // 处理表单提交
            document.getElementById('addTaskForm').onsubmit = async (e) => {
                e.preventDefault();
                
                const submitBtn = modal.querySelector('.premium-btn.primary');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<span class="btn-icon">⏳</span><span class="btn-text">创建中...</span>';
                submitBtn.disabled = true;
                
                const formData = new FormData(e.target);
                const taskData = Object.fromEntries(formData);
                
                try {
                    const response = await apiRequest('/admin/points/config', {
                        method: 'POST',
                        body: JSON.stringify(taskData)
                    });
                    
                    if (response.success) {
                        showMessage('🎉 任务创建成功！', 'success');
                        closeAddTaskModal();
                        // 重新加载当前页面
                        await loadPointsConfigData(pointsCurrentPage);
                    } else {
                        throw new Error(response.error || '创建失败');
                    }
                    
                } catch (error) {
                    showMessage(`❌ 创建失败: ${error.message}`, 'error');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            };
        }
        
        // 关闭新增任务模态框
        function closeAddTaskModal() {
            const modal = document.querySelector('.premium-modal');
            if (modal) {
                modal.classList.add('hide');
                setTimeout(() => {
                    modal.remove();
                }, 300);
            }
        }
        
        // 选择图标
        function selectIcon(button, icon) {
            const iconInput = button.closest('.icon-selector').querySelector('.icon-input');
            iconInput.value = icon;
            
            // 更新按钮状态
            button.closest('.icon-options').querySelectorAll('button').forEach(btn => {
                btn.classList.remove('selected');
            });
            button.classList.add('selected');
        }
        
        // 编辑任务图标
        function editTaskIcon(taskId) {
            const newIcon = prompt('请输入新的图标 (emoji):', '🎯');
            if (newIcon && newIcon.trim()) {
                updateTaskField(taskId, 'icon', newIcon.trim());
                setTimeout(() => loadPointsConfigData(), 500);
            }
        }
        
        // 分页辅助函数
        function generatePaginationNumbers(currentPage, totalPages, callbackFunction) {
            let paginationHTML = '';
            const maxShowPages = 5;
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + maxShowPages - 1);
            
            if (endPage - startPage < maxShowPages - 1) {
                startPage = Math.max(1, endPage - maxShowPages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <button class="pagination-btn ${i === currentPage ? 'active' : ''}" 
                            onclick="${callbackFunction}(${i})">${i}</button>
                `;
            }
            
            return paginationHTML;
        }
        
        // 积分任务搜索过滤
        function filterPointsTasks(searchTerm) {
            const cards = document.querySelectorAll('.premium-task-card');
            cards.forEach(card => {
                const taskName = card.querySelector('.task-name-premium').value.toLowerCase();
                const taskDesc = card.querySelector('.task-desc-premium').value.toLowerCase();
                const search = searchTerm.toLowerCase();
                
                if (taskName.includes(search) || taskDesc.includes(search)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // 按状态过滤任务
        function filterPointsByStatus(status) {
            const cards = document.querySelectorAll('.premium-task-card');
            cards.forEach(card => {
                if (status === '') {
                    card.style.display = 'block';
                } else if (status === 'enabled' && card.classList.contains('active')) {
                    card.style.display = 'block';
                } else if (status === 'disabled' && card.classList.contains('inactive')) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // 切换视图模式
        function switchPointsView(viewType) {
            const buttons = document.querySelectorAll('.view-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const container = document.getElementById('pointsTasksContainer');
            if (viewType === 'list') {
                container.classList.add('list-view');
            } else {
                container.classList.remove('list-view');
            }
        }
        
        // 任务操作菜单
        function toggleTaskActions(taskId) {
            const menu = document.getElementById(`actions_${taskId}`);
            const allMenus = document.querySelectorAll('.actions-menu');
            
            // 关闭其他菜单
            allMenus.forEach(m => {
                if (m !== menu) m.style.display = 'none';
            });
            
            // 切换当前菜单
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }
        
        // 关闭所有菜单（点击外部时）
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.task-actions-dropdown')) {
                document.querySelectorAll('.actions-menu').forEach(menu => {
                    menu.style.display = 'none';
                });
            }
        });
        
        // 复制任务
        async function duplicateTask(taskId) {
            const task = allPointsTasks.find(t => t.id === taskId);
            if (!task) return;
            
            const newTaskData = {
                id: `${task.id}_copy_${Date.now()}`,
                name: `${task.name} (副本)`,
                points: task.points,
                daily_limit: task.daily_limit,
                description: task.description,
                icon: task.icon,
                category: task.category || 'custom'
            };
            
            try {
                const response = await apiRequest('/admin/points/config', {
                    method: 'POST',
                    body: JSON.stringify(newTaskData)
                });
                
                if (response.success) {
                    showMessage('任务复制成功！', 'success');
                    await loadPointsConfigData(pointsCurrentPage);
                } else {
                    alert('复制失败: ' + response.error);
                }
            } catch (error) {
                alert('复制失败: ' + error.message);
            }
        }
        
        function exportPointsConfig() {
            alert('积分配置导出功能：\n\n在实际应用中会导出当前配置为JSON文件');
        }
        
        // ===================== AdMob配置管理功能 =====================
        
        async function loadAdMobConfigData() {
            // 在加载真实数据前显示骨架屏
            const admobContainer = document.getElementById('admobConfigContent');
            if (admobContainer && typeof getAdmobSkeletonHTML === 'function') {
                admobContainer.innerHTML = getAdmobSkeletonHTML();
            }
            try {
                const data = await apiRequest('/admin/admob/config');
                await uiDelay();
                const config = data.data;
                
                const configHTML = `
                    <!-- Gentelella Style Header -->
                    <div class="page-title">
                        <div class="title_left">
                            <h3>AdMob广告配置 <small>管理移动广告设置</small></h3>
                        </div>
                        <div class="title_right">
                            <div class="btn-group" role="group">
                                <button class="btn btn-primary" onclick="testAdMobConfig()">
                                    🧪 测试配置
                                </button>
                                <button class="btn btn-success" onclick="loadAdMobConfigData()">
                                    🔄 刷新
                                </button>
                                <button class="btn btn-info" onclick="exportAdMobConfig()">
                                    💾 导出
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="clearfix"></div>
                    
                    <!-- Stats Overview Cards -->
                    <div class="row">
                        <div class="col-md-3 col-sm-6">
                            <div class="x_panel tile fixed_height_320">
                                <div class="x_title">
                                    <h2>广告状态</h2>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <h4>${config.enabled ? '已启用' : '已禁用'}</h4>
                                    <div class="widget_summary">
                                        <div class="w_left w_25">
                                            <span class="text-${config.enabled ? 'success' : 'danger'}">📱</span>
                                        </div>
                                        <div class="w_center w_55">
                                            <div class="progress">
                                                <div class="progress-bar bg-${config.enabled ? 'green' : 'red'}" role="progressbar" 
                                                     style="width: ${config.enabled ? '100' : '0'}%">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="w_right w_20">
                                            <span class="text-${config.enabled ? 'success' : 'danger'}">${config.enabled ? 'ON' : 'OFF'}</span>
                                        </div>
                                        <div class="clearfix"></div>
                                    </div>
                                    <small class="text-muted">${config.enabled ? '广告正常运行' : '广告已暂停'}</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-3 col-sm-6">
                            <div class="x_panel tile fixed_height_320">
                                <div class="x_title">
                                    <h2>运行模式</h2>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <h4>${config.test_mode ? '测试模式' : '生产模式'}</h4>
                                    <div class="widget_summary">
                                        <div class="w_left w_25">
                                            <span class="text-${config.test_mode ? 'warning' : 'primary'}">🧪</span>
                                        </div>
                                        <div class="w_center w_55">
                                            <div class="progress">
                                                <div class="progress-bar bg-${config.test_mode ? 'orange' : 'blue'}" role="progressbar" 
                                                     style="width: 100%">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="w_right w_20">
                                            <span class="text-${config.test_mode ? 'warning' : 'primary'}">${config.test_mode ? 'TEST' : 'PROD'}</span>
                                        </div>
                                        <div class="clearfix"></div>
                                    </div>
                                    <small class="text-muted">${config.test_mode ? '使用测试广告' : '使用真实广告'}</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-3 col-sm-6">
                            <div class="x_panel tile fixed_height_320">
                                <div class="x_title">
                                    <h2>刷新间隔</h2>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <h4>${config.auto_refresh_interval}秒</h4>
                                    <div class="widget_summary">
                                        <div class="w_left w_25">
                                            <span class="text-info">⏱️</span>
                                        </div>
                                        <div class="w_center w_55">
                                            <div class="progress">
                                                <div class="progress-bar bg-blue" role="progressbar" style="width: 75%">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="w_right w_20">
                                            <span class="text-info">${config.auto_refresh_interval}s</span>
                                        </div>
                                        <div class="clearfix"></div>
                                    </div>
                                    <small class="text-muted">自动刷新已配置</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-3 col-sm-6">
                            <div class="x_panel tile fixed_height_320">
                                <div class="x_title">
                                    <h2>广告单元</h2>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <h4>4个单元</h4>
                                    <div class="widget_summary">
                                        <div class="w_left w_25">
                                            <span class="text-success">📊</span>
                                        </div>
                                        <div class="w_center w_55">
                                            <div class="progress">
                                                <div class="progress-bar bg-green" role="progressbar" style="width: 100%">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="w_right w_20">
                                            <span class="text-success">4</span>
                                        </div>
                                        <div class="clearfix"></div>
                                    </div>
                                    <small class="text-muted">全部已配置</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Basic Configuration Panel -->
                    <div class="row">
                        <div class="col-md-12">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2>基础配置 <small>AdMob核心设置</small></h2>
                                    <ul class="nav navbar-right panel_toolbox">
                                        <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
                                        <li><a class="close-link"><i class="fa fa-close"></i></a></li>
                                    </ul>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <form class="form-horizontal form-label-left">
                                        <div class="form-group row">
                                            <label class="col-form-label col-md-3 col-sm-3">应用ID</label>
                                            <div class="col-md-9 col-sm-9">
                                                <div class="input-group">
                                                    <input type="text" value="${config.app_id}" 
                                                           onchange="updateAdMobConfig('app_id', this.value)"
                                                           class="form-control" placeholder="ca-app-pub-xxxxxxxx~xxxxxxxxx">
                                                    <div class="input-group-append">
                                                                                                <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('${config.app_id}')" title="复制">
                                            📋
                                        </button>
                                                    </div>
                                                </div>
                                                <small class="form-text text-muted">AdMob应用标识符</small>
                                            </div>
                                        </div>
                                        
                                        <div class="form-group row">
                                            <label class="col-form-label col-md-3 col-sm-3">广告功能</label>
                                            <div class="col-md-9 col-sm-9">
                                                <div class="btn-group" data-toggle="buttons">
                                                    <label class="btn btn-${config.enabled ? 'success' : 'outline-success'} ${config.enabled ? 'active' : ''}">
                                                        <input type="radio" name="enabled" ${config.enabled ? 'checked' : ''} 
                                                               onchange="updateAdMobConfig('enabled', true)"> 启用
                                                    </label>
                                                    <label class="btn btn-${!config.enabled ? 'danger' : 'outline-danger'} ${!config.enabled ? 'active' : ''}">
                                                        <input type="radio" name="enabled" ${!config.enabled ? 'checked' : ''} 
                                                               onchange="updateAdMobConfig('enabled', false)"> 禁用
                                                    </label>
                                                </div>
                                                <small class="form-text text-muted">启用或禁用所有广告展示</small>
                                            </div>
                                        </div>
                                        
                                        <div class="form-group row">
                                            <label class="col-form-label col-md-3 col-sm-3">运行模式</label>
                                            <div class="col-md-9 col-sm-9">
                                                <div class="btn-group" data-toggle="buttons">
                                                    <label class="btn btn-${!config.test_mode ? 'primary' : 'outline-primary'} ${!config.test_mode ? 'active' : ''}">
                                                        <input type="radio" name="test_mode" ${!config.test_mode ? 'checked' : ''} 
                                                               onchange="updateAdMobConfig('test_mode', false)"> 生产模式
                                                    </label>
                                                    <label class="btn btn-${config.test_mode ? 'warning' : 'outline-warning'} ${config.test_mode ? 'active' : ''}">
                                                        <input type="radio" name="test_mode" ${config.test_mode ? 'checked' : ''} 
                                                               onchange="updateAdMobConfig('test_mode', true)"> 测试模式
                                                    </label>
                                                </div>
                                                <small class="form-text text-muted">测试模式使用测试广告单元，生产模式使用真实广告</small>
                                            </div>
                                        </div>
                                        
                                        <div class="form-group row">
                                            <label class="col-form-label col-md-3 col-sm-3">刷新间隔</label>
                                            <div class="col-md-9 col-sm-9">
                                                <div class="input-group">
                                                    <input type="number" value="${config.auto_refresh_interval}" min="10" max="300"
                                                           onchange="updateAdMobConfig('auto_refresh_interval', this.value)"
                                                           class="form-control">
                                                    <div class="input-group-append">
                                                        <span class="input-group-text">秒</span>
                                                    </div>
                                                </div>
                                                <small class="form-text text-muted">广告自动刷新时间间隔（10-300秒）</small>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ad Units Configuration Panel -->
                    <div class="row">
                        <div class="col-md-12">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2>广告单元配置 <small>管理各类型广告位</small></h2>
                                    <ul class="nav navbar-right panel_toolbox">
                                        <li><a onclick="exportAdMobConfig()" class="export-link"><i class="fa fa-download"></i></a></li>
                                        <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
                                        <li><a class="close-link"><i class="fa fa-close"></i></a></li>
                                    </ul>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <table class="table table-striped jambo_table bulk_action">
                                        <thead>
                                            <tr class="headings">
                                                <th class="column-title">广告类型</th>
                                                <th class="column-title">广告单元ID</th>
                                                <th class="column-title">显示策略</th>
                                                <th class="column-title">状态</th>
                                                <th class="column-title">操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                            <tr>
                                <td>
                                    <div class="media">
                                        <div class="media-left">
                                            <span style="font-size: 24px;">📊</span>
                                        </div>
                                        <div class="media-body">
                                            <strong>横幅广告</strong><br>
                                            <small class="text-muted">Banner Ad</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group input-group-sm">
                                        <input type="text" value="${config.banner_ad_unit}" 
                                               onchange="updateAdMobConfig('banner_ad_unit', this.value)"
                                               class="form-control" placeholder="ca-app-pub-xxxxxxxx/xxxxxxxxx">
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" onclick="copyToClipboard('${config.banner_ad_unit}')" title="复制">
                                                📋
                                            </button>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <select onchange="updateFrequency('banner', this.value)" class="form-control form-control-sm">
                                        <option value="always" ${config.show_frequency?.banner === 'always' ? 'selected' : ''}>始终显示</option>
                                        <option value="timed" ${config.show_frequency?.banner === 'timed' ? 'selected' : ''}>定时显示</option>
                                        <option value="manual" ${config.show_frequency?.banner === 'manual' ? 'selected' : ''}>手动控制</option>
                                    </select>
                                </td>
                                <td>
                                    <span class="badge badge-success">已配置</span>
                                </td>
                                <td>
                                    <button class="btn btn-info btn-xs" onclick="testAdUnit('banner')">
                                        <i class="fa fa-play"></i> 测试
                                    </button>
                                </td>
                            </tr>
                            
                            <tr>
                                <td>
                                    <div class="media">
                                        <div class="media-left">
                                            <span style="font-size: 24px;">🖼️</span>
                                        </div>
                                        <div class="media-body">
                                            <strong>插屏广告</strong><br>
                                            <small class="text-muted">Interstitial Ad</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group input-group-sm">
                                        <input type="text" value="${config.interstitial_ad_unit}" 
                                               onchange="updateAdMobConfig('interstitial_ad_unit', this.value)"
                                               class="form-control" placeholder="ca-app-pub-xxxxxxxx/xxxxxxxxx">
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" onclick="copyToClipboard('${config.interstitial_ad_unit}')" title="复制">
                                                📋
                                            </button>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <select onchange="updateFrequency('interstitial', this.value)" class="form-control form-control-sm">
                                        <option value="every_3_actions" ${config.show_frequency?.interstitial === 'every_3_actions' ? 'selected' : ''}>每3次操作</option>
                                        <option value="every_5_actions" ${config.show_frequency?.interstitial === 'every_5_actions' ? 'selected' : ''}>每5次操作</option>
                                        <option value="on_demand" ${config.show_frequency?.interstitial === 'on_demand' ? 'selected' : ''}>按需显示</option>
                                    </select>
                                </td>
                                <td>
                                    <span class="badge badge-success">已配置</span>
                                </td>
                                <td>
                                    <button class="btn btn-info btn-xs" onclick="testAdUnit('interstitial')">
                                        <i class="fa fa-play"></i> 测试
                                    </button>
                                </td>
                            </tr>
                            
                            <tr>
                                <td>
                                    <div class="media">
                                        <div class="media-left">
                                            <span style="font-size: 24px;">🎥</span>
                                        </div>
                                        <div class="media-body">
                                            <strong>激励视频</strong><br>
                                            <small class="text-muted">Rewarded Video</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group input-group-sm">
                                        <input type="text" value="${config.rewarded_ad_unit}" 
                                               onchange="updateAdMobConfig('rewarded_ad_unit', this.value)"
                                               class="form-control" placeholder="ca-app-pub-xxxxxxxx/xxxxxxxxx">
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" onclick="copyToClipboard('${config.rewarded_ad_unit}')" title="复制">
                                                📋
                                            </button>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <select onchange="updateFrequency('rewarded', this.value)" class="form-control form-control-sm">
                                        <option value="on_demand" ${config.show_frequency?.rewarded === 'on_demand' ? 'selected' : ''}>用户主动</option>
                                        <option value="suggested" ${config.show_frequency?.rewarded === 'suggested' ? 'selected' : ''}>智能推荐</option>
                                    </select>
                                </td>
                                <td>
                                    <span class="badge badge-success">已配置</span>
                                </td>
                                <td>
                                    <button class="btn btn-info btn-xs" onclick="testAdUnit('rewarded')">
                                        <i class="fa fa-play"></i> 测试
                                    </button>
                                </td>
                            </tr>
                            
                            <tr>
                                <td>
                                    <div class="media">
                                        <div class="media-left">
                                            <span style="font-size: 24px;">📝</span>
                                        </div>
                                        <div class="media-body">
                                            <strong>原生广告</strong><br>
                                            <small class="text-muted">Native Ad</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group input-group-sm">
                                        <input type="text" value="${config.native_ad_unit}" 
                                               onchange="updateAdMobConfig('native_ad_unit', this.value)"
                                               class="form-control" placeholder="ca-app-pub-xxxxxxxx/xxxxxxxxx">
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" onclick="copyToClipboard('${config.native_ad_unit}')" title="复制">
                                                📋
                                            </button>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <select onchange="updateFrequency('native', this.value)" class="form-control form-control-sm">
                                        <option value="auto" ${config.show_frequency?.native === 'auto' ? 'selected' : ''}>自动展示</option>
                                        <option value="manual" ${config.show_frequency?.native === 'manual' ? 'selected' : ''}>手动控制</option>
                                    </select>
                                </td>
                                <td>
                                    <span class="badge badge-success">已配置</span>
                                </td>
                                <td>
                                    <button class="btn btn-info btn-xs" onclick="testAdUnit('native')">
                                        <i class="fa fa-play"></i> 测试
                                    </button>
                                </td>
                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('admobConfigContent').innerHTML = configHTML;
                
            } catch (error) {
                document.getElementById('admobConfigContent').innerHTML = `
                    <div class="loading">
                        ⚠️ 加载AdMob配置失败: ${error.message}
                        <br><button onclick="loadAdMobConfigData()" class="btn btn-primary">重试</button>
                    </div>
                `;
            }
        }

        // 骨架屏HTML - AdMob配置
        function getAdmobSkeletonHTML() {
            return `
                <div class="page-title">
                    <div class="title_left">
                        <div class='skeleton skeleton-line' style='width:250px;height:36px;'></div>
                    </div>
                    <div class="title_right">
                        <div class="col-md-5 col-sm-5 form-group pull-right top_search">
                            <div class="col-md-7 col-sm-7 form-group">
                                ${Array.from({length:2}).map(()=>`<div class='skeleton skeleton-button' style='margin-right:5px;'></div>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="clearfix"></div>
                
                <!-- Stats Cards Skeleton -->
                <div class="row">
                    ${Array.from({length:4}).map(()=>`
                        <div class="col-md-3 col-sm-6">
                            <div class="x_panel tile fixed_height_320">
                                <div class="x_title">
                                    <div class='skeleton skeleton-line' style='width:100px;height:24px;'></div>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <div class='skeleton skeleton-line' style='width:80px;height:28px;margin-bottom:15px;'></div>
                                    <div class="widget_summary">
                                        <div class="w_left w_25">
                                            <div class='skeleton skeleton-line' style='width:30px;height:16px;'></div>
                                        </div>
                                        <div class="w_center w_55">
                                            <div class="progress">
                                                <div class='skeleton skeleton-line' style='width:100%;height:10px;'></div>
                                            </div>
                                        </div>
                                        <div class="w_right w_20">
                                            <div class='skeleton skeleton-line' style='width:25px;height:20px;'></div>
                                        </div>
                                        <div class="clearfix"></div>
                                    </div>
                                    <div class='skeleton skeleton-line' style='width:70%;height:14px;'></div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <!-- Configuration Form Skeleton -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="x_panel">
                            <div class="x_title">
                                <div class='skeleton skeleton-line' style='width:150px;height:28px;'></div>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <form class="form-horizontal form-label-left">
                                    ${Array.from({length:3}).map(()=>`
                                        <div class="form-group row">
                                            <div class="col-md-3 col-sm-3">
                                                <div class='skeleton skeleton-line' style='width:80%;height:20px;'></div>
                                            </div>
                                            <div class="col-md-9 col-sm-9">
                                                <div class='skeleton skeleton-line' style='width:100%;height:38px;'></div>
                                                <div class='skeleton skeleton-line' style='width:60%;height:14px;margin-top:5px;'></div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Table Skeleton -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="x_panel">
                            <div class="x_title">
                                <div class='skeleton skeleton-line' style='width:180px;height:28px;'></div>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <table class="table table-striped jambo_table">
                                    <thead>
                                        <tr class="headings">
                                            ${Array.from({length:5}).map(()=>`<th><div class='skeleton skeleton-line' style='width:80%;height:20px;'></div></th>`).join('')}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${Array.from({length:4}).map(()=>`
                                            <tr>
                                                ${Array.from({length:5}).map(()=>`<td><div class='skeleton skeleton-line' style='width:90%;height:16px;'></div></td>`).join('')}
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        async function updateAdMobConfig(field, value) {
            try {
                const updateData = { [field]: value };
                
                const response = await apiRequest('/admin/admob/config', {
                    method: 'PUT',
                    body: JSON.stringify(updateData)
                });
                
                if (response.success) {
                    console.log('AdMob配置更新成功:', response.message);
                } else {
                    alert('更新失败: ' + response.error);
                }
                
            } catch (error) {
                alert('更新失败: ' + error.message);
            }
        }
        
        function testAdMobConfig() {
            alert('AdMob配置测试：\n\n在实际应用中会:\n• 验证广告单元ID有效性\n• 测试广告加载\n• 检查配置完整性\n\n模拟：配置测试通过！');
        }
        
        // 更新显示频率策略
        async function updateFrequency(adType, frequency) {
            try {
                const updateData = {
                    show_frequency: {
                        [adType]: frequency
                    }
                };
                
                const response = await apiRequest('/admin/admob/config', {
                    method: 'PUT',
                    body: JSON.stringify(updateData)
                });
                
                if (response.success) {
                    console.log(`✅ ${adType} 广告频率更新为: ${frequency}`);
                } else {
                    alert('更新失败: ' + response.error);
                }
                
            } catch (error) {
                alert('更新失败: ' + error.message);
            }
        }
        
        // 复制到剪贴板
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // 显示复制成功的提示
                const toast = document.createElement('div');
                toast.className = 'copy-toast';
                toast.textContent = '已复制到剪贴板';
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 2000);
            }).catch(() => {
                // 备选方案
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('已复制到剪贴板');
            });
        }
        
        // 导出AdMob配置
        function exportAdMobConfig() {
            alert('AdMob配置导出功能：\n\n在实际应用中会导出当前配置为JSON文件');
        }
        
        function resetAdMobConfig() {
            if (confirm('确定要重置AdMob配置为默认值吗？')) {
                alert('AdMob配置重置功能：\n\n在实际应用中会恢复到默认配置');
                loadAdMobConfigData();
            }
        }

        // ===================== 系统设置相关功能 =====================
        
        // 安全管理功能
        function viewSecurityLogs() {
            alert('安全日志查看功能：\n\n在实际应用中，这里会显示:\n• 登录记录\n• 操作日志\n• 安全事件\n• 异常访问\n\n模拟：显示最近100条安全日志');
        }
        
        function configSecurity() {
            alert('安全配置功能：\n\n在实际应用中，这里可以配置:\n• Token有效期\n• 密码策略\n• 访问限制\n• API限流规则\n\n模拟：安全配置已更新！');
        }
        
        function emergencyLock() {
            if (confirm('确定要进行紧急锁定吗？这将:\n• 禁用所有API访问\n• 强制所有用户下线\n• 启用只读模式')) {
                alert('紧急锁定功能：\n\n在实际应用中，这里会:\n• 激活紧急锁定模式\n• 记录锁定事件\n• 通知管理员\n\n模拟：系统已进入紧急锁定模式！');
            }
        }
        
        function securityScan() {
            alert('安全扫描功能：\n\n正在执行安全扫描...\n\n✅ 检查项目:\n• 密码强度: 通过\n• 权限配置: 通过\n• API安全: 通过\n• 数据完整性: 通过\n\n扫描完成！未发现安全问题。');
        }
        
        // 数据管理功能
        function backupData() {
            if (confirm('确定要备份所有数据吗？')) {
                const backupData = {
                    timestamp: new Date().toISOString(),
                    version: '1.0',
                    data: {
                        localStorage: {...localStorage},
                        sessionStorage: {...sessionStorage}
                    }
                };
                
                const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                alert('数据备份已完成！文件已下载。');
            }
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (confirm('确定要导入数据吗？这将覆盖现有数据！')) {
                                if (data.data && data.data.localStorage) {
                                    Object.keys(data.data.localStorage).forEach(key => {
                                        localStorage.setItem(key, data.data.localStorage[key]);
                                    });
                                }
                                alert('数据导入成功！页面将重新加载。');
                                window.location.reload();
                            }
                        } catch (error) {
                            alert('导入失败：文件格式错误！');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        function clearAllData() {
            if (confirm('⚠️ 警告：这将清除所有数据！\n\n确定要继续吗？此操作不可恢复！')) {
                if (confirm('🚨 最后确认：真的要清除所有数据吗？')) {
                    localStorage.clear();
                    sessionStorage.clear();
                    alert('所有数据已清除！页面将重新加载。');
                    window.location.reload();
                }
            }
        }

        // 加载积分概览数据
        async function loadPointsOverview() {
            try {
                const response = await fetch(`${API_BASE}/admin/points/overview`, {
                    headers: getAuthHeaders()
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const data = result.data;
                    
                    // 更新积分概览统计
                    document.getElementById('totalPointsPool').textContent = 
                        data.overview.total_points?.toLocaleString() || '0';
                    document.getElementById('todayPointsEarned').textContent = 
                        data.today.points_earned_today?.toLocaleString() || '0';
                    document.getElementById('todayPointsSpent').textContent = 
                        data.today.points_spent_today?.toLocaleString() || '0';
                    document.getElementById('richUsers').textContent = 
                        data.overview.rich_users || '0';
                    
                    // 加载积分交易记录
                    loadPointsTransactions();
                    
                    // 生成积分类型图表
                    generatePointsCharts(data.types);
                } else {
                    console.error('加载积分数据失败:', response.status);
                }
            } catch (error) {
                console.error('加载积分数据错误:', error);
            }
        }

        // 加载积分交易记录
        async function loadPointsTransactions() {
            try {
                const response = await fetch(`${API_BASE}/admin/points/transactions?limit=20`, {
                    headers: getAuthHeaders()
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const transactions = result.data.transactions || [];
                    
                    const tbody = document.querySelector('#pointsTransactionsTable tbody');
                    if (transactions.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #999;">暂无积分交易记录</td></tr>';
                        return;
                    }
                    
                    tbody.innerHTML = transactions.map(tx => `
                        <tr>
                            <td>${new Date(tx.created_at).toLocaleString()}</td>
                            <td>${tx.username || tx.user_id}</td>
                            <td>${getTransactionTypeText(tx.transaction_type)}</td>
                            <td style="color: ${tx.points_change > 0 ? '#28a745' : '#dc3545'};">
                                ${tx.points_change > 0 ? '+' : ''}${tx.points_change.toLocaleString()}
                            </td>
                            <td>${tx.balance_after.toLocaleString()}</td>
                            <td>${tx.description}</td>
                            <td>${tx.admin_username || '-'}</td>
                        </tr>
                    `).join('');
                } else {
                    console.error('加载积分交易记录失败:', response.status);
                }
            } catch (error) {
                console.error('加载积分交易记录错误:', error);
            }
        }

        // 获取交易类型文本
        function getTransactionTypeText(type) {
            const types = {
                'watch_video': '观看视频',
                'download_app': '下载应用',
                'daily_checkin': '每日签到',
                'game_reward': '游戏奖励',
                'referral_bonus': '邀请奖励',
                'admin_adjustment': '管理员调整',
                'admin_batch_adjustment': '批量调整',
                'withdrawal': '积分提现',
                'purchase': '积分购买'
            };
            return types[type] || type;
        }

        // 生成积分类型图表
        function generatePointsCharts(typesData) {
            if (!typesData || typesData.length === 0) return;
            
            // 积分获得途径图表
            const earnCtx = document.getElementById('pointsEarnChart')?.getContext('2d');
            if (earnCtx) {
                new Chart(earnCtx, {
                    type: 'doughnut',
                    data: {
                        labels: typesData.map(t => getTransactionTypeText(t.transaction_type)),
                        datasets: [{
                            data: typesData.map(t => t.total_earned),
                            backgroundColor: [
                                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', 
                                '#9966FF', '#FF9F40', '#FF6384', '#C9CBCF'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }
        }

        // 显示积分调整模态框
        function showPointsAdjustModal() {
            document.getElementById('pointsAdjustModal').style.display = 'flex';
            clearPointsForm();
        }

        // 关闭积分调整模态框
        function closePointsModal() {
            document.getElementById('pointsAdjustModal').style.display = 'none';
            clearPointsForm();
        }

        // 清空积分调整表单
        function clearPointsForm() {
            document.getElementById('searchUserId').value = '';
            document.getElementById('pointsChange').value = '';
            document.getElementById('adjustReason').value = '';
            document.getElementById('userSearchResult').style.display = 'none';
            document.getElementById('pointsWarning').style.display = 'none';
            document.getElementById('pointsSuccess').style.display = 'none';
            document.getElementById('submitAdjust').disabled = true;
            currentUser = null;
        }

        // 搜索用户
        async function searchUser() {
            const searchTerm = document.getElementById('searchUserId').value.trim();
            if (searchTerm.length < 2) {
                document.getElementById('userSearchResult').style.display = 'none';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/admin/users?search=${encodeURIComponent(searchTerm)}&limit=1`, {
                    headers: getAuthHeaders()
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const users = result.data.users || [];
                    
                    if (users.length > 0) {
                        const user = users[0];
                        currentUser = user;
                        
                        // 显示用户信息
                        document.getElementById('selectedUsername').textContent = user.username;
                        document.getElementById('selectedUserEmail').textContent = user.email;
                        document.getElementById('selectedUserPoints').textContent = user.points_balance.toLocaleString();
                        document.getElementById('selectedUserLevel').textContent = user.membership_level;
                        document.getElementById('selectedUserTotal').textContent = user.total_earned.toLocaleString();
                        document.getElementById('userSearchResult').style.display = 'block';
                        
                        validatePoints();
                    } else {
                        document.getElementById('userSearchResult').style.display = 'none';
                        currentUser = null;
                    }
                }
            } catch (error) {
                console.error('搜索用户失败:', error);
            }
        }

        // 验证积分输入
        function validatePoints() {
            const pointsChange = parseInt(document.getElementById('pointsChange').value) || 0;
            const reason = document.getElementById('adjustReason').value.trim();
            const warningDiv = document.getElementById('pointsWarning');
            const submitBtn = document.getElementById('submitAdjust');
            
            warningDiv.style.display = 'none';
            
            if (!currentUser) {
                submitBtn.disabled = true;
                return;
            }
            
            if (pointsChange === 0) {
                submitBtn.disabled = true;
                return;
            }
            
            if (!reason) {
                submitBtn.disabled = true;
                return;
            }
            
            // 检查负数情况
            if (pointsChange < 0 && currentUser.points_balance + pointsChange < 0) {
                warningDiv.textContent = `警告：调整后积分将为负数 (${(currentUser.points_balance + pointsChange).toLocaleString()})`;
                warningDiv.style.display = 'block';
                submitBtn.disabled = true;
                return;
            }
            
            submitBtn.disabled = false;
        }

        // 提交积分调整
        function initPointsAdjustForm() {
            const form = document.getElementById('pointsAdjustForm');
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    if (!currentUser) return;
            
            const pointsChange = parseInt(document.getElementById('pointsChange').value);
            const reason = document.getElementById('adjustReason').value.trim();
            
            try {
                const response = await fetch(`${API_BASE}/admin/points/adjust`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        user_id: currentUser.user_id,
                        points_change: pointsChange,
                        reason: reason
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    const successDiv = document.getElementById('pointsSuccess');
                    successDiv.textContent = `积分调整成功！${currentUser.username} 的积分从 ${result.data.old_balance.toLocaleString()} 调整为 ${result.data.new_balance.toLocaleString()}`;
                    successDiv.style.display = 'block';
                    
                    setTimeout(() => {
                        closePointsModal();
                        loadPointsOverview();
                    }, 2000);
                } else {
                    const warningDiv = document.getElementById('pointsWarning');
                    warningDiv.textContent = result.error || '调整失败';
                    warningDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('调整积分失败:', error);
            }
                });
            }
        }

        // 显示用户积分搜索
        function showUserPointsSearch() {
            document.getElementById('userPointsModal').style.display = 'flex';
        }

        // 关闭用户积分模态框
        function closeUserPointsModal() {
            document.getElementById('userPointsModal').style.display = 'none';
            document.getElementById('searchUserIdDetail').value = '';
            document.getElementById('userDetailResult').style.display = 'none';
        }

        // 搜索用户详情
        async function searchUserDetail() {
            const searchTerm = document.getElementById('searchUserIdDetail').value.trim();
            if (searchTerm.length < 2) {
                document.getElementById('userDetailResult').style.display = 'none';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/admin/users?search=${encodeURIComponent(searchTerm)}&limit=1`, {
                    headers: getAuthHeaders()
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const users = result.data.users || [];
                    
                    if (users.length > 0) {
                        const user = users[0];
                        
                        // 显示用户详情
                        document.getElementById('detailUsername').textContent = user.username;
                        document.getElementById('detailUserEmail').textContent = user.email;
                        document.getElementById('detailUserId').textContent = user.user_id;
                        document.getElementById('detailUserPoints').textContent = user.points_balance.toLocaleString();
                        document.getElementById('detailUserLevel').textContent = user.membership_level;
                        document.getElementById('detailUserTotal').textContent = user.total_earned.toLocaleString();
                        document.getElementById('detailCreateTime').textContent = new Date(user.created_at).toLocaleDateString();
                        document.getElementById('detailLastActive').textContent = new Date(user.last_active).toLocaleDateString();
                        
                        // 加载用户积分交易记录
                        loadUserTransactions(user.user_id);
                        
                        document.getElementById('userDetailResult').style.display = 'block';
                    } else {
                        document.getElementById('userDetailResult').style.display = 'none';
                    }
                }
            } catch (error) {
                console.error('搜索用户详情失败:', error);
            }
        }

        // 加载用户积分交易记录
        async function loadUserTransactions(userId) {
            try {
                const response = await fetch(`${API_BASE}/admin/points/user/${userId}`, {
                    headers: getAuthHeaders()
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const transactions = result.data.transactions || [];
                    
                    const tbody = document.getElementById('userTransactionsList');
                    if (transactions.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 20px; color: #999;">暂无交易记录</td></tr>';
                        return;
                    }
                    
                    tbody.innerHTML = transactions.map(tx => `
                        <tr>
                            <td>${new Date(tx.created_at).toLocaleDateString()}</td>
                            <td>${getTransactionTypeText(tx.transaction_type)}</td>
                            <td style="text-align: right; color: ${tx.points_change > 0 ? '#28a745' : '#dc3545'};">
                                ${tx.points_change > 0 ? '+' : ''}${tx.points_change.toLocaleString()}
                            </td>
                            <td style="text-align: right;">${tx.balance_after.toLocaleString()}</td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('加载用户交易记录失败:', error);
            }
        }

        // 显示批量调整模态框
        function showBatchAdjustModal() {
            document.getElementById('batchAdjustModal').style.display = 'flex';
        }

        // 关闭批量调整模态框
        function closeBatchModal() {
            document.getElementById('batchAdjustModal').style.display = 'none';
        }

        // 添加批量调整行
        function addBatchRow() {
            const container = document.getElementById('batchRows');
            const newRow = document.createElement('div');
            newRow.className = 'batch-row';
            newRow.innerHTML = `
                <input type="text" placeholder="用户ID" class="batch-user-id">
                <input type="number" placeholder="积分变动" class="batch-points">
                <input type="text" placeholder="备注" class="batch-note">
                <button type="button" class="remove-row" onclick="removeBatchRow(this)">删除</button>
            `;
            container.appendChild(newRow);
        }

        // 删除批量调整行
        function removeBatchRow(button) {
            button.parentElement.remove();
        }

        // 提交批量调整
        async function submitBatchAdjust() {
            const reason = document.getElementById('batchReason').value.trim();
            if (!reason) {
                alert('请输入批量调整原因');
                return;
            }

            const rows = document.querySelectorAll('.batch-row');
            const adjustments = [];
            
            for (const row of rows) {
                const userId = row.querySelector('.batch-user-id').value.trim();
                const pointsChange = parseInt(row.querySelector('.batch-points').value) || 0;
                const note = row.querySelector('.batch-note').value.trim();
                
                if (userId && pointsChange !== 0) {
                    adjustments.push({
                        user_id: userId,
                        points_change: pointsChange,
                        note: note
                    });
                }
            }
            
            if (adjustments.length === 0) {
                alert('请添加至少一个有效的调整项');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/admin/points/batch-adjust`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        adjustments: adjustments,
                        batch_reason: reason
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    alert(`批量调整完成！成功: ${result.data.summary.successful}, 失败: ${result.data.summary.failed}`);
                    closeBatchModal();
                    loadPointsOverview();
                } else {
                    alert(result.error || '批量调整失败');
                }
            } catch (error) {
                console.error('批量调整失败:', error);
                alert('批量调整失败');
            }
        }

        // 显示积分分析
        function showPointsAnalytics() {
            alert('积分数据分析功能开发中...');
        }

        // 刷新积分数据
        function refreshPointsData() {
            loadPointsOverview();
        }

        // 导出积分报告
        function exportPointsReport() {
            alert('积分报告导出功能开发中...');
        }

        // 添加更新管理员信息显示的函数
        function updateAdminInfoDisplay() {
            const admin = getAdminData();
            if (admin) {
                const user = admin.user || admin.admin || admin;
                const displayName = user.name || user.username || '管理员';
                const displayRole = user.role || 'super_admin';

                const nameEl = document.getElementById('adminName');
                const roleEl = document.getElementById('adminRole');
                if (nameEl) nameEl.textContent = displayName;
                if (roleEl) roleEl.textContent = displayRole;
                
                console.log('✅ 管理员信息已更新:', displayName, displayRole);
            }
        }
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 确保管理员数据已加载
            getAdminData();
            
            // 初始化表单事件监听器
            initPointsAdjustForm();
            
            if (checkAuth()) {
                if (setAuthHeaders()) {
                    // 更新界面上的管理员信息显示
                    updateAdminInfoDisplay();
                    
                    checkPointsAccess();
                    loadDashboardData();
                } else {
                    showAuthError();
                }
            } else {
                showAuthError();
            }
        });
        
        // 显示认证错误
        function showAuthError() {
            document.getElementById('statsGrid').innerHTML = `
                <div class="error-message">
                    ⚠️ 认证失败，无法加载数据
                    <br><button class="btn btn-primary" style="margin-top:10px;" onclick="window.open('admin-quick-fix.html', '_blank')">使用快速修复工具</button>
                    <br><button class="btn btn-secondary" style="margin-top:5px;" onclick="window.location.href='admin-login-simple.html'">重新登录</button>
                </div>`;
        }
        
        // 打开修复工具
        function openUltimateFix() {
            window.open('admin-quick-fix.html', '_blank');
        }
    </script>

    <!-- 积分调整模态框 -->
    <div id="pointsAdjustModal" class="points-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>💎 调整用户积分</h2>
                <button class="close-btn" onclick="closePointsModal()">&times;</button>
            </div>
            <form id="pointsAdjustForm">
                <div class="form-group">
                    <label for="searchUserId">用户ID或用户名</label>
                    <input type="text" id="searchUserId" placeholder="输入用户ID或用户名" oninput="searchUser()">
                </div>
                
                <div id="userSearchResult" class="user-search-result">
                    <div class="user-info">
                        <div>
                            <strong id="selectedUsername">-</strong>
                            <br><small id="selectedUserEmail">-</small>
                        </div>
                        <div class="user-points" id="selectedUserPoints">0</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #666;">
                        会员等级: <span id="selectedUserLevel">-</span> | 
                        累计收益: <span id="selectedUserTotal">0</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="pointsChange">积分变动</label>
                    <input type="number" id="pointsChange" placeholder="正数为增加，负数为减少" oninput="validatePoints()">
                </div>
                
                <div class="form-group">
                    <label for="adjustReason">调整原因</label>
                    <textarea id="adjustReason" rows="3" placeholder="请输入积分调整的详细原因..."></textarea>
                </div>
                
                <div id="pointsWarning" class="points-warning"></div>
                <div id="pointsSuccess" class="points-success"></div>
                
                <div style="display: flex; gap: 10px; margin-top: 25px;">
                    <button type="button" class="btn btn-secondary" onclick="closePointsModal()">取消</button>
                    <button type="submit" class="btn btn-primary" id="submitAdjust" disabled>确认调整</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 用户积分查询模态框 -->
    <div id="userPointsModal" class="points-modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>🔍 用户积分详情</h2>
                <button class="close-btn" onclick="closeUserPointsModal()">&times;</button>
            </div>
            
            <div class="form-group">
                <label for="searchUserIdDetail">搜索用户</label>
                <input type="text" id="searchUserIdDetail" placeholder="输入用户ID或用户名" oninput="searchUserDetail()">
            </div>
            
            <div id="userDetailResult" style="display: none;">
                <div class="user-search-result" style="display: block;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <h3 id="detailUsername">-</h3>
                            <p id="detailUserEmail">-</p>
                            <p>用户ID: <span id="detailUserId">-</span></p>
                            <p>注册时间: <span id="detailCreateTime">-</span></p>
                        </div>
                        <div>
                            <div class="user-points" style="font-size: 2rem;" id="detailUserPoints">0</div>
                            <p>会员等级: <span id="detailUserLevel">-</span></p>
                            <p>累计收益: <span id="detailUserTotal">0</span></p>
                            <p>最后活跃: <span id="detailLastActive">-</span></p>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3>📋 积分交易记录</h3>
                    <div style="max-height: 300px; overflow-y: auto; margin-top: 15px;">
                        <table style="width: 100%; font-size: 0.9rem;">
                            <thead>
                                <tr style="background: #f8f9fa;">
                                    <th style="padding: 8px; text-align: left;">时间</th>
                                    <th style="padding: 8px; text-align: left;">类型</th>
                                    <th style="padding: 8px; text-align: right;">变动</th>
                                    <th style="padding: 8px; text-align: right;">余额</th>
                                </tr>
                            </thead>
                            <tbody id="userTransactionsList">
                                <tr><td colspan="4" style="text-align: center; padding: 20px; color: #999;">暂无数据</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 批量调整模态框 -->
    <div id="batchAdjustModal" class="points-modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>📝 批量积分调整</h2>
                <button class="close-btn" onclick="closeBatchModal()">&times;</button>
            </div>
            
            <div class="form-group">
                <label>批量调整原因</label>
                <input type="text" id="batchReason" placeholder="请输入批量调整的原因">
            </div>
            
            <div id="batchInputContainer">
                <div class="batch-input">
                    <h4>调整列表</h4>
                    <div id="batchRows">
                        <div class="batch-row">
                            <input type="text" placeholder="用户ID" class="batch-user-id">
                            <input type="number" placeholder="积分变动" class="batch-points">
                            <input type="text" placeholder="备注" class="batch-note">
                            <button type="button" class="remove-row" onclick="removeBatchRow(this)">删除</button>
                        </div>
                    </div>
                    <button type="button" class="add-row" onclick="addBatchRow()">+ 添加行</button>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 25px;">
                <button type="button" class="btn btn-secondary" onclick="closeBatchModal()">取消</button>
                <button type="button" class="btn btn-primary" onclick="submitBatchAdjust()">批量调整</button>
            </div>
        </div>
    </div>

</body>
</html>
