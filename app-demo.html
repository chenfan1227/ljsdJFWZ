<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§¯åˆ†å®</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .phone-container {
            width: 375px;
            height: 812px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 40px;
            padding: 60px 30px 30px;
            position: relative;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
        }
        
        .app-header {
            text-align: center;
            color: #fff;
            margin-bottom: 40px;
        }
        
        .app-logo {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .app-title {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .app-subtitle {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        /* ä¸»è¦å†…å®¹åŒºåŸŸ */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        /* ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ */
        .user-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px 20px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 100%;
        }
        
        .user-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #fff;
        }
        
        .user-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        
        .user-points {
            font-size: 2rem;
            font-weight: 900;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .vip-badge {
            background: linear-gradient(135deg, #ffd700, #ffb300);
            color: #333;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }
        
        /* 2x2 åŠŸèƒ½æŒ‰é’®ç½‘æ ¼ */
        .action-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
            margin-bottom: 30px;
        }
        
        .action-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .action-btn .icon {
            font-size: 1.8rem;
            margin-bottom: 8px;
            display: block;
        }
        
        .action-btn .text {
            font-size: 0.9rem;
            font-weight: 600;
            color: #333;
        }
        
        /* åº•éƒ¨å¯¼èˆª */
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 25px;
            padding: 15px 10px;
            margin-top: auto;
        }
        
        .nav-btn {
            background: none;
            border: none;
            padding: 10px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            min-width: 80px;
        }
        
        .nav-btn:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .nav-btn.active {
            background: rgba(102, 126, 234, 0.2);
        }
        
        /* ä¸ªäººèµ„æ–™é¡µé¢æ ·å¼ */
        .profile-container {
            padding: 20px;
            max-width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            margin: 10px;
            backdrop-filter: blur(10px);
        }
        
        .profile-header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid rgba(255,255,255,0.3);
            margin-bottom: 15px;
            object-fit: cover;
        }
        
        .profile-header h2 {
            margin: 10px 0 5px 0;
            color: white;
            font-size: 24px;
            font-weight: 600;
        }
        
        .profile-email {
            color: rgba(255,255,255,0.8);
            font-size: 14px;
            margin: 0;
        }
        
        .profile-stats {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-item {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stat-label {
            color: rgba(255,255,255,0.8);
            font-size: 14px;
        }
        
        .stat-value {
            color: white;
            font-weight: 600;
            font-size: 16px;
        }
        
        .profile-actions {
            margin-bottom: 25px;
        }
        
        .profile-btn {
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .profile-btn:hover {
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .profile-btn.logout-btn:hover {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        }
        
        .profile-info h3 {
            color: white;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        .info-item {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .info-label {
            color: rgba(255,255,255,0.7);
            font-size: 13px;
        }
        
        .info-value {
            color: white;
            font-size: 13px;
            font-weight: 500;
        }
        
        .nav-btn .icon {
            font-size: 1.5rem;
        }
        
        .nav-btn .text {
            font-size: 0.7rem;
            font-weight: 600;
            color: #333;
        }
        
        /* ç™»å½•æ¨¡æ€æ¡† */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .login-content {
            background: #fff;
            border-radius: 20px;
            padding: 30px;
            max-width: 320px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .login-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 20px;
        }
        
        .login-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .google-btn {
            background: #4285f4;
            color: #fff;
        }
        
        .apple-btn {
            background: #000;
            color: #fff;
        }
        
        .guest-btn {
            background: #f3f4f6;
            color: #333;
            border: 2px solid #667eea;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .login-message {
            margin-top: 15px;
            padding: 8px;
            border-radius: 8px;
            font-size: 0.8rem;
            display: none;
        }
        
        .success {
            background: #dcfce7;
            color: #16a34a;
        }
        
        .error {
            background: #fef2f2;
            color: #dc2626;
        }
        
        /* äº¤æ˜“è®°å½•è§†å›¾ */
        .transaction-view {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            width: 100%;
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }
        
        .section-title {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .transaction-item:last-child {
            border-bottom: none;
        }
        
        .transaction-info .title {
            font-size: 0.9rem;
            color: #333;
            margin-bottom: 2px;
        }
        
        .transaction-info .time {
            font-size: 0.7rem;
            color: #666;
        }
        
        .transaction-amount {
            font-weight: 700;
            color: #22c55e;
        }
        
        /* éšè—çŠ¶æ€ */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="phone-container">
        <!-- Appå¤´éƒ¨ -->
        <div class="app-header">
            <div class="app-logo">ğŸ’</div>
            <div class="app-title">ç§¯åˆ†å®</div>
            <div class="app-subtitle">Appç«¯ç™»å½•æ¼”ç¤º</div>
        </div>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
            <div class="user-card">
                <div class="user-avatar" id="userAvatar">ğŸ‘¤</div>
                <div class="user-name" id="userName">Demo Googleç”¨æˆ·</div>
                <div class="user-points" id="userPoints">10,000</div>
                <div class="vip-badge" id="vipBadge">æ™®é€šä¼šå‘˜</div>
            </div>

            <!-- 2x2 åŠŸèƒ½æŒ‰é’®ç½‘æ ¼ -->
            <div class="action-grid">
                <button class="action-btn" onclick="handleAction('video')">
                    <span class="icon">â˜•</span>
                    <span class="text">è§‚çœ‹è§†é¢‘</span>
                </button>
                
                <button class="action-btn" onclick="handleAction('app')">
                    <span class="icon">ğŸ“±</span>
                    <span class="text">ä¸‹è½½åº”ç”¨</span>
                </button>
                
                <button class="action-btn" onclick="handleAction('checkin')">
                    <span class="icon">ğŸ“…</span>
                    <span class="text">æ¯æ—¥ç­¾åˆ°</span>
                </button>
                
                <button class="action-btn" onclick="handleAction('refresh')">
                    <span class="icon">ğŸ”„</span>
                    <span class="text">åˆ·æ–°ç§¯åˆ†</span>
                </button>
            </div>

            <!-- äº¤æ˜“è®°å½•è§†å›¾ -->
            <div class="transaction-view" id="transactionView">
                <div class="section-title">æœ€è¿‘äº¤æ˜“è®°å½•</div>
                <div id="transactionList">
                    <div class="transaction-item">
                        <div class="transaction-info">
                            <div class="title">æ³¨å†Œå¥–åŠ±</div>
                            <div class="time">2024/8/9 20:58:59</div>
                        </div>
                        <div class="transaction-amount">+10,000</div>
                    </div>
                    
                    <div class="transaction-item">
                        <div class="transaction-info">
                            <div class="title">è§‚çœ‹è§†é¢‘</div>
                            <div class="time">2024/8/9 19:30:20</div>
                        </div>
                        <div class="transaction-amount">+50,000</div>
                    </div>
                    
                    <div class="transaction-item">
                        <div class="transaction-info">
                            <div class="title">æ³¨å†Œå¥–åŠ±</div>
                            <div class="time">2024/8/9 18:00:00</div>
                        </div>
                        <div class="transaction-amount">+10,000</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨å¯¼èˆªï¼ˆä¸‰ä¸ªæŒ‰é’®ï¼‰ -->
        <div class="bottom-nav">
            <button class="nav-btn active" onclick="showHomeView()">
                <span class="icon">ğŸ </span>
                <span class="text">é¦–é¡µ</span>
            </button>
            
            <button class="nav-btn" onclick="showTransactionView()">
                <span class="icon">ğŸ“Š</span>
                <span class="text">è®°å½•</span>
            </button>
            
            <button class="nav-btn" onclick="showProfileView()">
                <span class="icon">ğŸ‘¤</span>
                <span class="text">æˆ‘çš„</span>
            </button>
        </div>
    </div>

    <!-- ç™»å½•æ¨¡æ€æ¡† -->
    <div id="loginModal" class="login-modal">
        <div class="login-content">
            <h3 class="login-title">é€‰æ‹©ç™»å½•æ–¹å¼</h3>
            
            <button class="login-btn google-btn" onclick="loginWithGoogle()">
                <span>ğŸ”µ</span>
                ä½¿ç”¨ Google ç™»å½•
            </button>
            
            <button class="login-btn apple-btn" onclick="loginWithApple()">
                <span>ğŸ</span>
                ä½¿ç”¨ Apple ç™»å½•
            </button>
            
            <button class="login-btn guest-btn" onclick="loginAsGuest()">
                <span>ğŸ‘¤</span>
                æ¸¸å®¢æ¨¡å¼ä½“éªŒ
            </button>
            
            <div id="loginMessage" class="login-message"></div>
        </div>
    </div>

    <!-- Auth0 SDK -->
    <script src="https://cdn.auth0.com/js/auth0/9.23.2/auth0.min.js"></script>
    
    <script>
        const API_BASE = 'http://192.168.1.29:3001/api';
        let currentUser = null;
        let authToken = null;
        let isLoggedIn = false;
        let currentView = 'home';
        let pointsConfig = null; // ç§¯åˆ†é…ç½®
        let admobConfig = null;  // AdMobé…ç½®
        
        // Auth0 é…ç½®
        const auth0Config = {
            domain: 'dev-pnok5gjc2y8dk2eb.us.auth0.com', // æ›¿æ¢ä¸ºæ‚¨çš„Auth0åŸŸå
            clientId: 'wvn63LPmkjht4Pk3TYQpoc1HtpY94Wyz', // æ›¿æ¢ä¸ºæ‚¨çš„Auth0å®¢æˆ·ç«¯ID
            redirectUri: window.location.origin + '/app-demo.html',
            responseType: 'token id_token',
            scope: 'openid profile email',
            nonce: 'nonce_' + Math.random().toString(36).substr(2, 15)
        };
        
        // åˆå§‹åŒ–Auth0
        let auth0;
        let auth0InitializationAttempts = 0;
        const maxInitAttempts = 3;
        
        function initializeAuth0() {
            auth0InitializationAttempts++;
            console.log(`ğŸ”„ Auth0åˆå§‹åŒ–å°è¯• ${auth0InitializationAttempts}/${maxInitAttempts}`);
            
            try {
                // æ£€æŸ¥Auth0 SDKæ˜¯å¦å·²åŠ è½½
                if (typeof Auth0 === 'undefined') {
                    console.error('âŒ Auth0 SDKæœªåŠ è½½');
                    if (auth0InitializationAttempts < maxInitAttempts) {
                        console.log('â³ ç­‰å¾…Auth0 SDKåŠ è½½...');
                        setTimeout(initializeAuth0, 1000);
                        return;
                    } else {
                        console.error('âŒ Auth0 SDKåŠ è½½å¤±è´¥ï¼Œå°è¯•æ¬¡æ•°å·²è¾¾ä¸Šé™');
                        return;
                    }
                }
                
                console.log('âœ… Auth0 SDKå·²åŠ è½½');
                console.log('Auth0ç‰ˆæœ¬:', Auth0.version || 'unknown');
                
                auth0 = new Auth0.WebAuth(auth0Config);
                console.log('âœ… Auth0åˆå§‹åŒ–æˆåŠŸ', auth0Config);
                console.log('Auth0å¯¹è±¡ç±»å‹:', typeof auth0);
                
            } catch (error) {
                console.error('âŒ Auth0åˆå§‹åŒ–å¤±è´¥:', error);
                if (auth0InitializationAttempts < maxInitAttempts) {
                    console.log('â³ é‡è¯•Auth0åˆå§‹åŒ–...');
                    setTimeout(initializeAuth0, 1000);
                } else {
                    console.error('âŒ Auth0åˆå§‹åŒ–æœ€ç»ˆå¤±è´¥');
                }
            }
        }
        
        // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿SDKå®Œå…¨åŠ è½½
        setTimeout(initializeAuth0, 500);

        // é¡µé¢åŠ è½½æ—¶è®¾ç½®åˆå§‹çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            // æ£€æŸ¥æ˜¯å¦æœ‰Auth0å›è°ƒ
            if (window.location.hash && window.location.hash.includes('access_token')) {
                handleAuth0Callback();
            } else {
                // æ£€æŸ¥æ˜¯å¦å·²ç»ç™»å½•
                checkExistingAuth();
            }
            
            checkServerConnection();
            showHomeView();
        });

        // æ£€æŸ¥ç°æœ‰è®¤è¯çŠ¶æ€
        function checkExistingAuth() {
            console.log('ğŸ” æ£€æŸ¥ç°æœ‰è®¤è¯çŠ¶æ€...');
            console.log('Auth0é…ç½®:', auth0Config);
            
            const token = localStorage.getItem('auth0_token');
            const userProfile = localStorage.getItem('user_profile');
            
            if (token && userProfile) {
                try {
                    currentUser = JSON.parse(userProfile);
                    authToken = token;
                    isLoggedIn = true;
                    updateUserInterface();
                    console.log('âœ… å·²æ¢å¤ç™»å½•çŠ¶æ€:', currentUser.name);
                } catch (error) {
                    console.error('âŒ è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
                    logout();
                }
            } else {
                console.log('â„¹ï¸ æœªæ‰¾åˆ°ç°æœ‰ç™»å½•çŠ¶æ€');
                updateUIForLoggedOut();
            }
        }

        // æ›´æ–°UIä¸ºæœªç™»å½•çŠ¶æ€
        function updateUIForLoggedOut() {
            document.getElementById('userName').textContent = 'ç‚¹å‡»å¼€å§‹èµšé’±';
            document.getElementById('userPoints').textContent = '0';
            document.getElementById('vipBadge').textContent = 'æ–°ç”¨æˆ·';
            document.getElementById('userAvatar').textContent = 'ğŸ‘¤';
            isLoggedIn = false;
            currentUser = null;
            authToken = null;
        }

        // æ˜¾ç¤ºé¦–é¡µè§†å›¾
        function showHomeView() {
            currentView = 'home';
            document.querySelector('.user-card').style.display = 'block';
            document.querySelector('.action-grid').style.display = 'grid';
            document.getElementById('transactionView').style.display = 'none';
            updateNavActive('home');
        }

        // æ˜¾ç¤ºäº¤æ˜“è®°å½•è§†å›¾
        function showTransactionView() {
            if (!isLoggedIn) {
                sessionStorage.setItem('pendingAction', 'showTransaction');
                startAuth0Login();
                return;
            }
            currentView = 'transaction';
            document.querySelector('.user-card').style.display = 'none';
            document.querySelector('.action-grid').style.display = 'none';
            document.getElementById('transactionView').style.display = 'block';
            updateNavActive('transaction');
            loadTransactionHistory();
        }

        // æ˜¾ç¤ºä¸ªäººèµ„æ–™è§†å›¾
        function showProfileView() {
            console.log('ğŸ” showProfileView è¢«è°ƒç”¨');
            console.log('isLoggedIn:', isLoggedIn);
            console.log('currentUser:', currentUser);
            
            // æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
            if (!isLoggedIn || !currentUser) {
                console.log('âŒ ç”¨æˆ·æœªç™»å½•ï¼Œæ˜¾ç¤ºç™»å½•å¯¹è¯æ¡†');
                sessionStorage.setItem('pendingAction', 'showProfileView');
                showLoginModal();
                return;
            }
            
            console.log('âœ… ç”¨æˆ·å·²ç™»å½•ï¼Œæ˜¾ç¤ºä¸ªäººèµ„æ–™é¡µé¢');
            
            // éšè—ä¸»é¡µå†…å®¹
            const userCard = document.querySelector('.user-card');
            const actionGrid = document.querySelector('.action-grid');
            const transactionView = document.getElementById('transactionView');
            
            if (userCard) userCard.style.display = 'none';
            if (actionGrid) actionGrid.style.display = 'none';
            if (transactionView) transactionView.style.display = 'none';
            
            currentView = 'profile';
            updateNavActive('profile');
            
            // ç¡®ä¿ç”¨æˆ·æ•°æ®å®Œæ•´
            const userPoints = currentUser.points || 0;
            const userName = currentUser.name || currentUser.nickname || 'ç”¨æˆ·';
            const userEmail = currentUser.email || 'æœªç»‘å®šé‚®ç®±';
            const userAvatar = currentUser.avatar || currentUser.picture || 'ğŸ‘¤';
            const userId = currentUser.id || currentUser.sub || 'unknown';
            
            const profileHTML = `
                <div class="profile-container">
                    <div class="profile-header">
                        <img src="${userAvatar}" alt="å¤´åƒ" class="profile-avatar" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <div style="display:none; width:80px; height:80px; border-radius:50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display:flex; align-items:center; justify-content:center; font-size:2rem; margin:0 auto 15px;">ğŸ‘¤</div>
                        <h2>${userName}</h2>
                        <p class="profile-email">${userEmail}</p>
                    </div>
                    
                    <div class="profile-stats">
                        <div class="stat-item">
                            <span class="stat-label">å½“å‰ç§¯åˆ†</span>
                            <span class="stat-value">${userPoints.toLocaleString()}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ä¼šå‘˜ç­‰çº§</span>
                            <span class="stat-value">${currentUser.is_vip ? 'VIPä¼šå‘˜' : 'æ™®é€šä¼šå‘˜'}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">æ³¨å†Œæ—¶é—´</span>
                            <span class="stat-value">${new Date().toLocaleDateString()}</span>
                        </div>
                    </div>
                    
                    <div class="profile-actions">
                        <button class="profile-btn edit-btn" onclick="editProfile()">
                            <span class="icon">âœï¸</span>
                            ç¼–è¾‘èµ„æ–™
                        </button>
                        <button class="profile-btn settings-btn" onclick="showSettings()">
                            <span class="icon">âš™ï¸</span>
                            è´¦æˆ·è®¾ç½®
                        </button>
                        <button class="profile-btn history-btn" onclick="showTransactionView()">
                            <span class="icon">ğŸ“Š</span>
                            ç§¯åˆ†è®°å½•
                        </button>
                        <button class="profile-btn logout-btn" onclick="logoutUser()">
                            <span class="icon">ğŸšª</span>
                            é€€å‡ºç™»å½•
                        </button>
                    </div>
                    
                    <div class="profile-info">
                        <h3>è´¦æˆ·ä¿¡æ¯</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">ç”¨æˆ·ID</span>
                                <span class="info-value">${userId.substring(0, 12)}...</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ç»‘å®šé‚®ç®±</span>
                                <span class="info-value">${userEmail}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">æ³¨å†Œæ–¹å¼</span>
                                <span class="info-value">Auth0ç™»å½•</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">è´¦æˆ·çŠ¶æ€</span>
                                <span class="info-value" style="color: #4CAF50;">âœ… æ­£å¸¸</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.querySelector('.content').innerHTML = profileHTML;
            console.log('âœ… ä¸ªäººèµ„æ–™é¡µé¢å·²æ¸²æŸ“');
        }

        // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
        function updateNavActive(activeView) {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            if (activeView === 'home') {
                document.querySelectorAll('.nav-btn')[0].classList.add('active');
            } else if (activeView === 'transaction') {
                document.querySelectorAll('.nav-btn')[1].classList.add('active');
            }
        }

        // å¤„ç†åŠ¨ä½œæŒ‰é’®ç‚¹å‡»
        function handleAction(action) {
            if (!isLoggedIn) {
                // ä¿å­˜å¾…æ‰§è¡Œçš„æ“ä½œ
                sessionStorage.setItem('pendingAction', 'action:' + action);
                // ç›´æ¥å¯åŠ¨Auth0ç™»å½•ï¼Œä¸æ˜¾ç¤ºæ¨¡æ€æ¡†
                startAuth0Login();
                return;
            }

            // æ˜ å°„æ—§åŠ¨ä½œååˆ°æ–°åŠ¨ä½œå
            let newAction = action;
            switch(action) {
                case 'video':
                    newAction = 'watch_video';
                    break;
                case 'app':
                    newAction = 'download_app';
                    break;
                case 'checkin':
                    newAction = 'daily_checkin';
                    break;
                case 'refresh':
                    refreshPoints();
                    return;
            }
            
            executeAction(newAction);
        }
        
        // æ‰§è¡Œç§¯åˆ†æ“ä½œ
        async function executeAction(action) {
            console.log(`ğŸ¯ æ‰§è¡Œæ“ä½œ: ${action}`);
            
            // ä»åç«¯é…ç½®è·å–ç§¯åˆ†ä¿¡æ¯
            const actionConfig = getPointsForAction(action);
            const actionText = actionConfig.name || 'æœªçŸ¥æ“ä½œ';
            const points = actionConfig.points || 0;
            
            if (points === 0) {
                showMessage(`æ“ä½œ ${actionText} æš‚ä¸å¯ç”¨æˆ–æœªé…ç½®ç§¯åˆ†ï¼`, 'error');
                return;
            }
            
            // æ£€æŸ¥æ¯æ—¥é™åˆ¶
            const dailyLimit = actionConfig.daily_limit || 999;
            const todayActionCount = getTodayActionCount(action);
            
            if (todayActionCount >= dailyLimit) {
                showMessage(`ä»Šæ—¥ ${actionText} æ¬¡æ•°å·²è¾¾ä¸Šé™ (${dailyLimit}æ¬¡)ï¼`, 'warning');
                return;
            }
            
            // æ‰§è¡Œæ“ä½œé€»è¾‘
            let success = false;
            switch(action) {
                case 'watch_video':
                    success = await simulateVideoWatch();
                    break;
                case 'download_app':
                    success = await simulateAppDownload();
                    break;
                case 'daily_checkin':
                    success = await simulateDailyCheckin();
                    break;
                case 'complete_task':
                    success = await simulateTaskCompletion();
                    break;
                case 'invite_friend':
                    success = await simulateInviteFriend();
                    break;
                default:
                    // ä½¿ç”¨æ—§çš„å‡½æ•°ä½œä¸ºå¤‡é€‰
                    switch(action) {
                        case 'watch_video':
                            earnFromVideo();
                            success = true;
                            break;
                        case 'download_app':
                            earnFromApp();
                            success = true;
                            break;
                        case 'daily_checkin':
                            dailyCheckin();
                            success = true;
                            break;
                        default:
                            console.warn(`æœªçŸ¥æ“ä½œ: ${action}`);
                            return;
                    }
            }
            
            if (!success) {
                showMessage(`${actionText} æ‰§è¡Œå¤±è´¥ï¼Œè¯·é‡è¯•ï¼`, 'error');
                return;
            }
            
            // æ›´æ–°ç§¯åˆ†
            currentUser.points = (currentUser.points || 0) + points;
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('user_profile', JSON.stringify(currentUser));
            
            // æ›´æ–°UI
            updateUserInterface();
            
            // æ˜¾ç¤ºå¥–åŠ±åŠ¨ç”»
            showRewardAnimation(points);
            
            // è®°å½•ç§¯åˆ†å†å²
            const transaction = {
                id: Date.now(),
                action: action,
                action_text: actionText,
                points: points,
                timestamp: new Date().toISOString(),
                type: 'earn'
            };
            
            addTransactionRecord(transaction);
            
            // æ›´æ–°æ¯æ—¥æ“ä½œè®¡æ•°
            updateTodayActionCount(action);
            
            console.log(`âœ… ${actionText} å®Œæˆï¼Œè·å¾— ${points} ç§¯åˆ†`);
        }
        
        // æ¨¡æ‹Ÿæ“ä½œæ‰§è¡Œå‡½æ•°
        async function simulateVideoWatch() {
            return new Promise(resolve => {
                showMessage('æ­£åœ¨åŠ è½½è§†é¢‘å¹¿å‘Š...', 'info');
                setTimeout(() => {
                    showMessage('è§†é¢‘æ’­æ”¾å®Œæˆï¼', 'success');
                    resolve(true);
                }, 2000);
            });
        }
        
        async function simulateAppDownload() {
            return new Promise(resolve => {
                showMessage('æ­£åœ¨è·³è½¬åº”ç”¨å•†åº—...', 'info');
                setTimeout(() => {
                    showMessage('åº”ç”¨ä¸‹è½½éªŒè¯æˆåŠŸï¼', 'success');
                    resolve(true);
                }, 1500);
            });
        }
        
        async function simulateTaskCompletion() {
            return new Promise(resolve => {
                showMessage('æ­£åœ¨éªŒè¯ä»»åŠ¡å®ŒæˆçŠ¶æ€...', 'info');
                setTimeout(() => {
                    showMessage('ä»»åŠ¡éªŒè¯æˆåŠŸï¼', 'success');
                    resolve(true);
                }, 1000);
            });
        }
        
        async function simulateDailyCheckin() {
            return new Promise(resolve => {
                showMessage('æ­£åœ¨æ‰§è¡Œç­¾åˆ°...', 'info');
                setTimeout(() => {
                    showMessage('ç­¾åˆ°æˆåŠŸï¼', 'success');
                    resolve(true);
                }, 800);
            });
        }
        
        async function simulateInviteFriend() {
            return new Promise(resolve => {
                showMessage('æ­£åœ¨ç”Ÿæˆé‚€è¯·é“¾æ¥...', 'info');
                setTimeout(() => {
                    showMessage('é‚€è¯·é“¾æ¥å·²ç”Ÿæˆï¼', 'success');
                    resolve(true);
                }, 1200);
            });
        }
        
        // è·å–ä»Šæ—¥æ“ä½œæ¬¡æ•°
        function getTodayActionCount(action) {
            const today = new Date().toDateString();
            const key = `action_count_${action}_${today}`;
            return parseInt(localStorage.getItem(key)) || 0;
        }
        
        // æ›´æ–°ä»Šæ—¥æ“ä½œæ¬¡æ•°
        function updateTodayActionCount(action) {
            const today = new Date().toDateString();
            const key = `action_count_${action}_${today}`;
            const count = getTodayActionCount(action) + 1;
            localStorage.setItem(key, count);
        }

        // å¯åŠ¨Auth0ç™»å½•æµç¨‹ï¼ˆé»˜è®¤Googleç™»å½•ï¼‰
        function startAuth0Login() {
            console.log('ğŸš€ ç›´æ¥å¯åŠ¨Auth0ç™»å½•æµç¨‹...');
            console.log('Auth0é…ç½®:', auth0Config);
            console.log('Auth0å¯¹è±¡:', typeof auth0, auth0);
            
            // æ£€æŸ¥Auth0æ˜¯å¦å·²åˆå§‹åŒ–
            if (!auth0) {
                console.warn('âš ï¸ Auth0å¯¹è±¡æœªåˆå§‹åŒ–ï¼Œå°è¯•é‡æ–°åˆå§‹åŒ–...');
                
                // å°è¯•ç«‹å³é‡æ–°åˆå§‹åŒ–
                initializeAuth0();
                
                // ç­‰å¾…ä¸€ç§’åå†æ¬¡æ£€æŸ¥
                setTimeout(() => {
                    if (!auth0) {
                        console.error('âŒ Auth0åˆå§‹åŒ–å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ');
                        tryDirectRedirect();
                    } else {
                        // æˆåŠŸåˆå§‹åŒ–åç»§ç»­ç™»å½•æµç¨‹
                        startAuth0Login();
                    }
                }, 1500);
                return;
            }
            
            // æ£€æŸ¥Auth0 SDKå…¨å±€å¯¹è±¡
            if (typeof Auth0 === 'undefined') {
                console.error('âŒ Auth0 SDKæœªåŠ è½½ï¼Œä½¿ç”¨ç›´æ¥è·³è½¬åˆ°Auth0');
                tryDirectRedirect();
                return;
            }
            
            try {
                console.log('ğŸ“¡ è°ƒç”¨auth0.authorize...');
                auth0.authorize({
                    connection: 'google-oauth2'
                });
                console.log('âœ… authorizeè°ƒç”¨å®Œæˆï¼Œç­‰å¾…è·³è½¬...');
                
                // è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ£€æŸ¥ï¼Œå¦‚æœ5ç§’åè¿˜åœ¨å½“å‰é¡µé¢ï¼Œè¯´æ˜å¯èƒ½æœ‰é—®é¢˜
                setTimeout(() => {
                    console.warn('âš ï¸ 5ç§’åä»åœ¨å½“å‰é¡µé¢ï¼Œå¯èƒ½Auth0è·³è½¬å¤±è´¥');
                    // å°è¯•ç›´æ¥æ„é€ URLè·³è½¬
                    tryDirectRedirect();
                }, 5000);
                
            } catch (error) {
                console.error('âŒ Auth0ç™»å½•å¯åŠ¨å¤±è´¥:', error);
                alert('Auth0ç™»å½•å¤±è´¥: ' + error.message);
                // å¦‚æœAuth0å¤±è´¥ï¼Œåˆ™å›é€€åˆ°æ˜¾ç¤ºç™»å½•é€‰æ‹©
                showLoginModal();
            }
        }
        
        // å°è¯•ç›´æ¥æ„é€ Auth0 URLè¿›è¡Œè·³è½¬
        function tryDirectRedirect() {
            console.log('ğŸ”„ å°è¯•ç›´æ¥URLè·³è½¬...');
            try {
                const loginUrl = `https://${auth0Config.domain}/authorize?` +
                    `response_type=${auth0Config.responseType}&` +
                    `client_id=${auth0Config.clientId}&` +
                    `redirect_uri=${encodeURIComponent(auth0Config.redirectUri)}&` +
                    `scope=${encodeURIComponent(auth0Config.scope)}&` +
                    `connection=google-oauth2&` +
                    `nonce=${auth0Config.nonce}`;
                
                console.log('ğŸŒ è·³è½¬URL:', loginUrl);
                
                // å¼ºåˆ¶è·³è½¬åˆ°Auth0ï¼Œä¸è¿›è¡ŒåŸŸåæµ‹è¯•
                console.log('ğŸš€ ç›´æ¥è·³è½¬åˆ°Auth0ç™»å½•é¡µé¢');
                window.location.href = loginUrl;
                    
            } catch (error) {
                console.error('âŒ ç›´æ¥è·³è½¬ä¹Ÿå¤±è´¥:', error);
                simulateAuth0Login();
            }
        }
        
        // æ¨¡æ‹ŸAuth0ç™»å½•ï¼ˆç”¨äºæµ‹è¯•ï¼‰
        function simulateAuth0Login() {
            console.log('ğŸ§ª å¯åŠ¨æ¨¡æ‹ŸAuth0ç™»å½•æµç¨‹...');
            
            // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®
            const mockUser = {
                sub: 'auth0|mock_' + Date.now(),
                email: 'test@example.com',
                name: 'Test User',
                picture: 'https://via.placeholder.com/64'
            };
            
            // æ¨¡æ‹ŸAuth0å›è°ƒæ•°æ®
            const mockAuth = {
                access_token: 'mock_access_token_' + Date.now(),
                id_token: 'mock_id_token_' + Date.now(),
                expires_in: 86400,
                token_type: 'Bearer'
            };
            
            console.log('âœ… æ¨¡æ‹Ÿç™»å½•æˆåŠŸï¼Œå¤„ç†ç”¨æˆ·æ•°æ®...');
            
            // è®¾ç½®ç”¨æˆ·æ•°æ®
            currentUser = {
                id: mockUser.sub,
                name: mockUser.name,
                email: mockUser.email,
                avatar: mockUser.picture,
                points: 0
            };
            
            authToken = mockAuth.access_token;
            isLoggedIn = true;
            
            // å­˜å‚¨åˆ°localStorage
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('authToken', authToken);
            localStorage.setItem('isLoggedIn', 'true');
            
            // åŒæ­¥åˆ°åç«¯
            syncUserToBackend(mockUser, mockAuth.access_token);
            
            // æ›´æ–°UI
            updateUserInfo();
            hideLoginModal();
            showMessage('æ¨¡æ‹Ÿç™»å½•æˆåŠŸï¼', 'success');
            
            // æ‰§è¡Œå¾…å®šæ“ä½œ
            const pendingAction = sessionStorage.getItem('pendingAction');
            if (pendingAction) {
                sessionStorage.removeItem('pendingAction');
                console.log('æ‰§è¡Œå¾…å®šæ“ä½œ:', pendingAction);
                
                setTimeout(() => {
                    if (pendingAction.startsWith('action:')) {
                        handleAction(pendingAction.replace('action:', ''));
                    } else if (pendingAction === 'showTransactionView') {
                        showTransactionView();
                    } else if (pendingAction === 'showProfileView') {
                        showProfileView();
                    }
                }, 1000);
            }
        }

        // æ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'flex';
            showMessage('è¯·å…ˆç™»å½•å¼€å§‹èµšé’±', 'error');
        }

        // éšè—ç™»å½•æ¨¡æ€æ¡†
        function hideLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message, type = 'success') {
            const element = document.getElementById('loginMessage');
            element.textContent = message;
            element.className = `login-message ${type}`;
            element.style.display = 'block';
            
            setTimeout(() => {
                element.style.display = 'none';
            }, 3000);
        }

        // Googleç™»å½• - ä½¿ç”¨Auth0
        function loginWithGoogle() {
            console.log('ğŸ”µ å¯åŠ¨Googleç™»å½•...');
            showMessage('æ­£åœ¨è¿æ¥Google...', 'success');
            try {
                auth0.authorize({
                    connection: 'google-oauth2'
                });
            } catch (error) {
                console.error('âŒ Googleç™»å½•å¯åŠ¨å¤±è´¥:', error);
                showMessage('Googleç™»å½•å¯åŠ¨å¤±è´¥: ' + error.message, 'error');
            }
        }

        // Appleç™»å½• - ä½¿ç”¨Auth0
        function loginWithApple() {
            console.log('ğŸ å¯åŠ¨Appleç™»å½•...');
            showMessage('æ­£åœ¨è¿æ¥Apple...', 'success');
            try {
                auth0.authorize({
                    connection: 'apple'
                });
            } catch (error) {
                console.error('âŒ Appleç™»å½•å¯åŠ¨å¤±è´¥:', error);
                showMessage('Appleç™»å½•å¯åŠ¨å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ¸¸å®¢ç™»å½• - æ•°æ®åº“è¿æ¥
        function loginAsGuest() {
            console.log('ğŸ‘¤ å¯åŠ¨æ¸¸å®¢ç™»å½•...');
            showMessage('æ­£åœ¨ä»¥æ¸¸å®¢èº«ä»½ç™»å½•...', 'success');
            try {
                auth0.authorize({
                    connection: 'Username-Password-Authentication',
                    login_hint: 'guest_mode'
                });
            } catch (error) {
                console.error('âŒ æ¸¸å®¢ç™»å½•å¯åŠ¨å¤±è´¥:', error);
                showMessage('æ¸¸å®¢ç™»å½•å¯åŠ¨å¤±è´¥: ' + error.message, 'error');
            }
        }

        // Auth0å›è°ƒå¤„ç†
        function handleAuth0Callback() {
            auth0.parseHash((err, authResult) => {
                if (authResult && authResult.accessToken && authResult.idToken) {
                    // ç™»å½•æˆåŠŸ
                    auth0.client.userInfo(authResult.accessToken, (err, profile) => {
                        if (err) {
                            showMessage('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥', 'error');
                            return;
                        }
                        
                        // è®¾ç½®ç”¨æˆ·ä¿¡æ¯
                        currentUser = {
                            id: profile.sub,
                            name: profile.name || profile.nickname,
                            email: profile.email,
                            avatar: profile.picture || 'ğŸ‘¤',
                            points: 0
                        };
                        authToken = authResult.accessToken;
                        isLoggedIn = true;
                        
                        // å­˜å‚¨åˆ°localStorage
                        localStorage.setItem('auth0_token', authResult.accessToken);
                        localStorage.setItem('auth0_id_token', authResult.idToken);
                        localStorage.setItem('user_profile', JSON.stringify(currentUser));
                        
                        hideLoginModal();
                        updateUserInterface();
                        showMessage('ç™»å½•æˆåŠŸï¼', 'success');
                        
                        // æ‰§è¡Œå¾…å¤„ç†çš„æ“ä½œ
                        const pendingAction = sessionStorage.getItem('pendingAction');
                        if (pendingAction) {
                            sessionStorage.removeItem('pendingAction');
                            setTimeout(() => {
                                if (pendingAction === 'showTransaction') {
                                    showTransactionView();
                                } else if (pendingAction === 'showProfile') {
                                    showProfileView();
                                } else {
                                    handleAction(pendingAction);
                                }
                            }, 500);
                        }
                        
                        // åŒæ­¥ç”¨æˆ·ä¿¡æ¯åˆ°åç«¯
                        syncUserToBackend(currentUser, authResult.accessToken);
                        
                        // åŠ è½½åç«¯é…ç½®
                        setTimeout(() => {
                            loadPointsConfig();
                            loadAdMobConfig();
                        }, 1000);
                    });
                } else if (err) {
                    console.error('Auth0ç™»å½•é”™è¯¯:', err);
                    showMessage(`ç™»å½•å¤±è´¥: ${err.error_description || err.error}`, 'error');
                }
            });
        }

        // åŒæ­¥ç”¨æˆ·ä¿¡æ¯åˆ°åç«¯
        async function syncUserToBackend(user, token) {
            try {
                const response = await fetch(`${API_BASE}/auth/auth0-sync`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        auth0_id: user.id,
                        email: user.email,
                        name: user.name,
                        avatar: user.avatar
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    // æ›´æ–°ç”¨æˆ·ç§¯åˆ†ä¿¡æ¯
                    currentUser.points = result.data.points || 0;
                    updateUserInterface();
                }
            } catch (error) {
                console.error('åŒæ­¥ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
            }
        }

        // æ‰§è¡Œç¤¾äº¤ç™»å½•
        async function performSocialLogin(socialUser) {
            try {
                showMessage('æ­£åœ¨ç™»å½•...', 'success');
                
                const response = await fetch(`${API_BASE}/auth/social-login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(socialUser)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('ç™»å½•ç»“æœ:', result);
                
                if (result.success) {
                    currentUser = result.data.user;
                    authToken = result.data.token;
                    isLoggedIn = true;
                    
                    showMessage(result.message || 'ç™»å½•æˆåŠŸï¼', 'success');
                    
                    setTimeout(() => {
                        hideLoginModal();
                        updateUserInterface();
                        
                        const pendingAction = sessionStorage.getItem('pendingAction');
                        if (pendingAction) {
                            sessionStorage.removeItem('pendingAction');
                            setTimeout(() => handleAction(pendingAction), 500);
                        }
                    }, 1000);
                } else {
                    showMessage(result.error || 'ç™»å½•å¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('ç™»å½•å¤±è´¥:', error);
                showMessage(`ç™»å½•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ›´æ–°ç”¨æˆ·ç•Œé¢
        function updateUserInterface() {
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.nickname || currentUser.name;
                document.getElementById('userPoints').textContent = (currentUser.points || 0).toLocaleString();
                document.getElementById('vipBadge').textContent = currentUser.is_vip ? 'VIPä¼šå‘˜' : 'æ™®é€šç”¨æˆ·';
                document.getElementById('userAvatar').textContent = currentUser.avatar || 'ğŸ‘¤';
            }
        }

        // è§‚çœ‹è§†é¢‘èµšç§¯åˆ†
        async function earnFromVideo() {
            try {
                const response = await fetch(`${API_BASE}/app/earn/watch-video`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const result = await response.json();
                if (result.success) {
                    currentUser.points += result.data.points_earned;
                    updateUserInterface();
                    alert(`è§‚çœ‹è§†é¢‘å®Œæˆï¼è·å¾— ${result.data.points_earned} ç§¯åˆ†`);
                } else {
                    alert(result.error || 'æ“ä½œå¤±è´¥');
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // ä¸‹è½½åº”ç”¨èµšç§¯åˆ†
        async function earnFromApp() {
            try {
                const response = await fetch(`${API_BASE}/app/earn/download-app`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        app_name: 'Demoåº”ç”¨',
                        app_id: 'demo_app_001'
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    currentUser.points += result.data.points_earned;
                    updateUserInterface();
                    alert(`ä¸‹è½½åº”ç”¨å®Œæˆï¼è·å¾— ${result.data.points_earned} ç§¯åˆ†`);
                } else {
                    alert(result.error || 'æ“ä½œå¤±è´¥');
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // æ¯æ—¥ç­¾åˆ°
        async function dailyCheckin() {
            try {
                const response = await fetch(`${API_BASE}/app/earn/daily-checkin`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const result = await response.json();
                if (result.success) {
                    currentUser.points += result.data.points_earned;
                    updateUserInterface();
                    alert(`æ¯æ—¥ç­¾åˆ°å®Œæˆï¼è·å¾— ${result.data.points_earned} ç§¯åˆ†`);
                } else {
                    alert(result.error || 'æ“ä½œå¤±è´¥');
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // åˆ·æ–°ç§¯åˆ†
        async function refreshPoints() {
            try {
                const response = await fetch(`${API_BASE}/app/user/points`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const result = await response.json();
                if (result.success) {
                    currentUser.points = result.data.points;
                    updateUserInterface();
                    alert('ç§¯åˆ†å·²åˆ·æ–°');
                } else {
                    alert(result.error || 'åˆ·æ–°å¤±è´¥');
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // åŠ è½½äº¤æ˜“è®°å½•
        async function loadTransactionHistory() {
            if (!authToken) return;

            try {
                const response = await fetch(`${API_BASE}/app/user/transactions`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const result = await response.json();
                if (result.success && result.data.length > 0) {
                    const listElement = document.getElementById('transactionList');
                    listElement.innerHTML = '';
                    
                    result.data.forEach(transaction => {
                        const item = document.createElement('div');
                        item.className = 'transaction-item';
                        item.innerHTML = `
                            <div class="transaction-info">
                                <div class="title">${getTransactionTypeName(transaction.transaction_type)}</div>
                                <div class="time">${new Date(transaction.created_at).toLocaleString()}</div>
                            </div>
                            <div class="transaction-amount">+${transaction.points_change.toLocaleString()}</div>
                        `;
                        listElement.appendChild(item);
                    });
                }
            } catch (error) {
                console.error('åŠ è½½äº¤æ˜“è®°å½•å¤±è´¥:', error);
            }
        }

        // è·å–äº¤æ˜“ç±»å‹åç§°
        function getTransactionTypeName(type) {
            const types = {
                'registration_bonus': 'æ³¨å†Œå¥–åŠ±',
                'watch_video': 'è§‚çœ‹è§†é¢‘',
                'download_app': 'ä¸‹è½½åº”ç”¨',
                'daily_checkin': 'æ¯æ—¥ç­¾åˆ°',
                'admin_adjust': 'ç®¡ç†å‘˜è°ƒæ•´'
            };
            return types[type] || type;
        }

        // é€€å‡ºç™»å½• - Auth0ç‰ˆæœ¬
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                console.log('ğŸšª ç”¨æˆ·é€€å‡ºç™»å½•');
                
                // æ¸…é™¤æ‰€æœ‰æœ¬åœ°å­˜å‚¨
                localStorage.removeItem('auth0_token');
                localStorage.removeItem('auth0_id_token');
                localStorage.removeItem('user_profile');
                localStorage.removeItem('currentUser');
                localStorage.removeItem('authToken');
                localStorage.removeItem('isLoggedIn');
                sessionStorage.clear();
                
                // é‡ç½®çŠ¶æ€
                currentUser = null;
                authToken = null;
                isLoggedIn = false;
                
                // æ˜¾ç¤ºé€€å‡ºæ¶ˆæ¯
                showMessage('æ­£åœ¨é€€å‡ºç™»å½•...', 'info');
                
                // æ›´æ–°UI
                updateUIForLoggedOut();
                
                // Auth0é€€å‡ºç™»å½•
                if (auth0) {
                    try {
                        auth0.logout({
                            returnTo: window.location.origin + '/app-demo.html',
                            clientID: auth0Config.clientId
                        });
                    } catch (error) {
                        console.error('Auth0é€€å‡ºå¤±è´¥:', error);
                        // å¦‚æœAuth0é€€å‡ºå¤±è´¥ï¼Œç›´æ¥åˆ·æ–°é¡µé¢
                        setTimeout(() => {
                            window.location.reload();
                        }, 1000);
                    }
                } else {
                    // æ²¡æœ‰Auth0ï¼Œç›´æ¥åˆ·æ–°é¡µé¢
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                }
            }
        }
        
        // é€€å‡ºç™»å½•çš„åˆ«åå‡½æ•°
        function logoutUser() {
            logout();
        }
        
        // ç¼–è¾‘èµ„æ–™åŠŸèƒ½
        function editProfile() {
            alert('ç¼–è¾‘èµ„æ–™åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼\n\nå°†æ¥å¯ä»¥ä¿®æ”¹:\n- ç”¨æˆ·å\n- å¤´åƒ\n- ä¸ªäººç®€ä»‹');
        }
        
        // è´¦æˆ·è®¾ç½®åŠŸèƒ½
        function showSettings() {
            alert('è´¦æˆ·è®¾ç½®åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼\n\nå°†æ¥å¯ä»¥è®¾ç½®:\n- é€šçŸ¥åå¥½\n- éšç§è®¾ç½®\n- å®‰å…¨è®¾ç½®');
        }

        // æ£€æŸ¥æœåŠ¡å™¨è¿æ¥
        async function checkServerConnection() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                if (response.ok) {
                    console.log('âœ… åå°APIæœåŠ¡å™¨è¿æ¥æ­£å¸¸');
                }
            } catch (error) {
                console.error('âŒ æ— æ³•è¿æ¥åˆ°åå°APIæœåŠ¡å™¨');
            }
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('loginModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideLoginModal();
            }
        });
        
        // è°ƒè¯•å‡½æ•°
        function showDebugInfo() {
            const debugInfo = [
                `ğŸ” Auth0è°ƒè¯•ä¿¡æ¯:`,
                ``,
                `Auth0 SDK: ${typeof Auth0 !== 'undefined' ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½'}`,
                `Auth0å¯¹è±¡: ${auth0 ? 'âœ… å·²åˆå§‹åŒ–' : 'âŒ æœªåˆå§‹åŒ–'}`,
                `ç™»å½•çŠ¶æ€: ${isLoggedIn ? 'âœ… å·²ç™»å½•' : 'âŒ æœªç™»å½•'}`,
                `å½“å‰ç”¨æˆ·: ${currentUser ? currentUser.name : 'æ— '}`,
                `Domain: ${auth0Config.domain}`,
                `Client ID: ${auth0Config.clientId.substring(0, 12)}...`,
                ``,
                `ğŸŒ ç½‘ç»œä¿¡æ¯:`,
                `å½“å‰URL: ${window.location.href}`,
                `LocalStorage: ${localStorage.getItem('isLoggedIn') || 'æ— '}`,
                ``,
                `ğŸ“‹ æ“ä½œæç¤º:`,
                `- åŒå‡»ç”¨æˆ·å¡ç‰‡æŸ¥çœ‹æ­¤ä¿¡æ¯`,
                `- æŒ‰ Ctrl+D ä¹Ÿå¯æ‰“å¼€è°ƒè¯•é¢æ¿`,
                `- å¦‚æœAuth0å¤±è´¥ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨æ¨¡æ‹Ÿç™»å½•`
            ];
            
            alert(debugInfo.join('\n'));
        }
        
        // åŒå‡»ç”¨æˆ·å¡ç‰‡æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
        document.querySelector('.user-card').addEventListener('dblclick', showDebugInfo);
        
        // æŒ‰ Ctrl+D æ˜¾ç¤ºè°ƒè¯•é¢æ¿
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                showDebugInfo();
            }
        });
        // ===================== åç«¯é…ç½®ç®¡ç† =====================
        
        // ä»åç«¯è·å–ç§¯åˆ†é…ç½®
        async function loadPointsConfig() {
            try {
                if (!authToken) {
                    console.log('âš ï¸ æœªç™»å½•ï¼Œæ— æ³•è·å–ç§¯åˆ†é…ç½®');
                    return;
                }
                
                const response = await fetch(`${API_BASE}/app/points/config`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    pointsConfig = result.data;
                    console.log('âœ… ç§¯åˆ†é…ç½®å·²åŠ è½½:', pointsConfig);
                    updateActionPointsDisplay(); // æ›´æ–°ç•Œé¢æ˜¾ç¤º
                } else {
                    console.error('âŒ è·å–ç§¯åˆ†é…ç½®å¤±è´¥:', response.statusText);
                }
            } catch (error) {
                console.error('âŒ è·å–ç§¯åˆ†é…ç½®é”™è¯¯:', error);
            }
        }
        
        // ä»åç«¯è·å–AdMobé…ç½®
        async function loadAdMobConfig() {
            try {
                if (!authToken) {
                    console.log('âš ï¸ æœªç™»å½•ï¼Œæ— æ³•è·å–AdMobé…ç½®');
                    return;
                }
                
                const response = await fetch(`${API_BASE}/app/admob/config`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    admobConfig = result.data;
                    console.log('âœ… AdMobé…ç½®å·²åŠ è½½:', admobConfig);
                } else {
                    console.error('âŒ è·å–AdMobé…ç½®å¤±è´¥:', response.statusText);
                }
            } catch (error) {
                console.error('âŒ è·å–AdMobé…ç½®é”™è¯¯:', error);
            }
        }
        
        // è·å–ç§¯åˆ†é…ç½®å¹¶æ˜¾ç¤ºåœ¨UIä¸­
        function getPointsForAction(actionType) {
            if (!pointsConfig || !pointsConfig[actionType]) {
                return { points: 10, name: 'æœªçŸ¥æ“ä½œ', description: 'è·å¾—ç§¯åˆ†' };
            }
            return pointsConfig[actionType];
        }
        
        // æ›´æ–°æ“ä½œæŒ‰é’®çš„ç§¯åˆ†æ˜¾ç¤º
        function updateActionPointsDisplay() {
            if (!pointsConfig) return;
            
            // æ›´æ–°è§‚çœ‹è§†é¢‘æŒ‰é’®
            const watchVideoConfig = getPointsForAction('watch_video');
            const watchBtn = document.querySelector('[onclick="handleAction(\'watch_video\')"]');
            if (watchBtn) {
                const rewardText = watchBtn.querySelector('.reward');
                if (rewardText) {
                    rewardText.textContent = `+${watchVideoConfig.points}ç§¯åˆ†`;
                }
            }
            
            // æ›´æ–°ä¸‹è½½åº”ç”¨æŒ‰é’®
            const downloadConfig = getPointsForAction('download_app');
            const downloadBtn = document.querySelector('[onclick="handleAction(\'download_app\')"]');
            if (downloadBtn) {
                const rewardText = downloadBtn.querySelector('.reward');
                if (rewardText) {
                    rewardText.textContent = `+${downloadConfig.points}ç§¯åˆ†`;
                }
            }
            
            // æ›´æ–°å®Œæˆä»»åŠ¡æŒ‰é’®
            const taskConfig = getPointsForAction('complete_task');
            const taskBtn = document.querySelector('[onclick="handleAction(\'complete_task\')"]');
            if (taskBtn) {
                const rewardText = taskBtn.querySelector('.reward');
                if (rewardText) {
                    rewardText.textContent = `+${taskConfig.points}ç§¯åˆ†`;
                }
            }
            
            console.log('âœ… æ“ä½œæŒ‰é’®ç§¯åˆ†æ˜¾ç¤ºå·²æ›´æ–°');
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“± DOMåŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–APP');
            initializeAuth0();
        });

    </script>
</body>
</html>
                const response = await fetch(`${API_BASE}/app/earn/daily-checkin`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const result = await response.json();
                if (result.success) {
                    currentUser.points += result.data.points_earned;
                    updateUserInterface();
                    alert(`æ¯æ—¥ç­¾åˆ°å®Œæˆï¼è·å¾— ${result.data.points_earned} ç§¯åˆ†`);
                } else {
                    alert(result.error || 'æ“ä½œå¤±è´¥');
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // åˆ·æ–°ç§¯åˆ†
        async function refreshPoints() {
            try {
                const response = await fetch(`${API_BASE}/app/user/points`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const result = await response.json();
                if (result.success) {
                    currentUser.points = result.data.points;
                    updateUserInterface();
                    alert('ç§¯åˆ†å·²åˆ·æ–°');
                } else {
                    alert(result.error || 'åˆ·æ–°å¤±è´¥');
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // åŠ è½½äº¤æ˜“è®°å½•
        async function loadTransactionHistory() {
            if (!authToken) return;

            try {
                const response = await fetch(`${API_BASE}/app/user/transactions`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const result = await response.json();
                if (result.success && result.data.length > 0) {
                    const listElement = document.getElementById('transactionList');
                    listElement.innerHTML = '';
                    
                    result.data.forEach(transaction => {
                        const item = document.createElement('div');
                        item.className = 'transaction-item';
                        item.innerHTML = `
                            <div class="transaction-info">
                                <div class="title">${getTransactionTypeName(transaction.transaction_type)}</div>
                                <div class="time">${new Date(transaction.created_at).toLocaleString()}</div>
                            </div>
                            <div class="transaction-amount">+${transaction.points_change.toLocaleString()}</div>
                        `;
                        listElement.appendChild(item);
                    });
                }
            } catch (error) {
                console.error('åŠ è½½äº¤æ˜“è®°å½•å¤±è´¥:', error);
            }
        }

        // è·å–äº¤æ˜“ç±»å‹åç§°
        function getTransactionTypeName(type) {
            const types = {
                'registration_bonus': 'æ³¨å†Œå¥–åŠ±',
                'watch_video': 'è§‚çœ‹è§†é¢‘',
                'download_app': 'ä¸‹è½½åº”ç”¨',
                'daily_checkin': 'æ¯æ—¥ç­¾åˆ°',
                'admin_adjust': 'ç®¡ç†å‘˜è°ƒæ•´'
            };
            return types[type] || type;
        }

        // é€€å‡ºç™»å½• - Auth0ç‰ˆæœ¬
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                console.log('ğŸšª ç”¨æˆ·é€€å‡ºç™»å½•');
                
                // æ¸…é™¤æ‰€æœ‰æœ¬åœ°å­˜å‚¨
                localStorage.removeItem('auth0_token');
                localStorage.removeItem('auth0_id_token');
                localStorage.removeItem('user_profile');
                localStorage.removeItem('currentUser');
                localStorage.removeItem('authToken');
                localStorage.removeItem('isLoggedIn');
                sessionStorage.clear();
                
                // é‡ç½®çŠ¶æ€
                currentUser = null;
                authToken = null;
                isLoggedIn = false;
                
                // æ˜¾ç¤ºé€€å‡ºæ¶ˆæ¯
                showMessage('æ­£åœ¨é€€å‡ºç™»å½•...', 'info');
                
                // æ›´æ–°UI
                updateUIForLoggedOut();
                
                // Auth0é€€å‡ºç™»å½•
                if (auth0) {
                    try {
                        auth0.logout({
                            returnTo: window.location.origin + '/app-demo.html',
                            clientID: auth0Config.clientId
                        });
                    } catch (error) {
                        console.error('Auth0é€€å‡ºå¤±è´¥:', error);
                        // å¦‚æœAuth0é€€å‡ºå¤±è´¥ï¼Œç›´æ¥åˆ·æ–°é¡µé¢
                        setTimeout(() => {
                            window.location.reload();
                        }, 1000);
                    }
                } else {
                    // æ²¡æœ‰Auth0ï¼Œç›´æ¥åˆ·æ–°é¡µé¢
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                }
            }
        }
        
        // é€€å‡ºç™»å½•çš„åˆ«åå‡½æ•°
        function logoutUser() {
            logout();
        }
        
        // ç¼–è¾‘èµ„æ–™åŠŸèƒ½
        function editProfile() {
            alert('ç¼–è¾‘èµ„æ–™åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼\n\nå°†æ¥å¯ä»¥ä¿®æ”¹:\n- ç”¨æˆ·å\n- å¤´åƒ\n- ä¸ªäººç®€ä»‹');
        }
        
        // è´¦æˆ·è®¾ç½®åŠŸèƒ½
        function showSettings() {
            alert('è´¦æˆ·è®¾ç½®åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼\n\nå°†æ¥å¯ä»¥è®¾ç½®:\n- é€šçŸ¥åå¥½\n- éšç§è®¾ç½®\n- å®‰å…¨è®¾ç½®');
        }

        // æ£€æŸ¥æœåŠ¡å™¨è¿æ¥
        async function checkServerConnection() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                if (response.ok) {
                    console.log('âœ… åå°APIæœåŠ¡å™¨è¿æ¥æ­£å¸¸');
                }
            } catch (error) {
                console.error('âŒ æ— æ³•è¿æ¥åˆ°åå°APIæœåŠ¡å™¨');
            }
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('loginModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideLoginModal();
            }
        });
        
        // è°ƒè¯•å‡½æ•°
        function showDebugInfo() {
            const debugInfo = [
                `ğŸ” Auth0è°ƒè¯•ä¿¡æ¯:`,
                ``,
                `Auth0 SDK: ${typeof Auth0 !== 'undefined' ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½'}`,
                `Auth0å¯¹è±¡: ${auth0 ? 'âœ… å·²åˆå§‹åŒ–' : 'âŒ æœªåˆå§‹åŒ–'}`,
                `ç™»å½•çŠ¶æ€: ${isLoggedIn ? 'âœ… å·²ç™»å½•' : 'âŒ æœªç™»å½•'}`,
                `å½“å‰ç”¨æˆ·: ${currentUser ? currentUser.name : 'æ— '}`,
                `Domain: ${auth0Config.domain}`,
                `Client ID: ${auth0Config.clientId.substring(0, 12)}...`,
                ``,
                `ğŸŒ ç½‘ç»œä¿¡æ¯:`,
                `å½“å‰URL: ${window.location.href}`,
                `LocalStorage: ${localStorage.getItem('isLoggedIn') || 'æ— '}`,
                ``,
                `ğŸ“‹ æ“ä½œæç¤º:`,
                `- åŒå‡»ç”¨æˆ·å¡ç‰‡æŸ¥çœ‹æ­¤ä¿¡æ¯`,
                `- æŒ‰ Ctrl+D ä¹Ÿå¯æ‰“å¼€è°ƒè¯•é¢æ¿`,
                `- å¦‚æœAuth0å¤±è´¥ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨æ¨¡æ‹Ÿç™»å½•`
            ];
            
            alert(debugInfo.join('\n'));
        }
        
        // åŒå‡»ç”¨æˆ·å¡ç‰‡æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
        document.querySelector('.user-card').addEventListener('dblclick', showDebugInfo);
        
        // æŒ‰ Ctrl+D æ˜¾ç¤ºè°ƒè¯•é¢æ¿
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                showDebugInfo();
            }
        });
        // ===================== åç«¯é…ç½®ç®¡ç† =====================
        
        // ä»åç«¯è·å–ç§¯åˆ†é…ç½®
        async function loadPointsConfig() {
            try {
                if (!authToken) {
                    console.log('âš ï¸ æœªç™»å½•ï¼Œæ— æ³•è·å–ç§¯åˆ†é…ç½®');
                    return;
                }
                
                const response = await fetch(`${API_BASE}/app/points/config`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    pointsConfig = result.data;
                    console.log('âœ… ç§¯åˆ†é…ç½®å·²åŠ è½½:', pointsConfig);
                    updateActionPointsDisplay(); // æ›´æ–°ç•Œé¢æ˜¾ç¤º
                } else {
                    console.error('âŒ è·å–ç§¯åˆ†é…ç½®å¤±è´¥:', response.statusText);
                }
            } catch (error) {
                console.error('âŒ è·å–ç§¯åˆ†é…ç½®é”™è¯¯:', error);
            }
        }
        
        // ä»åç«¯è·å–AdMobé…ç½®
        async function loadAdMobConfig() {
            try {
                if (!authToken) {
                    console.log('âš ï¸ æœªç™»å½•ï¼Œæ— æ³•è·å–AdMobé…ç½®');
                    return;
                }
                
                const response = await fetch(`${API_BASE}/app/admob/config`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    admobConfig = result.data;
                    console.log('âœ… AdMobé…ç½®å·²åŠ è½½:', admobConfig);
                } else {
                    console.error('âŒ è·å–AdMobé…ç½®å¤±è´¥:', response.statusText);
                }
            } catch (error) {
                console.error('âŒ è·å–AdMobé…ç½®é”™è¯¯:', error);
            }
        }
        
        // è·å–ç§¯åˆ†é…ç½®å¹¶æ˜¾ç¤ºåœ¨UIä¸­
        function getPointsForAction(actionType) {
            if (!pointsConfig || !pointsConfig[actionType]) {
                return { points: 10, name: 'æœªçŸ¥æ“ä½œ', description: 'è·å¾—ç§¯åˆ†' };
            }
            return pointsConfig[actionType];
        }
        
        // æ›´æ–°æ“ä½œæŒ‰é’®çš„ç§¯åˆ†æ˜¾ç¤º
        function updateActionPointsDisplay() {
            if (!pointsConfig) return;
            
            // æ›´æ–°è§‚çœ‹è§†é¢‘æŒ‰é’®
            const watchVideoConfig = getPointsForAction('watch_video');
            const watchBtn = document.querySelector('[onclick="handleAction(\'watch_video\')"]');
            if (watchBtn) {
                const rewardText = watchBtn.querySelector('.reward');
                if (rewardText) {
                    rewardText.textContent = `+${watchVideoConfig.points}ç§¯åˆ†`;
                }
            }
            
            // æ›´æ–°ä¸‹è½½åº”ç”¨æŒ‰é’®
            const downloadConfig = getPointsForAction('download_app');
            const downloadBtn = document.querySelector('[onclick="handleAction(\'download_app\')"]');
            if (downloadBtn) {
                const rewardText = downloadBtn.querySelector('.reward');
                if (rewardText) {
                    rewardText.textContent = `+${downloadConfig.points}ç§¯åˆ†`;
                }
            }
            
            // æ›´æ–°å®Œæˆä»»åŠ¡æŒ‰é’®
            const taskConfig = getPointsForAction('complete_task');
            const taskBtn = document.querySelector('[onclick="handleAction(\'complete_task\')"]');
            if (taskBtn) {
                const rewardText = taskBtn.querySelector('.reward');
                if (rewardText) {
                    rewardText.textContent = `+${taskConfig.points}ç§¯åˆ†`;
                }
            }
            
            console.log('âœ… æ“ä½œæŒ‰é’®ç§¯åˆ†æ˜¾ç¤ºå·²æ›´æ–°');
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“± DOMåŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–APP');
            initializeAuth0();
        });

    </script>
</body>
</html>