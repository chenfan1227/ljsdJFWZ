<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁßØÂàÜÂÆù</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .phone-container {
            width: min(420px, 100vw - 24px);
            height: auto;
            min-height: 100vh; /* ‰ΩøÂÆπÂô®ÊíëÊª°Â±èÂπïÔºåÂ∫ïÈÉ®ÂØºËà™Á®≥ÂÆö */
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 40px;
            padding: clamp(28px, 5vw, 60px) clamp(16px, 4vw, 30px) clamp(16px, 4vw, 30px);
            position: relative;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
        }
        
        .app-header {
            text-align: center;
            color: #fff;
            margin-bottom: 40px;
        }
        
        .app-logo {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .app-title {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .app-subtitle {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        /* ‰∏ªË¶ÅÂÜÖÂÆπÂå∫ÂüüÔºöÈ°∂ÈÉ®ÂØπÈΩêÂπ∂ÂèØÊªöÂä®ÔºåÈÅøÂÖçËßÜÂõæÂè†Âä†ÂØºËá¥ÁöÑ‚ÄúÂèòÂΩ¢‚Äù */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            justify-content: flex-start;
            padding: 0 16px 12px;
            overflow-y: auto;
            min-height: 0;
            gap: 16px;
        }
        
        /* Áî®Êà∑‰ø°ÊÅØÂç°Áâá */
        .user-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px 20px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 100%;
        }
        
        .user-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #fff;
        }
        
        .user-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        
        .user-points {
            font-size: 2rem;
            font-weight: 900;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .vip-badge {
            background: linear-gradient(135deg, #ffd700, #ffb300);
            color: #333;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }
        
        /* 2x2 ÂäüËÉΩÊåâÈíÆÁΩëÊ†º */
        .action-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
            margin-bottom: 30px;
        }
        
        .action-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .action-btn .icon {
            font-size: 1.8rem;
            margin-bottom: 8px;
            display: block;
        }
        
        .action-btn .text {
            font-size: 0.9rem;
            font-weight: 600;
            color: #333;
        }
        
        /* Â∫ïÈÉ®ÂØºËà™ */
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: clamp(10px, 2.5vw, 15px) clamp(8px, 2vw, 12px);
            margin-top: auto;
            position: sticky;
            bottom: 0;
            z-index: 1000; /* ÂßãÁªàÊµÆÂú®ÂÜÖÂÆπ‰πã‰∏ä */
        }

        /* ÂèëÁé∞È°µÔºàÊ∏∏Êàè/ÊäΩÂ•ñ/ÂïÜÂüé/ËÆ¢ÈòÖÔºâ */
        .discover-view { width: 100%; }
        .discover-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
            width: 100%;
        }
        .discover-tile {
            background: rgba(255, 255, 255, 0.92);
            border-radius: 18px;
            padding: 22px 10px;
            text-align: center;
            box-shadow: 0 8px 22px rgba(0,0,0,0.12);
            cursor: pointer;
            transition: transform .2s ease, box-shadow .2s ease;
        }
        .discover-tile:hover { transform: translateY(-2px); box-shadow: 0 12px 30px rgba(0,0,0,0.16); }
        .discover-tile .icon { font-size: 1.8rem; display:block; margin-bottom: 8px; }
        .discover-tile .text { font-weight: 700; }
        .hint { display:block; margin-top:4px; font-size:12px; color:#6b7280; }

        /* È¶ñÈ°µÔºàFast Job È£éÊ†ºÔºâ */
        .home-view { width: 100%; }
        .home-banner {
            width: 100%;
            height: 120px;
            border-radius: 16px;
            background: linear-gradient(135deg, #ffedd5, #fde68a);
            display: flex; align-items: center; justify-content: center;
            color: #7c2d12; font-weight: 800; font-size: 20px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            margin-bottom: 16px;
        }
        .home-title { text-align:center; margin: 6px 0 14px; color:#1f2937; font-weight:800; }
        .app-card {
            background: rgba(255,255,255,0.95);
            border-radius: 16px;
            padding: 14px;
            box-shadow: 0 10px 28px rgba(0,0,0,0.12);
        }
        .app-header { display:flex; align-items:center; gap:12px; }
        .app-title { font-weight:800; color:#111827; line-height:1.3; }
        .app-sub { color:#6b7280; font-size:12px; margin-top:2px; }
        .app-icon { width:56px; height:56px; border-radius:12px; background:#f59e0b; flex-shrink:0; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:900; }
        .app-rows { margin:12px 0; display:grid; gap:10px; }
        .app-row { display:flex; align-items:center; justify-content:space-between; background:#f9fafb; padding:12px; border-radius:12px; border:1px solid #eef2f7; }
        .app-row .label { display:flex; align-items:center; gap:8px; color:#374151; font-weight:700; }
        .app-row .value { color:#b45309; font-weight:900; }
        .cta-btn { width:100%; background:#f97316; color:#fff; border:none; padding:14px; border-radius:999px; font-weight:800; box-shadow: 0 10px 24px rgba(249,115,22,.35); cursor:pointer; }
        .cta-btn:active { transform: translateY(1px); }
        .contact-note { text-align:center; color:#6b7280; margin:12px 0; font-size:12px; }
        .contact-list { display:grid; gap:10px; }
        .contact-item { display:flex; align-items:center; justify-content:space-between; background:rgba(255,255,255,0.95); padding:12px; border-radius:12px; border:1px solid #eef2f7; }
        .contact-left { display:flex; align-items:center; gap:10px; color:#374151; font-weight:700; }
        .contact-icon { width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; background:#e5f6ff; }
        .contact-btn { background:#10b981; color:#fff; border:none; padding:10px 16px; border-radius:999px; font-weight:800; cursor:pointer; }

        @media (max-width: 420px) {
            body { align-items: flex-start; padding: 12px 0; }
            .phone-container { border-radius: 24px; }
        }
        
        .nav-btn {
            background: none;
            border: none;
            padding: 10px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            min-width: 80px;
        }
        
        .nav-btn:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .nav-btn.active {
            background: rgba(102, 126, 234, 0.2);
        }
        
        /* ‰∏™‰∫∫ËµÑÊñôÈ°µÈù¢Ê†∑Âºè */
        .profile-container {
            padding: 20px;
            max-width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            margin: 0; /* ÂéªÊéâÂ§ñËæπË∑ùÔºåËÆ©ÂÜÖÂÆπÂç†Êª° */
            backdrop-filter: blur(10px);
        }
        /* ÊàëÁöÑÈ°µÂç†Êª°ÂÆπÂô® */
        .profile-view { width: 100%; }
        /* ‰Ωø‚ÄúÊàëÁöÑ‚ÄùÈ°µÂ∑¶Âè≥Ë¥¥ËæπÔºàË¶ÜÁõñ main-content ÁöÑÂ∑¶Âè≥ÂÜÖËæπË∑ùÔºâ*/
        .profile-view.full { width: calc(100% + 32px); margin-left: -16px; margin-right: -16px; }
        
        .profile-header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid rgba(255,255,255,0.3);
            margin-bottom: 15px;
            object-fit: cover;
        }
        
        .profile-header h2 {
            margin: 10px 0 5px 0;
            color: white;
            font-size: 24px;
            font-weight: 600;
        }
        
        .profile-email {
            color: rgba(255,255,255,0.8);
            font-size: 14px;
            margin: 0;
        }
        
        .profile-stats {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-item {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stat-label {
            color: rgba(255,255,255,0.8);
            font-size: 14px;
        }
        
        .stat-value {
            color: white;
            font-weight: 600;
            font-size: 16px;
        }
        
        .profile-actions {
            margin-bottom: 25px;
        }
        
        .profile-btn {
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .profile-btn:hover {
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .profile-btn.logout-btn:hover {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        }
        
        .profile-info h3 {
            color: white;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        .info-item {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .info-label {
            color: rgba(255,255,255,0.7);
            font-size: 13px;
        }
        
        .info-value {
            color: white;
            font-size: 13px;
            font-weight: 500;
        }
        
        .nav-btn .icon {
            font-size: 1.5rem;
        }
        
        .nav-btn .text {
            font-size: 0.7rem;
            font-weight: 600;
            color: #333;
        }
        
        /* ÁôªÂΩïÊ®°ÊÄÅÊ°Ü */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .login-content {
            background: #fff;
            border-radius: 20px;
            padding: 30px;
            max-width: 380px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .login-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 20px;
        }
        
        .login-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .google-btn {
            background: #4285f4;
            color: #fff;
        }
        
        .apple-btn {
            background: #000;
            color: #fff;
        }
        
        .guest-btn {
            background: #f3f4f6;
            color: #333;
            border: 2px solid #667eea;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .login-message {
            margin-top: 15px;
            padding: 8px;
            border-radius: 8px;
            font-size: 0.8rem;
            display: none;
        }

        /* ËÆ§ËØÅË°®ÂçïÊ†∑Âºè */
        .auth-form {
            text-align: left;
        }

        /* ÂπøÂëäÂÆπÂô®Ê†∑Âºè */
        .ad-container {
            margin: 10px 0;
            padding: 5px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 8px;
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            pointer-events: none; /* ÂπøÂëäÂÆπÂô®‰∏çÊã¶Êà™ÁÇπÂáª */
        }
        
        .ad-container .adsbygoogle {
            display: block !important;
            width: 100%;
            pointer-events: auto; /* ‰ªÖÂπøÂëäÂÖÉÁ¥†ÂèØ‰∫§‰∫í */
        }
        
        .ad-loading {
            color: #888;
            font-size: 12px;
            text-align: center;
            opacity: 0.7;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group.checkbox {
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .form-group.checkbox input[type="checkbox"] {
            width: auto;
            margin: 0;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .form-group.checkbox label {
            font-size: 0.8rem;
            color: #666;
            line-height: 1.4;
        }

        .form-group.checkbox a {
            color: #667eea;
            text-decoration: none;
        }

        .form-group.checkbox a:hover {
            text-decoration: underline;
        }

        .auth-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .auth-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }

        .auth-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .social-login {
            margin: 20px 0;
        }

        .divider {
            position: relative;
            text-align: center;
            margin: 20px 0;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e5e7eb;
        }

        .divider span {
            background: #fff;
            padding: 0 15px;
            color: #666;
            font-size: 0.8rem;
        }

        .auth-links {
            text-align: center;
            margin-top: 20px;
        }

        .auth-links a {
            color: #667eea;
            text-decoration: none;
            font-size: 0.85rem;
            margin: 0 5px;
        }

        .auth-links a:hover {
            text-decoration: underline;
        }

        .form-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        /* ÈÇÆÁÆ±È™åËØÅÁõ∏ÂÖ≥Ê†∑Âºè */
        .verification-info {
            text-align: center;
            margin-bottom: 25px;
        }

        .verification-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .verification-info h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .verification-info p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .verification-info strong {
            color: #667eea;
        }

        /* ÁßØÂàÜÂïÜÂüéÊ†∑Âºè */
        .shop-content {
            padding: 15px;
        }

        .shop-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .category-btn {
            padding: 8px 16px;
            border: 1px solid #e5e7eb;
            border-radius: 20px;
            background: #fff;
            color: #666;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .category-btn.active,
        .category-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border-color: #667eea;
        }

        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px;
        }

        .shop-item {
            background: #fff;
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }

        .shop-item:hover {
            transform: translateY(-2px);
        }

        .shop-item.out-of-stock {
            opacity: 0.6;
        }

        .item-image {
            position: relative;
            width: 100%;
            height: 100px;
            margin-bottom: 10px;
        }

        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .discount-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ef4444;
            color: #fff;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .item-name {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        .item-description {
            font-size: 0.7rem;
            color: #666;
            margin-bottom: 10px;
            line-height: 1.3;
        }

        .item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .item-price .price {
            font-weight: 600;
            color: #667eea;
        }

        .item-price .original-price {
            font-size: 0.7rem;
            color: #999;
            text-decoration: line-through;
            margin-left: 5px;
        }

        .buy-btn {
            padding: 5px 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border: none;
            border-radius: 15px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .buy-btn:hover:not(:disabled) {
            transform: scale(1.05);
        }

        .buy-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .item-stock {
            font-size: 0.6rem;
            color: #999;
            text-align: right;
        }

        /* ÁßØÂàÜËΩ¨Ëµ†Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .transfer-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .transfer-modal .modal-content {
            background: #fff;
            border-radius: 20px;
            padding: 0;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .transfer-modal .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px 15px;
            border-bottom: 1px solid #e5e7eb;
        }

        .transfer-modal .modal-header h3 {
            margin: 0;
            color: #333;
            font-size: 1.1rem;
        }

        .transfer-modal .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .transfer-modal .modal-body {
            padding: 20px 25px;
        }

        .current-points {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .current-points span {
            font-size: 1.2rem;
        }

        .transfer-modal .form-group {
            margin-bottom: 15px;
        }

        .transfer-modal label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .transfer-modal input,
        .transfer-modal textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        .transfer-modal input:focus,
        .transfer-modal textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .transfer-modal textarea {
            height: 80px;
            resize: vertical;
        }

        .form-note {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .form-note p {
            margin: 0 0 5px 0;
            font-size: 0.8rem;
            color: #666;
        }

        .transfer-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .transfer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        /* ÊèêÁé∞Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .withdrawal-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .withdrawal-modal .modal-content {
            background: #fff;
            border-radius: 20px;
            padding: 0;
            max-width: 450px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
        }

        .balance-info {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: #fff;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }

        .balance-title {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .balance-amount {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .balance-note {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .withdrawal-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            background: #f3f4f6;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #666;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }

        .withdrawal-form .form-group {
            margin-bottom: 15px;
        }

        .amount-input-group {
            position: relative;
            display: flex;
            align-items: center;
        }

        .amount-input-group .currency {
            position: absolute;
            left: 12px;
            color: #666;
            font-weight: 600;
            z-index: 1;
        }

        .amount-input-group input {
            padding-left: 40px;
            flex: 1;
        }

        .amount-input-group .currency:last-child {
            position: static;
            padding: 12px 15px;
            background: #f3f4f6;
            border: 2px solid #e5e7eb;
            border-left: 0;
            border-radius: 0 8px 8px 0;
            color: #333;
            font-size: 0.9rem;
        }

        .withdrawal-summary {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: #666;
        }

        .summary-item.total {
            font-weight: 600;
            color: #333;
            border-top: 1px solid #e5e7eb;
            padding-top: 8px;
            margin-top: 8px;
            margin-bottom: 0;
        }

        .form-help {
            display: block;
            margin-top: 5px;
            font-size: 0.75rem;
            color: #666;
        }

        .withdrawal-modal select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.9rem;
            background: #fff;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        .withdrawal-modal select:focus {
            outline: none;
            border-color: #667eea;
        }

        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 10px;
        }

        .modal-footer .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-footer .btn-secondary {
            background: #f3f4f6;
            color: #666;
        }

        .modal-footer .btn-secondary:hover {
            background: #e5e7eb;
        }

        .modal-footer .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }

        .modal-footer .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
        }

        /* ‰ºöÂëòÁ≥ªÁªüÊ†∑Âºè */
        .membership-content {
            padding: 15px;
        }

        .current-membership {
            margin-bottom: 25px;
        }

        .membership-card {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
            overflow: hidden;
        }

        .membership-card.bronze {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: #fff;
        }

        .membership-card.silver {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: #fff;
        }

        .membership-card.gold {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #fff;
        }

        .membership-card.diamond {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: #fff;
        }

        .membership-icon {
            font-size: 2.5rem;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .membership-info h3 {
            margin: 0 0 5px 0;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .membership-info p {
            margin: 0;
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .membership-benefits {
            margin-left: auto;
        }

        .benefit-tag {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .membership-plans h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1.1rem;
        }

        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 25px;
        }

        .plan-card {
            background: #fff;
            border-radius: 15px;
            padding: 15px;
            border: 2px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .plan-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .plan-card.featured {
            border-color: #fbbf24;
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.2);
        }

        .plan-header {
            text-align: center;
            margin-bottom: 15px;
            position: relative;
        }

        .plan-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .plan-header h4 {
            margin: 0;
            font-size: 0.9rem;
            color: #333;
            font-weight: 600;
        }

        .plan-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #ef4444;
            color: #fff;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.6rem;
            font-weight: 600;
        }

        .plan-badge.popular {
            background: #fbbf24;
        }

        .plan-badge.exclusive {
            background: #8b5cf6;
        }

        .plan-price {
            text-align: center;
            margin-bottom: 15px;
        }

        .plan-price .price {
            font-size: 1.2rem;
            font-weight: 700;
            color: #333;
        }

        .plan-price .period {
            font-size: 0.7rem;
            color: #666;
        }

        .plan-features {
            margin-bottom: 15px;
        }

        .plan-features .feature {
            font-size: 0.7rem;
            color: #666;
            margin-bottom: 5px;
            padding-left: 5px;
        }

        .plan-points {
            text-align: center;
            font-size: 0.7rem;
            color: #667eea;
            font-weight: 600;
        }

        .membership-privileges h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1.1rem;
        }

        .privileges-list {
            display: grid;
            gap: 15px;
        }

        .privilege-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
        }

        .privilege-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .privilege-info h4 {
            margin: 0 0 5px 0;
            font-size: 0.9rem;
            color: #333;
            font-weight: 600;
        }

        .privilege-info p {
            margin: 0;
            font-size: 0.8rem;
            color: #666;
            line-height: 1.4;
        }

        /* ‰ºöÂëòÂçáÁ∫ßÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .membership-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .membership-modal .modal-content {
            background: #fff;
            border-radius: 20px;
            padding: 0;
            max-width: 400px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
        }

        .upgrade-plan-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }

        .plan-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .plan-duration {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .payment-methods h4 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1rem;
        }

        .payment-options {
            display: grid;
            gap: 10px;
            margin-bottom: 20px;
        }

        .payment-option {
            display: block;
            cursor: pointer;
        }

        .payment-option input[type="radio"] {
            display: none;
        }

        .option-content {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .payment-option input[type="radio"]:checked + .option-content {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .option-icon {
            font-size: 1.5rem;
        }

        .option-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 2px;
        }

        .option-price {
            color: #667eea;
            font-weight: 600;
        }

        .upgrade-benefits h4 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1rem;
        }

        .benefits-list {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .benefit-item {
            font-size: 0.9rem;
            color: #059669;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .balance-check {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            padding: 12px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .balance-status .sufficient {
            color: #059669;
            font-weight: 600;
        }

        .balance-status .insufficient {
            color: #dc2626;
            font-weight: 600;
        }
        
        .success {
            background: #dcfce7;
            color: #16a34a;
        }
        
        .error {
            background: #fef2f2;
            color: #dc2626;
        }
        
        /* ‰∫§ÊòìËÆ∞ÂΩïËßÜÂõæ */
        .transaction-view {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            width: 100%;
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }
        
        .section-title {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .transaction-item:last-child {
            border-bottom: none;
        }
        
        .transaction-info .title {
            font-size: 0.9rem;
            color: #333;
            margin-bottom: 2px;
        }
        
        .transaction-info .time {
            font-size: 0.7rem;
            color: #666;
        }
        
        .transaction-amount {
            font-weight: 700;
            color: #22c55e;
        }
        
        /* ÈöêËóèÁä∂ÊÄÅ */
        .hidden {
            display: none !important;
        }

        /* ÁºñËæëËµÑÊñôÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .profile-edit-modal {
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .profile-edit-form {
            padding: 20px 0;
        }

        .avatar-section {
            text-align: center;
            margin-bottom: 25px;
        }

        .avatar-container {
            position: relative;
            display: inline-block;
            width: 80px;
            height: 80px;
            margin-bottom: 10px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #667eea;
        }

        .avatar-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            cursor: pointer;
            color: white;
            font-size: 12px;
        }

        .avatar-container:hover .avatar-overlay {
            opacity: 1;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 14px;
            background: #fff;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group input[readonly] {
            background: #f8f9fa;
            color: #6c757d;
        }

        .form-help {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
            display: block;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            padding-top: 20px;
            border-top: 1px solid #e1e5e9;
        }

        .modal-footer .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .modal-footer .btn-secondary {
            background: #f8f9fa;
            color: #6c757d;
        }

        .modal-footer .btn-secondary:hover {
            background: #e9ecef;
        }

        .modal-footer .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .modal-footer .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .modal-footer .btn-primary:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        /* ËÆæÁΩÆÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .settings-modal {
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .settings-tabs {
            display: flex;
            border-bottom: 2px solid #e1e5e9;
            margin-bottom: 25px;
        }

        .settings-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .settings-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .settings-content {
            min-height: 300px;
        }

        .settings-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .settings-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid #f1f3f4;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-info {
            flex: 1;
        }

        .setting-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .setting-desc {
            font-size: 13px;
            color: #6c757d;
        }

        .setting-control {
            margin-left: 20px;
        }

        /* ÂºÄÂÖ≥Ê†∑Âºè */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #667eea;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .version-info {
            text-align: center;
            padding: 20px;
            color: #6c757d;
            font-size: 13px;
            border-top: 1px solid #e1e5e9;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="phone-container">
        <!-- AppÂ§¥ÈÉ® -->
        <div class="app-header">
            <div class="app-logo">üíé</div>
            <div class="app-title">ÁßØÂàÜÂÆù</div>
            <div class="app-subtitle">AppÁ´ØÁôªÂΩïÊºîÁ§∫</div>
        </div>
        
        <!-- È°∂ÈÉ®Ê®™ÂπÖÂπøÂëä -->
        <div id="top-banner-ad" class="ad-container">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-3940256099942544"
                 data-ad-slot="6300978111"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
        </div>

        <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
        <div class="main-content">
            <!-- È¶ñÈ°µÔºàÂèÇËÄÉFast JobÊ†∑ÂºèÔºâ -->
            <div id="homeView" class="home-view">
                <div class="home-banner">Fast Job ¬∑ Start earning easily</div>
                <div class="home-title">Earn Money App List</div>
                <div class="app-card">
                    <div class="app-header">
                        <div style="flex:1">
                            <div class="app-title">Gold Age: Earn 100,000ksh everyday</div>
                            <div class="app-sub">5 Minutes Fast Withdrawal</div>
                        </div>
                        <div class="app-icon">üí∞</div>
                    </div>
                    <div class="app-rows">
                        <div class="app-row">
                            <div class="label">‚Üó Free Cash</div>
                            <div class="value">10,000ksh</div>
                        </div>
                        <div class="app-row">
                            <div class="label">‚Üó Daily Income</div>
                            <div class="value">100,000ksh</div>
                        </div>
                    </div>
                    <button class="cta-btn" onclick="showDiscoverView()">Click to Earn Money</button>
                    <div class="contact-note">Contact and learn more</div>
                    <div class="contact-list">
                        <div class="contact-item">
                            <div class="contact-left"><div class="contact-icon">üü¢</div>WhatsApp Service</div>
                            <button class="contact-btn" onclick="window.open('https://wa.me/','_blank')">Contact ‚ñ∂</button>
                        </div>
                        <div class="contact-item">
                            <div class="contact-left"><div class="contact-icon">üü¢</div>WhatsApp Group</div>
                            <button class="contact-btn" onclick="window.open('https://wa.me/','_blank')">Contact ‚ñ∂</button>
                        </div>
                        <div class="contact-item">
                            <div class="contact-left"><div class="contact-icon">‚úàÔ∏è</div>Telegram Channel</div>
                            <button class="contact-btn" onclick="window.open('https://t.me/','_blank')">Contact ‚ñ∂</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÂèëÁé∞ËßÜÂõæÔºàÁã¨Á´ãÂØºËà™È°µÔºåÂåÖÂê´‰∏â‰∏™ÂÖ•Âè£ + ËÆ¢ÈòÖÔºâ -->
            <div id="discoverView" class="discover-view view" style="display:none;">
                <div class="section-title">ÂèëÁé∞</div>
                <div class="discover-grid">
                    <div class="discover-tile" onclick="showPointsShop()">
                        <span class="icon">üõí</span><span class="text">ÁßØÂàÜÂïÜÂüé</span>
                        <span class="hint">Â∞ÜÊâìÂºÄÊñ∞ÁïåÈù¢</span>
                    </div>
                    <div class="discover-tile" onclick="showTransactionView()">
                        <span class="icon">üìä</span><span class="text">ÁßØÂàÜËÆ∞ÂΩï</span>
                        <span class="hint">Â∞ÜÊâìÂºÄÊñ∞ÁïåÈù¢</span>
                    </div>
                    <div class="discover-tile" onclick="showWithdrawalRequest()">
                        <span class="icon">üí∞</span><span class="text">Áî≥ËØ∑ÊèêÁé∞</span>
                        <span class="hint">Â∞ÜÊâìÂºÄÊñ∞ÁïåÈù¢</span>
                    </div>
                    <div class="discover-tile" onclick="showSettings()">
                        <span class="icon">‚öôÔ∏è</span><span class="text">Ë¥¶Êà∑ËÆæÁΩÆ</span>
                        <span class="hint">Â∞ÜÊâìÂºÄÊñ∞ÁïåÈù¢</span>
                    </div>
                </div>
            </div>

            <!-- ‰∫§ÊòìËÆ∞ÂΩïËßÜÂõæÔºàÁã¨Á´ãÈ°µÈù¢Ôºâ -->
            <div class="transaction-view view" id="transactionView" style="display:none;">
                <div class="section-title">ÊúÄËøë‰∫§ÊòìËÆ∞ÂΩï</div>
                <div id="transactionList">
                    <div class="transaction-item">
                        <div class="transaction-info">
                            <div class="title">Ê≥®ÂÜåÂ•ñÂä±</div>
                            <div class="time">2024/8/9 20:58:59</div>
                        </div>
                        <div class="transaction-amount">+10,000</div>
                    </div>
                    
                    <div class="transaction-item">
                        <div class="transaction-info">
                            <div class="title">ËßÇÁúãËßÜÈ¢ë</div>
                            <div class="time">2024/8/9 19:30:20</div>
                        </div>
                        <div class="transaction-amount">+50,000</div>
                    </div>
                    
                    <div class="transaction-item">
                        <div class="transaction-info">
                            <div class="title">Ê≥®ÂÜåÂ•ñÂä±</div>
                            <div class="time">2024/8/9 18:00:00</div>
                        </div>
                        <div class="transaction-amount">+10,000</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Â∫ïÈÉ®ÂØºËà™Ôºà‰∏â‰∏™ÊåâÈíÆÔºâ -->
        <div class="bottom-nav">
            <button class="nav-btn active" onclick="navigateTo('home')">
                <span class="icon">üè†</span>
                <span class="text">È¶ñÈ°µ</span>
            </button>
            <button class="nav-btn" onclick="navigateTo('transaction')">
                <span class="icon">üìä</span>
                <span class="text">ËÆ∞ÂΩï</span>
            </button>
            <button class="nav-btn" onclick="navigateTo('discover')">
                <span class="icon">üß≠</span>
                <span class="text">ÂèëÁé∞</span>
            </button>
            <button class="nav-btn" onclick="navigateTo('profile')">
                <span class="icon">üë§</span>
                <span class="text">ÊàëÁöÑ</span>
            </button>
        </div>
    </div>

    <!-- ÁôªÂΩïÊ®°ÊÄÅÊ°Ü -->
    <div id="loginModal" class="login-modal">
        <div class="login-content">
            <h3 id="modalTitle" class="login-title">ÁôªÂΩï</h3>
            
            <!-- ÁôªÂΩïË°®Âçï -->
            <div id="loginForm" class="auth-form">
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <input type="email" id="loginEmail" placeholder="ÈÇÆÁÆ±" required>
                    </div>
                    <div class="form-group">
                        <input type="password" id="loginPassword" placeholder="ÂØÜÁ†Å" required>
                    </div>
                    <button type="submit" class="auth-btn primary">ÁôªÂΩï</button>
                </form>
                
                <div class="social-login">
                    <div class="divider"><span>Êàñ‰ΩøÁî®Á§æ‰∫§Ë¥¶Âè∑ÁôªÂΩï</span></div>
                    <button class="login-btn google-btn" onclick="loginWithGoogle()">
                        <span>üîµ</span>
                        Google ÁôªÂΩï
                    </button>
                    <button class="login-btn apple-btn" onclick="loginWithApple()">
                        <span>üçé</span>
                        Apple ÁôªÂΩï
                    </button>
                    <button class="login-btn guest-btn" onclick="loginAsGuest()">
                        <span>üë§</span>
                        Ê∏∏ÂÆ¢‰ΩìÈ™å
                    </button>
                </div>
                
                <div class="auth-links">
                    <a href="#" onclick="showRegisterForm()">Ê≤°ÊúâË¥¶Âè∑ÔºüÁ´ãÂç≥Ê≥®ÂÜå</a>
                    <a href="#" onclick="showForgotPasswordForm()">ÂøòËÆ∞ÂØÜÁ†ÅÔºü</a>
                </div>
            </div>

            <!-- Ê≥®ÂÜåË°®Âçï -->
            <div id="registerForm" class="auth-form" style="display: none;">
                <form onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <input type="text" id="registerUsername" placeholder="Áî®Êà∑Âêç" required>
                    </div>
                    <div class="form-group">
                        <input type="email" id="registerEmail" placeholder="ÈÇÆÁÆ±" required>
                    </div>
                    <div class="form-group">
                        <input type="password" id="registerPassword" placeholder="ÂØÜÁ†Å (Ëá≥Â∞ë6‰Ωç)" required minlength="6">
                    </div>
                    <div class="form-group">
                        <input type="password" id="confirmPassword" placeholder="Á°ÆËÆ§ÂØÜÁ†Å" required minlength="6">
                    </div>
                    <div class="form-group">
                        <input type="text" id="referralCode" placeholder="ÈÇÄËØ∑Á†Å (ÂèØÈÄâ)">
                    </div>
                    <div class="form-group checkbox">
                        <label>
                            <input type="checkbox" id="agreeTerms" required>
                            <span>ÊàëÂêåÊÑè <a href="#" onclick="showTerms()">Áî®Êà∑ÂçèËÆÆ</a> Âíå <a href="#" onclick="showPrivacy()">ÈöêÁßÅÊîøÁ≠ñ</a></span>
                        </label>
                    </div>
                    <button type="submit" class="auth-btn primary">Ê≥®ÂÜå</button>
                </form>
                
                <div class="auth-links">
                    <a href="#" onclick="showLoginForm()">Â∑≤ÊúâË¥¶Âè∑ÔºüÁ´ãÂç≥ÁôªÂΩï</a>
                </div>
            </div>

            <!-- ÂøòËÆ∞ÂØÜÁ†ÅË°®Âçï -->
            <div id="forgotPasswordForm" class="auth-form" style="display: none;">
                <p class="form-description">ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÈÇÆÁÆ±Âú∞ÂùÄÔºåÊàë‰ª¨Â∞ÜÂèëÈÄÅÈáçÁΩÆÂØÜÁ†ÅÁöÑÈìæÊé•ÁªôÊÇ®„ÄÇ</p>
                <form onsubmit="handleForgotPassword(event)">
                    <div class="form-group">
                        <input type="email" id="forgotEmail" placeholder="ÈÇÆÁÆ±" required>
                    </div>
                    <button type="submit" class="auth-btn primary">ÂèëÈÄÅÈáçÁΩÆÈìæÊé•</button>
                </form>
                
                <div class="auth-links">
                    <a href="#" onclick="showLoginForm()">ËøîÂõûÁôªÂΩï</a>
                </div>
            </div>

            <!-- ÈÇÆÁÆ±È™åËØÅË°®Âçï -->
            <div id="emailVerificationForm" class="auth-form" style="display: none;">
                <div class="verification-info">
                    <div class="verification-icon">üìß</div>
                    <h4>È™åËØÅÊÇ®ÁöÑÈÇÆÁÆ±</h4>
                    <p>Êàë‰ª¨Â∑≤ÂèëÈÄÅÈ™åËØÅÁ†ÅÂà∞ <strong id="verificationEmail"></strong></p>
                    <p>ËØ∑ËæìÂÖ•ÊÇ®Êî∂Âà∞ÁöÑ6‰ΩçÈ™åËØÅÁ†ÅÔºö</p>
                </div>
                <form onsubmit="handleEmailVerification(event)">
                    <div class="form-group">
                        <input type="text" id="verificationCode" placeholder="6‰ΩçÈ™åËØÅÁ†Å" maxlength="6" required>
                    </div>
                    <button type="submit" class="auth-btn primary">È™åËØÅ</button>
                </form>
                
                <div class="auth-links">
                    <a href="#" onclick="resendVerificationCode()">ÈáçÊñ∞ÂèëÈÄÅÈ™åËØÅÁ†Å</a>
                    <a href="#" onclick="showRegisterForm()">‰øÆÊîπÈÇÆÁÆ±Âú∞ÂùÄ</a>
                </div>
            </div>
            
            <div id="loginMessage" class="login-message"></div>
        </div>
    </div>

    <!-- Auth0 SDK -->
    <script src="https://cdn.auth0.com/js/auth0/9.23.2/auth0.min.js"></script>
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3940256099942544"
     crossorigin="anonymous"></script>
     
    <!-- Áî®Êà∑‰∏≠ÂøÉÈÄöÁî®ÂáΩÊï∞ -->
    <script src="user-profile-functions.js"></script>

    <!-- AdMob Integration -->
    <script src="admob-integration.js"></script>
    
    <!-- Game System -->
    <link rel="stylesheet" href="game-styles.css">
    <script src="game-system.js"></script>
    
    <!-- Lottery System -->
    <link rel="stylesheet" href="lottery-styles.css">
    <script src="lottery-system.js"></script>
    
    <script>
        // ÂÖ®Â±ÄÂÖ≥Èó≠Êó•ÂøóËæìÂá∫ÔºàÁîü‰∫ßÁéØÂ¢ÉÔºâ
        (function(){
            try {
                const noop = function(){};
                if (window && window.console) {
                    console.log = noop;
                    console.error = noop;
                    console.warn = noop;
                    console.debug = noop;
                    console.info = noop;
                }
            } catch(_) {}
        })();

        const API_BASE = (location.hostname === 'localhost' || location.hostname === '127.0.0.1')
            ? 'http://localhost:3001/api'
            : 'http://192.168.1.29:3001/api';
        let currentUser = null;
        let authToken = null;
        let isLoggedIn = false;
        let currentView = 'home';
        let pointsConfig = null; // ÁßØÂàÜÈÖçÁΩÆ
        let admobConfig = null;  // AdMobÈÖçÁΩÆ
        
        // Auth0 ÈÖçÁΩÆ
        const auth0Config = {
            domain: 'dev-pnok5gjc2y8dk2eb.us.auth0.com', // ÊõøÊç¢‰∏∫ÊÇ®ÁöÑAuth0ÂüüÂêç
            clientId: 'wvn63LPmkjht4Pk3TYQpoc1HtpY94Wyz', // ÊõøÊç¢‰∏∫ÊÇ®ÁöÑAuth0ÂÆ¢Êà∑Á´ØID
            redirectUri: window.location.origin + '/app-demo.html',
            responseType: 'token id_token',
            scope: 'openid profile email',
            nonce: 'nonce_' + Math.random().toString(36).substr(2, 15)
        };
        
        // ÂàùÂßãÂåñAuth0
        let auth0;
        let auth0InitializationAttempts = 0;
        const maxInitAttempts = 3;
        
        function initializeAuth0() {
            auth0InitializationAttempts++;
            console.log(`üîÑ Auth0ÂàùÂßãÂåñÂ∞ùËØï ${auth0InitializationAttempts}/${maxInitAttempts}`);
            
            try {
                // Ê£ÄÊü•Auth0 SDKÊòØÂê¶Â∑≤Âä†ËΩΩ
                if (typeof Auth0 === 'undefined') {
                    console.error('‚ùå Auth0 SDKÊú™Âä†ËΩΩ');
                    if (auth0InitializationAttempts < maxInitAttempts) {
                        console.log('‚è≥ Á≠âÂæÖAuth0 SDKÂä†ËΩΩ...');
                        setTimeout(initializeAuth0, 1000);
                        return;
                    } else {
                        console.error('‚ùå Auth0 SDKÂä†ËΩΩÂ§±Ë¥•ÔºåÂ∞ùËØïÊ¨°Êï∞Â∑≤Ëææ‰∏äÈôê');
                        return;
                    }
                }
                
                console.log('‚úÖ Auth0 SDKÂ∑≤Âä†ËΩΩ');
                console.log('Auth0ÁâàÊú¨:', Auth0.version || 'unknown');
                
                auth0 = new Auth0.WebAuth(auth0Config);
                console.log('‚úÖ Auth0ÂàùÂßãÂåñÊàêÂäü', auth0Config);
                console.log('Auth0ÂØπË±°Á±ªÂûã:', typeof auth0);
                
            } catch (error) {
                console.error('‚ùå Auth0ÂàùÂßãÂåñÂ§±Ë¥•:', error);
                if (auth0InitializationAttempts < maxInitAttempts) {
                    console.log('‚è≥ ÈáçËØïAuth0ÂàùÂßãÂåñ...');
                    setTimeout(initializeAuth0, 1000);
                } else {
                    console.error('‚ùå Auth0ÂàùÂßãÂåñÊúÄÁªàÂ§±Ë¥•');
                }
            }
        }
        
        // Âª∂ËøüÂàùÂßãÂåñÔºåÁ°Æ‰øùSDKÂÆåÂÖ®Âä†ËΩΩ
        setTimeout(initializeAuth0, 500);

        // È°µÈù¢Âä†ËΩΩÊó∂ËÆæÁΩÆÂàùÂßãÁä∂ÊÄÅ
        document.addEventListener('DOMContentLoaded', function() {
            // Ê£ÄÊü•ÊòØÂê¶ÊúâAuth0ÂõûË∞É
            if (window.location.hash && window.location.hash.includes('access_token')) {
                handleAuth0Callback();
            } else {
                // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÁôªÂΩï
                checkExistingAuth();
            }
            
            checkServerConnection();
            showHomeView();
        });

        // Ê£ÄÊü•Áé∞ÊúâËÆ§ËØÅÁä∂ÊÄÅ
        function checkExistingAuth() {
            console.log('üîç Ê£ÄÊü•Áé∞ÊúâËÆ§ËØÅÁä∂ÊÄÅ...');
            console.log('Auth0ÈÖçÁΩÆ:', auth0Config);
            
            const token = localStorage.getItem('auth0_token');
            const userProfile = localStorage.getItem('user_profile');
            
            if (token && userProfile) {
                try {
                    currentUser = JSON.parse(userProfile);
                    authToken = token;
                    isLoggedIn = true;
                    updateUserInterface();
                    console.log('‚úÖ Â∑≤ÊÅ¢Â§çÁôªÂΩïÁä∂ÊÄÅ:', currentUser.name);
                } catch (error) {
                    console.error('‚ùå Ëß£ÊûêÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•:', error);
                    logout();
                }
            } else {
                console.log('‚ÑπÔ∏è Êú™ÊâæÂà∞Áé∞ÊúâÁôªÂΩïÁä∂ÊÄÅ');
                updateUIForLoggedOut();
            }
        }

        // Êõ¥Êñ∞UI‰∏∫Êú™ÁôªÂΩïÁä∂ÊÄÅ
        function updateUIForLoggedOut() {
            document.getElementById('userName').textContent = 'ÁÇπÂáªÂºÄÂßãËµöÈí±';
            document.getElementById('userPoints').textContent = '0';
            document.getElementById('vipBadge').textContent = 'Êñ∞Áî®Êà∑';
            document.getElementById('userAvatar').textContent = 'üë§';
            isLoggedIn = false;
            currentUser = null;
            authToken = null;
        }

        // ÊòæÁ§∫È¶ñÈ°µËßÜÂõæ
        function showHomeView() {
            currentView = 'home';
            // ÈöêËóèÊâÄÊúâÂäüËÉΩËßÜÂõæ
            document.querySelectorAll('.view').forEach(v => { v.style.display = 'none'; });
            const profileView = document.getElementById('profileView');
            if (profileView) profileView.style.display = 'none';
            // ÊòæÁ§∫È¶ñÈ°µÂÆπÂô®
            const home = document.getElementById('homeView');
            if (home) home.style.display = 'block';
            updateNavActive('home');
        }

        // ÈîöÁÇπË∑ØÁî±Âºè‚ÄúÊñ∞È°µÈù¢Ë∑≥ËΩ¨‚Äù
        function navigateTo(route) {
            switch(route) {
                case 'home':
                    location.hash = '#/home';
                    showHomeView();
                    break;
                case 'transaction':
                    location.hash = '#/transaction';
                    showTransactionView();
                    break;
                case 'profile':
                    location.hash = '#/profile';
                    showProfileView();
                    break;
                case 'discover':
                    location.hash = '#/discover';
                    showDiscoverView();
                    break;
            }
        }

        // ÊòæÁ§∫‰∫§ÊòìËÆ∞ÂΩïËßÜÂõæ
        function showTransactionView() {
            if (!isLoggedIn) {
                sessionStorage.setItem('pendingAction', 'showTransaction');
                startAuth0Login();
                return;
            }
            currentView = 'transaction';
            // ÈöêËóèÊâÄÊúâËßÜÂõæ
            document.querySelectorAll('.view').forEach(v => { v.style.display = 'none'; });
            const homeView = document.getElementById('homeView');
            if (homeView) homeView.style.display = 'none';
            const profileView = document.getElementById('profileView');
            if (profileView) profileView.style.display = 'none';
            const txnView = document.getElementById('transactionView');
            if (txnView) txnView.style.display = 'block';
            updateNavActive('transaction');
            loadTransactionHistory();
        }

        // ÊòæÁ§∫ÂèëÁé∞ËßÜÂõæÔºàÊ∏∏Êàè/ÊäΩÂ•ñ/ÂïÜÂüé/ËÆ¢ÈòÖÔºâ
        function showDiscoverView() {
            currentView = 'discover';
            // ÈöêËóèÊâÄÊúâËßÜÂõæ
            document.querySelectorAll('.view').forEach(v => { v.style.display = 'none'; });
            const homeView = document.getElementById('homeView');
            if (homeView) homeView.style.display = 'none';
            const profileView = document.getElementById('profileView');
            if (profileView) profileView.style.display = 'none';
            const discover = document.getElementById('discoverView');
            if (discover) discover.style.display = 'block';
            updateNavActive('discover');
        }

        // ÊòæÁ§∫‰∏™‰∫∫ËµÑÊñôËßÜÂõæ
        function showProfileView() {
            console.log('üîç showProfileView Ë¢´Ë∞ÉÁî®');
            console.log('isLoggedIn:', isLoggedIn);
            console.log('currentUser:', currentUser);
            
            // Ê£ÄÊü•Áî®Êà∑ÁôªÂΩïÁä∂ÊÄÅ
            if (!isLoggedIn || !currentUser) {
                console.log('‚ùå Áî®Êà∑Êú™ÁôªÂΩïÔºåÊòæÁ§∫ÁôªÂΩïÂØπËØùÊ°Ü');
                sessionStorage.setItem('pendingAction', 'showProfileView');
                showLoginModal();
                return;
            }
            
            console.log('‚úÖ Áî®Êà∑Â∑≤ÁôªÂΩïÔºåÊòæÁ§∫‰∏™‰∫∫ËµÑÊñôÈ°µÈù¢');
            
            // ÈöêËóè‰∏ªÈ°µÂÜÖÂÆπ
            const userCard = document.querySelector('.user-card');
            const actionGrid = document.querySelector('.action-grid');
            const transactionView = document.getElementById('transactionView');
            
            if (userCard) userCard.style.display = 'none';
            if (actionGrid) actionGrid.style.display = 'none';
            if (transactionView) transactionView.style.display = 'none';
            
            currentView = 'profile';
            updateNavActive('profile');
            
            // Á°Æ‰øùÁî®Êà∑Êï∞ÊçÆÂÆåÊï¥
            const userPoints = currentUser.points || 0;
            const userName = currentUser.name || currentUser.nickname || 'Áî®Êà∑';
            const userEmail = currentUser.email || 'Êú™ÁªëÂÆöÈÇÆÁÆ±';
            const userAvatar = currentUser.avatar || currentUser.picture || 'üë§';
            const isAvatarUrl = /^https?:\/\/|^data:/.test(userAvatar);
            const userId = currentUser.id || currentUser.sub || 'unknown';
            
            const profileHTML = `
                <div class="profile-container">
                    <div class="profile-header">
                        <img src="${isAvatarUrl ? userAvatar : ''}" alt="Â§¥ÂÉè" class="profile-avatar" style="${isAvatarUrl ? '' : 'display:none;'}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div style="${isAvatarUrl ? 'display:none;' : 'display:flex;'} width:80px; height:80px; border-radius:50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); align-items:center; justify-content:center; font-size:2rem; margin:0 auto 15px;">üë§</div>
                        <h2>${userName}</h2>
                        <p class="profile-email">${userEmail}</p>
                        <!-- ËÆ¢ÈòÖÂÖ•Âè£ÂéªÈô§ÔºåÈÅøÂÖçÂíåÂèëÁé∞È°µÈáçÂ§ç -->
                    </div>
                    
                    <!-- ÂéªÈô§ÂèëÁé∞È°µ‰∏≠ÁöÑÂø´Êç∑ÂäüËÉΩÔºå‰øùËØÅ‚ÄúÊàëÁöÑ‚ÄùÂè™ÂëàÁé∞‰∏™‰∫∫Áõ∏ÂÖ≥Ê®°Âùó -->
                    
                    <div class="profile-stats">
                        <div class="stat-item">
                            <span class="stat-label">ÂΩìÂâçÁßØÂàÜ</span>
                            <span class="stat-value">${userPoints.toLocaleString()}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">‰ºöÂëòÁ≠âÁ∫ß</span>
                            <span class="stat-value">${currentUser.is_vip ? 'VIP‰ºöÂëò' : 'ÊôÆÈÄö‰ºöÂëò'}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Ê≥®ÂÜåÊó∂Èó¥</span>
                            <span class="stat-value">${new Date().toLocaleDateString()}</span>
                        </div>
                    </div>
                    
                    <div class="profile-actions">
                        <button class="profile-btn edit-btn" onclick="editProfile()">
                            <span class="icon">‚úèÔ∏è</span>
                            ÁºñËæëËµÑÊñô
                        </button>
                        <button class="profile-btn settings-btn" onclick="showSettings()">
                            <span class="icon">‚öôÔ∏è</span>
                            Ë¥¶Êà∑ËÆæÁΩÆ
                        </button>
                        <button class="profile-btn history-btn" onclick="showTransactionView()">
                            <span class="icon">üìä</span>
                            ÁßØÂàÜËÆ∞ÂΩï
                        </button>
                        <button class="profile-btn shop-btn" onclick="showPointsShop()">
                            <span class="icon">üõí</span>
                            ÁßØÂàÜÂïÜÂüé
                        </button>
                        <button class="profile-btn transfer-btn" onclick="showPointsTransfer()">
                            <span class="icon">üí∏</span>
                            ÁßØÂàÜËΩ¨Ëµ†
                        </button>
                        <button class="profile-btn withdrawal-btn" onclick="showWithdrawalRequest()">
                            <span class="icon">üí∞</span>
                            Áî≥ËØ∑ÊèêÁé∞
                        </button>
                        <button class="profile-btn membership-btn" onclick="showMembershipCenter()">
                            <span class="icon">üëë</span>
                            ‰ºöÂëò‰∏≠ÂøÉ
                        </button>
                        <button class="profile-btn game-btn" onclick="showGameCenter()">
                            <span class="icon">üéÆ</span>
                            Ê∏∏Êàè‰∏≠ÂøÉ
                        </button>
                        <button class="profile-btn lottery-btn" onclick="showLotterySystem()">
                            <span class="icon">üé∞</span>
                            Âπ∏ËøêÊäΩÂ•ñ
                        </button>
                        <button class="profile-btn logout-btn" onclick="logoutUser()">
                            <span class="icon">üö™</span>
                            ÈÄÄÂá∫ÁôªÂΩï
                        </button>
                    </div>
                    
                    <div class="profile-info">
                        <h3>Ë¥¶Êà∑‰ø°ÊÅØ</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Áî®Êà∑ID</span>
                                <span class="info-value">${userId.substring(0, 12)}...</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ÁªëÂÆöÈÇÆÁÆ±</span>
                                <span class="info-value">${userEmail}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Ê≥®ÂÜåÊñπÂºè</span>
                                <span class="info-value">Auth0ÁôªÂΩï</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Ë¥¶Êà∑Áä∂ÊÄÅ</span>
                                <span class="info-value" style="color: #4CAF50;">‚úÖ Ê≠£Â∏∏</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Ê∏≤ÊüìÂà∞Áã¨Á´ãÁöÑ profile ÂÆπÂô®ÔºõËã•‰∏çÂ≠òÂú®ÂàôÂàõÂª∫ÔºåÈÅøÂÖçÈÄâÊã©‰∏çÂ≠òÂú®ÁöÑ .content ÂØºËá¥Êä•Èîô
            const main = document.querySelector('.main-content');
            let profileView = document.getElementById('profileView');
            if (!profileView) {
                profileView = document.createElement('div');
                profileView.id = 'profileView';
                profileView.className = 'profile-view';
                main.appendChild(profileView);
            }
            profileView.style.display = 'block';
            profileView.classList.add('full');
            profileView.innerHTML = profileHTML;
            console.log('‚úÖ ‰∏™‰∫∫ËµÑÊñôÈ°µÈù¢Â∑≤Ê∏≤Êüì');
            currentView = 'profile';
            updateNavActive('profile');
        }

        // Êõ¥Êñ∞ÂØºËà™ÊåâÈíÆÁä∂ÊÄÅ
        function updateNavActive(activeView) {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            const btns = document.querySelectorAll('.nav-btn');
            if (activeView === 'home') btns[0].classList.add('active');
            else if (activeView === 'transaction') btns[1].classList.add('active');
            else if (activeView === 'profile') btns[2].classList.add('active');
            else if (activeView === 'discover') btns[3].classList.add('active');
        }

        // Â§ÑÁêÜÂä®‰ΩúÊåâÈíÆÁÇπÂáª
        function handleAction(action) {
            if (!isLoggedIn) {
                // ‰øùÂ≠òÂæÖÊâßË°åÁöÑÊìç‰Ωú
                sessionStorage.setItem('pendingAction', 'action:' + action);
                // Áõ¥Êé•ÂêØÂä®Auth0ÁôªÂΩïÔºå‰∏çÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
                startAuth0Login();
                return;
            }

            // Êò†Â∞ÑÊóßÂä®‰ΩúÂêçÂà∞Êñ∞Âä®‰ΩúÂêç
            let newAction = action;
            switch(action) {
                case 'video':
                    newAction = 'watch_video';
                    break;
                case 'app':
                    newAction = 'download_app';
                    break;
                case 'checkin':
                    newAction = 'daily_checkin';
                    break;
                case 'refresh':
                    refreshPoints();
                    return;
            }
            
            executeAction(newAction);
        }
        
        // ÊâßË°åÁßØÂàÜÊìç‰Ωú
        async function executeAction(action) {
            console.log(`üéØ ÊâßË°åÊìç‰Ωú: ${action}`);
            
            // ‰ªéÂêéÁ´ØÈÖçÁΩÆËé∑ÂèñÁßØÂàÜ‰ø°ÊÅØ
            const actionConfig = getPointsForAction(action);
            const actionText = actionConfig.name || 'Êú™Áü•Êìç‰Ωú';
            const points = actionConfig.points || 0;
            
            if (points === 0) {
                showMessage(`Êìç‰Ωú ${actionText} ÊöÇ‰∏çÂèØÁî®ÊàñÊú™ÈÖçÁΩÆÁßØÂàÜÔºÅ`, 'error');
                return;
            }
            
            // Ê£ÄÊü•ÊØèÊó•ÈôêÂà∂
            const dailyLimit = actionConfig.daily_limit || 999;
            const todayActionCount = getTodayActionCount(action);
            
            if (todayActionCount >= dailyLimit) {
                showMessage(`‰ªäÊó• ${actionText} Ê¨°Êï∞Â∑≤Ëææ‰∏äÈôê (${dailyLimit}Ê¨°)ÔºÅ`, 'warning');
                return;
            }
            
            // ÊâßË°åÊìç‰ΩúÈÄªËæë
            let success = false;
            switch(action) {
                case 'watch_video':
                    success = await simulateVideoWatch();
                    break;
                case 'download_app':
                    success = await simulateAppDownload();
                    break;
                case 'daily_checkin':
                    success = await simulateDailyCheckin();
                    break;
                case 'complete_task':
                    success = await simulateTaskCompletion();
                    break;
                case 'invite_friend':
                    success = await simulateInviteFriend();
                    break;
                default:
                    // ‰ΩøÁî®ÊóßÁöÑÂáΩÊï∞‰Ωú‰∏∫Â§áÈÄâ
                    switch(action) {
                        case 'watch_video':
                            earnFromVideo();
                            success = true;
                            break;
                        case 'download_app':
                            earnFromApp();
                            success = true;
                            break;
                        case 'daily_checkin':
                            dailyCheckin();
                            success = true;
                            break;
                        default:
                            console.warn(`Êú™Áü•Êìç‰Ωú: ${action}`);
                            return;
                    }
            }
            
            if (!success) {
                showMessage(`${actionText} ÊâßË°åÂ§±Ë¥•ÔºåËØ∑ÈáçËØïÔºÅ`, 'error');
                return;
            }
            
            // Êõ¥Êñ∞ÁßØÂàÜ
            currentUser.points = (currentUser.points || 0) + points;
            
            // ‰øùÂ≠òÂà∞localStorage
            localStorage.setItem('user_profile', JSON.stringify(currentUser));
            
            // Êõ¥Êñ∞UI
            updateUserInterface();
            
            // ÊòæÁ§∫Â•ñÂä±Âä®Áîª
            showRewardAnimation(points);
            
            // ËÆ∞ÂΩïÁßØÂàÜÂéÜÂè≤
            const transaction = {
                id: Date.now(),
                action: action,
                action_text: actionText,
                points: points,
                timestamp: new Date().toISOString(),
                type: 'earn'
            };
            
            addTransactionRecord(transaction);
            
            // Êõ¥Êñ∞ÊØèÊó•Êìç‰ΩúËÆ°Êï∞
            updateTodayActionCount(action);
            
            console.log(`‚úÖ ${actionText} ÂÆåÊàêÔºåËé∑Âæó ${points} ÁßØÂàÜ`);
            
            // Ê£ÄÊü•Âπ∂ÊòæÁ§∫ÊèíÂ±èÂπøÂëä
            if (typeof checkAndShowInterstitialAd === 'function') {
                checkAndShowInterstitialAd();
            }
        }
        
        // Ê®°ÊãüÊìç‰ΩúÊâßË°åÂáΩÊï∞
        async function simulateVideoWatch() {
            return new Promise(resolve => {
                showMessage('Ê≠£Âú®Âä†ËΩΩËßÜÈ¢ëÂπøÂëä...', 'info');
                setTimeout(() => {
                    showMessage('ËßÜÈ¢ëÊí≠ÊîæÂÆåÊàêÔºÅ', 'success');
                    resolve(true);
                }, 2000);
            });
        }
        
        async function simulateAppDownload() {
            return new Promise(resolve => {
                showMessage('Ê≠£Âú®Ë∑≥ËΩ¨Â∫îÁî®ÂïÜÂ∫ó...', 'info');
                setTimeout(() => {
                    showMessage('Â∫îÁî®‰∏ãËΩΩÈ™åËØÅÊàêÂäüÔºÅ', 'success');
                    resolve(true);
                }, 1500);
            });
        }
        
        async function simulateTaskCompletion() {
            return new Promise(resolve => {
                showMessage('Ê≠£Âú®È™åËØÅ‰ªªÂä°ÂÆåÊàêÁä∂ÊÄÅ...', 'info');
                setTimeout(() => {
                    showMessage('‰ªªÂä°È™åËØÅÊàêÂäüÔºÅ', 'success');
                    resolve(true);
                }, 1000);
            });
        }
        
        async function simulateDailyCheckin() {
            return new Promise(resolve => {
                showMessage('Ê≠£Âú®ÊâßË°åÁ≠æÂà∞...', 'info');
                setTimeout(() => {
                    showMessage('Á≠æÂà∞ÊàêÂäüÔºÅ', 'success');
                    resolve(true);
                }, 800);
            });
        }
        
        async function simulateInviteFriend() {
            return new Promise(resolve => {
                showMessage('Ê≠£Âú®ÁîüÊàêÈÇÄËØ∑ÈìæÊé•...', 'info');
                setTimeout(() => {
                    showMessage('ÈÇÄËØ∑ÈìæÊé•Â∑≤ÁîüÊàêÔºÅ', 'success');
                    resolve(true);
                }, 1200);
            });
        }
        
        // Ëé∑Âèñ‰ªäÊó•Êìç‰ΩúÊ¨°Êï∞
        function getTodayActionCount(action) {
            const today = new Date().toDateString();
            const key = `action_count_${action}_${today}`;
            return parseInt(localStorage.getItem(key)) || 0;
        }
        
        // Êõ¥Êñ∞‰ªäÊó•Êìç‰ΩúÊ¨°Êï∞
        function updateTodayActionCount(action) {
            const today = new Date().toDateString();
            const key = `action_count_${action}_${today}`;
            const count = getTodayActionCount(action) + 1;
            localStorage.setItem(key, count);
        }

        // ÂêØÂä®Auth0ÁôªÂΩïÊµÅÁ®ãÔºàÈªòËÆ§GoogleÁôªÂΩïÔºâ
        function startAuth0Login() {
            console.log('üöÄ Áõ¥Êé•ÂêØÂä®Auth0ÁôªÂΩïÊµÅÁ®ã...');
            console.log('Auth0ÈÖçÁΩÆ:', auth0Config);
            console.log('Auth0ÂØπË±°:', typeof auth0, auth0);
            
            // Ê£ÄÊü•Auth0ÊòØÂê¶Â∑≤ÂàùÂßãÂåñ
            if (!auth0) {
                console.warn('‚ö†Ô∏è Auth0ÂØπË±°Êú™ÂàùÂßãÂåñÔºåÂ∞ùËØïÈáçÊñ∞ÂàùÂßãÂåñ...');
                
                // Â∞ùËØïÁ´ãÂç≥ÈáçÊñ∞ÂàùÂßãÂåñ
                initializeAuth0();
                
                // Á≠âÂæÖ‰∏ÄÁßíÂêéÂÜçÊ¨°Ê£ÄÊü•
                setTimeout(() => {
                    if (!auth0) {
                        console.error('‚ùå Auth0ÂàùÂßãÂåñÂ§±Ë¥•Ôºå‰ΩøÁî®Â§áÁî®ÊñπÊ°à');
                        tryDirectRedirect();
                    } else {
                        // ÊàêÂäüÂàùÂßãÂåñÂêéÁªßÁª≠ÁôªÂΩïÊµÅÁ®ã
                        startAuth0Login();
                    }
                }, 1500);
                return;
            }
            
            // Ê£ÄÊü•Auth0 SDKÂÖ®Â±ÄÂØπË±°
            if (typeof Auth0 === 'undefined') {
                console.error('‚ùå Auth0 SDKÊú™Âä†ËΩΩÔºå‰ΩøÁî®Áõ¥Êé•Ë∑≥ËΩ¨Âà∞Auth0');
                tryDirectRedirect();
                return;
            }
            
            try {
                console.log('üì° Ë∞ÉÁî®auth0.authorize...');
                auth0.authorize({
                    connection: 'google-oauth2'
                });
                console.log('‚úÖ authorizeË∞ÉÁî®ÂÆåÊàêÔºåÁ≠âÂæÖË∑≥ËΩ¨...');
                
                // ËÆæÁΩÆ‰∏Ä‰∏™Ë∂ÖÊó∂Ê£ÄÊü•ÔºåÂ¶ÇÊûú5ÁßíÂêéËøòÂú®ÂΩìÂâçÈ°µÈù¢ÔºåËØ¥ÊòéÂèØËÉΩÊúâÈóÆÈ¢ò
                setTimeout(() => {
                    console.warn('‚ö†Ô∏è 5ÁßíÂêé‰ªçÂú®ÂΩìÂâçÈ°µÈù¢ÔºåÂèØËÉΩAuth0Ë∑≥ËΩ¨Â§±Ë¥•');
                    // Â∞ùËØïÁõ¥Êé•ÊûÑÈÄ†URLË∑≥ËΩ¨
                    tryDirectRedirect();
                }, 5000);
                
            } catch (error) {
                console.error('‚ùå Auth0ÁôªÂΩïÂêØÂä®Â§±Ë¥•:', error);
                alert('Auth0ÁôªÂΩïÂ§±Ë¥•: ' + error.message);
                // Â¶ÇÊûúAuth0Â§±Ë¥•ÔºåÂàôÂõûÈÄÄÂà∞ÊòæÁ§∫ÁôªÂΩïÈÄâÊã©
                showLoginModal();
            }
        }
        
        // Â∞ùËØïÁõ¥Êé•ÊûÑÈÄ†Auth0 URLËøõË°åË∑≥ËΩ¨
        function tryDirectRedirect() {
            console.log('üîÑ Â∞ùËØïÁõ¥Êé•URLË∑≥ËΩ¨...');
            try {
                const loginUrl = `https://${auth0Config.domain}/authorize?` +
                    `response_type=${auth0Config.responseType}&` +
                    `client_id=${auth0Config.clientId}&` +
                    `redirect_uri=${encodeURIComponent(auth0Config.redirectUri)}&` +
                    `scope=${encodeURIComponent(auth0Config.scope)}&` +
                    `connection=google-oauth2&` +
                    `nonce=${auth0Config.nonce}`;
                
                console.log('üåê Ë∑≥ËΩ¨URL:', loginUrl);
                
                // Âº∫Âà∂Ë∑≥ËΩ¨Âà∞Auth0Ôºå‰∏çËøõË°åÂüüÂêçÊµãËØï
                console.log('üöÄ Áõ¥Êé•Ë∑≥ËΩ¨Âà∞Auth0ÁôªÂΩïÈ°µÈù¢');
                window.location.href = loginUrl;
                    
            } catch (error) {
                console.error('‚ùå Áõ¥Êé•Ë∑≥ËΩ¨‰πüÂ§±Ë¥•:', error);
                simulateAuth0Login();
            }
        }
        
        // Ê®°ÊãüAuth0ÁôªÂΩïÔºàÁî®‰∫éÊµãËØïÔºâ
        function simulateAuth0Login() {
            console.log('üß™ ÂêØÂä®Ê®°ÊãüAuth0ÁôªÂΩïÊµÅÁ®ã...');
            
            // Ê®°ÊãüÁî®Êà∑Êï∞ÊçÆ
            const mockUser = {
                sub: 'auth0|mock_' + Date.now(),
                email: 'test@example.com',
                name: 'Test User',
                picture: 'https://via.placeholder.com/64'
            };
            
            // Ê®°ÊãüAuth0ÂõûË∞ÉÊï∞ÊçÆ
            const mockAuth = {
                access_token: 'mock_access_token_' + Date.now(),
                id_token: 'mock_id_token_' + Date.now(),
                expires_in: 86400,
                token_type: 'Bearer'
            };
            
            console.log('‚úÖ Ê®°ÊãüÁôªÂΩïÊàêÂäüÔºåÂ§ÑÁêÜÁî®Êà∑Êï∞ÊçÆ...');
            
            // ËÆæÁΩÆÁî®Êà∑Êï∞ÊçÆ
            currentUser = {
                id: mockUser.sub,
                name: mockUser.name,
                email: mockUser.email,
                avatar: mockUser.picture,
                points: 0
            };
            
            authToken = mockAuth.access_token;
            isLoggedIn = true;
            
            // Â≠òÂÇ®Âà∞localStorage
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('authToken', authToken);
            localStorage.setItem('isLoggedIn', 'true');
            
            // ÂêåÊ≠•Âà∞ÂêéÁ´Ø
            syncUserToBackend(mockUser, mockAuth.access_token);
            
            // Êõ¥Êñ∞UI
            updateUserInfo();
            hideLoginModal();
            showMessage('Ê®°ÊãüÁôªÂΩïÊàêÂäüÔºÅ', 'success');
            
            // ÊâßË°åÂæÖÂÆöÊìç‰Ωú
            const pendingAction = sessionStorage.getItem('pendingAction');
            if (pendingAction) {
                sessionStorage.removeItem('pendingAction');
                console.log('ÊâßË°åÂæÖÂÆöÊìç‰Ωú:', pendingAction);
                
                setTimeout(() => {
                    if (pendingAction.startsWith('action:')) {
                        handleAction(pendingAction.replace('action:', ''));
                    } else if (pendingAction === 'showTransactionView') {
                        showTransactionView();
                    } else if (pendingAction === 'showProfileView') {
                        showProfileView();
                    }
                }, 1000);
            }
        }

        // ÊòæÁ§∫ÁôªÂΩïÊ®°ÊÄÅÊ°Ü
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'flex';
            showLoginForm();
        }

        // ÈöêËóèÁôªÂΩïÊ®°ÊÄÅÊ°Ü
        function hideLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
            clearFormData();
        }

        // ÊòæÁ§∫ÁôªÂΩïË°®Âçï
        function showLoginForm() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('forgotPasswordForm').style.display = 'none';
            document.getElementById('emailVerificationForm').style.display = 'none';
            
            document.getElementById('modalTitle').textContent = 'ÁôªÂΩï';
        }

        // ÊòæÁ§∫Ê≥®ÂÜåË°®Âçï
        function showRegisterForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
            document.getElementById('forgotPasswordForm').style.display = 'none';
            document.getElementById('emailVerificationForm').style.display = 'none';
            
            document.getElementById('modalTitle').textContent = 'Ê≥®ÂÜå';
        }

        // ÊòæÁ§∫ÂøòËÆ∞ÂØÜÁ†ÅË°®Âçï
        function showForgotPasswordForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('forgotPasswordForm').style.display = 'block';
            document.getElementById('emailVerificationForm').style.display = 'none';
            
            document.getElementById('modalTitle').textContent = 'ÈáçÁΩÆÂØÜÁ†Å';
        }

        // ÊòæÁ§∫ÈÇÆÁÆ±È™åËØÅË°®Âçï
        function showEmailVerificationForm(email) {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('forgotPasswordForm').style.display = 'none';
            document.getElementById('emailVerificationForm').style.display = 'block';
            
            document.getElementById('modalTitle').textContent = 'ÈÇÆÁÆ±È™åËØÅ';
            document.getElementById('verificationEmail').textContent = email;
        }

        // Ê∏ÖÁ©∫Ë°®ÂçïÊï∞ÊçÆ
        function clearFormData() {
            document.querySelectorAll('#loginModal input[type="text"], #loginModal input[type="email"], #loginModal input[type="password"]').forEach(input => {
                input.value = '';
            });
            const agreeCheckbox = document.querySelector('#agreeTerms');
            if (agreeCheckbox) {
                agreeCheckbox.checked = false;
            }
        }

        // Â§ÑÁêÜÈÇÆÁÆ±ÂØÜÁ†ÅÁôªÂΩï
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showMessage('ËØ∑Â°´ÂÜôÂÆåÊï¥‰ø°ÊÅØ', 'error');
                return;
            }
            
            try {
                showMessage('Ê≠£Âú®ÁôªÂΩï...', 'info');
                
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // ËÆæÁΩÆÁî®Êà∑‰ø°ÊÅØ
                    currentUser = result.data.user;
                    authToken = result.data.token;
                    isLoggedIn = true;
                    
                    // Â≠òÂÇ®Âà∞localStorage
                    localStorage.setItem('auth_token', authToken);
                    localStorage.setItem('user_profile', JSON.stringify(currentUser));
                    
                    hideLoginModal();
                    updateUserInterface();
                    showMessage('ÁôªÂΩïÊàêÂäüÔºÅ', 'success');
                    
                    // ÊâßË°åÂæÖÂ§ÑÁêÜÁöÑÊìç‰Ωú
                    const pendingAction = sessionStorage.getItem('pendingAction');
                    if (pendingAction) {
                        sessionStorage.removeItem('pendingAction');
                        setTimeout(() => {
                            if (pendingAction === 'showTransaction') {
                                showTransactionView();
                            } else if (pendingAction === 'showProfile') {
                                showProfileView();
                            } else {
                                handleAction(pendingAction);
                            }
                        }, 500);
                    }
                } else {
                    showMessage(result.message || 'ÁôªÂΩïÂ§±Ë¥•', 'error');
                }
            } catch (error) {
                showMessage('ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï', 'error');
            }
        }

        // Â§ÑÁêÜÁî®Êà∑Ê≥®ÂÜå
        async function handleRegister(event) {
            event.preventDefault();
            
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const referralCode = document.getElementById('referralCode').value;
            const agreeTerms = document.getElementById('agreeTerms').checked;
            
            // Ë°®ÂçïÈ™åËØÅ
            if (!username || !email || !password || !confirmPassword) {
                showMessage('ËØ∑Â°´ÂÜôÂÆåÊï¥‰ø°ÊÅØ', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showMessage('‰∏§Ê¨°ËæìÂÖ•ÁöÑÂØÜÁ†Å‰∏ç‰∏ÄËá¥', 'error');
                return;
            }
            
            if (password.length < 6) {
                showMessage('ÂØÜÁ†ÅËá≥Â∞ëÈúÄË¶Å6‰Ωç', 'error');
                return;
            }
            
            if (!agreeTerms) {
                showMessage('ËØ∑ÂêåÊÑèÁî®Êà∑ÂçèËÆÆÂíåÈöêÁßÅÊîøÁ≠ñ', 'error');
                return;
            }
            
            try {
                showMessage('Ê≠£Âú®Ê≥®ÂÜå...', 'info');
                
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username,
                        email,
                        password,
                        referralCode: referralCode || undefined
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('Ê≥®ÂÜåÊàêÂäüÔºåÊ≠£Âú®ÂèëÈÄÅÈÇÆÁÆ±È™åËØÅÁ†Å...', 'success');
                    // ÊòæÁ§∫ÈÇÆÁÆ±È™åËØÅË°®Âçï
                    setTimeout(() => {
                        showEmailVerificationForm(email);
                    }, 1500);
                } else {
                    showMessage(result.message || 'Ê≥®ÂÜåÂ§±Ë¥•', 'error');
                }
            } catch (error) {
                showMessage('ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï', 'error');
            }
        }

        // Â§ÑÁêÜÂøòËÆ∞ÂØÜÁ†Å
        async function handleForgotPassword(event) {
            event.preventDefault();
            
            const email = document.getElementById('forgotEmail').value;
            
            if (!email) {
                showMessage('ËØ∑ËæìÂÖ•ÈÇÆÁÆ±Âú∞ÂùÄ', 'error');
                return;
            }
            
            try {
                showMessage('Ê≠£Âú®ÂèëÈÄÅÈáçÁΩÆÈìæÊé•...', 'info');
                
                const response = await fetch(`${API_BASE}/auth/forgot-password`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('ÈáçÁΩÆÈìæÊé•Â∑≤ÂèëÈÄÅÂà∞ÊÇ®ÁöÑÈÇÆÁÆ±ÔºåËØ∑Êü•Êî∂', 'success');
                    setTimeout(() => {
                        showLoginForm();
                    }, 2000);
                } else {
                    showMessage(result.message || 'ÂèëÈÄÅÂ§±Ë¥•', 'error');
                }
            } catch (error) {
                showMessage('ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï', 'error');
            }
        }

        // Â§ÑÁêÜÈÇÆÁÆ±È™åËØÅ
        async function handleEmailVerification(event) {
            event.preventDefault();
            
            const code = document.getElementById('verificationCode').value;
            const email = document.getElementById('verificationEmail').textContent;
            
            if (!code || code.length !== 6) {
                showMessage('ËØ∑ËæìÂÖ•6‰ΩçÈ™åËØÅÁ†Å', 'error');
                return;
            }
            
            try {
                showMessage('Ê≠£Âú®È™åËØÅ...', 'info');
                
                const response = await fetch(`${API_BASE}/auth/verify-email`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, code })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Ëá™Âä®ÁôªÂΩï
                    currentUser = result.data.user;
                    authToken = result.data.token;
                    isLoggedIn = true;
                    
                    localStorage.setItem('auth_token', authToken);
                    localStorage.setItem('user_profile', JSON.stringify(currentUser));
                    
                    hideLoginModal();
                    updateUserInterface();
                    showMessage('Ê≥®ÂÜåÊàêÂäüÔºÅËé∑ÂæóÊñ∞Áî®Êà∑Â•ñÂä±ÁßØÂàÜÔºÅ', 'success');
                } else {
                    showMessage(result.message || 'È™åËØÅÂ§±Ë¥•', 'error');
                }
            } catch (error) {
                showMessage('ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï', 'error');
            }
        }

        // ÈáçÊñ∞ÂèëÈÄÅÈ™åËØÅÁ†Å
        async function resendVerificationCode() {
            const email = document.getElementById('verificationEmail').textContent;
            
            try {
                showMessage('Ê≠£Âú®ÈáçÊñ∞ÂèëÈÄÅÈ™åËØÅÁ†Å...', 'info');
                
                const response = await fetch(`${API_BASE}/auth/resend-verification`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('È™åËØÅÁ†ÅÂ∑≤ÈáçÊñ∞ÂèëÈÄÅ', 'success');
                } else {
                    showMessage(result.message || 'ÂèëÈÄÅÂ§±Ë¥•', 'error');
                }
            } catch (error) {
                showMessage('ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï', 'error');
            }
        }

        // ÊòæÁ§∫Áî®Êà∑ÂçèËÆÆ
        function showTerms() {
            alert('Áî®Êà∑ÂçèËÆÆ\n\n1. Áî®Êà∑Â∫îÈÅµÂÆàÁõ∏ÂÖ≥Ê≥ïÂæãÊ≥ïËßÑ\n2. Á¶ÅÊ≠¢ÊÅ∂ÊÑèÂà∑ÂàÜË°å‰∏∫\n3. ÁßØÂàÜ‰∏çÂèØÂÖëÊç¢Áé∞Èáë\n4. Êàë‰ª¨‰øùÁïôÊúÄÁªàËß£ÈáäÊùÉ');
        }

        // ÊòæÁ§∫ÈöêÁßÅÊîøÁ≠ñ
        function showPrivacy() {
            alert('ÈöêÁßÅÊîøÁ≠ñ\n\n1. Êàë‰ª¨‰ºö‰øùÊä§ÊÇ®ÁöÑ‰∏™‰∫∫‰ø°ÊÅØ\n2. ‰∏ç‰ºöÂêëÁ¨¨‰∏âÊñπÊ≥ÑÈú≤ÊÇ®ÁöÑ‰ø°ÊÅØ\n3. Êî∂ÈõÜ‰ø°ÊÅØ‰ªÖÁî®‰∫éÊîπÂñÑÊúçÂä°\n4. ÊÇ®ÊúâÊùÉË¶ÅÊ±ÇÂà†Èô§‰∏™‰∫∫‰ø°ÊÅØ');
        }

        // ÊòæÁ§∫Ê∂àÊÅØ
        function showMessage(message, type = 'success') {
            const element = document.getElementById('loginMessage');
            element.textContent = message;
            element.className = `login-message ${type}`;
            element.style.display = 'block';
            setTimeout(() => { element.style.display = 'none'; }, 2000);
        }

        // Â•ñÂä±Âä®ÁîªÔºåÈÅøÂÖçÊú™ÂÆö‰πâÂØºËá¥ÁöÑÈîôËØØ
        function showRewardAnimation(points) {
            try {
                const toast = document.createElement('div');
                toast.textContent = `+${(points || 0).toLocaleString()} ÁßØÂàÜ`;
                toast.style.position = 'fixed';
                toast.style.left = '50%';
                toast.style.top = '45%';
                toast.style.transform = 'translate(-50%, -50%)';
                toast.style.padding = '12px 18px';
                toast.style.borderRadius = '14px';
                toast.style.background = 'rgba(0,0,0,0.85)';
                toast.style.color = '#fff';
                toast.style.fontSize = '18px';
                toast.style.zIndex = '9999';
                toast.style.boxShadow = '0 8px 24px rgba(0,0,0,0.25)';
                document.body.appendChild(toast);
                requestAnimationFrame(() => {
                    toast.style.transition = 'all .6s ease';
                    toast.style.opacity = '1';
                });
                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translate(-50%, -70%)';
                }, 800);
                setTimeout(() => toast.remove(), 1500);
            } catch (_) {}
        }

        // GoogleÁôªÂΩï - ‰ΩøÁî®Auth0
        function loginWithGoogle() {
            console.log('üîµ ÂêØÂä®GoogleÁôªÂΩï...');
            showMessage('Ê≠£Âú®ËøûÊé•Google...', 'success');
            try {
                auth0.authorize({
                    connection: 'google-oauth2'
                });
            } catch (error) {
                console.error('‚ùå GoogleÁôªÂΩïÂêØÂä®Â§±Ë¥•:', error);
                showMessage('GoogleÁôªÂΩïÂêØÂä®Â§±Ë¥•: ' + error.message, 'error');
            }
        }

        // AppleÁôªÂΩï - ‰ΩøÁî®Auth0
        function loginWithApple() {
            console.log('üçé ÂêØÂä®AppleÁôªÂΩï...');
            showMessage('Ê≠£Âú®ËøûÊé•Apple...', 'success');
            try {
                auth0.authorize({
                    connection: 'apple'
                });
            } catch (error) {
                console.error('‚ùå AppleÁôªÂΩïÂêØÂä®Â§±Ë¥•:', error);
                showMessage('AppleÁôªÂΩïÂêØÂä®Â§±Ë¥•: ' + error.message, 'error');
            }
        }

        // Ê∏∏ÂÆ¢ÁôªÂΩï - Êï∞ÊçÆÂ∫ìËøûÊé•
        function loginAsGuest() {
            console.log('üë§ ÂêØÂä®Ê∏∏ÂÆ¢ÁôªÂΩï...');
            showMessage('Ê≠£Âú®‰ª•Ê∏∏ÂÆ¢Ë∫´‰ªΩÁôªÂΩï...', 'success');
            try {
                auth0.authorize({
                    connection: 'Username-Password-Authentication',
                    login_hint: 'guest_mode'
                });
            } catch (error) {
                console.error('‚ùå Ê∏∏ÂÆ¢ÁôªÂΩïÂêØÂä®Â§±Ë¥•:', error);
                showMessage('Ê∏∏ÂÆ¢ÁôªÂΩïÂêØÂä®Â§±Ë¥•: ' + error.message, 'error');
            }
        }

        // Auth0ÂõûË∞ÉÂ§ÑÁêÜ
        function handleAuth0Callback() {
            auth0.parseHash((err, authResult) => {
                if (authResult && authResult.accessToken && authResult.idToken) {
                    // ÁôªÂΩïÊàêÂäü
                    auth0.client.userInfo(authResult.accessToken, (err, profile) => {
                        if (err) {
                            showMessage('Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•', 'error');
                            return;
                        }
                        
                        // ËÆæÁΩÆÁî®Êà∑‰ø°ÊÅØ
                        currentUser = {
                            id: profile.sub,
                            name: profile.name || profile.nickname,
                            email: profile.email,
                            avatar: profile.picture || 'üë§',
                            points: 0
                        };
                        authToken = authResult.accessToken;
                        isLoggedIn = true;
                        
                        // Â≠òÂÇ®Âà∞localStorage
                        localStorage.setItem('auth0_token', authResult.accessToken);
                        localStorage.setItem('auth0_id_token', authResult.idToken);
                        localStorage.setItem('user_profile', JSON.stringify(currentUser));
                        
                        hideLoginModal();
                        updateUserInterface();
                        showMessage('ÁôªÂΩïÊàêÂäüÔºÅ', 'success');
                        
                        // ÊâßË°åÂæÖÂ§ÑÁêÜÁöÑÊìç‰Ωú
                        const pendingAction = sessionStorage.getItem('pendingAction');
                        if (pendingAction) {
                            sessionStorage.removeItem('pendingAction');
                            setTimeout(() => {
                                if (pendingAction === 'showTransaction') {
                                    showTransactionView();
                                } else if (pendingAction === 'showProfile') {
                                    showProfileView();
                                } else {
                                    handleAction(pendingAction);
                                }
                            }, 500);
                        }
                        
                        // ÂêåÊ≠•Áî®Êà∑‰ø°ÊÅØÂà∞ÂêéÁ´Ø
                        syncUserToBackend(currentUser, authResult.accessToken);
                        
                        // Âä†ËΩΩÂêéÁ´ØÈÖçÁΩÆ
                        setTimeout(() => {
                            loadPointsConfig();
                            loadAdMobConfig();
                        }, 1000);
                    });
                } else if (err) {
                    console.error('Auth0ÁôªÂΩïÈîôËØØ:', err);
                    showMessage(`ÁôªÂΩïÂ§±Ë¥•: ${err.error_description || err.error}`, 'error');
                }
            });
        }

        // ÂêåÊ≠•Áî®Êà∑‰ø°ÊÅØÂà∞ÂêéÁ´Ø
        async function syncUserToBackend(user, token) {
            try {
                const response = await fetch(`${API_BASE}/auth/auth0-sync`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        auth0_id: user.id,
                        email: user.email,
                        name: user.name,
                        avatar: user.avatar
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    // Êõ¥Êñ∞Áî®Êà∑ÁßØÂàÜ‰ø°ÊÅØ
                    currentUser.points = result.data.points || 0;
                    updateUserInterface();
                }
            } catch (error) {
                console.error('ÂêåÊ≠•Áî®Êà∑‰ø°ÊÅØÂ§±Ë¥•:', error);
            }
        }

        // ÊâßË°åÁ§æ‰∫§ÁôªÂΩï
        async function performSocialLogin(socialUser) {
            try {
                showMessage('Ê≠£Âú®ÁôªÂΩï...', 'success');
                
                const response = await fetch(`${API_BASE}/auth/social-login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(socialUser)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('ÁôªÂΩïÁªìÊûú:', result);
                
                if (result.success) {
                    currentUser = result.data.user;
                    authToken = result.data.token;
                    isLoggedIn = true;
                    
                    showMessage(result.message || 'ÁôªÂΩïÊàêÂäüÔºÅ', 'success');
                    
                    setTimeout(() => {
                        hideLoginModal();
                        updateUserInterface();
                        
                        const pendingAction = sessionStorage.getItem('pendingAction');
                        if (pendingAction) {
                            sessionStorage.removeItem('pendingAction');
                            setTimeout(() => handleAction(pendingAction), 500);
                        }
                    }, 1000);
                } else {
                    showMessage(result.error || 'ÁôªÂΩïÂ§±Ë¥•', 'error');
                }
            } catch (error) {
                console.error('ÁôªÂΩïÂ§±Ë¥•:', error);
                showMessage(`ÁôªÂΩïÂ§±Ë¥•: ${error.message}`, 'error');
            }
        }

        // Êõ¥Êñ∞Áî®Êà∑ÁïåÈù¢
        function updateUserInterface() {
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.nickname || currentUser.name;
                document.getElementById('userPoints').textContent = (currentUser.points || 0).toLocaleString();
                document.getElementById('vipBadge').textContent = currentUser.is_vip ? 'VIP‰ºöÂëò' : 'ÊôÆÈÄöÁî®Êà∑';
                document.getElementById('userAvatar').textContent = currentUser.avatar || 'üë§';
            }
        }

        // ËßÇÁúãËßÜÈ¢ëËµöÁßØÂàÜ
        async function earnFromVideo() {
            // È¶ñÂÖàÊòæÁ§∫ÊøÄÂä±ËßÜÈ¢ëÂπøÂëä
            if (typeof showRewardedAd === 'function') {
                showRewardedAd((success) => {
                    if (success) {
                        // ÂπøÂëäËßÇÁúãÊàêÂäüÔºåÊâßË°åÂéüÊúâÁöÑÁßØÂàÜÂ•ñÂä±ÈÄªËæë
                        performVideoEarnRequest();
                    }
                });
            } else {
                // ÈôçÁ∫ßÂà∞ÂéüÊúâÈÄªËæë
                performVideoEarnRequest();
            }
        }
        
        // ÊâßË°åËßÜÈ¢ëÁßØÂàÜËØ∑Ê±Ç
        async function performVideoEarnRequest() {
            try {
                const response = await fetch(`${API_BASE}/app/earn/watch-video`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const result = await response.json();
                if (result.success) {
                    currentUser.points += result.data.points_earned;
                    updateUserInterface();
                    alert(`ËßÇÁúãËßÜÈ¢ëÂÆåÊàêÔºÅËé∑Âæó ${result.data.points_earned} ÁßØÂàÜ`);
                } else {
                    alert(result.error || 'Êìç‰ΩúÂ§±Ë¥•');
                }
            } catch (error) {
                alert('ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï');
            }
        }

        // ‰∏ãËΩΩÂ∫îÁî®ËµöÁßØÂàÜ
        async function earnFromApp() {
            try {
                const response = await fetch(`${API_BASE}/app/earn/download-app`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        app_name: 'DemoÂ∫îÁî®',
                        app_id: 'demo_app_001'
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    currentUser.points += result.data.points_earned;
                    updateUserInterface();
                    alert(`‰∏ãËΩΩÂ∫îÁî®ÂÆåÊàêÔºÅËé∑Âæó ${result.data.points_earned} ÁßØÂàÜ`);
                } else {
                    alert(result.error || 'Êìç‰ΩúÂ§±Ë¥•');
                }
            } catch (error) {
                alert('ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï');
            }
        }

        // ÊØèÊó•Á≠æÂà∞
        async function dailyCheckin() {
            try {
                const response = await fetch(`${API_BASE}/app/earn/daily-checkin`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const result = await response.json();
                if (result.success) {
                    currentUser.points += result.data.points_earned;
                    updateUserInterface();
                    alert(`ÊØèÊó•Á≠æÂà∞ÂÆåÊàêÔºÅËé∑Âæó ${result.data.points_earned} ÁßØÂàÜ`);
                } else {
                    alert(result.error || 'Êìç‰ΩúÂ§±Ë¥•');
                }
            } catch (error) {
                alert('ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï');
            }
        }

        // Âà∑Êñ∞ÁßØÂàÜ
        async function refreshPoints() {
            try {
                const response = await fetch(`${API_BASE}/app/user/points`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const result = await response.json();
                if (result.success) {
                    currentUser.points = result.data.points;
                    updateUserInterface();
                    alert('ÁßØÂàÜÂ∑≤Âà∑Êñ∞');
                } else {
                    alert(result.error || 'Âà∑Êñ∞Â§±Ë¥•');
                }
            } catch (error) {
                alert('ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï');
            }
        }

        // Âä†ËΩΩ‰∫§ÊòìËÆ∞ÂΩï
        async function loadTransactionHistory() {
            if (!authToken) return;

            try {
                const response = await fetch(`${API_BASE}/app/user/transactions`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const result = await response.json();
                if (result.success && result.data.length > 0) {
                    const listElement = document.getElementById('transactionList');
                    listElement.innerHTML = '';
                    
                    result.data.forEach(transaction => {
                        const item = document.createElement('div');
                        item.className = 'transaction-item';
                        item.innerHTML = `
                            <div class="transaction-info">
                                <div class="title">${getTransactionTypeName(transaction.transaction_type)}</div>
                                <div class="time">${new Date(transaction.created_at).toLocaleString()}</div>
                            </div>
                            <div class="transaction-amount">+${transaction.points_change.toLocaleString()}</div>
                        `;
                        listElement.appendChild(item);
                    });
                }
            } catch (error) {
                console.error('Âä†ËΩΩ‰∫§ÊòìËÆ∞ÂΩïÂ§±Ë¥•:', error);
            }
        }

        // Ëé∑Âèñ‰∫§ÊòìÁ±ªÂûãÂêçÁß∞
        function getTransactionTypeName(type) {
            const types = {
                'registration_bonus': 'Ê≥®ÂÜåÂ•ñÂä±',
                'watch_video': 'ËßÇÁúãËßÜÈ¢ë',
                'download_app': '‰∏ãËΩΩÂ∫îÁî®',
                'daily_checkin': 'ÊØèÊó•Á≠æÂà∞',
                'admin_adjust': 'ÁÆ°ÁêÜÂëòË∞ÉÊï¥'
            };
            return types[type] || type;
        }

        // ËøΩÂä†‰∏ÄÊù°Êú¨Âú∞‰∫§ÊòìËÆ∞ÂΩïÔºàÁî®‰∫éÁ´ãÂç≥Âú®‚ÄúËÆ∞ÂΩï‚ÄùÈ°µÂ±ïÁ§∫Ôºâ
        function addTransactionRecord(record) {
            try {
                const listElement = document.getElementById('transactionList');
                if (!listElement) return;
                const item = document.createElement('div');
                item.className = 'transaction-item';
                item.innerHTML = `
                    <div class="transaction-info">
                        <div class="title">${getTransactionTypeName(record.transaction_type || record.action)}</div>
                        <div class="time">${new Date(record.created_at || record.timestamp).toLocaleString()}</div>
                    </div>
                    <div class="transaction-amount">+${(record.points_change || record.points || 0).toLocaleString()}</div>
                `;
                listElement.prepend(item);
            } catch (_) {}
        }

        // ÈÄÄÂá∫ÁôªÂΩï - Auth0ÁâàÊú¨
        function logout() {
            if (confirm('Á°ÆÂÆöË¶ÅÈÄÄÂá∫ÁôªÂΩïÂêóÔºü')) {
                console.log('üö™ Áî®Êà∑ÈÄÄÂá∫ÁôªÂΩï');
                
                // Ê∏ÖÈô§ÊâÄÊúâÊú¨Âú∞Â≠òÂÇ®
                localStorage.removeItem('auth0_token');
                localStorage.removeItem('auth0_id_token');
                localStorage.removeItem('user_profile');
                localStorage.removeItem('currentUser');
                localStorage.removeItem('authToken');
                localStorage.removeItem('isLoggedIn');
                sessionStorage.clear();
                
                // ÈáçÁΩÆÁä∂ÊÄÅ
                currentUser = null;
                authToken = null;
                isLoggedIn = false;
                
                // ÊòæÁ§∫ÈÄÄÂá∫Ê∂àÊÅØ
                showMessage('Ê≠£Âú®ÈÄÄÂá∫ÁôªÂΩï...', 'info');
                
                // Êõ¥Êñ∞UI
                updateUIForLoggedOut();
                
                // Auth0ÈÄÄÂá∫ÁôªÂΩï
                if (auth0) {
                    try {
                        auth0.logout({
                            returnTo: window.location.origin + '/app-demo.html',
                            clientID: auth0Config.clientId
                        });
                    } catch (error) {
                        console.error('Auth0ÈÄÄÂá∫Â§±Ë¥•:', error);
                        // Â¶ÇÊûúAuth0ÈÄÄÂá∫Â§±Ë¥•ÔºåÁõ¥Êé•Âà∑Êñ∞È°µÈù¢
                        setTimeout(() => {
                            window.location.reload();
                        }, 1000);
                    }
                } else {
                    // Ê≤°ÊúâAuth0ÔºåÁõ¥Êé•Âà∑Êñ∞È°µÈù¢
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                }
            }
        }
        
        // ÈÄÄÂá∫ÁôªÂΩïÁöÑÂà´ÂêçÂáΩÊï∞
        function logoutUser() {
            logout();
        }
        
        // ÁºñËæëËµÑÊñôÂäüËÉΩ
        function editProfile() {
            showEditProfileModal();
        }
        
        // Ë¥¶Êà∑ËÆæÁΩÆÂäüËÉΩ
        function showSettings() {
            showSettingsModal();
        }

        // Ê£ÄÊü•ÊúçÂä°Âô®ËøûÊé•
        async function checkServerConnection() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                if (response.ok) {
                    console.log('‚úÖ ÂêéÂè∞APIÊúçÂä°Âô®ËøûÊé•Ê≠£Â∏∏');
                }
            } catch (error) {
                console.error('‚ùå Êó†Ê≥ïËøûÊé•Âà∞ÂêéÂè∞APIÊúçÂä°Âô®');
            }
        }

        // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
        document.getElementById('loginModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideLoginModal();
            }
        });
        
        // Ë∞ÉËØïÂáΩÊï∞ÔºàÂ∑≤Á¶ÅÁî®Ôºâ
        function showDebugInfo() { /* logs disabled */ }
        // ÁßªÈô§Ë∞ÉËØï‰∫ã‰ª∂ÁõëÂê¨ÔºàÂç†‰ΩçÔºåÈò≤Ê≠¢ÊÑèÂ§ñÁªëÂÆöÔºâ
        try {
            const uc = document.querySelector('.user-card');
            if (uc) {
                uc.addEventListener('dblclick', function(ev){ ev.stopPropagation(); });
            }
            document.addEventListener('keydown', function(e){ /* ignore */ }, { once: true });
        } catch(_) {}
        // ===================== ÂêéÁ´ØÈÖçÁΩÆÁÆ°ÁêÜ =====================
        
        // ‰ªéÂêéÁ´ØËé∑ÂèñÁßØÂàÜÈÖçÁΩÆ
        async function loadPointsConfig() {
            try {
                if (!authToken) {
                    console.log('‚ö†Ô∏è Êú™ÁôªÂΩïÔºåÊó†Ê≥ïËé∑ÂèñÁßØÂàÜÈÖçÁΩÆ');
                    return;
                }
                
                const response = await fetch(`${API_BASE}/app/points/config`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    pointsConfig = result.data;
                    console.log('‚úÖ ÁßØÂàÜÈÖçÁΩÆÂ∑≤Âä†ËΩΩ:', pointsConfig);
                    updateActionPointsDisplay(); // Êõ¥Êñ∞ÁïåÈù¢ÊòæÁ§∫
                    
                    // Ê£ÄÊü•ÁßØÂàÜËøáÊúü
                    checkPointsExpiration();
                } else {
                    console.error('‚ùå Ëé∑ÂèñÁßØÂàÜÈÖçÁΩÆÂ§±Ë¥•:', response.statusText);
                }
            } catch (error) {
                console.error('‚ùå Ëé∑ÂèñÁßØÂàÜÈÖçÁΩÆÈîôËØØ:', error);
            }
        }
        
        // ‰ªéÂêéÁ´ØËé∑ÂèñAdMobÈÖçÁΩÆ
        async function loadAdMobConfig() {
            try {
                if (!authToken) {
                    console.log('‚ö†Ô∏è Êú™ÁôªÂΩïÔºåÊó†Ê≥ïËé∑ÂèñAdMobÈÖçÁΩÆ');
                    return;
                }
                
                const response = await fetch(`${API_BASE}/app/admob/config`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    admobConfig = result.data;
                    console.log('‚úÖ AdMobÈÖçÁΩÆÂ∑≤Âä†ËΩΩ:', admobConfig);
                    
                    // ÂàùÂßãÂåñÂπøÂëä
                    if (typeof initializeAds === 'function') {
                        initializeAds();
                    }
                } else {
                    console.error('‚ùå Ëé∑ÂèñAdMobÈÖçÁΩÆÂ§±Ë¥•:', response.statusText);
                }
            } catch (error) {
                console.error('‚ùå Ëé∑ÂèñAdMobÈÖçÁΩÆÈîôËØØ:', error);
            }
        }
        
        // Ëé∑ÂèñÁßØÂàÜÈÖçÁΩÆÂπ∂ÊòæÁ§∫Âú®UI‰∏≠
        function getPointsForAction(actionType) {
            if (!pointsConfig || !pointsConfig[actionType]) {
                return { points: 10, name: 'Êú™Áü•Êìç‰Ωú', description: 'Ëé∑ÂæóÁßØÂàÜ' };
            }
            return pointsConfig[actionType];
        }
        
        // Êõ¥Êñ∞Êìç‰ΩúÊåâÈíÆÁöÑÁßØÂàÜÊòæÁ§∫
        function updateActionPointsDisplay() {
            if (!pointsConfig) return;
            
            // Êõ¥Êñ∞ËßÇÁúãËßÜÈ¢ëÊåâÈíÆ
            const watchVideoConfig = getPointsForAction('watch_video');
            const watchBtn = document.querySelector('[onclick="handleAction(\'watch_video\')"]');
            if (watchBtn) {
                const rewardText = watchBtn.querySelector('.reward');
                if (rewardText) {
                    rewardText.textContent = `+${watchVideoConfig.points}ÁßØÂàÜ`;
                }
            }
            
            // Êõ¥Êñ∞‰∏ãËΩΩÂ∫îÁî®ÊåâÈíÆ
            const downloadConfig = getPointsForAction('download_app');
            const downloadBtn = document.querySelector('[onclick="handleAction(\'download_app\')"]');
            if (downloadBtn) {
                const rewardText = downloadBtn.querySelector('.reward');
                if (rewardText) {
                    rewardText.textContent = `+${downloadConfig.points}ÁßØÂàÜ`;
                }
            }
            
            // Êõ¥Êñ∞ÂÆåÊàê‰ªªÂä°ÊåâÈíÆ
            const taskConfig = getPointsForAction('complete_task');
            const taskBtn = document.querySelector('[onclick="handleAction(\'complete_task\')"]');
            if (taskBtn) {
                const rewardText = taskBtn.querySelector('.reward');
                if (rewardText) {
                    rewardText.textContent = `+${taskConfig.points}ÁßØÂàÜ`;
                }
            }
            
            console.log('‚úÖ Êìç‰ΩúÊåâÈíÆÁßØÂàÜÊòæÁ§∫Â∑≤Êõ¥Êñ∞');
        }
        
        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initializeAuth0();
        });

        // ‰øÆÂ§çÊÑèÂ§ñÊÆãÁïôÁöÑÈ°∂Â±Ç try ‰ª£Á†ÅÂùóÂºïËµ∑ÁöÑÈùûÊ≥ï return
        async function safeLoadPointsConfigOnInit() {
                if (!authToken) {
                    console.log('‚ö†Ô∏è Êú™ÁôªÂΩïÔºåÊó†Ê≥ïËé∑ÂèñÁßØÂàÜÈÖçÁΩÆ');
                return;
            }
            try {
                const response = await fetch(`${API_BASE}/app/points/config`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                if (response.ok) {
                    const result = await response.json();
                    pointsConfig = result.data;
                    console.log('‚úÖ ÁßØÂàÜÈÖçÁΩÆÂ∑≤Âä†ËΩΩ:', pointsConfig);
                    updateActionPointsDisplay();
                } else {
                    console.error('‚ùå Ëé∑ÂèñÁßØÂàÜÈÖçÁΩÆÂ§±Ë¥•:', response.statusText);
                }
            } catch (error) {
                console.error('‚ùå Ëé∑ÂèñÁßØÂàÜÈÖçÁΩÆÈîôËØØ:', error);
            }
        }
        
        // ‰ªéÂêéÁ´ØËé∑ÂèñAdMobÈÖçÁΩÆ
        async function loadAdMobConfig() {
            try {
                if (!authToken) {
                    console.log('‚ö†Ô∏è Êú™ÁôªÂΩïÔºåÊó†Ê≥ïËé∑ÂèñAdMobÈÖçÁΩÆ');
                    return;
                }
                
                const response = await fetch(`${API_BASE}/app/admob/config`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    admobConfig = result.data;
                    console.log('‚úÖ AdMobÈÖçÁΩÆÂ∑≤Âä†ËΩΩ:', admobConfig);
                    
                    // ÂàùÂßãÂåñÂπøÂëä
                    if (typeof initializeAds === 'function') {
                        initializeAds();
                    }
                } else {
                    console.error('‚ùå Ëé∑ÂèñAdMobÈÖçÁΩÆÂ§±Ë¥•:', response.statusText);
                }
            } catch (error) {
                console.error('‚ùå Ëé∑ÂèñAdMobÈÖçÁΩÆÈîôËØØ:', error);
            }
        }
        
        // Ëé∑ÂèñÁßØÂàÜÈÖçÁΩÆÂπ∂ÊòæÁ§∫Âú®UI‰∏≠
        function getPointsForAction(actionType) {
            if (!pointsConfig || !pointsConfig[actionType]) {
                return { points: 10, name: 'Êú™Áü•Êìç‰Ωú', description: 'Ëé∑ÂæóÁßØÂàÜ' };
            }
            return pointsConfig[actionType];
        }
        
        // Êõ¥Êñ∞Êìç‰ΩúÊåâÈíÆÁöÑÁßØÂàÜÊòæÁ§∫
        function updateActionPointsDisplay() {
            if (!pointsConfig) return;
            
            // Êõ¥Êñ∞ËßÇÁúãËßÜÈ¢ëÊåâÈíÆ
            const watchVideoConfig = getPointsForAction('watch_video');
            const watchBtn = document.querySelector('[onclick="handleAction(\'watch_video\')"]');
            if (watchBtn) {
                const rewardText = watchBtn.querySelector('.reward');
                if (rewardText) {
                    rewardText.textContent = `+${watchVideoConfig.points}ÁßØÂàÜ`;
                }
            }
            
            // Êõ¥Êñ∞‰∏ãËΩΩÂ∫îÁî®ÊåâÈíÆ
            const downloadConfig = getPointsForAction('download_app');
            const downloadBtn = document.querySelector('[onclick="handleAction(\'download_app\')"]');
            if (downloadBtn) {
                const rewardText = downloadBtn.querySelector('.reward');
                if (rewardText) {
                    rewardText.textContent = `+${downloadConfig.points}ÁßØÂàÜ`;
                }
            }
            
            // Êõ¥Êñ∞ÂÆåÊàê‰ªªÂä°ÊåâÈíÆ
            const taskConfig = getPointsForAction('complete_task');
            const taskBtn = document.querySelector('[onclick="handleAction(\'complete_task\')"]');
            if (taskBtn) {
                const rewardText = taskBtn.querySelector('.reward');
                if (rewardText) {
                    rewardText.textContent = `+${taskConfig.points}ÁßØÂàÜ`;
                }
            }
            
            console.log('‚úÖ Êìç‰ΩúÊåâÈíÆÁßØÂàÜÊòæÁ§∫Â∑≤Êõ¥Êñ∞');
        }

        // ===================== ÁßØÂàÜÂ¢ûÂº∫ÂäüËÉΩ =====================

        // Ê£ÄÊü•ÁßØÂàÜËøáÊúü
        async function checkPointsExpiration() {
            if (!isLoggedIn || !currentUser) return;
            
            try {
                const response = await fetch(`${API_BASE}/points/check-expiration`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ userId: currentUser.id })
                });
                
                const result = await response.json();
                
                if (result.success && result.data.expiredPoints > 0) {
                    showMessage(`Êúâ ${result.data.expiredPoints} ÁßØÂàÜÂ∑≤ËøáÊúü`, 'warning');
                    // Êõ¥Êñ∞Áî®Êà∑ÁßØÂàÜÊòæÁ§∫
                    currentUser.points = result.data.newBalance;
                    updateUserInterface();
                }
            } catch (error) {
                // ÈùôÈªòÂ§ÑÁêÜÈîôËØØ
            }
        }

        // ÊòæÁ§∫ÁßØÂàÜÂïÜÂüé
        function showPointsShop() {
            if (!isLoggedIn || !currentUser) {
                showLoginModal();
                return;
            }
            
            // ÈöêËóèÊâÄÊúâËßÜÂõæ
            document.querySelectorAll('.view').forEach(view => { view.style.display = 'none'; });
            const txn = document.getElementById('transactionView');
            if (txn) txn.style.display = 'none';
            const userCard = document.querySelector('.user-card');
            const actionGrid = document.querySelector('.action-grid');
            if (userCard) userCard.style.display = 'none';
            if (actionGrid) actionGrid.style.display = 'none';
            
            // ÊòæÁ§∫ÁßØÂàÜÂïÜÂüé
            const shopView = document.getElementById('pointsShopView');
            if (!shopView) {
                createPointsShopView();
            } else {
                shopView.style.display = 'block';
                loadShopItems();
            }
            
            currentView = 'shop';
            if (typeof updateNavigation === 'function') {
                updateNavigation();
            } else {
                // ÂõûÈÄÄÔºöÈ´ò‰∫ÆÂ∫ïÈÉ®‚ÄúËÆ∞ÂΩï‚ÄùÊåâÈíÆ
                updateNavActive('transaction');
            }
        }

        // ÂàõÂª∫ÁßØÂàÜÂïÜÂüéËßÜÂõæ
        function createPointsShopView() {
            const container = document.querySelector('.phone-container');
            const shopView = document.createElement('div');
            shopView.id = 'pointsShopView';
            shopView.className = 'view';
            shopView.innerHTML = `
                <div class="view-header">
                    <button class="back-btn" onclick="showHomeView()">‚Üê ËøîÂõû</button>
                    <h2>ÁßØÂàÜÂïÜÂüé</h2>
                    <div class="user-points">
                        <span id="shopPointsDisplay">${currentUser.points}</span> ÁßØÂàÜ
                    </div>
                </div>
                
                <div class="shop-content">
                    <div class="shop-categories">
                        <button class="category-btn active" onclick="filterShopItems('all')">ÂÖ®ÈÉ®</button>
                        <button class="category-btn" onclick="filterShopItems('virtual')">ËôöÊãüÂïÜÂìÅ</button>
                        <button class="category-btn" onclick="filterShopItems('physical')">ÂÆûÁâ©ÂïÜÂìÅ</button>
                        <button class="category-btn" onclick="filterShopItems('coupon')">‰ºòÊÉ†Âà∏</button>
                    </div>
                    
                    <div id="shopItemsContainer" class="shop-items">
                        <!-- ÂïÜÂìÅÂàóË°®Â∞ÜÂä®ÊÄÅÂä†ËΩΩ -->
                    </div>
                </div>
            `;
            
            container.appendChild(shopView);
            loadShopItems();
        }

        // Âä†ËΩΩÂïÜÂüéÂïÜÂìÅ
        async function loadShopItems() {
            try {
                const response = await fetch(`${API_BASE}/shop/items`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    renderShopItems(result.data);
                }
            } catch (error) {
                showMessage('Âä†ËΩΩÂïÜÂìÅÂ§±Ë¥•', 'error');
            }
        }

        // Ê∏≤ÊüìÂïÜÂüéÂïÜÂìÅ
        function renderShopItems(items) {
            const container = document.getElementById('shopItemsContainer');
            container.innerHTML = items.map(item => `
                <div class="shop-item ${item.stock <= 0 ? 'out-of-stock' : ''}" data-category="${item.category}">
                    <div class="item-image">
                        <img src="${item.image || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjRjNGNEY2Ii8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSIjNjY2IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7llYblkZU8L3RleHQ+Cjwvc3ZnPg=='}" alt="${item.name}">
                        ${item.discount ? `<div class="discount-badge">-${item.discount}%</div>` : ''}
                    </div>
                    <div class="item-info">
                        <h3 class="item-name">${item.name}</h3>
                        <p class="item-description">${item.description}</p>
                        <div class="item-footer">
                            <div class="item-price">
                                <span class="price">${item.price}</span> ÁßØÂàÜ
                                ${item.originalPrice ? `<span class="original-price">${item.originalPrice}</span>` : ''}
                            </div>
                            <button class="buy-btn" onclick="buyShopItem('${item.id}')" ${item.stock <= 0 ? 'disabled' : ''}>
                                ${item.stock <= 0 ? 'Áº∫Ë¥ß' : 'ÂÖëÊç¢'}
                            </button>
                        </div>
                        <div class="item-stock">Â∫ìÂ≠ò: ${item.stock}</div>
                    </div>
                </div>
            `).join('');
        }

        // Á≠õÈÄâÂïÜÂìÅ
        function filterShopItems(category) {
            // Êõ¥Êñ∞ÂàÜÁ±ªÊåâÈíÆÁä∂ÊÄÅ
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ÊòæÁ§∫/ÈöêËóèÂïÜÂìÅ
            document.querySelectorAll('.shop-item').forEach(item => {
                if (category === 'all' || item.dataset.category === category) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Ë¥≠‰π∞ÂïÜÂìÅ
        async function buyShopItem(itemId) {
            try {
                const response = await fetch(`${API_BASE}/shop/buy`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        userId: currentUser.id,
                        itemId: itemId
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('ÂÖëÊç¢ÊàêÂäüÔºÅ', 'success');
                    // Êõ¥Êñ∞Áî®Êà∑ÁßØÂàÜ
                    currentUser.points = result.data.newBalance;
                    document.getElementById('shopPointsDisplay').textContent = currentUser.points;
                    updateUserInterface();
                    // ÈáçÊñ∞Âä†ËΩΩÂïÜÂìÅÂàóË°®
                    loadShopItems();
                } else {
                    showMessage(result.message || 'ÂÖëÊç¢Â§±Ë¥•', 'error');
                }
            } catch (error) {
                showMessage('ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï', 'error');
            }
        }

        // ÊòæÁ§∫ÁßØÂàÜËΩ¨Ëµ†ÁïåÈù¢
        function showPointsTransfer() {
            if (!isLoggedIn || !currentUser) {
                showLoginModal();
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'transfer-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ÁßØÂàÜËΩ¨Ëµ†</h3>
                        <button class="close-btn" onclick="closeTransferModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="current-points">
                            ÂΩìÂâçÁßØÂàÜ: <span>${currentUser.points}</span>
                        </div>
                        <form onsubmit="handlePointsTransfer(event)">
                            <div class="form-group">
                                <label>Êé•Êî∂‰∫∫ÈÇÆÁÆ±/Áî®Êà∑ID</label>
                                <input type="text" id="transferRecipient" placeholder="ËØ∑ËæìÂÖ•Êé•Êî∂‰∫∫ÈÇÆÁÆ±ÊàñÁî®Êà∑ID" required>
                            </div>
                            <div class="form-group">
                                <label>ËΩ¨Ëµ†ÁßØÂàÜ</label>
                                <input type="number" id="transferAmount" placeholder="ËØ∑ËæìÂÖ•ËΩ¨Ëµ†ÁßØÂàÜÊï∞Èáè" min="1" max="${currentUser.points}" required>
                            </div>
                            <div class="form-group">
                                <label>ËΩ¨Ëµ†ÁïôË®Ä (ÂèØÈÄâ)</label>
                                <textarea id="transferMessage" placeholder="ÁïôË®ÄÁªôÂØπÊñπ..."></textarea>
                            </div>
                            <div class="form-note">
                                <p>‚Ä¢ ÊØèÊó•ÊúÄÂ§öËΩ¨Ëµ† 5 Ê¨°</p>
                                <p>‚Ä¢ ÂçïÊ¨°ÊúÄÂ∞ëËΩ¨Ëµ† 100 ÁßØÂàÜ</p>
                                <p>‚Ä¢ ËΩ¨Ëµ†‰∏çÊî∂ÂèñÊâãÁª≠Ë¥π</p>
                            </div>
                            <button type="submit" class="transfer-btn">Á°ÆËÆ§ËΩ¨Ëµ†</button>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Â§ÑÁêÜÁßØÂàÜËΩ¨Ëµ†
        async function handlePointsTransfer(event) {
            event.preventDefault();
            
            const recipient = document.getElementById('transferRecipient').value;
            const amount = parseInt(document.getElementById('transferAmount').value);
            const message = document.getElementById('transferMessage').value;
            
            if (amount < 100) {
                showMessage('ÂçïÊ¨°ÊúÄÂ∞ëËΩ¨Ëµ† 100 ÁßØÂàÜ', 'error');
                return;
            }
            
            if (amount > currentUser.points) {
                showMessage('ÁßØÂàÜ‰ΩôÈ¢ù‰∏çË∂≥', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/points/transfer`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        fromUserId: currentUser.id,
                        toUserIdentifier: recipient,
                        amount: amount,
                        message: message
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('ËΩ¨Ëµ†ÊàêÂäüÔºÅ', 'success');
                    // Êõ¥Êñ∞Áî®Êà∑ÁßØÂàÜ
                    currentUser.points = result.data.newBalance;
                    updateUserInterface();
                    closeTransferModal();
                } else {
                    showMessage(result.message || 'ËΩ¨Ëµ†Â§±Ë¥•', 'error');
                }
            } catch (error) {
                showMessage('ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï', 'error');
            }
        }

        // ÂÖ≥Èó≠ËΩ¨Ëµ†Ê®°ÊÄÅÊ°Ü
        function closeTransferModal() {
            const modal = document.querySelector('.transfer-modal');
            if (modal) {
                modal.remove();
            }
        }

        // ÊòæÁ§∫ÊèêÁé∞Áî≥ËØ∑ÁïåÈù¢
        function showWithdrawalRequest() {
            if (!isLoggedIn || !currentUser) {
                showLoginModal();
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'withdrawal-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>üí∞ Áî≥ËØ∑ÊèêÁé∞</h3>
                        <button class="close-btn" onclick="closeWithdrawalModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="balance-info">
                            <div class="balance-title">ÂèØÊèêÁé∞ÁßØÂàÜ</div>
                            <div class="balance-amount">${(currentUser.points || 0).toLocaleString()}</div>
                            <div class="balance-note">1000ÁßØÂàÜ = $1.00</div>
                        </div>
                        
                        <div class="withdrawal-tabs">
                            <button class="tab-btn active" onclick="switchWithdrawalTab('fiat')">Ê≥ïÂ∏ÅÊèêÁé∞</button>
                            <button class="tab-btn" onclick="switchWithdrawalTab('crypto')">Âä†ÂØÜË¥ßÂ∏Å</button>
                        </div>
                        
                        <!-- Ê≥ïÂ∏ÅÊèêÁé∞ -->
                        <div id="fiatWithdrawal" class="withdrawal-form">
                            <div class="form-group">
                                <label>üí∞ ÊèêÁé∞ÈáëÈ¢ù (USD)</label>
                                <div class="amount-input-group">
                                    <span class="currency">$</span>
                                    <input type="number" id="fiatAmount" placeholder="10.00" min="10" step="0.01" oninput="calculateFiatAmount()">
                                </div>
                                <small class="form-help">ÊúÄ‰ΩéÊèêÁé∞ÈáëÈ¢ùÔºö$10.00</small>
                            </div>
                            
                            <div class="form-group">
                                <label>üè¶ ÊèêÁé∞ÊñπÂºè</label>
                                <select id="fiatMethod">
                                    <option value="">ËØ∑ÈÄâÊã©ÊèêÁé∞ÊñπÂºè</option>
                                    <option value="paypal">PayPal</option>
                                    <option value="bank">Èì∂Ë°åËΩ¨Ë¥¶</option>
                                    <option value="alipay">ÊîØ‰ªòÂÆù</option>
                                    <option value="wechat">ÂæÆ‰ø°ÊîØ‰ªò</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>üìß Êî∂Ê¨æË¥¶Êà∑</label>
                                <input type="text" id="fiatAccount" placeholder="ËØ∑ËæìÂÖ•Êî∂Ê¨æË¥¶Êà∑‰ø°ÊÅØ">
                                <small class="form-help">ËØ∑Á°Æ‰øùË¥¶Êà∑‰ø°ÊÅØÂáÜÁ°ÆÊó†ËØØ</small>
                            </div>
                            
                            <div class="withdrawal-summary">
                                <div class="summary-item">
                                    <span>ÊâÄÈúÄÁßØÂàÜÔºö</span>
                                    <span id="fiatPointsNeeded">0</span>
                                </div>
                                <div class="summary-item">
                                    <span>ÊâãÁª≠Ë¥πÔºö</span>
                                    <span>$0.50</span>
                                </div>
                                <div class="summary-item total">
                                    <span>ÂÆûÈôÖÂà∞Ë¥¶Ôºö</span>
                                    <span id="fiatActualAmount">$0.00</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Âä†ÂØÜË¥ßÂ∏ÅÊèêÁé∞ -->
                        <div id="cryptoWithdrawal" class="withdrawal-form" style="display: none;">
                            <div class="form-group">
                                <label>ü™ô ÈÄâÊã©Â∏ÅÁßç</label>
                                <select id="cryptoType" onchange="updateCryptoInfo()">
                                    <option value="">ËØ∑ÈÄâÊã©Âä†ÂØÜË¥ßÂ∏Å</option>
                                    <option value="USDT">USDT (Tether)</option>
                                    <option value="USDC">USDC (USD Coin)</option>
                                    <option value="BTC">BTC (Bitcoin)</option>
                                    <option value="ETH">ETH (Ethereum)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>üí∞ ÊèêÁé∞Êï∞Èáè</label>
                                <div class="amount-input-group">
                                    <input type="number" id="cryptoAmount" placeholder="0.00" step="0.00000001" oninput="calculateCryptoAmount()">
                                    <span class="currency" id="cryptoCurrency">USDT</span>
                                </div>
                                <small class="form-help" id="cryptoMinAmount">ËØ∑ÂÖàÈÄâÊã©Â∏ÅÁßç</small>
                            </div>
                            
                            <div class="form-group">
                                <label>üè† Èí±ÂåÖÂú∞ÂùÄ</label>
                                <input type="text" id="walletAddress" placeholder="ËØ∑ËæìÂÖ•Èí±ÂåÖÂú∞ÂùÄ">
                                <small class="form-help" id="cryptoNetwork">ËØ∑Á°Æ‰øùÂú∞ÂùÄÊ≠£Á°Æ</small>
                            </div>
                            
                            <div class="withdrawal-summary">
                                <div class="summary-item">
                                    <span>ÊâÄÈúÄÁßØÂàÜÔºö</span>
                                    <span id="cryptoPointsNeeded">0</span>
                                </div>
                                <div class="summary-item">
                                    <span>ÊâãÁª≠Ë¥πÔºö</span>
                                    <span id="cryptoFee">0</span>
                                </div>
                                <div class="summary-item total">
                                    <span>ÂÆûÈôÖÂà∞Ë¥¶Ôºö</span>
                                    <span id="cryptoActualAmount">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeWithdrawalModal()">ÂèñÊ∂à</button>
                        <button class="btn btn-primary" onclick="submitWithdrawal()">Êèê‰∫§Áî≥ËØ∑</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // ÂàáÊç¢ÊèêÁé∞Á±ªÂûã
        function switchWithdrawalTab(type) {
            // Êõ¥Êñ∞Ê†áÁ≠æÈ°µÁä∂ÊÄÅ
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // ÊòæÁ§∫ÂØπÂ∫îË°®Âçï
            if (type === 'fiat') {
                document.getElementById('fiatWithdrawal').style.display = 'block';
                document.getElementById('cryptoWithdrawal').style.display = 'none';
            } else {
                document.getElementById('fiatWithdrawal').style.display = 'none';
                document.getElementById('cryptoWithdrawal').style.display = 'block';
            }
        }

        // ËÆ°ÁÆóÊ≥ïÂ∏ÅÊèêÁé∞ÈáëÈ¢ù
        function calculateFiatAmount() {
            const amount = parseFloat(document.getElementById('fiatAmount').value) || 0;
            const pointsNeeded = amount * 1000;
            const actualAmount = Math.max(0, amount - 0.50);
            
            document.getElementById('fiatPointsNeeded').textContent = pointsNeeded.toLocaleString();
            document.getElementById('fiatActualAmount').textContent = `$${actualAmount.toFixed(2)}`;
        }

        // Êõ¥Êñ∞Âä†ÂØÜË¥ßÂ∏Å‰ø°ÊÅØ
        function updateCryptoInfo() {
            const cryptoType = document.getElementById('cryptoType').value;
            const currencySpan = document.getElementById('cryptoCurrency');
            const minAmountHelp = document.getElementById('cryptoMinAmount');
            const networkHelp = document.getElementById('cryptoNetwork');
            
            const cryptoInfo = {
                'USDT': { symbol: 'USDT', minAmount: 10, network: 'TRC20ÁΩëÁªú', fee: '1 USDT', rate: 100 },
                'USDC': { symbol: 'USDC', minAmount: 10, network: 'ERC20ÁΩëÁªú', fee: '2 USDC', rate: 100 },
                'BTC': { symbol: 'BTC', minAmount: 0.001, network: 'BitcoinÁΩëÁªú', fee: '0.0001 BTC', rate: 6500000 },
                'ETH': { symbol: 'ETH', minAmount: 0.01, network: 'EthereumÁΩëÁªú', fee: '0.002 ETH', rate: 350000 }
            };
            
            if (cryptoType && cryptoInfo[cryptoType]) {
                const info = cryptoInfo[cryptoType];
                currencySpan.textContent = info.symbol;
                minAmountHelp.textContent = `ÊúÄ‰ΩéÊèêÁé∞Ôºö${info.minAmount} ${info.symbol}`;
                networkHelp.textContent = `${info.network} - ËØ∑Á°Æ‰øùÂú∞ÂùÄÊ≠£Á°Æ`;
                
                // ÈáçÁΩÆËÆ°ÁÆó
                calculateCryptoAmount();
            } else {
                currencySpan.textContent = '';
                minAmountHelp.textContent = 'ËØ∑ÂÖàÈÄâÊã©Â∏ÅÁßç';
                networkHelp.textContent = 'ËØ∑Á°Æ‰øùÂú∞ÂùÄÊ≠£Á°Æ';
            }
        }

        // ËÆ°ÁÆóÂä†ÂØÜË¥ßÂ∏ÅÊèêÁé∞ÈáëÈ¢ù
        function calculateCryptoAmount() {
            const cryptoType = document.getElementById('cryptoType').value;
            const amount = parseFloat(document.getElementById('cryptoAmount').value) || 0;
            
            const cryptoInfo = {
                'USDT': { fee: 1, rate: 100 },
                'USDC': { fee: 2, rate: 100 },
                'BTC': { fee: 0.0001, rate: 6500000 },
                'ETH': { fee: 0.002, rate: 350000 }
            };
            
            if (cryptoType && cryptoInfo[cryptoType]) {
                const info = cryptoInfo[cryptoType];
                const pointsNeeded = Math.ceil(amount * info.rate);
                const actualAmount = Math.max(0, amount - info.fee);
                
                document.getElementById('cryptoPointsNeeded').textContent = pointsNeeded.toLocaleString();
                document.getElementById('cryptoFee').textContent = `${info.fee} ${cryptoType}`;
                document.getElementById('cryptoActualAmount').textContent = `${actualAmount.toFixed(8)} ${cryptoType}`;
            }
        }

        // Êèê‰∫§ÊèêÁé∞Áî≥ËØ∑
        async function submitWithdrawal() {
            const activeTab = document.querySelector('.tab-btn.active').textContent;
            
            try {
                let requestData;
                
                if (activeTab === 'Ê≥ïÂ∏ÅÊèêÁé∞') {
                    const amount = parseFloat(document.getElementById('fiatAmount').value);
                    const method = document.getElementById('fiatMethod').value;
                    const account = document.getElementById('fiatAccount').value;
                    
                    if (!amount || amount < 10) {
                        showMessage('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÊèêÁé∞ÈáëÈ¢ùÔºàÊúÄ‰Ωé$10Ôºâ', 'error');
                        return;
                    }
                    
                    if (!method) {
                        showMessage('ËØ∑ÈÄâÊã©ÊèêÁé∞ÊñπÂºè', 'error');
                        return;
                    }
                    
                    if (!account) {
                        showMessage('ËØ∑ËæìÂÖ•Êî∂Ê¨æË¥¶Êà∑‰ø°ÊÅØ', 'error');
                        return;
                    }
                    
                    requestData = {
                        userId: currentUser.id,
                        amount: amount,
                        method: method,
                        accountInfo: account
                    };
                } else {
                    const cryptoType = document.getElementById('cryptoType').value;
                    const amount = parseFloat(document.getElementById('cryptoAmount').value);
                    const walletAddress = document.getElementById('walletAddress').value;
                    
                    if (!cryptoType) {
                        showMessage('ËØ∑ÈÄâÊã©Âä†ÂØÜË¥ßÂ∏ÅÁ±ªÂûã', 'error');
                        return;
                    }
                    
                    const minAmounts = { 'USDT': 10, 'USDC': 10, 'BTC': 0.001, 'ETH': 0.01 };
                    if (!amount || amount < minAmounts[cryptoType]) {
                        showMessage(`ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÊèêÁé∞Êï∞ÈáèÔºàÊúÄ‰Ωé${minAmounts[cryptoType]} ${cryptoType}Ôºâ`, 'error');
                        return;
                    }
                    
                    if (!walletAddress) {
                        showMessage('ËØ∑ËæìÂÖ•Èí±ÂåÖÂú∞ÂùÄ', 'error');
                        return;
                    }
                    
                    requestData = {
                        userId: currentUser.id,
                        amount: amount,
                        cryptoType: cryptoType,
                        walletAddress: walletAddress
                    };
                }
                
                showMessage('Ê≠£Âú®Êèê‰∫§Áî≥ËØ∑...', 'info');
                
                const response = await fetch(`${API_BASE}/withdrawal/request`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(requestData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('ÊèêÁé∞Áî≥ËØ∑Êèê‰∫§ÊàêÂäüÔºÅ', 'success');
                    // Êõ¥Êñ∞Áî®Êà∑ÁßØÂàÜÊòæÁ§∫
                    currentUser.points = currentUser.points - (activeTab === 'Ê≥ïÂ∏ÅÊèêÁé∞' ? 
                        parseFloat(document.getElementById('fiatAmount').value) * 1000 :
                        Math.ceil(parseFloat(document.getElementById('cryptoAmount').value) * 
                            { 'USDT': 100, 'USDC': 100, 'BTC': 6500000, 'ETH': 350000 }[document.getElementById('cryptoType').value])
                    );
                    updateUserInterface();
                    closeWithdrawalModal();
                } else {
                    showMessage(result.message || 'ÊèêÁé∞Áî≥ËØ∑Â§±Ë¥•', 'error');
                }
            } catch (error) {
                showMessage('ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï', 'error');
            }
        }

        // ÂÖ≥Èó≠ÊèêÁé∞Ê®°ÊÄÅÊ°Ü
        function closeWithdrawalModal() {
            const modal = document.querySelector('.withdrawal-modal');
            if (modal) {
                modal.remove();
            }
        }

        // ===================== ‰ºöÂëòÁ≥ªÁªüÂäüËÉΩ =====================

        // ÊòæÁ§∫‰ºöÂëò‰∏≠ÂøÉ
        function showMembershipCenter() {
            if (!isLoggedIn || !currentUser) {
                showLoginModal();
                return;
            }
            
            // ÈöêËóèÊâÄÊúâËßÜÂõæ
            document.querySelectorAll('.view').forEach(view => {
                view.style.display = 'none';
            });
            
            // ÊòæÁ§∫‰ºöÂëò‰∏≠ÂøÉ
            const membershipView = document.getElementById('membershipView');
            if (!membershipView) {
                createMembershipView();
            } else {
                membershipView.style.display = 'block';
                updateMembershipStatus();
            }
            
            currentView = 'membership';
            if (typeof updateNavigation === 'function') {
                updateNavigation();
            } else {
                updateNavActive('discover');
            }
        }

        // ÂàõÂª∫‰ºöÂëò‰∏≠ÂøÉËßÜÂõæ
        function createMembershipView() {
            const container = document.querySelector('.phone-container');
            const membershipView = document.createElement('div');
            membershipView.id = 'membershipView';
            membershipView.className = 'view';
            membershipView.innerHTML = `
                <div class="view-header">
                    <button class="back-btn" onclick="showHomeView()">‚Üê ËøîÂõû</button>
                    <h2>‰ºöÂëò‰∏≠ÂøÉ</h2>
                </div>
                
                <div class="membership-content">
                    <!-- ÂΩìÂâç‰ºöÂëòÁä∂ÊÄÅ -->
                    <div class="current-membership">
                        <div class="membership-card" id="currentMembershipCard">
                            <div class="membership-icon">üë§</div>
                            <div class="membership-info">
                                <h3 id="currentMembershipName">ÂÖçË¥πÁî®Êà∑</h3>
                                <p id="membershipExpiry">Ê∞∏‰πÖÊúâÊïà</p>
                            </div>
                            <div class="membership-benefits" id="currentBenefits">
                                <span class="benefit-tag">Âü∫Á°ÄÂäüËÉΩ</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ‰ºöÂëòÂ•óÈ§ê -->
                    <div class="membership-plans">
                        <h3>ÂçáÁ∫ß‰ºöÂëò</h3>
                        <div class="plans-grid">
                            <!-- ÈùíÈìú‰ºöÂëò -->
                            <div class="plan-card bronze" onclick="selectMembershipPlan('bronze')">
                                <div class="plan-header">
                                    <div class="plan-icon">ü•â</div>
                                    <h4>ÈùíÈìú‰ºöÂëò</h4>
                                    <div class="plan-badge">ÁÉ≠Èó®</div>
                                </div>
                                <div class="plan-price">
                                    <span class="price">¬•9.9</span>
                                    <span class="period">/Êúà</span>
                                </div>
                                <div class="plan-features">
                                    <div class="feature">‚úì ÁßØÂàÜËé∑Âèñ +10%</div>
                                    <div class="feature">‚úì ÂéªÈô§Ê®™ÂπÖÂπøÂëä</div>
                                    <div class="feature">‚úì ‰∏ìÂ±ûÈùíÈìúÊ∏∏Êàè</div>
                                    <div class="feature">‚úì ‰ºòÂÖàÂÆ¢ÊúçÊîØÊåÅ</div>
                                    <div class="feature">‚úì ÊèêÁé∞ÊâãÁª≠Ë¥π -5%</div>
                                </div>
                                <div class="plan-points">Êàñ 1,000 ÁßØÂàÜ</div>
                            </div>
                            
                            <!-- ÁôΩÈì∂‰ºöÂëò -->
                            <div class="plan-card silver" onclick="selectMembershipPlan('silver')">
                                <div class="plan-header">
                                    <div class="plan-icon">ü•à</div>
                                    <h4>ÁôΩÈì∂‰ºöÂëò</h4>
                                </div>
                                <div class="plan-price">
                                    <span class="price">¬•29.9</span>
                                    <span class="period">/Êúà</span>
                                </div>
                                <div class="plan-features">
                                    <div class="feature">‚úì ÁßØÂàÜËé∑Âèñ +25%</div>
                                    <div class="feature">‚úì ÂÆåÂÖ®Êó†ÂπøÂëä</div>
                                    <div class="feature">‚úì Áã¨ÂÆ∂ÁôΩÈì∂Ê∏∏Êàè</div>
                                    <div class="feature">‚úì VIPÂÆ¢ÊúçÈÄöÈÅì</div>
                                    <div class="feature">‚úì ÊèêÁé∞ÊâãÁª≠Ë¥π -10%</div>
                                    <div class="feature">‚úì ÊäΩÂ•ñ‰∏≠Â•ñÁéá +15%</div>
                                </div>
                                <div class="plan-points">Êàñ 3,000 ÁßØÂàÜ</div>
                            </div>
                            
                            <!-- ÈªÑÈáë‰ºöÂëò -->
                            <div class="plan-card gold featured" onclick="selectMembershipPlan('gold')">
                                <div class="plan-header">
                                    <div class="plan-icon">ü•á</div>
                                    <h4>ÈªÑÈáë‰ºöÂëò</h4>
                                    <div class="plan-badge popular">Êé®Ëçê</div>
                                </div>
                                <div class="plan-price">
                                    <span class="price">¬•59.9</span>
                                    <span class="period">/Êúà</span>
                                </div>
                                <div class="plan-features">
                                    <div class="feature">‚úì ÁßØÂàÜËé∑Âèñ +35%</div>
                                    <div class="feature">‚úì Èõ∂ÂπøÂëä‰ΩìÈ™å</div>
                                    <div class="feature">‚úì Áã¨ÂÆ∂ÈªÑÈáëÂÜÖÂÆπ</div>
                                    <div class="feature">‚úì ‰∏ìÂ±ûÂÆ¢Êà∑ÁªèÁêÜ</div>
                                    <div class="feature">‚úì ÊèêÁé∞ÊâãÁª≠Ë¥π -20%</div>
                                    <div class="feature">‚úì ÊäΩÂ•ñ‰∏≠Â•ñÁéá +25%</div>
                                    <div class="feature">‚úì Êé®ËçêÂ•ñÂä± +50%</div>
                                </div>
                                <div class="plan-points">Êàñ 6,000 ÁßØÂàÜ</div>
                            </div>
                            
                            <!-- ÈíªÁü≥‰ºöÂëò -->
                            <div class="plan-card diamond" onclick="selectMembershipPlan('diamond')">
                                <div class="plan-header">
                                    <div class="plan-icon">üíé</div>
                                    <h4>ÈíªÁü≥‰ºöÂëò</h4>
                                    <div class="plan-badge exclusive">Â∞äË¥µ</div>
                                </div>
                                <div class="plan-price">
                                    <span class="price">¬•99.9</span>
                                    <span class="period">/Êúà</span>
                                </div>
                                <div class="plan-features">
                                    <div class="feature">‚úì ÁßØÂàÜËé∑Âèñ +50%</div>
                                    <div class="feature">‚úì ÂÆåÂÖ®Êó†ÂπøÂëä</div>
                                    <div class="feature">‚úì Áã¨ÂÆ∂ÈíªÁü≥ÂÜÖÂÆπ</div>
                                    <div class="feature">‚úì 24/7‰∏ìÂ±ûÊúçÂä°</div>
                                    <div class="feature">‚úì Èõ∂ÊâãÁª≠Ë¥πÊèêÁé∞</div>
                                    <div class="feature">‚úì ÊäΩÂ•ñ‰∏≠Â•ñÁéá +50%</div>
                                    <div class="feature">‚úì Êé®ËçêÂ•ñÂä± +100%</div>
                                    <div class="feature">‚úì ‰∏ìÂ±ûNFTÂ•ñÂä±</div>
                                </div>
                                <div class="plan-points">Êàñ 10,000 ÁßØÂàÜ</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ‰ºöÂëòÁâπÊùÉËØ¶ÊÉÖ -->
                    <div class="membership-privileges">
                        <h3>‰ºöÂëòÁâπÊùÉËØ¥Êòé</h3>
                        <div class="privileges-list">
                            <div class="privilege-item">
                                <div class="privilege-icon">‚ö°</div>
                                <div class="privilege-info">
                                    <h4>ÁßØÂàÜÂä†Êàê</h4>
                                    <p>‰ºöÂëòÂèØ‰∫´Âèó‰∏çÂêåÁ≠âÁ∫ßÁöÑÁßØÂàÜËé∑ÂèñÂä†ÊàêÔºåËÆ©ÊÇ®Êõ¥Âø´Á¥ØÁßØË¥¢ÂØå</p>
                                </div>
                            </div>
                            <div class="privilege-item">
                                <div class="privilege-icon">üö´</div>
                                <div class="privilege-info">
                                    <h4>Êó†ÂπøÂëä‰ΩìÈ™å</h4>
                                    <p>‰∫´ÂèóÁ∫ØÂáÄÁöÑÂ∫îÁî®‰ΩìÈ™åÔºå‰∏çÂÜçË¢´ÂπøÂëäÊâìÊâ∞</p>
                                </div>
                            </div>
                            <div class="privilege-item">
                                <div class="privilege-icon">üéÆ</div>
                                <div class="privilege-info">
                                    <h4>‰∏ìÂ±ûÊ∏∏Êàè</h4>
                                    <p>Ëß£ÈîÅÈ´òÁ≠âÁ∫ß‰ºöÂëò‰∏ìÂ±ûÁöÑÊ∏∏ÊàèÂíåÂ®±‰πêÂÜÖÂÆπ</p>
                                </div>
                            </div>
                            <div class="privilege-item">
                                <div class="privilege-icon">üí∞</div>
                                <div class="privilege-info">
                                    <h4>ÊèêÁé∞‰ºòÊÉ†</h4>
                                    <p>‰∫´ÂèóÊõ¥‰ΩéÁöÑÊèêÁé∞ÊâãÁª≠Ë¥πÔºåÁîöËá≥Èõ∂ÊâãÁª≠Ë¥π</p>
                                </div>
                            </div>
                            <div class="privilege-item">
                                <div class="privilege-icon">üçÄ</div>
                                <div class="privilege-info">
                                    <h4>ÊäΩÂ•ñÂä†Êàê</h4>
                                    <p>ÊèêÈ´òÊäΩÂ•ñ‰∏≠Â•ñÊ¶ÇÁéáÔºåËé∑ÂæóÊõ¥Â§öÊÑèÂ§ñÊÉäÂñú</p>
                                </div>
                            </div>
                            <div class="privilege-item">
                                <div class="privilege-icon">üë•</div>
                                <div class="privilege-info">
                                    <h4>Êé®ËçêÂ•ñÂä±</h4>
                                    <p>ÈÇÄËØ∑Â•ΩÂèãÂèØËé∑ÂæóÊõ¥È´òÁöÑÊé®ËçêÂ•ñÂä±</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            container.appendChild(membershipView);
            updateMembershipStatus();
        }

        // Êõ¥Êñ∞‰ºöÂëòÁä∂ÊÄÅÊòæÁ§∫
        function updateMembershipStatus() {
            if (!currentUser) return;
            
            const membershipLevels = {
                'basic': { name: 'ÂÖçË¥πÁî®Êà∑', icon: 'üë§', class: 'free' },
                'bronze': { name: 'ÈùíÈìú‰ºöÂëò', icon: 'ü•â', class: 'bronze' },
                'silver': { name: 'ÁôΩÈì∂‰ºöÂëò', icon: 'ü•à', class: 'silver' },
                'gold': { name: 'ÈªÑÈáë‰ºöÂëò', icon: 'ü•á', class: 'gold' },
                'diamond': { name: 'ÈíªÁü≥‰ºöÂëò', icon: 'üíé', class: 'diamond' }
            };
            
            const currentLevel = currentUser.membership_level || 'basic';
            const membership = membershipLevels[currentLevel];
            
            const card = document.getElementById('currentMembershipCard');
            const nameEl = document.getElementById('currentMembershipName');
            const iconEl = card.querySelector('.membership-icon');
            
            if (card && nameEl && iconEl) {
                card.className = `membership-card ${membership.class}`;
                nameEl.textContent = membership.name;
                iconEl.textContent = membership.icon;
            }
        }

        // ÈÄâÊã©‰ºöÂëòÂ•óÈ§ê
        function selectMembershipPlan(level) {
            showMembershipUpgradeModal(level);
        }

        // ÊòæÁ§∫‰ºöÂëòÂçáÁ∫ßÊ®°ÊÄÅÊ°Ü
        function showMembershipUpgradeModal(level) {
            const plans = {
                'bronze': { name: 'ÈùíÈìú‰ºöÂëò', price: 9.9, points: 1000, icon: 'ü•â' },
                'silver': { name: 'ÁôΩÈì∂‰ºöÂëò', price: 29.9, points: 3000, icon: 'ü•à' },
                'gold': { name: 'ÈªÑÈáë‰ºöÂëò', price: 59.9, points: 6000, icon: 'ü•á' },
                'diamond': { name: 'ÈíªÁü≥‰ºöÂëò', price: 99.9, points: 10000, icon: 'üíé' }
            };
            
            const plan = plans[level];
            if (!plan) return;
            
            // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÊòØËØ•Á≠âÁ∫ßÊàñÊõ¥È´òÁ≠âÁ∫ß
            const currentLevel = currentUser.membership_level || 'basic';
            const levelOrder = ['basic', 'bronze', 'silver', 'gold', 'diamond'];
            if (levelOrder.indexOf(currentLevel) >= levelOrder.indexOf(level)) {
                showMessage('ÊÇ®Â∑≤ÁªèÊòØËØ•Á≠âÁ∫ßÊàñÊõ¥È´òÁ≠âÁ∫ßÁöÑ‰ºöÂëò', 'error');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'membership-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>${plan.icon} ÂçáÁ∫ßÂà∞${plan.name}</h3>
                        <button class="close-btn" onclick="closeMembershipModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="upgrade-plan-info">
                            <div class="plan-summary">
                                <div class="plan-title">${plan.name}</div>
                                <div class="plan-duration">1‰∏™ÊúàÊúâÊïàÊúü</div>
                            </div>
                        </div>
                        
                        <div class="payment-methods">
                            <h4>ÈÄâÊã©ÊîØ‰ªòÊñπÂºè</h4>
                            <div class="payment-options">
                                <label class="payment-option">
                                    <input type="radio" name="payment" value="points" checked>
                                    <div class="option-content">
                                        <div class="option-icon">üí∞</div>
                                        <div class="option-info">
                                            <div class="option-title">ÁßØÂàÜÊîØ‰ªò</div>
                                            <div class="option-price">${plan.points.toLocaleString()} ÁßØÂàÜ</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="payment-option">
                                    <input type="radio" name="payment" value="money">
                                    <div class="option-content">
                                        <div class="option-icon">üí≥</div>
                                        <div class="option-info">
                                            <div class="option-title">Áé∞ÈáëÊîØ‰ªò</div>
                                            <div class="option-price">¬•${plan.price}</div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <div class="upgrade-benefits">
                            <h4>ÂçáÁ∫ßÂêéÊÇ®Â∞ÜËé∑Âæó</h4>
                            <div class="benefits-list" id="upgradeBenefits">
                                <!-- Âä®ÊÄÅÁîüÊàêÊùÉÁõäÂàóË°® -->
                            </div>
                        </div>
                        
                        <div class="balance-check">
                            <div class="balance-info">
                                <span>ÂΩìÂâçÁßØÂàÜ:</span>
                                <span>${(currentUser.points || 0).toLocaleString()}</span>
                            </div>
                            <div class="balance-status" id="balanceStatus">
                                ${(currentUser.points || 0) >= plan.points ? 
                                    '<span class="sufficient">‚úì ÁßØÂàÜÂÖÖË∂≥</span>' : 
                                    '<span class="insufficient">‚úó ÁßØÂàÜ‰∏çË∂≥</span>'}
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeMembershipModal()">ÂèñÊ∂à</button>
                        <button class="btn btn-primary" onclick="confirmMembershipUpgrade('${level}')">Á°ÆËÆ§ÂçáÁ∫ß</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Êõ¥Êñ∞ÊùÉÁõäÂàóË°®
            updateUpgradeBenefits(level);
        }

        // Êõ¥Êñ∞ÂçáÁ∫ßÊùÉÁõäÊòæÁ§∫
        function updateUpgradeBenefits(level) {
            const benefits = {
                'bronze': ['ÁßØÂàÜËé∑Âèñ +10%', 'ÂéªÈô§Ê®™ÂπÖÂπøÂëä', '‰∏ìÂ±ûÈùíÈìúÊ∏∏Êàè', '‰ºòÂÖàÂÆ¢ÊúçÊîØÊåÅ', 'ÊèêÁé∞ÊâãÁª≠Ë¥π -5%'],
                'silver': ['ÁßØÂàÜËé∑Âèñ +25%', 'ÂÆåÂÖ®Êó†ÂπøÂëä', 'Áã¨ÂÆ∂ÁôΩÈì∂Ê∏∏Êàè', 'VIPÂÆ¢ÊúçÈÄöÈÅì', 'ÊèêÁé∞ÊâãÁª≠Ë¥π -10%', 'ÊäΩÂ•ñ‰∏≠Â•ñÁéá +15%'],
                'gold': ['ÁßØÂàÜËé∑Âèñ +35%', 'Èõ∂ÂπøÂëä‰ΩìÈ™å', 'Áã¨ÂÆ∂ÈªÑÈáëÂÜÖÂÆπ', '‰∏ìÂ±ûÂÆ¢Êà∑ÁªèÁêÜ', 'ÊèêÁé∞ÊâãÁª≠Ë¥π -20%', 'ÊäΩÂ•ñ‰∏≠Â•ñÁéá +25%', 'Êé®ËçêÂ•ñÂä± +50%'],
                'diamond': ['ÁßØÂàÜËé∑Âèñ +50%', 'ÂÆåÂÖ®Êó†ÂπøÂëä', 'Áã¨ÂÆ∂ÈíªÁü≥ÂÜÖÂÆπ', '24/7‰∏ìÂ±ûÊúçÂä°', 'Èõ∂ÊâãÁª≠Ë¥πÊèêÁé∞', 'ÊäΩÂ•ñ‰∏≠Â•ñÁéá +50%', 'Êé®ËçêÂ•ñÂä± +100%', '‰∏ìÂ±ûNFTÂ•ñÂä±']
            };
            
            const benefitsList = document.getElementById('upgradeBenefits');
            if (benefitsList && benefits[level]) {
                benefitsList.innerHTML = benefits[level].map(benefit => 
                    `<div class="benefit-item">‚úì ${benefit}</div>`
                ).join('');
            }
        }

        // Á°ÆËÆ§‰ºöÂëòÂçáÁ∫ß
        async function confirmMembershipUpgrade(level) {
            const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
            
            try {
                showMessage('Ê≠£Âú®Â§ÑÁêÜÂçáÁ∫ß...', 'info');
                
                const response = await fetch(`${API_BASE}/membership/upgrade`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        userId: currentUser.id,
                        level: level,
                        paymentMethod: paymentMethod
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('‰ºöÂëòÂçáÁ∫ßÊàêÂäüÔºÅ', 'success');
                    // Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØ
                    currentUser.membership_level = level;
                    if (paymentMethod === 'points') {
                        currentUser.points = result.data.newBalance;
                    }
                    updateUserInterface();
                    updateMembershipStatus();
                    closeMembershipModal();
                } else {
                    showMessage(result.message || 'ÂçáÁ∫ßÂ§±Ë¥•', 'error');
                }
            } catch (error) {
                showMessage('ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï', 'error');
            }
        }

        // ÂÖ≥Èó≠‰ºöÂëòÊ®°ÊÄÅÊ°Ü
        function closeMembershipModal() {
            const modal = document.querySelector('.membership-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üì± DOMÂä†ËΩΩÂÆåÊàêÔºåÂàùÂßãÂåñAPP');
            initializeAuth0();
        });

    </script>
</body>
</html>